var Ez=Object.defineProperty;var Tz=(l,u,f)=>u in l?Ez(l,u,{enumerable:!0,configurable:!0,writable:!0,value:f}):l[u]=f;var lc=(l,u,f)=>(Tz(l,typeof u!="symbol"?u+"":u,f),f);(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))y(b);new MutationObserver(b=>{for(const C of b)if(C.type==="childList")for(const P of C.addedNodes)P.tagName==="LINK"&&P.rel==="modulepreload"&&y(P)}).observe(document,{childList:!0,subtree:!0});function f(b){const C={};return b.integrity&&(C.integrity=b.integrity),b.referrerPolicy&&(C.referrerPolicy=b.referrerPolicy),b.crossOrigin==="use-credentials"?C.credentials="include":b.crossOrigin==="anonymous"?C.credentials="omit":C.credentials="same-origin",C}function y(b){if(b.ep)return;b.ep=!0;const C=f(b);fetch(b.href,C)}})();var Rd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Iv(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var _D={exports:{}},Bv={},yD={exports:{}},Wn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var I_=Symbol.for("react.element"),Cz=Symbol.for("react.portal"),Sz=Symbol.for("react.fragment"),Mz=Symbol.for("react.strict_mode"),Iz=Symbol.for("react.profiler"),Bz=Symbol.for("react.provider"),Dz=Symbol.for("react.context"),Pz=Symbol.for("react.forward_ref"),Lz=Symbol.for("react.suspense"),Rz=Symbol.for("react.memo"),kz=Symbol.for("react.lazy"),qI=Symbol.iterator;function Fz(l){return l===null||typeof l!="object"?null:(l=qI&&l[qI]||l["@@iterator"],typeof l=="function"?l:null)}var xD={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},vD=Object.assign,wD={};function sp(l,u,f){this.props=l,this.context=u,this.refs=wD,this.updater=f||xD}sp.prototype.isReactComponent={};sp.prototype.setState=function(l,u){if(typeof l!="object"&&typeof l!="function"&&l!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,l,u,"setState")};sp.prototype.forceUpdate=function(l){this.updater.enqueueForceUpdate(this,l,"forceUpdate")};function bD(){}bD.prototype=sp.prototype;function QE(l,u,f){this.props=l,this.context=u,this.refs=wD,this.updater=f||xD}var tT=QE.prototype=new bD;tT.constructor=QE;vD(tT,sp.prototype);tT.isPureReactComponent=!0;var JI=Array.isArray,AD=Object.prototype.hasOwnProperty,eT={current:null},ED={key:!0,ref:!0,__self:!0,__source:!0};function TD(l,u,f){var y,b={},C=null,P=null;if(u!=null)for(y in u.ref!==void 0&&(P=u.ref),u.key!==void 0&&(C=""+u.key),u)AD.call(u,y)&&!ED.hasOwnProperty(y)&&(b[y]=u[y]);var O=arguments.length-2;if(O===1)b.children=f;else if(1<O){for(var F=Array(O),k=0;k<O;k++)F[k]=arguments[k+2];b.children=F}if(l&&l.defaultProps)for(y in O=l.defaultProps,O)b[y]===void 0&&(b[y]=O[y]);return{$$typeof:I_,type:l,key:C,ref:P,props:b,_owner:eT.current}}function zz(l,u){return{$$typeof:I_,type:l.type,key:u,ref:l.ref,props:l.props,_owner:l._owner}}function nT(l){return typeof l=="object"&&l!==null&&l.$$typeof===I_}function Oz(l){var u={"=":"=0",":":"=2"};return"$"+l.replace(/[=:]/g,function(f){return u[f]})}var $I=/\/+/g;function IA(l,u){return typeof l=="object"&&l!==null&&l.key!=null?Oz(""+l.key):u.toString(36)}function Vx(l,u,f,y,b){var C=typeof l;(C==="undefined"||C==="boolean")&&(l=null);var P=!1;if(l===null)P=!0;else switch(C){case"string":case"number":P=!0;break;case"object":switch(l.$$typeof){case I_:case Cz:P=!0}}if(P)return P=l,b=b(P),l=y===""?"."+IA(P,0):y,JI(b)?(f="",l!=null&&(f=l.replace($I,"$&/")+"/"),Vx(b,u,f,"",function(k){return k})):b!=null&&(nT(b)&&(b=zz(b,f+(!b.key||P&&P.key===b.key?"":(""+b.key).replace($I,"$&/")+"/")+l)),u.push(b)),1;if(P=0,y=y===""?".":y+":",JI(l))for(var O=0;O<l.length;O++){C=l[O];var F=y+IA(C,O);P+=Vx(C,u,f,F,b)}else if(F=Fz(l),typeof F=="function")for(l=F.call(l),O=0;!(C=l.next()).done;)C=C.value,F=y+IA(C,O++),P+=Vx(C,u,f,F,b);else if(C==="object")throw u=String(l),Error("Objects are not valid as a React child (found: "+(u==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":u)+"). If you meant to render a collection of children, use an array instead.");return P}function Ax(l,u,f){if(l==null)return l;var y=[],b=0;return Vx(l,y,"","",function(C){return u.call(f,C,b++)}),y}function Nz(l){if(l._status===-1){var u=l._result;u=u(),u.then(function(f){(l._status===0||l._status===-1)&&(l._status=1,l._result=f)},function(f){(l._status===0||l._status===-1)&&(l._status=2,l._result=f)}),l._status===-1&&(l._status=0,l._result=u)}if(l._status===1)return l._result.default;throw l._result}var Mo={current:null},Gx={transition:null},Uz={ReactCurrentDispatcher:Mo,ReactCurrentBatchConfig:Gx,ReactCurrentOwner:eT};Wn.Children={map:Ax,forEach:function(l,u,f){Ax(l,function(){u.apply(this,arguments)},f)},count:function(l){var u=0;return Ax(l,function(){u++}),u},toArray:function(l){return Ax(l,function(u){return u})||[]},only:function(l){if(!nT(l))throw Error("React.Children.only expected to receive a single React element child.");return l}};Wn.Component=sp;Wn.Fragment=Sz;Wn.Profiler=Iz;Wn.PureComponent=QE;Wn.StrictMode=Mz;Wn.Suspense=Lz;Wn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Uz;Wn.cloneElement=function(l,u,f){if(l==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+l+".");var y=vD({},l.props),b=l.key,C=l.ref,P=l._owner;if(u!=null){if(u.ref!==void 0&&(C=u.ref,P=eT.current),u.key!==void 0&&(b=""+u.key),l.type&&l.type.defaultProps)var O=l.type.defaultProps;for(F in u)AD.call(u,F)&&!ED.hasOwnProperty(F)&&(y[F]=u[F]===void 0&&O!==void 0?O[F]:u[F])}var F=arguments.length-2;if(F===1)y.children=f;else if(1<F){O=Array(F);for(var k=0;k<F;k++)O[k]=arguments[k+2];y.children=O}return{$$typeof:I_,type:l.type,key:b,ref:C,props:y,_owner:P}};Wn.createContext=function(l){return l={$$typeof:Dz,_currentValue:l,_currentValue2:l,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},l.Provider={$$typeof:Bz,_context:l},l.Consumer=l};Wn.createElement=TD;Wn.createFactory=function(l){var u=TD.bind(null,l);return u.type=l,u};Wn.createRef=function(){return{current:null}};Wn.forwardRef=function(l){return{$$typeof:Pz,render:l}};Wn.isValidElement=nT;Wn.lazy=function(l){return{$$typeof:kz,_payload:{_status:-1,_result:l},_init:Nz}};Wn.memo=function(l,u){return{$$typeof:Rz,type:l,compare:u===void 0?null:u}};Wn.startTransition=function(l){var u=Gx.transition;Gx.transition={};try{l()}finally{Gx.transition=u}};Wn.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Wn.useCallback=function(l,u){return Mo.current.useCallback(l,u)};Wn.useContext=function(l){return Mo.current.useContext(l)};Wn.useDebugValue=function(){};Wn.useDeferredValue=function(l){return Mo.current.useDeferredValue(l)};Wn.useEffect=function(l,u){return Mo.current.useEffect(l,u)};Wn.useId=function(){return Mo.current.useId()};Wn.useImperativeHandle=function(l,u,f){return Mo.current.useImperativeHandle(l,u,f)};Wn.useInsertionEffect=function(l,u){return Mo.current.useInsertionEffect(l,u)};Wn.useLayoutEffect=function(l,u){return Mo.current.useLayoutEffect(l,u)};Wn.useMemo=function(l,u){return Mo.current.useMemo(l,u)};Wn.useReducer=function(l,u,f){return Mo.current.useReducer(l,u,f)};Wn.useRef=function(l){return Mo.current.useRef(l)};Wn.useState=function(l){return Mo.current.useState(l)};Wn.useSyncExternalStore=function(l,u,f){return Mo.current.useSyncExternalStore(l,u,f)};Wn.useTransition=function(){return Mo.current.useTransition()};Wn.version="18.2.0";yD.exports=Wn;var Pr=yD.exports;const Vz=Iv(Pr);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gz=Pr,jz=Symbol.for("react.element"),Hz=Symbol.for("react.fragment"),Zz=Object.prototype.hasOwnProperty,Wz=Gz.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,qz={key:!0,ref:!0,__self:!0,__source:!0};function CD(l,u,f){var y,b={},C=null,P=null;f!==void 0&&(C=""+f),u.key!==void 0&&(C=""+u.key),u.ref!==void 0&&(P=u.ref);for(y in u)Zz.call(u,y)&&!qz.hasOwnProperty(y)&&(b[y]=u[y]);if(l&&l.defaultProps)for(y in u=l.defaultProps,u)b[y]===void 0&&(b[y]=u[y]);return{$$typeof:jz,type:l,key:C,ref:P,props:b,_owner:Wz.current}}Bv.Fragment=Hz;Bv.jsx=CD;Bv.jsxs=CD;_D.exports=Bv;var un=_D.exports,nE={},SD={exports:{}},hs={},MD={exports:{}},ID={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(l){function u(fe,He){var We=fe.length;fe.push(He);t:for(;0<We;){var hn=We-1>>>1,$t=fe[hn];if(0<b($t,He))fe[hn]=He,fe[We]=$t,We=hn;else break t}}function f(fe){return fe.length===0?null:fe[0]}function y(fe){if(fe.length===0)return null;var He=fe[0],We=fe.pop();if(We!==He){fe[0]=We;t:for(var hn=0,$t=fe.length,Ui=$t>>>1;hn<Ui;){var ci=2*(hn+1)-1,Mi=fe[ci],hi=ci+1,re=fe[hi];if(0>b(Mi,We))hi<$t&&0>b(re,Mi)?(fe[hn]=re,fe[hi]=We,hn=hi):(fe[hn]=Mi,fe[ci]=We,hn=ci);else if(hi<$t&&0>b(re,We))fe[hn]=re,fe[hi]=We,hn=hi;else break t}}return He}function b(fe,He){var We=fe.sortIndex-He.sortIndex;return We!==0?We:fe.id-He.id}if(typeof performance=="object"&&typeof performance.now=="function"){var C=performance;l.unstable_now=function(){return C.now()}}else{var P=Date,O=P.now();l.unstable_now=function(){return P.now()-O}}var F=[],k=[],ot=1,ft=null,X=3,zt=!1,Lt=!1,Ht=!1,we=typeof setTimeout=="function"?setTimeout:null,mt=typeof clearTimeout=="function"?clearTimeout:null,at=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function xt(fe){for(var He=f(k);He!==null;){if(He.callback===null)y(k);else if(He.startTime<=fe)y(k),He.sortIndex=He.expirationTime,u(F,He);else break;He=f(k)}}function It(fe){if(Ht=!1,xt(fe),!Lt)if(f(F)!==null)Lt=!0,Bo(Xt);else{var He=f(k);He!==null&&si(It,He.startTime-fe)}}function Xt(fe,He){Lt=!1,Ht&&(Ht=!1,mt(me),me=-1),zt=!0;var We=X;try{for(xt(He),ft=f(F);ft!==null&&(!(ft.expirationTime>He)||fe&&!Re());){var hn=ft.callback;if(typeof hn=="function"){ft.callback=null,X=ft.priorityLevel;var $t=hn(ft.expirationTime<=He);He=l.unstable_now(),typeof $t=="function"?ft.callback=$t:ft===f(F)&&y(F),xt(He)}else y(F);ft=f(F)}if(ft!==null)var Ui=!0;else{var ci=f(k);ci!==null&&si(It,ci.startTime-He),Ui=!1}return Ui}finally{ft=null,X=We,zt=!1}}var ue=!1,oe=null,me=-1,Nn=5,nt=-1;function Re(){return!(l.unstable_now()-nt<Nn)}function ds(){if(oe!==null){var fe=l.unstable_now();nt=fe;var He=!0;try{He=oe(!0,fe)}finally{He?Ni():(ue=!1,oe=null)}}else ue=!1}var Ni;if(typeof at=="function")Ni=function(){at(ds)};else if(typeof MessageChannel<"u"){var Ae=new MessageChannel,dr=Ae.port2;Ae.port1.onmessage=ds,Ni=function(){dr.postMessage(null)}}else Ni=function(){we(ds,0)};function Bo(fe){oe=fe,ue||(ue=!0,Ni())}function si(fe,He){me=we(function(){fe(l.unstable_now())},He)}l.unstable_IdlePriority=5,l.unstable_ImmediatePriority=1,l.unstable_LowPriority=4,l.unstable_NormalPriority=3,l.unstable_Profiling=null,l.unstable_UserBlockingPriority=2,l.unstable_cancelCallback=function(fe){fe.callback=null},l.unstable_continueExecution=function(){Lt||zt||(Lt=!0,Bo(Xt))},l.unstable_forceFrameRate=function(fe){0>fe||125<fe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Nn=0<fe?Math.floor(1e3/fe):5},l.unstable_getCurrentPriorityLevel=function(){return X},l.unstable_getFirstCallbackNode=function(){return f(F)},l.unstable_next=function(fe){switch(X){case 1:case 2:case 3:var He=3;break;default:He=X}var We=X;X=He;try{return fe()}finally{X=We}},l.unstable_pauseExecution=function(){},l.unstable_requestPaint=function(){},l.unstable_runWithPriority=function(fe,He){switch(fe){case 1:case 2:case 3:case 4:case 5:break;default:fe=3}var We=X;X=fe;try{return He()}finally{X=We}},l.unstable_scheduleCallback=function(fe,He,We){var hn=l.unstable_now();switch(typeof We=="object"&&We!==null?(We=We.delay,We=typeof We=="number"&&0<We?hn+We:hn):We=hn,fe){case 1:var $t=-1;break;case 2:$t=250;break;case 5:$t=1073741823;break;case 4:$t=1e4;break;default:$t=5e3}return $t=We+$t,fe={id:ot++,callback:He,priorityLevel:fe,startTime:We,expirationTime:$t,sortIndex:-1},We>hn?(fe.sortIndex=We,u(k,fe),f(F)===null&&fe===f(k)&&(Ht?(mt(me),me=-1):Ht=!0,si(It,We-hn))):(fe.sortIndex=$t,u(F,fe),Lt||zt||(Lt=!0,Bo(Xt))),fe},l.unstable_shouldYield=Re,l.unstable_wrapCallback=function(fe){var He=X;return function(){var We=X;X=He;try{return fe.apply(this,arguments)}finally{X=We}}}})(ID);MD.exports=ID;var Jz=MD.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var BD=Pr,cs=Jz;function he(l){for(var u="https://reactjs.org/docs/error-decoder.html?invariant="+l,f=1;f<arguments.length;f++)u+="&args[]="+encodeURIComponent(arguments[f]);return"Minified React error #"+l+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var DD=new Set,c_={};function Wh(l,u){Qd(l,u),Qd(l+"Capture",u)}function Qd(l,u){for(c_[l]=u,l=0;l<u.length;l++)DD.add(u[l])}var eu=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),rE=Object.prototype.hasOwnProperty,$z=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,KI={},XI={};function Kz(l){return rE.call(XI,l)?!0:rE.call(KI,l)?!1:$z.test(l)?XI[l]=!0:(KI[l]=!0,!1)}function Xz(l,u,f,y){if(f!==null&&f.type===0)return!1;switch(typeof u){case"function":case"symbol":return!0;case"boolean":return y?!1:f!==null?!f.acceptsBooleans:(l=l.toLowerCase().slice(0,5),l!=="data-"&&l!=="aria-");default:return!1}}function Yz(l,u,f,y){if(u===null||typeof u>"u"||Xz(l,u,f,y))return!0;if(y)return!1;if(f!==null)switch(f.type){case 3:return!u;case 4:return u===!1;case 5:return isNaN(u);case 6:return isNaN(u)||1>u}return!1}function Io(l,u,f,y,b,C,P){this.acceptsBooleans=u===2||u===3||u===4,this.attributeName=y,this.attributeNamespace=b,this.mustUseProperty=f,this.propertyName=l,this.type=u,this.sanitizeURL=C,this.removeEmptyString=P}var no={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(l){no[l]=new Io(l,0,!1,l,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(l){var u=l[0];no[u]=new Io(u,1,!1,l[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(l){no[l]=new Io(l,2,!1,l.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(l){no[l]=new Io(l,2,!1,l,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(l){no[l]=new Io(l,3,!1,l.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(l){no[l]=new Io(l,3,!0,l,null,!1,!1)});["capture","download"].forEach(function(l){no[l]=new Io(l,4,!1,l,null,!1,!1)});["cols","rows","size","span"].forEach(function(l){no[l]=new Io(l,6,!1,l,null,!1,!1)});["rowSpan","start"].forEach(function(l){no[l]=new Io(l,5,!1,l.toLowerCase(),null,!1,!1)});var rT=/[\-:]([a-z])/g;function iT(l){return l[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(l){var u=l.replace(rT,iT);no[u]=new Io(u,1,!1,l,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(l){var u=l.replace(rT,iT);no[u]=new Io(u,1,!1,l,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(l){var u=l.replace(rT,iT);no[u]=new Io(u,1,!1,l,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(l){no[l]=new Io(l,1,!1,l.toLowerCase(),null,!1,!1)});no.xlinkHref=new Io("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(l){no[l]=new Io(l,1,!1,l.toLowerCase(),null,!0,!0)});function oT(l,u,f,y){var b=no.hasOwnProperty(u)?no[u]:null;(b!==null?b.type!==0:y||!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(Yz(u,f,b,y)&&(f=null),y||b===null?Kz(u)&&(f===null?l.removeAttribute(u):l.setAttribute(u,""+f)):b.mustUseProperty?l[b.propertyName]=f===null?b.type===3?!1:"":f:(u=b.attributeName,y=b.attributeNamespace,f===null?l.removeAttribute(u):(b=b.type,f=b===3||b===4&&f===!0?"":""+f,y?l.setAttributeNS(y,u,f):l.setAttribute(u,f))))}var ou=BD.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ex=Symbol.for("react.element"),kd=Symbol.for("react.portal"),Fd=Symbol.for("react.fragment"),sT=Symbol.for("react.strict_mode"),iE=Symbol.for("react.profiler"),PD=Symbol.for("react.provider"),LD=Symbol.for("react.context"),aT=Symbol.for("react.forward_ref"),oE=Symbol.for("react.suspense"),sE=Symbol.for("react.suspense_list"),lT=Symbol.for("react.memo"),cc=Symbol.for("react.lazy"),RD=Symbol.for("react.offscreen"),YI=Symbol.iterator;function Ug(l){return l===null||typeof l!="object"?null:(l=YI&&l[YI]||l["@@iterator"],typeof l=="function"?l:null)}var Qr=Object.assign,BA;function Kg(l){if(BA===void 0)try{throw Error()}catch(f){var u=f.stack.trim().match(/\n( *(at )?)/);BA=u&&u[1]||""}return`
`+BA+l}var DA=!1;function PA(l,u){if(!l||DA)return"";DA=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(u)if(u=function(){throw Error()},Object.defineProperty(u.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(u,[])}catch(k){var y=k}Reflect.construct(l,[],u)}else{try{u.call()}catch(k){y=k}l.call(u.prototype)}else{try{throw Error()}catch(k){y=k}l()}}catch(k){if(k&&y&&typeof k.stack=="string"){for(var b=k.stack.split(`
`),C=y.stack.split(`
`),P=b.length-1,O=C.length-1;1<=P&&0<=O&&b[P]!==C[O];)O--;for(;1<=P&&0<=O;P--,O--)if(b[P]!==C[O]){if(P!==1||O!==1)do if(P--,O--,0>O||b[P]!==C[O]){var F=`
`+b[P].replace(" at new "," at ");return l.displayName&&F.includes("<anonymous>")&&(F=F.replace("<anonymous>",l.displayName)),F}while(1<=P&&0<=O);break}}}finally{DA=!1,Error.prepareStackTrace=f}return(l=l?l.displayName||l.name:"")?Kg(l):""}function Qz(l){switch(l.tag){case 5:return Kg(l.type);case 16:return Kg("Lazy");case 13:return Kg("Suspense");case 19:return Kg("SuspenseList");case 0:case 2:case 15:return l=PA(l.type,!1),l;case 11:return l=PA(l.type.render,!1),l;case 1:return l=PA(l.type,!0),l;default:return""}}function aE(l){if(l==null)return null;if(typeof l=="function")return l.displayName||l.name||null;if(typeof l=="string")return l;switch(l){case Fd:return"Fragment";case kd:return"Portal";case iE:return"Profiler";case sT:return"StrictMode";case oE:return"Suspense";case sE:return"SuspenseList"}if(typeof l=="object")switch(l.$$typeof){case LD:return(l.displayName||"Context")+".Consumer";case PD:return(l._context.displayName||"Context")+".Provider";case aT:var u=l.render;return l=l.displayName,l||(l=u.displayName||u.name||"",l=l!==""?"ForwardRef("+l+")":"ForwardRef"),l;case lT:return u=l.displayName||null,u!==null?u:aE(l.type)||"Memo";case cc:u=l._payload,l=l._init;try{return aE(l(u))}catch{}}return null}function tO(l){var u=l.type;switch(l.tag){case 24:return"Cache";case 9:return(u.displayName||"Context")+".Consumer";case 10:return(u._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return l=u.render,l=l.displayName||l.name||"",u.displayName||(l!==""?"ForwardRef("+l+")":"ForwardRef");case 7:return"Fragment";case 5:return u;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return aE(u);case 8:return u===sT?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof u=="function")return u.displayName||u.name||null;if(typeof u=="string")return u}return null}function Ec(l){switch(typeof l){case"boolean":case"number":case"string":case"undefined":return l;case"object":return l;default:return""}}function kD(l){var u=l.type;return(l=l.nodeName)&&l.toLowerCase()==="input"&&(u==="checkbox"||u==="radio")}function eO(l){var u=kD(l)?"checked":"value",f=Object.getOwnPropertyDescriptor(l.constructor.prototype,u),y=""+l[u];if(!l.hasOwnProperty(u)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var b=f.get,C=f.set;return Object.defineProperty(l,u,{configurable:!0,get:function(){return b.call(this)},set:function(P){y=""+P,C.call(this,P)}}),Object.defineProperty(l,u,{enumerable:f.enumerable}),{getValue:function(){return y},setValue:function(P){y=""+P},stopTracking:function(){l._valueTracker=null,delete l[u]}}}}function Tx(l){l._valueTracker||(l._valueTracker=eO(l))}function FD(l){if(!l)return!1;var u=l._valueTracker;if(!u)return!0;var f=u.getValue(),y="";return l&&(y=kD(l)?l.checked?"true":"false":l.value),l=y,l!==f?(u.setValue(l),!0):!1}function tv(l){if(l=l||(typeof document<"u"?document:void 0),typeof l>"u")return null;try{return l.activeElement||l.body}catch{return l.body}}function lE(l,u){var f=u.checked;return Qr({},u,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:f??l._wrapperState.initialChecked})}function QI(l,u){var f=u.defaultValue==null?"":u.defaultValue,y=u.checked!=null?u.checked:u.defaultChecked;f=Ec(u.value!=null?u.value:f),l._wrapperState={initialChecked:y,initialValue:f,controlled:u.type==="checkbox"||u.type==="radio"?u.checked!=null:u.value!=null}}function zD(l,u){u=u.checked,u!=null&&oT(l,"checked",u,!1)}function uE(l,u){zD(l,u);var f=Ec(u.value),y=u.type;if(f!=null)y==="number"?(f===0&&l.value===""||l.value!=f)&&(l.value=""+f):l.value!==""+f&&(l.value=""+f);else if(y==="submit"||y==="reset"){l.removeAttribute("value");return}u.hasOwnProperty("value")?cE(l,u.type,f):u.hasOwnProperty("defaultValue")&&cE(l,u.type,Ec(u.defaultValue)),u.checked==null&&u.defaultChecked!=null&&(l.defaultChecked=!!u.defaultChecked)}function tB(l,u,f){if(u.hasOwnProperty("value")||u.hasOwnProperty("defaultValue")){var y=u.type;if(!(y!=="submit"&&y!=="reset"||u.value!==void 0&&u.value!==null))return;u=""+l._wrapperState.initialValue,f||u===l.value||(l.value=u),l.defaultValue=u}f=l.name,f!==""&&(l.name=""),l.defaultChecked=!!l._wrapperState.initialChecked,f!==""&&(l.name=f)}function cE(l,u,f){(u!=="number"||tv(l.ownerDocument)!==l)&&(f==null?l.defaultValue=""+l._wrapperState.initialValue:l.defaultValue!==""+f&&(l.defaultValue=""+f))}var Xg=Array.isArray;function qd(l,u,f,y){if(l=l.options,u){u={};for(var b=0;b<f.length;b++)u["$"+f[b]]=!0;for(f=0;f<l.length;f++)b=u.hasOwnProperty("$"+l[f].value),l[f].selected!==b&&(l[f].selected=b),b&&y&&(l[f].defaultSelected=!0)}else{for(f=""+Ec(f),u=null,b=0;b<l.length;b++){if(l[b].value===f){l[b].selected=!0,y&&(l[b].defaultSelected=!0);return}u!==null||l[b].disabled||(u=l[b])}u!==null&&(u.selected=!0)}}function hE(l,u){if(u.dangerouslySetInnerHTML!=null)throw Error(he(91));return Qr({},u,{value:void 0,defaultValue:void 0,children:""+l._wrapperState.initialValue})}function eB(l,u){var f=u.value;if(f==null){if(f=u.children,u=u.defaultValue,f!=null){if(u!=null)throw Error(he(92));if(Xg(f)){if(1<f.length)throw Error(he(93));f=f[0]}u=f}u==null&&(u=""),f=u}l._wrapperState={initialValue:Ec(f)}}function OD(l,u){var f=Ec(u.value),y=Ec(u.defaultValue);f!=null&&(f=""+f,f!==l.value&&(l.value=f),u.defaultValue==null&&l.defaultValue!==f&&(l.defaultValue=f)),y!=null&&(l.defaultValue=""+y)}function nB(l){var u=l.textContent;u===l._wrapperState.initialValue&&u!==""&&u!==null&&(l.value=u)}function ND(l){switch(l){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function fE(l,u){return l==null||l==="http://www.w3.org/1999/xhtml"?ND(u):l==="http://www.w3.org/2000/svg"&&u==="foreignObject"?"http://www.w3.org/1999/xhtml":l}var Cx,UD=function(l){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(u,f,y,b){MSApp.execUnsafeLocalFunction(function(){return l(u,f,y,b)})}:l}(function(l,u){if(l.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in l)l.innerHTML=u;else{for(Cx=Cx||document.createElement("div"),Cx.innerHTML="<svg>"+u.valueOf().toString()+"</svg>",u=Cx.firstChild;l.firstChild;)l.removeChild(l.firstChild);for(;u.firstChild;)l.appendChild(u.firstChild)}});function h_(l,u){if(u){var f=l.firstChild;if(f&&f===l.lastChild&&f.nodeType===3){f.nodeValue=u;return}}l.textContent=u}var t_={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},nO=["Webkit","ms","Moz","O"];Object.keys(t_).forEach(function(l){nO.forEach(function(u){u=u+l.charAt(0).toUpperCase()+l.substring(1),t_[u]=t_[l]})});function VD(l,u,f){return u==null||typeof u=="boolean"||u===""?"":f||typeof u!="number"||u===0||t_.hasOwnProperty(l)&&t_[l]?(""+u).trim():u+"px"}function GD(l,u){l=l.style;for(var f in u)if(u.hasOwnProperty(f)){var y=f.indexOf("--")===0,b=VD(f,u[f],y);f==="float"&&(f="cssFloat"),y?l.setProperty(f,b):l[f]=b}}var rO=Qr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function dE(l,u){if(u){if(rO[l]&&(u.children!=null||u.dangerouslySetInnerHTML!=null))throw Error(he(137,l));if(u.dangerouslySetInnerHTML!=null){if(u.children!=null)throw Error(he(60));if(typeof u.dangerouslySetInnerHTML!="object"||!("__html"in u.dangerouslySetInnerHTML))throw Error(he(61))}if(u.style!=null&&typeof u.style!="object")throw Error(he(62))}}function pE(l,u){if(l.indexOf("-")===-1)return typeof u.is=="string";switch(l){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var mE=null;function uT(l){return l=l.target||l.srcElement||window,l.correspondingUseElement&&(l=l.correspondingUseElement),l.nodeType===3?l.parentNode:l}var gE=null,Jd=null,$d=null;function rB(l){if(l=P_(l)){if(typeof gE!="function")throw Error(he(280));var u=l.stateNode;u&&(u=kv(u),gE(l.stateNode,l.type,u))}}function jD(l){Jd?$d?$d.push(l):$d=[l]:Jd=l}function HD(){if(Jd){var l=Jd,u=$d;if($d=Jd=null,rB(l),u)for(l=0;l<u.length;l++)rB(u[l])}}function ZD(l,u){return l(u)}function WD(){}var LA=!1;function qD(l,u,f){if(LA)return l(u,f);LA=!0;try{return ZD(l,u,f)}finally{LA=!1,(Jd!==null||$d!==null)&&(WD(),HD())}}function f_(l,u){var f=l.stateNode;if(f===null)return null;var y=kv(f);if(y===null)return null;f=y[u];t:switch(u){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(y=!y.disabled)||(l=l.type,y=!(l==="button"||l==="input"||l==="select"||l==="textarea")),l=!y;break t;default:l=!1}if(l)return null;if(f&&typeof f!="function")throw Error(he(231,u,typeof f));return f}var _E=!1;if(eu)try{var Vg={};Object.defineProperty(Vg,"passive",{get:function(){_E=!0}}),window.addEventListener("test",Vg,Vg),window.removeEventListener("test",Vg,Vg)}catch{_E=!1}function iO(l,u,f,y,b,C,P,O,F){var k=Array.prototype.slice.call(arguments,3);try{u.apply(f,k)}catch(ot){this.onError(ot)}}var e_=!1,ev=null,nv=!1,yE=null,oO={onError:function(l){e_=!0,ev=l}};function sO(l,u,f,y,b,C,P,O,F){e_=!1,ev=null,iO.apply(oO,arguments)}function aO(l,u,f,y,b,C,P,O,F){if(sO.apply(this,arguments),e_){if(e_){var k=ev;e_=!1,ev=null}else throw Error(he(198));nv||(nv=!0,yE=k)}}function qh(l){var u=l,f=l;if(l.alternate)for(;u.return;)u=u.return;else{l=u;do u=l,u.flags&4098&&(f=u.return),l=u.return;while(l)}return u.tag===3?f:null}function JD(l){if(l.tag===13){var u=l.memoizedState;if(u===null&&(l=l.alternate,l!==null&&(u=l.memoizedState)),u!==null)return u.dehydrated}return null}function iB(l){if(qh(l)!==l)throw Error(he(188))}function lO(l){var u=l.alternate;if(!u){if(u=qh(l),u===null)throw Error(he(188));return u!==l?null:l}for(var f=l,y=u;;){var b=f.return;if(b===null)break;var C=b.alternate;if(C===null){if(y=b.return,y!==null){f=y;continue}break}if(b.child===C.child){for(C=b.child;C;){if(C===f)return iB(b),l;if(C===y)return iB(b),u;C=C.sibling}throw Error(he(188))}if(f.return!==y.return)f=b,y=C;else{for(var P=!1,O=b.child;O;){if(O===f){P=!0,f=b,y=C;break}if(O===y){P=!0,y=b,f=C;break}O=O.sibling}if(!P){for(O=C.child;O;){if(O===f){P=!0,f=C,y=b;break}if(O===y){P=!0,y=C,f=b;break}O=O.sibling}if(!P)throw Error(he(189))}}if(f.alternate!==y)throw Error(he(190))}if(f.tag!==3)throw Error(he(188));return f.stateNode.current===f?l:u}function $D(l){return l=lO(l),l!==null?KD(l):null}function KD(l){if(l.tag===5||l.tag===6)return l;for(l=l.child;l!==null;){var u=KD(l);if(u!==null)return u;l=l.sibling}return null}var XD=cs.unstable_scheduleCallback,oB=cs.unstable_cancelCallback,uO=cs.unstable_shouldYield,cO=cs.unstable_requestPaint,ui=cs.unstable_now,hO=cs.unstable_getCurrentPriorityLevel,cT=cs.unstable_ImmediatePriority,YD=cs.unstable_UserBlockingPriority,rv=cs.unstable_NormalPriority,fO=cs.unstable_LowPriority,QD=cs.unstable_IdlePriority,Dv=null,ul=null;function dO(l){if(ul&&typeof ul.onCommitFiberRoot=="function")try{ul.onCommitFiberRoot(Dv,l,void 0,(l.current.flags&128)===128)}catch{}}var Ta=Math.clz32?Math.clz32:gO,pO=Math.log,mO=Math.LN2;function gO(l){return l>>>=0,l===0?32:31-(pO(l)/mO|0)|0}var Sx=64,Mx=4194304;function Yg(l){switch(l&-l){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return l&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return l}}function iv(l,u){var f=l.pendingLanes;if(f===0)return 0;var y=0,b=l.suspendedLanes,C=l.pingedLanes,P=f&268435455;if(P!==0){var O=P&~b;O!==0?y=Yg(O):(C&=P,C!==0&&(y=Yg(C)))}else P=f&~b,P!==0?y=Yg(P):C!==0&&(y=Yg(C));if(y===0)return 0;if(u!==0&&u!==y&&!(u&b)&&(b=y&-y,C=u&-u,b>=C||b===16&&(C&4194240)!==0))return u;if(y&4&&(y|=f&16),u=l.entangledLanes,u!==0)for(l=l.entanglements,u&=y;0<u;)f=31-Ta(u),b=1<<f,y|=l[f],u&=~b;return y}function _O(l,u){switch(l){case 1:case 2:case 4:return u+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return u+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function yO(l,u){for(var f=l.suspendedLanes,y=l.pingedLanes,b=l.expirationTimes,C=l.pendingLanes;0<C;){var P=31-Ta(C),O=1<<P,F=b[P];F===-1?(!(O&f)||O&y)&&(b[P]=_O(O,u)):F<=u&&(l.expiredLanes|=O),C&=~O}}function xE(l){return l=l.pendingLanes&-1073741825,l!==0?l:l&1073741824?1073741824:0}function t5(){var l=Sx;return Sx<<=1,!(Sx&4194240)&&(Sx=64),l}function RA(l){for(var u=[],f=0;31>f;f++)u.push(l);return u}function B_(l,u,f){l.pendingLanes|=u,u!==536870912&&(l.suspendedLanes=0,l.pingedLanes=0),l=l.eventTimes,u=31-Ta(u),l[u]=f}function xO(l,u){var f=l.pendingLanes&~u;l.pendingLanes=u,l.suspendedLanes=0,l.pingedLanes=0,l.expiredLanes&=u,l.mutableReadLanes&=u,l.entangledLanes&=u,u=l.entanglements;var y=l.eventTimes;for(l=l.expirationTimes;0<f;){var b=31-Ta(f),C=1<<b;u[b]=0,y[b]=-1,l[b]=-1,f&=~C}}function hT(l,u){var f=l.entangledLanes|=u;for(l=l.entanglements;f;){var y=31-Ta(f),b=1<<y;b&u|l[y]&u&&(l[y]|=u),f&=~b}}var vr=0;function e5(l){return l&=-l,1<l?4<l?l&268435455?16:536870912:4:1}var n5,fT,r5,i5,o5,vE=!1,Ix=[],gc=null,_c=null,yc=null,d_=new Map,p_=new Map,fc=[],vO="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function sB(l,u){switch(l){case"focusin":case"focusout":gc=null;break;case"dragenter":case"dragleave":_c=null;break;case"mouseover":case"mouseout":yc=null;break;case"pointerover":case"pointerout":d_.delete(u.pointerId);break;case"gotpointercapture":case"lostpointercapture":p_.delete(u.pointerId)}}function Gg(l,u,f,y,b,C){return l===null||l.nativeEvent!==C?(l={blockedOn:u,domEventName:f,eventSystemFlags:y,nativeEvent:C,targetContainers:[b]},u!==null&&(u=P_(u),u!==null&&fT(u)),l):(l.eventSystemFlags|=y,u=l.targetContainers,b!==null&&u.indexOf(b)===-1&&u.push(b),l)}function wO(l,u,f,y,b){switch(u){case"focusin":return gc=Gg(gc,l,u,f,y,b),!0;case"dragenter":return _c=Gg(_c,l,u,f,y,b),!0;case"mouseover":return yc=Gg(yc,l,u,f,y,b),!0;case"pointerover":var C=b.pointerId;return d_.set(C,Gg(d_.get(C)||null,l,u,f,y,b)),!0;case"gotpointercapture":return C=b.pointerId,p_.set(C,Gg(p_.get(C)||null,l,u,f,y,b)),!0}return!1}function s5(l){var u=Fh(l.target);if(u!==null){var f=qh(u);if(f!==null){if(u=f.tag,u===13){if(u=JD(f),u!==null){l.blockedOn=u,o5(l.priority,function(){r5(f)});return}}else if(u===3&&f.stateNode.current.memoizedState.isDehydrated){l.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}l.blockedOn=null}function jx(l){if(l.blockedOn!==null)return!1;for(var u=l.targetContainers;0<u.length;){var f=wE(l.domEventName,l.eventSystemFlags,u[0],l.nativeEvent);if(f===null){f=l.nativeEvent;var y=new f.constructor(f.type,f);mE=y,f.target.dispatchEvent(y),mE=null}else return u=P_(f),u!==null&&fT(u),l.blockedOn=f,!1;u.shift()}return!0}function aB(l,u,f){jx(l)&&f.delete(u)}function bO(){vE=!1,gc!==null&&jx(gc)&&(gc=null),_c!==null&&jx(_c)&&(_c=null),yc!==null&&jx(yc)&&(yc=null),d_.forEach(aB),p_.forEach(aB)}function jg(l,u){l.blockedOn===u&&(l.blockedOn=null,vE||(vE=!0,cs.unstable_scheduleCallback(cs.unstable_NormalPriority,bO)))}function m_(l){function u(b){return jg(b,l)}if(0<Ix.length){jg(Ix[0],l);for(var f=1;f<Ix.length;f++){var y=Ix[f];y.blockedOn===l&&(y.blockedOn=null)}}for(gc!==null&&jg(gc,l),_c!==null&&jg(_c,l),yc!==null&&jg(yc,l),d_.forEach(u),p_.forEach(u),f=0;f<fc.length;f++)y=fc[f],y.blockedOn===l&&(y.blockedOn=null);for(;0<fc.length&&(f=fc[0],f.blockedOn===null);)s5(f),f.blockedOn===null&&fc.shift()}var Kd=ou.ReactCurrentBatchConfig,ov=!0;function AO(l,u,f,y){var b=vr,C=Kd.transition;Kd.transition=null;try{vr=1,dT(l,u,f,y)}finally{vr=b,Kd.transition=C}}function EO(l,u,f,y){var b=vr,C=Kd.transition;Kd.transition=null;try{vr=4,dT(l,u,f,y)}finally{vr=b,Kd.transition=C}}function dT(l,u,f,y){if(ov){var b=wE(l,u,f,y);if(b===null)HA(l,u,y,sv,f),sB(l,y);else if(wO(b,l,u,f,y))y.stopPropagation();else if(sB(l,y),u&4&&-1<vO.indexOf(l)){for(;b!==null;){var C=P_(b);if(C!==null&&n5(C),C=wE(l,u,f,y),C===null&&HA(l,u,y,sv,f),C===b)break;b=C}b!==null&&y.stopPropagation()}else HA(l,u,y,null,f)}}var sv=null;function wE(l,u,f,y){if(sv=null,l=uT(y),l=Fh(l),l!==null)if(u=qh(l),u===null)l=null;else if(f=u.tag,f===13){if(l=JD(u),l!==null)return l;l=null}else if(f===3){if(u.stateNode.current.memoizedState.isDehydrated)return u.tag===3?u.stateNode.containerInfo:null;l=null}else u!==l&&(l=null);return sv=l,null}function a5(l){switch(l){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(hO()){case cT:return 1;case YD:return 4;case rv:case fO:return 16;case QD:return 536870912;default:return 16}default:return 16}}var pc=null,pT=null,Hx=null;function l5(){if(Hx)return Hx;var l,u=pT,f=u.length,y,b="value"in pc?pc.value:pc.textContent,C=b.length;for(l=0;l<f&&u[l]===b[l];l++);var P=f-l;for(y=1;y<=P&&u[f-y]===b[C-y];y++);return Hx=b.slice(l,1<y?1-y:void 0)}function Zx(l){var u=l.keyCode;return"charCode"in l?(l=l.charCode,l===0&&u===13&&(l=13)):l=u,l===10&&(l=13),32<=l||l===13?l:0}function Bx(){return!0}function lB(){return!1}function fs(l){function u(f,y,b,C,P){this._reactName=f,this._targetInst=b,this.type=y,this.nativeEvent=C,this.target=P,this.currentTarget=null;for(var O in l)l.hasOwnProperty(O)&&(f=l[O],this[O]=f?f(C):C[O]);return this.isDefaultPrevented=(C.defaultPrevented!=null?C.defaultPrevented:C.returnValue===!1)?Bx:lB,this.isPropagationStopped=lB,this}return Qr(u.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=Bx)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=Bx)},persist:function(){},isPersistent:Bx}),u}var ap={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(l){return l.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},mT=fs(ap),D_=Qr({},ap,{view:0,detail:0}),TO=fs(D_),kA,FA,Hg,Pv=Qr({},D_,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:gT,button:0,buttons:0,relatedTarget:function(l){return l.relatedTarget===void 0?l.fromElement===l.srcElement?l.toElement:l.fromElement:l.relatedTarget},movementX:function(l){return"movementX"in l?l.movementX:(l!==Hg&&(Hg&&l.type==="mousemove"?(kA=l.screenX-Hg.screenX,FA=l.screenY-Hg.screenY):FA=kA=0,Hg=l),kA)},movementY:function(l){return"movementY"in l?l.movementY:FA}}),uB=fs(Pv),CO=Qr({},Pv,{dataTransfer:0}),SO=fs(CO),MO=Qr({},D_,{relatedTarget:0}),zA=fs(MO),IO=Qr({},ap,{animationName:0,elapsedTime:0,pseudoElement:0}),BO=fs(IO),DO=Qr({},ap,{clipboardData:function(l){return"clipboardData"in l?l.clipboardData:window.clipboardData}}),PO=fs(DO),LO=Qr({},ap,{data:0}),cB=fs(LO),RO={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},kO={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},FO={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function zO(l){var u=this.nativeEvent;return u.getModifierState?u.getModifierState(l):(l=FO[l])?!!u[l]:!1}function gT(){return zO}var OO=Qr({},D_,{key:function(l){if(l.key){var u=RO[l.key]||l.key;if(u!=="Unidentified")return u}return l.type==="keypress"?(l=Zx(l),l===13?"Enter":String.fromCharCode(l)):l.type==="keydown"||l.type==="keyup"?kO[l.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:gT,charCode:function(l){return l.type==="keypress"?Zx(l):0},keyCode:function(l){return l.type==="keydown"||l.type==="keyup"?l.keyCode:0},which:function(l){return l.type==="keypress"?Zx(l):l.type==="keydown"||l.type==="keyup"?l.keyCode:0}}),NO=fs(OO),UO=Qr({},Pv,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hB=fs(UO),VO=Qr({},D_,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:gT}),GO=fs(VO),jO=Qr({},ap,{propertyName:0,elapsedTime:0,pseudoElement:0}),HO=fs(jO),ZO=Qr({},Pv,{deltaX:function(l){return"deltaX"in l?l.deltaX:"wheelDeltaX"in l?-l.wheelDeltaX:0},deltaY:function(l){return"deltaY"in l?l.deltaY:"wheelDeltaY"in l?-l.wheelDeltaY:"wheelDelta"in l?-l.wheelDelta:0},deltaZ:0,deltaMode:0}),WO=fs(ZO),qO=[9,13,27,32],_T=eu&&"CompositionEvent"in window,n_=null;eu&&"documentMode"in document&&(n_=document.documentMode);var JO=eu&&"TextEvent"in window&&!n_,u5=eu&&(!_T||n_&&8<n_&&11>=n_),fB=" ",dB=!1;function c5(l,u){switch(l){case"keyup":return qO.indexOf(u.keyCode)!==-1;case"keydown":return u.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function h5(l){return l=l.detail,typeof l=="object"&&"data"in l?l.data:null}var zd=!1;function $O(l,u){switch(l){case"compositionend":return h5(u);case"keypress":return u.which!==32?null:(dB=!0,fB);case"textInput":return l=u.data,l===fB&&dB?null:l;default:return null}}function KO(l,u){if(zd)return l==="compositionend"||!_T&&c5(l,u)?(l=l5(),Hx=pT=pc=null,zd=!1,l):null;switch(l){case"paste":return null;case"keypress":if(!(u.ctrlKey||u.altKey||u.metaKey)||u.ctrlKey&&u.altKey){if(u.char&&1<u.char.length)return u.char;if(u.which)return String.fromCharCode(u.which)}return null;case"compositionend":return u5&&u.locale!=="ko"?null:u.data;default:return null}}var XO={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pB(l){var u=l&&l.nodeName&&l.nodeName.toLowerCase();return u==="input"?!!XO[l.type]:u==="textarea"}function f5(l,u,f,y){jD(y),u=av(u,"onChange"),0<u.length&&(f=new mT("onChange","change",null,f,y),l.push({event:f,listeners:u}))}var r_=null,g_=null;function YO(l){A5(l,0)}function Lv(l){var u=Ud(l);if(FD(u))return l}function QO(l,u){if(l==="change")return u}var d5=!1;if(eu){var OA;if(eu){var NA="oninput"in document;if(!NA){var mB=document.createElement("div");mB.setAttribute("oninput","return;"),NA=typeof mB.oninput=="function"}OA=NA}else OA=!1;d5=OA&&(!document.documentMode||9<document.documentMode)}function gB(){r_&&(r_.detachEvent("onpropertychange",p5),g_=r_=null)}function p5(l){if(l.propertyName==="value"&&Lv(g_)){var u=[];f5(u,g_,l,uT(l)),qD(YO,u)}}function t4(l,u,f){l==="focusin"?(gB(),r_=u,g_=f,r_.attachEvent("onpropertychange",p5)):l==="focusout"&&gB()}function e4(l){if(l==="selectionchange"||l==="keyup"||l==="keydown")return Lv(g_)}function n4(l,u){if(l==="click")return Lv(u)}function r4(l,u){if(l==="input"||l==="change")return Lv(u)}function i4(l,u){return l===u&&(l!==0||1/l===1/u)||l!==l&&u!==u}var Sa=typeof Object.is=="function"?Object.is:i4;function __(l,u){if(Sa(l,u))return!0;if(typeof l!="object"||l===null||typeof u!="object"||u===null)return!1;var f=Object.keys(l),y=Object.keys(u);if(f.length!==y.length)return!1;for(y=0;y<f.length;y++){var b=f[y];if(!rE.call(u,b)||!Sa(l[b],u[b]))return!1}return!0}function _B(l){for(;l&&l.firstChild;)l=l.firstChild;return l}function yB(l,u){var f=_B(l);l=0;for(var y;f;){if(f.nodeType===3){if(y=l+f.textContent.length,l<=u&&y>=u)return{node:f,offset:u-l};l=y}t:{for(;f;){if(f.nextSibling){f=f.nextSibling;break t}f=f.parentNode}f=void 0}f=_B(f)}}function m5(l,u){return l&&u?l===u?!0:l&&l.nodeType===3?!1:u&&u.nodeType===3?m5(l,u.parentNode):"contains"in l?l.contains(u):l.compareDocumentPosition?!!(l.compareDocumentPosition(u)&16):!1:!1}function g5(){for(var l=window,u=tv();u instanceof l.HTMLIFrameElement;){try{var f=typeof u.contentWindow.location.href=="string"}catch{f=!1}if(f)l=u.contentWindow;else break;u=tv(l.document)}return u}function yT(l){var u=l&&l.nodeName&&l.nodeName.toLowerCase();return u&&(u==="input"&&(l.type==="text"||l.type==="search"||l.type==="tel"||l.type==="url"||l.type==="password")||u==="textarea"||l.contentEditable==="true")}function o4(l){var u=g5(),f=l.focusedElem,y=l.selectionRange;if(u!==f&&f&&f.ownerDocument&&m5(f.ownerDocument.documentElement,f)){if(y!==null&&yT(f)){if(u=y.start,l=y.end,l===void 0&&(l=u),"selectionStart"in f)f.selectionStart=u,f.selectionEnd=Math.min(l,f.value.length);else if(l=(u=f.ownerDocument||document)&&u.defaultView||window,l.getSelection){l=l.getSelection();var b=f.textContent.length,C=Math.min(y.start,b);y=y.end===void 0?C:Math.min(y.end,b),!l.extend&&C>y&&(b=y,y=C,C=b),b=yB(f,C);var P=yB(f,y);b&&P&&(l.rangeCount!==1||l.anchorNode!==b.node||l.anchorOffset!==b.offset||l.focusNode!==P.node||l.focusOffset!==P.offset)&&(u=u.createRange(),u.setStart(b.node,b.offset),l.removeAllRanges(),C>y?(l.addRange(u),l.extend(P.node,P.offset)):(u.setEnd(P.node,P.offset),l.addRange(u)))}}for(u=[],l=f;l=l.parentNode;)l.nodeType===1&&u.push({element:l,left:l.scrollLeft,top:l.scrollTop});for(typeof f.focus=="function"&&f.focus(),f=0;f<u.length;f++)l=u[f],l.element.scrollLeft=l.left,l.element.scrollTop=l.top}}var s4=eu&&"documentMode"in document&&11>=document.documentMode,Od=null,bE=null,i_=null,AE=!1;function xB(l,u,f){var y=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;AE||Od==null||Od!==tv(y)||(y=Od,"selectionStart"in y&&yT(y)?y={start:y.selectionStart,end:y.selectionEnd}:(y=(y.ownerDocument&&y.ownerDocument.defaultView||window).getSelection(),y={anchorNode:y.anchorNode,anchorOffset:y.anchorOffset,focusNode:y.focusNode,focusOffset:y.focusOffset}),i_&&__(i_,y)||(i_=y,y=av(bE,"onSelect"),0<y.length&&(u=new mT("onSelect","select",null,u,f),l.push({event:u,listeners:y}),u.target=Od)))}function Dx(l,u){var f={};return f[l.toLowerCase()]=u.toLowerCase(),f["Webkit"+l]="webkit"+u,f["Moz"+l]="moz"+u,f}var Nd={animationend:Dx("Animation","AnimationEnd"),animationiteration:Dx("Animation","AnimationIteration"),animationstart:Dx("Animation","AnimationStart"),transitionend:Dx("Transition","TransitionEnd")},UA={},_5={};eu&&(_5=document.createElement("div").style,"AnimationEvent"in window||(delete Nd.animationend.animation,delete Nd.animationiteration.animation,delete Nd.animationstart.animation),"TransitionEvent"in window||delete Nd.transitionend.transition);function Rv(l){if(UA[l])return UA[l];if(!Nd[l])return l;var u=Nd[l],f;for(f in u)if(u.hasOwnProperty(f)&&f in _5)return UA[l]=u[f];return l}var y5=Rv("animationend"),x5=Rv("animationiteration"),v5=Rv("animationstart"),w5=Rv("transitionend"),b5=new Map,vB="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Cc(l,u){b5.set(l,u),Wh(u,[l])}for(var VA=0;VA<vB.length;VA++){var GA=vB[VA],a4=GA.toLowerCase(),l4=GA[0].toUpperCase()+GA.slice(1);Cc(a4,"on"+l4)}Cc(y5,"onAnimationEnd");Cc(x5,"onAnimationIteration");Cc(v5,"onAnimationStart");Cc("dblclick","onDoubleClick");Cc("focusin","onFocus");Cc("focusout","onBlur");Cc(w5,"onTransitionEnd");Qd("onMouseEnter",["mouseout","mouseover"]);Qd("onMouseLeave",["mouseout","mouseover"]);Qd("onPointerEnter",["pointerout","pointerover"]);Qd("onPointerLeave",["pointerout","pointerover"]);Wh("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Wh("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Wh("onBeforeInput",["compositionend","keypress","textInput","paste"]);Wh("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Wh("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Wh("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Qg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),u4=new Set("cancel close invalid load scroll toggle".split(" ").concat(Qg));function wB(l,u,f){var y=l.type||"unknown-event";l.currentTarget=f,aO(y,u,void 0,l),l.currentTarget=null}function A5(l,u){u=(u&4)!==0;for(var f=0;f<l.length;f++){var y=l[f],b=y.event;y=y.listeners;t:{var C=void 0;if(u)for(var P=y.length-1;0<=P;P--){var O=y[P],F=O.instance,k=O.currentTarget;if(O=O.listener,F!==C&&b.isPropagationStopped())break t;wB(b,O,k),C=F}else for(P=0;P<y.length;P++){if(O=y[P],F=O.instance,k=O.currentTarget,O=O.listener,F!==C&&b.isPropagationStopped())break t;wB(b,O,k),C=F}}}if(nv)throw l=yE,nv=!1,yE=null,l}function zr(l,u){var f=u[ME];f===void 0&&(f=u[ME]=new Set);var y=l+"__bubble";f.has(y)||(E5(u,l,2,!1),f.add(y))}function jA(l,u,f){var y=0;u&&(y|=4),E5(f,l,y,u)}var Px="_reactListening"+Math.random().toString(36).slice(2);function y_(l){if(!l[Px]){l[Px]=!0,DD.forEach(function(f){f!=="selectionchange"&&(u4.has(f)||jA(f,!1,l),jA(f,!0,l))});var u=l.nodeType===9?l:l.ownerDocument;u===null||u[Px]||(u[Px]=!0,jA("selectionchange",!1,u))}}function E5(l,u,f,y){switch(a5(u)){case 1:var b=AO;break;case 4:b=EO;break;default:b=dT}f=b.bind(null,u,f,l),b=void 0,!_E||u!=="touchstart"&&u!=="touchmove"&&u!=="wheel"||(b=!0),y?b!==void 0?l.addEventListener(u,f,{capture:!0,passive:b}):l.addEventListener(u,f,!0):b!==void 0?l.addEventListener(u,f,{passive:b}):l.addEventListener(u,f,!1)}function HA(l,u,f,y,b){var C=y;if(!(u&1)&&!(u&2)&&y!==null)t:for(;;){if(y===null)return;var P=y.tag;if(P===3||P===4){var O=y.stateNode.containerInfo;if(O===b||O.nodeType===8&&O.parentNode===b)break;if(P===4)for(P=y.return;P!==null;){var F=P.tag;if((F===3||F===4)&&(F=P.stateNode.containerInfo,F===b||F.nodeType===8&&F.parentNode===b))return;P=P.return}for(;O!==null;){if(P=Fh(O),P===null)return;if(F=P.tag,F===5||F===6){y=C=P;continue t}O=O.parentNode}}y=y.return}qD(function(){var k=C,ot=uT(f),ft=[];t:{var X=b5.get(l);if(X!==void 0){var zt=mT,Lt=l;switch(l){case"keypress":if(Zx(f)===0)break t;case"keydown":case"keyup":zt=NO;break;case"focusin":Lt="focus",zt=zA;break;case"focusout":Lt="blur",zt=zA;break;case"beforeblur":case"afterblur":zt=zA;break;case"click":if(f.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":zt=uB;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":zt=SO;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":zt=GO;break;case y5:case x5:case v5:zt=BO;break;case w5:zt=HO;break;case"scroll":zt=TO;break;case"wheel":zt=WO;break;case"copy":case"cut":case"paste":zt=PO;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":zt=hB}var Ht=(u&4)!==0,we=!Ht&&l==="scroll",mt=Ht?X!==null?X+"Capture":null:X;Ht=[];for(var at=k,xt;at!==null;){xt=at;var It=xt.stateNode;if(xt.tag===5&&It!==null&&(xt=It,mt!==null&&(It=f_(at,mt),It!=null&&Ht.push(x_(at,It,xt)))),we)break;at=at.return}0<Ht.length&&(X=new zt(X,Lt,null,f,ot),ft.push({event:X,listeners:Ht}))}}if(!(u&7)){t:{if(X=l==="mouseover"||l==="pointerover",zt=l==="mouseout"||l==="pointerout",X&&f!==mE&&(Lt=f.relatedTarget||f.fromElement)&&(Fh(Lt)||Lt[nu]))break t;if((zt||X)&&(X=ot.window===ot?ot:(X=ot.ownerDocument)?X.defaultView||X.parentWindow:window,zt?(Lt=f.relatedTarget||f.toElement,zt=k,Lt=Lt?Fh(Lt):null,Lt!==null&&(we=qh(Lt),Lt!==we||Lt.tag!==5&&Lt.tag!==6)&&(Lt=null)):(zt=null,Lt=k),zt!==Lt)){if(Ht=uB,It="onMouseLeave",mt="onMouseEnter",at="mouse",(l==="pointerout"||l==="pointerover")&&(Ht=hB,It="onPointerLeave",mt="onPointerEnter",at="pointer"),we=zt==null?X:Ud(zt),xt=Lt==null?X:Ud(Lt),X=new Ht(It,at+"leave",zt,f,ot),X.target=we,X.relatedTarget=xt,It=null,Fh(ot)===k&&(Ht=new Ht(mt,at+"enter",Lt,f,ot),Ht.target=xt,Ht.relatedTarget=we,It=Ht),we=It,zt&&Lt)e:{for(Ht=zt,mt=Lt,at=0,xt=Ht;xt;xt=Dd(xt))at++;for(xt=0,It=mt;It;It=Dd(It))xt++;for(;0<at-xt;)Ht=Dd(Ht),at--;for(;0<xt-at;)mt=Dd(mt),xt--;for(;at--;){if(Ht===mt||mt!==null&&Ht===mt.alternate)break e;Ht=Dd(Ht),mt=Dd(mt)}Ht=null}else Ht=null;zt!==null&&bB(ft,X,zt,Ht,!1),Lt!==null&&we!==null&&bB(ft,we,Lt,Ht,!0)}}t:{if(X=k?Ud(k):window,zt=X.nodeName&&X.nodeName.toLowerCase(),zt==="select"||zt==="input"&&X.type==="file")var Xt=QO;else if(pB(X))if(d5)Xt=r4;else{Xt=e4;var ue=t4}else(zt=X.nodeName)&&zt.toLowerCase()==="input"&&(X.type==="checkbox"||X.type==="radio")&&(Xt=n4);if(Xt&&(Xt=Xt(l,k))){f5(ft,Xt,f,ot);break t}ue&&ue(l,X,k),l==="focusout"&&(ue=X._wrapperState)&&ue.controlled&&X.type==="number"&&cE(X,"number",X.value)}switch(ue=k?Ud(k):window,l){case"focusin":(pB(ue)||ue.contentEditable==="true")&&(Od=ue,bE=k,i_=null);break;case"focusout":i_=bE=Od=null;break;case"mousedown":AE=!0;break;case"contextmenu":case"mouseup":case"dragend":AE=!1,xB(ft,f,ot);break;case"selectionchange":if(s4)break;case"keydown":case"keyup":xB(ft,f,ot)}var oe;if(_T)t:{switch(l){case"compositionstart":var me="onCompositionStart";break t;case"compositionend":me="onCompositionEnd";break t;case"compositionupdate":me="onCompositionUpdate";break t}me=void 0}else zd?c5(l,f)&&(me="onCompositionEnd"):l==="keydown"&&f.keyCode===229&&(me="onCompositionStart");me&&(u5&&f.locale!=="ko"&&(zd||me!=="onCompositionStart"?me==="onCompositionEnd"&&zd&&(oe=l5()):(pc=ot,pT="value"in pc?pc.value:pc.textContent,zd=!0)),ue=av(k,me),0<ue.length&&(me=new cB(me,l,null,f,ot),ft.push({event:me,listeners:ue}),oe?me.data=oe:(oe=h5(f),oe!==null&&(me.data=oe)))),(oe=JO?$O(l,f):KO(l,f))&&(k=av(k,"onBeforeInput"),0<k.length&&(ot=new cB("onBeforeInput","beforeinput",null,f,ot),ft.push({event:ot,listeners:k}),ot.data=oe))}A5(ft,u)})}function x_(l,u,f){return{instance:l,listener:u,currentTarget:f}}function av(l,u){for(var f=u+"Capture",y=[];l!==null;){var b=l,C=b.stateNode;b.tag===5&&C!==null&&(b=C,C=f_(l,f),C!=null&&y.unshift(x_(l,C,b)),C=f_(l,u),C!=null&&y.push(x_(l,C,b))),l=l.return}return y}function Dd(l){if(l===null)return null;do l=l.return;while(l&&l.tag!==5);return l||null}function bB(l,u,f,y,b){for(var C=u._reactName,P=[];f!==null&&f!==y;){var O=f,F=O.alternate,k=O.stateNode;if(F!==null&&F===y)break;O.tag===5&&k!==null&&(O=k,b?(F=f_(f,C),F!=null&&P.unshift(x_(f,F,O))):b||(F=f_(f,C),F!=null&&P.push(x_(f,F,O)))),f=f.return}P.length!==0&&l.push({event:u,listeners:P})}var c4=/\r\n?/g,h4=/\u0000|\uFFFD/g;function AB(l){return(typeof l=="string"?l:""+l).replace(c4,`
`).replace(h4,"")}function Lx(l,u,f){if(u=AB(u),AB(l)!==u&&f)throw Error(he(425))}function lv(){}var EE=null,TE=null;function CE(l,u){return l==="textarea"||l==="noscript"||typeof u.children=="string"||typeof u.children=="number"||typeof u.dangerouslySetInnerHTML=="object"&&u.dangerouslySetInnerHTML!==null&&u.dangerouslySetInnerHTML.__html!=null}var SE=typeof setTimeout=="function"?setTimeout:void 0,f4=typeof clearTimeout=="function"?clearTimeout:void 0,EB=typeof Promise=="function"?Promise:void 0,d4=typeof queueMicrotask=="function"?queueMicrotask:typeof EB<"u"?function(l){return EB.resolve(null).then(l).catch(p4)}:SE;function p4(l){setTimeout(function(){throw l})}function ZA(l,u){var f=u,y=0;do{var b=f.nextSibling;if(l.removeChild(f),b&&b.nodeType===8)if(f=b.data,f==="/$"){if(y===0){l.removeChild(b),m_(u);return}y--}else f!=="$"&&f!=="$?"&&f!=="$!"||y++;f=b}while(f);m_(u)}function xc(l){for(;l!=null;l=l.nextSibling){var u=l.nodeType;if(u===1||u===3)break;if(u===8){if(u=l.data,u==="$"||u==="$!"||u==="$?")break;if(u==="/$")return null}}return l}function TB(l){l=l.previousSibling;for(var u=0;l;){if(l.nodeType===8){var f=l.data;if(f==="$"||f==="$!"||f==="$?"){if(u===0)return l;u--}else f==="/$"&&u++}l=l.previousSibling}return null}var lp=Math.random().toString(36).slice(2),al="__reactFiber$"+lp,v_="__reactProps$"+lp,nu="__reactContainer$"+lp,ME="__reactEvents$"+lp,m4="__reactListeners$"+lp,g4="__reactHandles$"+lp;function Fh(l){var u=l[al];if(u)return u;for(var f=l.parentNode;f;){if(u=f[nu]||f[al]){if(f=u.alternate,u.child!==null||f!==null&&f.child!==null)for(l=TB(l);l!==null;){if(f=l[al])return f;l=TB(l)}return u}l=f,f=l.parentNode}return null}function P_(l){return l=l[al]||l[nu],!l||l.tag!==5&&l.tag!==6&&l.tag!==13&&l.tag!==3?null:l}function Ud(l){if(l.tag===5||l.tag===6)return l.stateNode;throw Error(he(33))}function kv(l){return l[v_]||null}var IE=[],Vd=-1;function Sc(l){return{current:l}}function Or(l){0>Vd||(l.current=IE[Vd],IE[Vd]=null,Vd--)}function Lr(l,u){Vd++,IE[Vd]=l.current,l.current=u}var Tc={},po=Sc(Tc),$o=Sc(!1),Vh=Tc;function tp(l,u){var f=l.type.contextTypes;if(!f)return Tc;var y=l.stateNode;if(y&&y.__reactInternalMemoizedUnmaskedChildContext===u)return y.__reactInternalMemoizedMaskedChildContext;var b={},C;for(C in f)b[C]=u[C];return y&&(l=l.stateNode,l.__reactInternalMemoizedUnmaskedChildContext=u,l.__reactInternalMemoizedMaskedChildContext=b),b}function Ko(l){return l=l.childContextTypes,l!=null}function uv(){Or($o),Or(po)}function CB(l,u,f){if(po.current!==Tc)throw Error(he(168));Lr(po,u),Lr($o,f)}function T5(l,u,f){var y=l.stateNode;if(u=u.childContextTypes,typeof y.getChildContext!="function")return f;y=y.getChildContext();for(var b in y)if(!(b in u))throw Error(he(108,tO(l)||"Unknown",b));return Qr({},f,y)}function cv(l){return l=(l=l.stateNode)&&l.__reactInternalMemoizedMergedChildContext||Tc,Vh=po.current,Lr(po,l),Lr($o,$o.current),!0}function SB(l,u,f){var y=l.stateNode;if(!y)throw Error(he(169));f?(l=T5(l,u,Vh),y.__reactInternalMemoizedMergedChildContext=l,Or($o),Or(po),Lr(po,l)):Or($o),Lr($o,f)}var Xl=null,Fv=!1,WA=!1;function C5(l){Xl===null?Xl=[l]:Xl.push(l)}function _4(l){Fv=!0,C5(l)}function Mc(){if(!WA&&Xl!==null){WA=!0;var l=0,u=vr;try{var f=Xl;for(vr=1;l<f.length;l++){var y=f[l];do y=y(!0);while(y!==null)}Xl=null,Fv=!1}catch(b){throw Xl!==null&&(Xl=Xl.slice(l+1)),XD(cT,Mc),b}finally{vr=u,WA=!1}}return null}var Gd=[],jd=0,hv=null,fv=0,Ns=[],Us=0,Gh=null,Yl=1,Ql="";function Rh(l,u){Gd[jd++]=fv,Gd[jd++]=hv,hv=l,fv=u}function S5(l,u,f){Ns[Us++]=Yl,Ns[Us++]=Ql,Ns[Us++]=Gh,Gh=l;var y=Yl;l=Ql;var b=32-Ta(y)-1;y&=~(1<<b),f+=1;var C=32-Ta(u)+b;if(30<C){var P=b-b%5;C=(y&(1<<P)-1).toString(32),y>>=P,b-=P,Yl=1<<32-Ta(u)+b|f<<b|y,Ql=C+l}else Yl=1<<C|f<<b|y,Ql=l}function xT(l){l.return!==null&&(Rh(l,1),S5(l,1,0))}function vT(l){for(;l===hv;)hv=Gd[--jd],Gd[jd]=null,fv=Gd[--jd],Gd[jd]=null;for(;l===Gh;)Gh=Ns[--Us],Ns[Us]=null,Ql=Ns[--Us],Ns[Us]=null,Yl=Ns[--Us],Ns[Us]=null}var us=null,ls=null,jr=!1,Ea=null;function M5(l,u){var f=Vs(5,null,null,0);f.elementType="DELETED",f.stateNode=u,f.return=l,u=l.deletions,u===null?(l.deletions=[f],l.flags|=16):u.push(f)}function MB(l,u){switch(l.tag){case 5:var f=l.type;return u=u.nodeType!==1||f.toLowerCase()!==u.nodeName.toLowerCase()?null:u,u!==null?(l.stateNode=u,us=l,ls=xc(u.firstChild),!0):!1;case 6:return u=l.pendingProps===""||u.nodeType!==3?null:u,u!==null?(l.stateNode=u,us=l,ls=null,!0):!1;case 13:return u=u.nodeType!==8?null:u,u!==null?(f=Gh!==null?{id:Yl,overflow:Ql}:null,l.memoizedState={dehydrated:u,treeContext:f,retryLane:1073741824},f=Vs(18,null,null,0),f.stateNode=u,f.return=l,l.child=f,us=l,ls=null,!0):!1;default:return!1}}function BE(l){return(l.mode&1)!==0&&(l.flags&128)===0}function DE(l){if(jr){var u=ls;if(u){var f=u;if(!MB(l,u)){if(BE(l))throw Error(he(418));u=xc(f.nextSibling);var y=us;u&&MB(l,u)?M5(y,f):(l.flags=l.flags&-4097|2,jr=!1,us=l)}}else{if(BE(l))throw Error(he(418));l.flags=l.flags&-4097|2,jr=!1,us=l}}}function IB(l){for(l=l.return;l!==null&&l.tag!==5&&l.tag!==3&&l.tag!==13;)l=l.return;us=l}function Rx(l){if(l!==us)return!1;if(!jr)return IB(l),jr=!0,!1;var u;if((u=l.tag!==3)&&!(u=l.tag!==5)&&(u=l.type,u=u!=="head"&&u!=="body"&&!CE(l.type,l.memoizedProps)),u&&(u=ls)){if(BE(l))throw I5(),Error(he(418));for(;u;)M5(l,u),u=xc(u.nextSibling)}if(IB(l),l.tag===13){if(l=l.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(he(317));t:{for(l=l.nextSibling,u=0;l;){if(l.nodeType===8){var f=l.data;if(f==="/$"){if(u===0){ls=xc(l.nextSibling);break t}u--}else f!=="$"&&f!=="$!"&&f!=="$?"||u++}l=l.nextSibling}ls=null}}else ls=us?xc(l.stateNode.nextSibling):null;return!0}function I5(){for(var l=ls;l;)l=xc(l.nextSibling)}function ep(){ls=us=null,jr=!1}function wT(l){Ea===null?Ea=[l]:Ea.push(l)}var y4=ou.ReactCurrentBatchConfig;function ba(l,u){if(l&&l.defaultProps){u=Qr({},u),l=l.defaultProps;for(var f in l)u[f]===void 0&&(u[f]=l[f]);return u}return u}var dv=Sc(null),pv=null,Hd=null,bT=null;function AT(){bT=Hd=pv=null}function ET(l){var u=dv.current;Or(dv),l._currentValue=u}function PE(l,u,f){for(;l!==null;){var y=l.alternate;if((l.childLanes&u)!==u?(l.childLanes|=u,y!==null&&(y.childLanes|=u)):y!==null&&(y.childLanes&u)!==u&&(y.childLanes|=u),l===f)break;l=l.return}}function Xd(l,u){pv=l,bT=Hd=null,l=l.dependencies,l!==null&&l.firstContext!==null&&(l.lanes&u&&(Jo=!0),l.firstContext=null)}function js(l){var u=l._currentValue;if(bT!==l)if(l={context:l,memoizedValue:u,next:null},Hd===null){if(pv===null)throw Error(he(308));Hd=l,pv.dependencies={lanes:0,firstContext:l}}else Hd=Hd.next=l;return u}var zh=null;function TT(l){zh===null?zh=[l]:zh.push(l)}function B5(l,u,f,y){var b=u.interleaved;return b===null?(f.next=f,TT(u)):(f.next=b.next,b.next=f),u.interleaved=f,ru(l,y)}function ru(l,u){l.lanes|=u;var f=l.alternate;for(f!==null&&(f.lanes|=u),f=l,l=l.return;l!==null;)l.childLanes|=u,f=l.alternate,f!==null&&(f.childLanes|=u),f=l,l=l.return;return f.tag===3?f.stateNode:null}var hc=!1;function CT(l){l.updateQueue={baseState:l.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function D5(l,u){l=l.updateQueue,u.updateQueue===l&&(u.updateQueue={baseState:l.baseState,firstBaseUpdate:l.firstBaseUpdate,lastBaseUpdate:l.lastBaseUpdate,shared:l.shared,effects:l.effects})}function tu(l,u){return{eventTime:l,lane:u,tag:0,payload:null,callback:null,next:null}}function vc(l,u,f){var y=l.updateQueue;if(y===null)return null;if(y=y.shared,Yn&2){var b=y.pending;return b===null?u.next=u:(u.next=b.next,b.next=u),y.pending=u,ru(l,f)}return b=y.interleaved,b===null?(u.next=u,TT(y)):(u.next=b.next,b.next=u),y.interleaved=u,ru(l,f)}function Wx(l,u,f){if(u=u.updateQueue,u!==null&&(u=u.shared,(f&4194240)!==0)){var y=u.lanes;y&=l.pendingLanes,f|=y,u.lanes=f,hT(l,f)}}function BB(l,u){var f=l.updateQueue,y=l.alternate;if(y!==null&&(y=y.updateQueue,f===y)){var b=null,C=null;if(f=f.firstBaseUpdate,f!==null){do{var P={eventTime:f.eventTime,lane:f.lane,tag:f.tag,payload:f.payload,callback:f.callback,next:null};C===null?b=C=P:C=C.next=P,f=f.next}while(f!==null);C===null?b=C=u:C=C.next=u}else b=C=u;f={baseState:y.baseState,firstBaseUpdate:b,lastBaseUpdate:C,shared:y.shared,effects:y.effects},l.updateQueue=f;return}l=f.lastBaseUpdate,l===null?f.firstBaseUpdate=u:l.next=u,f.lastBaseUpdate=u}function mv(l,u,f,y){var b=l.updateQueue;hc=!1;var C=b.firstBaseUpdate,P=b.lastBaseUpdate,O=b.shared.pending;if(O!==null){b.shared.pending=null;var F=O,k=F.next;F.next=null,P===null?C=k:P.next=k,P=F;var ot=l.alternate;ot!==null&&(ot=ot.updateQueue,O=ot.lastBaseUpdate,O!==P&&(O===null?ot.firstBaseUpdate=k:O.next=k,ot.lastBaseUpdate=F))}if(C!==null){var ft=b.baseState;P=0,ot=k=F=null,O=C;do{var X=O.lane,zt=O.eventTime;if((y&X)===X){ot!==null&&(ot=ot.next={eventTime:zt,lane:0,tag:O.tag,payload:O.payload,callback:O.callback,next:null});t:{var Lt=l,Ht=O;switch(X=u,zt=f,Ht.tag){case 1:if(Lt=Ht.payload,typeof Lt=="function"){ft=Lt.call(zt,ft,X);break t}ft=Lt;break t;case 3:Lt.flags=Lt.flags&-65537|128;case 0:if(Lt=Ht.payload,X=typeof Lt=="function"?Lt.call(zt,ft,X):Lt,X==null)break t;ft=Qr({},ft,X);break t;case 2:hc=!0}}O.callback!==null&&O.lane!==0&&(l.flags|=64,X=b.effects,X===null?b.effects=[O]:X.push(O))}else zt={eventTime:zt,lane:X,tag:O.tag,payload:O.payload,callback:O.callback,next:null},ot===null?(k=ot=zt,F=ft):ot=ot.next=zt,P|=X;if(O=O.next,O===null){if(O=b.shared.pending,O===null)break;X=O,O=X.next,X.next=null,b.lastBaseUpdate=X,b.shared.pending=null}}while(!0);if(ot===null&&(F=ft),b.baseState=F,b.firstBaseUpdate=k,b.lastBaseUpdate=ot,u=b.shared.interleaved,u!==null){b=u;do P|=b.lane,b=b.next;while(b!==u)}else C===null&&(b.shared.lanes=0);Hh|=P,l.lanes=P,l.memoizedState=ft}}function DB(l,u,f){if(l=u.effects,u.effects=null,l!==null)for(u=0;u<l.length;u++){var y=l[u],b=y.callback;if(b!==null){if(y.callback=null,y=f,typeof b!="function")throw Error(he(191,b));b.call(y)}}}var P5=new BD.Component().refs;function LE(l,u,f,y){u=l.memoizedState,f=f(y,u),f=f==null?u:Qr({},u,f),l.memoizedState=f,l.lanes===0&&(l.updateQueue.baseState=f)}var zv={isMounted:function(l){return(l=l._reactInternals)?qh(l)===l:!1},enqueueSetState:function(l,u,f){l=l._reactInternals;var y=So(),b=bc(l),C=tu(y,b);C.payload=u,f!=null&&(C.callback=f),u=vc(l,C,b),u!==null&&(Ca(u,l,b,y),Wx(u,l,b))},enqueueReplaceState:function(l,u,f){l=l._reactInternals;var y=So(),b=bc(l),C=tu(y,b);C.tag=1,C.payload=u,f!=null&&(C.callback=f),u=vc(l,C,b),u!==null&&(Ca(u,l,b,y),Wx(u,l,b))},enqueueForceUpdate:function(l,u){l=l._reactInternals;var f=So(),y=bc(l),b=tu(f,y);b.tag=2,u!=null&&(b.callback=u),u=vc(l,b,y),u!==null&&(Ca(u,l,y,f),Wx(u,l,y))}};function PB(l,u,f,y,b,C,P){return l=l.stateNode,typeof l.shouldComponentUpdate=="function"?l.shouldComponentUpdate(y,C,P):u.prototype&&u.prototype.isPureReactComponent?!__(f,y)||!__(b,C):!0}function L5(l,u,f){var y=!1,b=Tc,C=u.contextType;return typeof C=="object"&&C!==null?C=js(C):(b=Ko(u)?Vh:po.current,y=u.contextTypes,C=(y=y!=null)?tp(l,b):Tc),u=new u(f,C),l.memoizedState=u.state!==null&&u.state!==void 0?u.state:null,u.updater=zv,l.stateNode=u,u._reactInternals=l,y&&(l=l.stateNode,l.__reactInternalMemoizedUnmaskedChildContext=b,l.__reactInternalMemoizedMaskedChildContext=C),u}function LB(l,u,f,y){l=u.state,typeof u.componentWillReceiveProps=="function"&&u.componentWillReceiveProps(f,y),typeof u.UNSAFE_componentWillReceiveProps=="function"&&u.UNSAFE_componentWillReceiveProps(f,y),u.state!==l&&zv.enqueueReplaceState(u,u.state,null)}function RE(l,u,f,y){var b=l.stateNode;b.props=f,b.state=l.memoizedState,b.refs=P5,CT(l);var C=u.contextType;typeof C=="object"&&C!==null?b.context=js(C):(C=Ko(u)?Vh:po.current,b.context=tp(l,C)),b.state=l.memoizedState,C=u.getDerivedStateFromProps,typeof C=="function"&&(LE(l,u,C,f),b.state=l.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(u=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),u!==b.state&&zv.enqueueReplaceState(b,b.state,null),mv(l,f,b,y),b.state=l.memoizedState),typeof b.componentDidMount=="function"&&(l.flags|=4194308)}function Zg(l,u,f){if(l=f.ref,l!==null&&typeof l!="function"&&typeof l!="object"){if(f._owner){if(f=f._owner,f){if(f.tag!==1)throw Error(he(309));var y=f.stateNode}if(!y)throw Error(he(147,l));var b=y,C=""+l;return u!==null&&u.ref!==null&&typeof u.ref=="function"&&u.ref._stringRef===C?u.ref:(u=function(P){var O=b.refs;O===P5&&(O=b.refs={}),P===null?delete O[C]:O[C]=P},u._stringRef=C,u)}if(typeof l!="string")throw Error(he(284));if(!f._owner)throw Error(he(290,l))}return l}function kx(l,u){throw l=Object.prototype.toString.call(u),Error(he(31,l==="[object Object]"?"object with keys {"+Object.keys(u).join(", ")+"}":l))}function RB(l){var u=l._init;return u(l._payload)}function R5(l){function u(mt,at){if(l){var xt=mt.deletions;xt===null?(mt.deletions=[at],mt.flags|=16):xt.push(at)}}function f(mt,at){if(!l)return null;for(;at!==null;)u(mt,at),at=at.sibling;return null}function y(mt,at){for(mt=new Map;at!==null;)at.key!==null?mt.set(at.key,at):mt.set(at.index,at),at=at.sibling;return mt}function b(mt,at){return mt=Ac(mt,at),mt.index=0,mt.sibling=null,mt}function C(mt,at,xt){return mt.index=xt,l?(xt=mt.alternate,xt!==null?(xt=xt.index,xt<at?(mt.flags|=2,at):xt):(mt.flags|=2,at)):(mt.flags|=1048576,at)}function P(mt){return l&&mt.alternate===null&&(mt.flags|=2),mt}function O(mt,at,xt,It){return at===null||at.tag!==6?(at=QA(xt,mt.mode,It),at.return=mt,at):(at=b(at,xt),at.return=mt,at)}function F(mt,at,xt,It){var Xt=xt.type;return Xt===Fd?ot(mt,at,xt.props.children,It,xt.key):at!==null&&(at.elementType===Xt||typeof Xt=="object"&&Xt!==null&&Xt.$$typeof===cc&&RB(Xt)===at.type)?(It=b(at,xt.props),It.ref=Zg(mt,at,xt),It.return=mt,It):(It=Yx(xt.type,xt.key,xt.props,null,mt.mode,It),It.ref=Zg(mt,at,xt),It.return=mt,It)}function k(mt,at,xt,It){return at===null||at.tag!==4||at.stateNode.containerInfo!==xt.containerInfo||at.stateNode.implementation!==xt.implementation?(at=tE(xt,mt.mode,It),at.return=mt,at):(at=b(at,xt.children||[]),at.return=mt,at)}function ot(mt,at,xt,It,Xt){return at===null||at.tag!==7?(at=Uh(xt,mt.mode,It,Xt),at.return=mt,at):(at=b(at,xt),at.return=mt,at)}function ft(mt,at,xt){if(typeof at=="string"&&at!==""||typeof at=="number")return at=QA(""+at,mt.mode,xt),at.return=mt,at;if(typeof at=="object"&&at!==null){switch(at.$$typeof){case Ex:return xt=Yx(at.type,at.key,at.props,null,mt.mode,xt),xt.ref=Zg(mt,null,at),xt.return=mt,xt;case kd:return at=tE(at,mt.mode,xt),at.return=mt,at;case cc:var It=at._init;return ft(mt,It(at._payload),xt)}if(Xg(at)||Ug(at))return at=Uh(at,mt.mode,xt,null),at.return=mt,at;kx(mt,at)}return null}function X(mt,at,xt,It){var Xt=at!==null?at.key:null;if(typeof xt=="string"&&xt!==""||typeof xt=="number")return Xt!==null?null:O(mt,at,""+xt,It);if(typeof xt=="object"&&xt!==null){switch(xt.$$typeof){case Ex:return xt.key===Xt?F(mt,at,xt,It):null;case kd:return xt.key===Xt?k(mt,at,xt,It):null;case cc:return Xt=xt._init,X(mt,at,Xt(xt._payload),It)}if(Xg(xt)||Ug(xt))return Xt!==null?null:ot(mt,at,xt,It,null);kx(mt,xt)}return null}function zt(mt,at,xt,It,Xt){if(typeof It=="string"&&It!==""||typeof It=="number")return mt=mt.get(xt)||null,O(at,mt,""+It,Xt);if(typeof It=="object"&&It!==null){switch(It.$$typeof){case Ex:return mt=mt.get(It.key===null?xt:It.key)||null,F(at,mt,It,Xt);case kd:return mt=mt.get(It.key===null?xt:It.key)||null,k(at,mt,It,Xt);case cc:var ue=It._init;return zt(mt,at,xt,ue(It._payload),Xt)}if(Xg(It)||Ug(It))return mt=mt.get(xt)||null,ot(at,mt,It,Xt,null);kx(at,It)}return null}function Lt(mt,at,xt,It){for(var Xt=null,ue=null,oe=at,me=at=0,Nn=null;oe!==null&&me<xt.length;me++){oe.index>me?(Nn=oe,oe=null):Nn=oe.sibling;var nt=X(mt,oe,xt[me],It);if(nt===null){oe===null&&(oe=Nn);break}l&&oe&&nt.alternate===null&&u(mt,oe),at=C(nt,at,me),ue===null?Xt=nt:ue.sibling=nt,ue=nt,oe=Nn}if(me===xt.length)return f(mt,oe),jr&&Rh(mt,me),Xt;if(oe===null){for(;me<xt.length;me++)oe=ft(mt,xt[me],It),oe!==null&&(at=C(oe,at,me),ue===null?Xt=oe:ue.sibling=oe,ue=oe);return jr&&Rh(mt,me),Xt}for(oe=y(mt,oe);me<xt.length;me++)Nn=zt(oe,mt,me,xt[me],It),Nn!==null&&(l&&Nn.alternate!==null&&oe.delete(Nn.key===null?me:Nn.key),at=C(Nn,at,me),ue===null?Xt=Nn:ue.sibling=Nn,ue=Nn);return l&&oe.forEach(function(Re){return u(mt,Re)}),jr&&Rh(mt,me),Xt}function Ht(mt,at,xt,It){var Xt=Ug(xt);if(typeof Xt!="function")throw Error(he(150));if(xt=Xt.call(xt),xt==null)throw Error(he(151));for(var ue=Xt=null,oe=at,me=at=0,Nn=null,nt=xt.next();oe!==null&&!nt.done;me++,nt=xt.next()){oe.index>me?(Nn=oe,oe=null):Nn=oe.sibling;var Re=X(mt,oe,nt.value,It);if(Re===null){oe===null&&(oe=Nn);break}l&&oe&&Re.alternate===null&&u(mt,oe),at=C(Re,at,me),ue===null?Xt=Re:ue.sibling=Re,ue=Re,oe=Nn}if(nt.done)return f(mt,oe),jr&&Rh(mt,me),Xt;if(oe===null){for(;!nt.done;me++,nt=xt.next())nt=ft(mt,nt.value,It),nt!==null&&(at=C(nt,at,me),ue===null?Xt=nt:ue.sibling=nt,ue=nt);return jr&&Rh(mt,me),Xt}for(oe=y(mt,oe);!nt.done;me++,nt=xt.next())nt=zt(oe,mt,me,nt.value,It),nt!==null&&(l&&nt.alternate!==null&&oe.delete(nt.key===null?me:nt.key),at=C(nt,at,me),ue===null?Xt=nt:ue.sibling=nt,ue=nt);return l&&oe.forEach(function(ds){return u(mt,ds)}),jr&&Rh(mt,me),Xt}function we(mt,at,xt,It){if(typeof xt=="object"&&xt!==null&&xt.type===Fd&&xt.key===null&&(xt=xt.props.children),typeof xt=="object"&&xt!==null){switch(xt.$$typeof){case Ex:t:{for(var Xt=xt.key,ue=at;ue!==null;){if(ue.key===Xt){if(Xt=xt.type,Xt===Fd){if(ue.tag===7){f(mt,ue.sibling),at=b(ue,xt.props.children),at.return=mt,mt=at;break t}}else if(ue.elementType===Xt||typeof Xt=="object"&&Xt!==null&&Xt.$$typeof===cc&&RB(Xt)===ue.type){f(mt,ue.sibling),at=b(ue,xt.props),at.ref=Zg(mt,ue,xt),at.return=mt,mt=at;break t}f(mt,ue);break}else u(mt,ue);ue=ue.sibling}xt.type===Fd?(at=Uh(xt.props.children,mt.mode,It,xt.key),at.return=mt,mt=at):(It=Yx(xt.type,xt.key,xt.props,null,mt.mode,It),It.ref=Zg(mt,at,xt),It.return=mt,mt=It)}return P(mt);case kd:t:{for(ue=xt.key;at!==null;){if(at.key===ue)if(at.tag===4&&at.stateNode.containerInfo===xt.containerInfo&&at.stateNode.implementation===xt.implementation){f(mt,at.sibling),at=b(at,xt.children||[]),at.return=mt,mt=at;break t}else{f(mt,at);break}else u(mt,at);at=at.sibling}at=tE(xt,mt.mode,It),at.return=mt,mt=at}return P(mt);case cc:return ue=xt._init,we(mt,at,ue(xt._payload),It)}if(Xg(xt))return Lt(mt,at,xt,It);if(Ug(xt))return Ht(mt,at,xt,It);kx(mt,xt)}return typeof xt=="string"&&xt!==""||typeof xt=="number"?(xt=""+xt,at!==null&&at.tag===6?(f(mt,at.sibling),at=b(at,xt),at.return=mt,mt=at):(f(mt,at),at=QA(xt,mt.mode,It),at.return=mt,mt=at),P(mt)):f(mt,at)}return we}var np=R5(!0),k5=R5(!1),L_={},cl=Sc(L_),w_=Sc(L_),b_=Sc(L_);function Oh(l){if(l===L_)throw Error(he(174));return l}function ST(l,u){switch(Lr(b_,u),Lr(w_,l),Lr(cl,L_),l=u.nodeType,l){case 9:case 11:u=(u=u.documentElement)?u.namespaceURI:fE(null,"");break;default:l=l===8?u.parentNode:u,u=l.namespaceURI||null,l=l.tagName,u=fE(u,l)}Or(cl),Lr(cl,u)}function rp(){Or(cl),Or(w_),Or(b_)}function F5(l){Oh(b_.current);var u=Oh(cl.current),f=fE(u,l.type);u!==f&&(Lr(w_,l),Lr(cl,f))}function MT(l){w_.current===l&&(Or(cl),Or(w_))}var Xr=Sc(0);function gv(l){for(var u=l;u!==null;){if(u.tag===13){var f=u.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||f.data==="$?"||f.data==="$!"))return u}else if(u.tag===19&&u.memoizedProps.revealOrder!==void 0){if(u.flags&128)return u}else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===l)break;for(;u.sibling===null;){if(u.return===null||u.return===l)return null;u=u.return}u.sibling.return=u.return,u=u.sibling}return null}var qA=[];function IT(){for(var l=0;l<qA.length;l++)qA[l]._workInProgressVersionPrimary=null;qA.length=0}var qx=ou.ReactCurrentDispatcher,JA=ou.ReactCurrentBatchConfig,jh=0,Yr=null,Ci=null,zi=null,_v=!1,o_=!1,A_=0,x4=0;function co(){throw Error(he(321))}function BT(l,u){if(u===null)return!1;for(var f=0;f<u.length&&f<l.length;f++)if(!Sa(l[f],u[f]))return!1;return!0}function DT(l,u,f,y,b,C){if(jh=C,Yr=u,u.memoizedState=null,u.updateQueue=null,u.lanes=0,qx.current=l===null||l.memoizedState===null?A4:E4,l=f(y,b),o_){C=0;do{if(o_=!1,A_=0,25<=C)throw Error(he(301));C+=1,zi=Ci=null,u.updateQueue=null,qx.current=T4,l=f(y,b)}while(o_)}if(qx.current=yv,u=Ci!==null&&Ci.next!==null,jh=0,zi=Ci=Yr=null,_v=!1,u)throw Error(he(300));return l}function PT(){var l=A_!==0;return A_=0,l}function sl(){var l={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return zi===null?Yr.memoizedState=zi=l:zi=zi.next=l,zi}function Hs(){if(Ci===null){var l=Yr.alternate;l=l!==null?l.memoizedState:null}else l=Ci.next;var u=zi===null?Yr.memoizedState:zi.next;if(u!==null)zi=u,Ci=l;else{if(l===null)throw Error(he(310));Ci=l,l={memoizedState:Ci.memoizedState,baseState:Ci.baseState,baseQueue:Ci.baseQueue,queue:Ci.queue,next:null},zi===null?Yr.memoizedState=zi=l:zi=zi.next=l}return zi}function E_(l,u){return typeof u=="function"?u(l):u}function $A(l){var u=Hs(),f=u.queue;if(f===null)throw Error(he(311));f.lastRenderedReducer=l;var y=Ci,b=y.baseQueue,C=f.pending;if(C!==null){if(b!==null){var P=b.next;b.next=C.next,C.next=P}y.baseQueue=b=C,f.pending=null}if(b!==null){C=b.next,y=y.baseState;var O=P=null,F=null,k=C;do{var ot=k.lane;if((jh&ot)===ot)F!==null&&(F=F.next={lane:0,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null}),y=k.hasEagerState?k.eagerState:l(y,k.action);else{var ft={lane:ot,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null};F===null?(O=F=ft,P=y):F=F.next=ft,Yr.lanes|=ot,Hh|=ot}k=k.next}while(k!==null&&k!==C);F===null?P=y:F.next=O,Sa(y,u.memoizedState)||(Jo=!0),u.memoizedState=y,u.baseState=P,u.baseQueue=F,f.lastRenderedState=y}if(l=f.interleaved,l!==null){b=l;do C=b.lane,Yr.lanes|=C,Hh|=C,b=b.next;while(b!==l)}else b===null&&(f.lanes=0);return[u.memoizedState,f.dispatch]}function KA(l){var u=Hs(),f=u.queue;if(f===null)throw Error(he(311));f.lastRenderedReducer=l;var y=f.dispatch,b=f.pending,C=u.memoizedState;if(b!==null){f.pending=null;var P=b=b.next;do C=l(C,P.action),P=P.next;while(P!==b);Sa(C,u.memoizedState)||(Jo=!0),u.memoizedState=C,u.baseQueue===null&&(u.baseState=C),f.lastRenderedState=C}return[C,y]}function z5(){}function O5(l,u){var f=Yr,y=Hs(),b=u(),C=!Sa(y.memoizedState,b);if(C&&(y.memoizedState=b,Jo=!0),y=y.queue,LT(V5.bind(null,f,y,l),[l]),y.getSnapshot!==u||C||zi!==null&&zi.memoizedState.tag&1){if(f.flags|=2048,T_(9,U5.bind(null,f,y,b,u),void 0,null),Oi===null)throw Error(he(349));jh&30||N5(f,u,b)}return b}function N5(l,u,f){l.flags|=16384,l={getSnapshot:u,value:f},u=Yr.updateQueue,u===null?(u={lastEffect:null,stores:null},Yr.updateQueue=u,u.stores=[l]):(f=u.stores,f===null?u.stores=[l]:f.push(l))}function U5(l,u,f,y){u.value=f,u.getSnapshot=y,G5(u)&&j5(l)}function V5(l,u,f){return f(function(){G5(u)&&j5(l)})}function G5(l){var u=l.getSnapshot;l=l.value;try{var f=u();return!Sa(l,f)}catch{return!0}}function j5(l){var u=ru(l,1);u!==null&&Ca(u,l,1,-1)}function kB(l){var u=sl();return typeof l=="function"&&(l=l()),u.memoizedState=u.baseState=l,l={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:E_,lastRenderedState:l},u.queue=l,l=l.dispatch=b4.bind(null,Yr,l),[u.memoizedState,l]}function T_(l,u,f,y){return l={tag:l,create:u,destroy:f,deps:y,next:null},u=Yr.updateQueue,u===null?(u={lastEffect:null,stores:null},Yr.updateQueue=u,u.lastEffect=l.next=l):(f=u.lastEffect,f===null?u.lastEffect=l.next=l:(y=f.next,f.next=l,l.next=y,u.lastEffect=l)),l}function H5(){return Hs().memoizedState}function Jx(l,u,f,y){var b=sl();Yr.flags|=l,b.memoizedState=T_(1|u,f,void 0,y===void 0?null:y)}function Ov(l,u,f,y){var b=Hs();y=y===void 0?null:y;var C=void 0;if(Ci!==null){var P=Ci.memoizedState;if(C=P.destroy,y!==null&&BT(y,P.deps)){b.memoizedState=T_(u,f,C,y);return}}Yr.flags|=l,b.memoizedState=T_(1|u,f,C,y)}function FB(l,u){return Jx(8390656,8,l,u)}function LT(l,u){return Ov(2048,8,l,u)}function Z5(l,u){return Ov(4,2,l,u)}function W5(l,u){return Ov(4,4,l,u)}function q5(l,u){if(typeof u=="function")return l=l(),u(l),function(){u(null)};if(u!=null)return l=l(),u.current=l,function(){u.current=null}}function J5(l,u,f){return f=f!=null?f.concat([l]):null,Ov(4,4,q5.bind(null,u,l),f)}function RT(){}function $5(l,u){var f=Hs();u=u===void 0?null:u;var y=f.memoizedState;return y!==null&&u!==null&&BT(u,y[1])?y[0]:(f.memoizedState=[l,u],l)}function K5(l,u){var f=Hs();u=u===void 0?null:u;var y=f.memoizedState;return y!==null&&u!==null&&BT(u,y[1])?y[0]:(l=l(),f.memoizedState=[l,u],l)}function X5(l,u,f){return jh&21?(Sa(f,u)||(f=t5(),Yr.lanes|=f,Hh|=f,l.baseState=!0),u):(l.baseState&&(l.baseState=!1,Jo=!0),l.memoizedState=f)}function v4(l,u){var f=vr;vr=f!==0&&4>f?f:4,l(!0);var y=JA.transition;JA.transition={};try{l(!1),u()}finally{vr=f,JA.transition=y}}function Y5(){return Hs().memoizedState}function w4(l,u,f){var y=bc(l);if(f={lane:y,action:f,hasEagerState:!1,eagerState:null,next:null},Q5(l))t3(u,f);else if(f=B5(l,u,f,y),f!==null){var b=So();Ca(f,l,y,b),e3(f,u,y)}}function b4(l,u,f){var y=bc(l),b={lane:y,action:f,hasEagerState:!1,eagerState:null,next:null};if(Q5(l))t3(u,b);else{var C=l.alternate;if(l.lanes===0&&(C===null||C.lanes===0)&&(C=u.lastRenderedReducer,C!==null))try{var P=u.lastRenderedState,O=C(P,f);if(b.hasEagerState=!0,b.eagerState=O,Sa(O,P)){var F=u.interleaved;F===null?(b.next=b,TT(u)):(b.next=F.next,F.next=b),u.interleaved=b;return}}catch{}finally{}f=B5(l,u,b,y),f!==null&&(b=So(),Ca(f,l,y,b),e3(f,u,y))}}function Q5(l){var u=l.alternate;return l===Yr||u!==null&&u===Yr}function t3(l,u){o_=_v=!0;var f=l.pending;f===null?u.next=u:(u.next=f.next,f.next=u),l.pending=u}function e3(l,u,f){if(f&4194240){var y=u.lanes;y&=l.pendingLanes,f|=y,u.lanes=f,hT(l,f)}}var yv={readContext:js,useCallback:co,useContext:co,useEffect:co,useImperativeHandle:co,useInsertionEffect:co,useLayoutEffect:co,useMemo:co,useReducer:co,useRef:co,useState:co,useDebugValue:co,useDeferredValue:co,useTransition:co,useMutableSource:co,useSyncExternalStore:co,useId:co,unstable_isNewReconciler:!1},A4={readContext:js,useCallback:function(l,u){return sl().memoizedState=[l,u===void 0?null:u],l},useContext:js,useEffect:FB,useImperativeHandle:function(l,u,f){return f=f!=null?f.concat([l]):null,Jx(4194308,4,q5.bind(null,u,l),f)},useLayoutEffect:function(l,u){return Jx(4194308,4,l,u)},useInsertionEffect:function(l,u){return Jx(4,2,l,u)},useMemo:function(l,u){var f=sl();return u=u===void 0?null:u,l=l(),f.memoizedState=[l,u],l},useReducer:function(l,u,f){var y=sl();return u=f!==void 0?f(u):u,y.memoizedState=y.baseState=u,l={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:l,lastRenderedState:u},y.queue=l,l=l.dispatch=w4.bind(null,Yr,l),[y.memoizedState,l]},useRef:function(l){var u=sl();return l={current:l},u.memoizedState=l},useState:kB,useDebugValue:RT,useDeferredValue:function(l){return sl().memoizedState=l},useTransition:function(){var l=kB(!1),u=l[0];return l=v4.bind(null,l[1]),sl().memoizedState=l,[u,l]},useMutableSource:function(){},useSyncExternalStore:function(l,u,f){var y=Yr,b=sl();if(jr){if(f===void 0)throw Error(he(407));f=f()}else{if(f=u(),Oi===null)throw Error(he(349));jh&30||N5(y,u,f)}b.memoizedState=f;var C={value:f,getSnapshot:u};return b.queue=C,FB(V5.bind(null,y,C,l),[l]),y.flags|=2048,T_(9,U5.bind(null,y,C,f,u),void 0,null),f},useId:function(){var l=sl(),u=Oi.identifierPrefix;if(jr){var f=Ql,y=Yl;f=(y&~(1<<32-Ta(y)-1)).toString(32)+f,u=":"+u+"R"+f,f=A_++,0<f&&(u+="H"+f.toString(32)),u+=":"}else f=x4++,u=":"+u+"r"+f.toString(32)+":";return l.memoizedState=u},unstable_isNewReconciler:!1},E4={readContext:js,useCallback:$5,useContext:js,useEffect:LT,useImperativeHandle:J5,useInsertionEffect:Z5,useLayoutEffect:W5,useMemo:K5,useReducer:$A,useRef:H5,useState:function(){return $A(E_)},useDebugValue:RT,useDeferredValue:function(l){var u=Hs();return X5(u,Ci.memoizedState,l)},useTransition:function(){var l=$A(E_)[0],u=Hs().memoizedState;return[l,u]},useMutableSource:z5,useSyncExternalStore:O5,useId:Y5,unstable_isNewReconciler:!1},T4={readContext:js,useCallback:$5,useContext:js,useEffect:LT,useImperativeHandle:J5,useInsertionEffect:Z5,useLayoutEffect:W5,useMemo:K5,useReducer:KA,useRef:H5,useState:function(){return KA(E_)},useDebugValue:RT,useDeferredValue:function(l){var u=Hs();return Ci===null?u.memoizedState=l:X5(u,Ci.memoizedState,l)},useTransition:function(){var l=KA(E_)[0],u=Hs().memoizedState;return[l,u]},useMutableSource:z5,useSyncExternalStore:O5,useId:Y5,unstable_isNewReconciler:!1};function ip(l,u){try{var f="",y=u;do f+=Qz(y),y=y.return;while(y);var b=f}catch(C){b=`
Error generating stack: `+C.message+`
`+C.stack}return{value:l,source:u,stack:b,digest:null}}function XA(l,u,f){return{value:l,source:null,stack:f??null,digest:u??null}}function kE(l,u){try{console.error(u.value)}catch(f){setTimeout(function(){throw f})}}var C4=typeof WeakMap=="function"?WeakMap:Map;function n3(l,u,f){f=tu(-1,f),f.tag=3,f.payload={element:null};var y=u.value;return f.callback=function(){vv||(vv=!0,ZE=y),kE(l,u)},f}function r3(l,u,f){f=tu(-1,f),f.tag=3;var y=l.type.getDerivedStateFromError;if(typeof y=="function"){var b=u.value;f.payload=function(){return y(b)},f.callback=function(){kE(l,u)}}var C=l.stateNode;return C!==null&&typeof C.componentDidCatch=="function"&&(f.callback=function(){kE(l,u),typeof y!="function"&&(wc===null?wc=new Set([this]):wc.add(this));var P=u.stack;this.componentDidCatch(u.value,{componentStack:P!==null?P:""})}),f}function zB(l,u,f){var y=l.pingCache;if(y===null){y=l.pingCache=new C4;var b=new Set;y.set(u,b)}else b=y.get(u),b===void 0&&(b=new Set,y.set(u,b));b.has(f)||(b.add(f),l=U4.bind(null,l,u,f),u.then(l,l))}function OB(l){do{var u;if((u=l.tag===13)&&(u=l.memoizedState,u=u!==null?u.dehydrated!==null:!0),u)return l;l=l.return}while(l!==null);return null}function NB(l,u,f,y,b){return l.mode&1?(l.flags|=65536,l.lanes=b,l):(l===u?l.flags|=65536:(l.flags|=128,f.flags|=131072,f.flags&=-52805,f.tag===1&&(f.alternate===null?f.tag=17:(u=tu(-1,1),u.tag=2,vc(f,u,1))),f.lanes|=1),l)}var S4=ou.ReactCurrentOwner,Jo=!1;function Co(l,u,f,y){u.child=l===null?k5(u,null,f,y):np(u,l.child,f,y)}function UB(l,u,f,y,b){f=f.render;var C=u.ref;return Xd(u,b),y=DT(l,u,f,y,C,b),f=PT(),l!==null&&!Jo?(u.updateQueue=l.updateQueue,u.flags&=-2053,l.lanes&=~b,iu(l,u,b)):(jr&&f&&xT(u),u.flags|=1,Co(l,u,y,b),u.child)}function VB(l,u,f,y,b){if(l===null){var C=f.type;return typeof C=="function"&&!GT(C)&&C.defaultProps===void 0&&f.compare===null&&f.defaultProps===void 0?(u.tag=15,u.type=C,i3(l,u,C,y,b)):(l=Yx(f.type,null,y,u,u.mode,b),l.ref=u.ref,l.return=u,u.child=l)}if(C=l.child,!(l.lanes&b)){var P=C.memoizedProps;if(f=f.compare,f=f!==null?f:__,f(P,y)&&l.ref===u.ref)return iu(l,u,b)}return u.flags|=1,l=Ac(C,y),l.ref=u.ref,l.return=u,u.child=l}function i3(l,u,f,y,b){if(l!==null){var C=l.memoizedProps;if(__(C,y)&&l.ref===u.ref)if(Jo=!1,u.pendingProps=y=C,(l.lanes&b)!==0)l.flags&131072&&(Jo=!0);else return u.lanes=l.lanes,iu(l,u,b)}return FE(l,u,f,y,b)}function o3(l,u,f){var y=u.pendingProps,b=y.children,C=l!==null?l.memoizedState:null;if(y.mode==="hidden")if(!(u.mode&1))u.memoizedState={baseLanes:0,cachePool:null,transitions:null},Lr(Wd,as),as|=f;else{if(!(f&1073741824))return l=C!==null?C.baseLanes|f:f,u.lanes=u.childLanes=1073741824,u.memoizedState={baseLanes:l,cachePool:null,transitions:null},u.updateQueue=null,Lr(Wd,as),as|=l,null;u.memoizedState={baseLanes:0,cachePool:null,transitions:null},y=C!==null?C.baseLanes:f,Lr(Wd,as),as|=y}else C!==null?(y=C.baseLanes|f,u.memoizedState=null):y=f,Lr(Wd,as),as|=y;return Co(l,u,b,f),u.child}function s3(l,u){var f=u.ref;(l===null&&f!==null||l!==null&&l.ref!==f)&&(u.flags|=512,u.flags|=2097152)}function FE(l,u,f,y,b){var C=Ko(f)?Vh:po.current;return C=tp(u,C),Xd(u,b),f=DT(l,u,f,y,C,b),y=PT(),l!==null&&!Jo?(u.updateQueue=l.updateQueue,u.flags&=-2053,l.lanes&=~b,iu(l,u,b)):(jr&&y&&xT(u),u.flags|=1,Co(l,u,f,b),u.child)}function GB(l,u,f,y,b){if(Ko(f)){var C=!0;cv(u)}else C=!1;if(Xd(u,b),u.stateNode===null)$x(l,u),L5(u,f,y),RE(u,f,y,b),y=!0;else if(l===null){var P=u.stateNode,O=u.memoizedProps;P.props=O;var F=P.context,k=f.contextType;typeof k=="object"&&k!==null?k=js(k):(k=Ko(f)?Vh:po.current,k=tp(u,k));var ot=f.getDerivedStateFromProps,ft=typeof ot=="function"||typeof P.getSnapshotBeforeUpdate=="function";ft||typeof P.UNSAFE_componentWillReceiveProps!="function"&&typeof P.componentWillReceiveProps!="function"||(O!==y||F!==k)&&LB(u,P,y,k),hc=!1;var X=u.memoizedState;P.state=X,mv(u,y,P,b),F=u.memoizedState,O!==y||X!==F||$o.current||hc?(typeof ot=="function"&&(LE(u,f,ot,y),F=u.memoizedState),(O=hc||PB(u,f,O,y,X,F,k))?(ft||typeof P.UNSAFE_componentWillMount!="function"&&typeof P.componentWillMount!="function"||(typeof P.componentWillMount=="function"&&P.componentWillMount(),typeof P.UNSAFE_componentWillMount=="function"&&P.UNSAFE_componentWillMount()),typeof P.componentDidMount=="function"&&(u.flags|=4194308)):(typeof P.componentDidMount=="function"&&(u.flags|=4194308),u.memoizedProps=y,u.memoizedState=F),P.props=y,P.state=F,P.context=k,y=O):(typeof P.componentDidMount=="function"&&(u.flags|=4194308),y=!1)}else{P=u.stateNode,D5(l,u),O=u.memoizedProps,k=u.type===u.elementType?O:ba(u.type,O),P.props=k,ft=u.pendingProps,X=P.context,F=f.contextType,typeof F=="object"&&F!==null?F=js(F):(F=Ko(f)?Vh:po.current,F=tp(u,F));var zt=f.getDerivedStateFromProps;(ot=typeof zt=="function"||typeof P.getSnapshotBeforeUpdate=="function")||typeof P.UNSAFE_componentWillReceiveProps!="function"&&typeof P.componentWillReceiveProps!="function"||(O!==ft||X!==F)&&LB(u,P,y,F),hc=!1,X=u.memoizedState,P.state=X,mv(u,y,P,b);var Lt=u.memoizedState;O!==ft||X!==Lt||$o.current||hc?(typeof zt=="function"&&(LE(u,f,zt,y),Lt=u.memoizedState),(k=hc||PB(u,f,k,y,X,Lt,F)||!1)?(ot||typeof P.UNSAFE_componentWillUpdate!="function"&&typeof P.componentWillUpdate!="function"||(typeof P.componentWillUpdate=="function"&&P.componentWillUpdate(y,Lt,F),typeof P.UNSAFE_componentWillUpdate=="function"&&P.UNSAFE_componentWillUpdate(y,Lt,F)),typeof P.componentDidUpdate=="function"&&(u.flags|=4),typeof P.getSnapshotBeforeUpdate=="function"&&(u.flags|=1024)):(typeof P.componentDidUpdate!="function"||O===l.memoizedProps&&X===l.memoizedState||(u.flags|=4),typeof P.getSnapshotBeforeUpdate!="function"||O===l.memoizedProps&&X===l.memoizedState||(u.flags|=1024),u.memoizedProps=y,u.memoizedState=Lt),P.props=y,P.state=Lt,P.context=F,y=k):(typeof P.componentDidUpdate!="function"||O===l.memoizedProps&&X===l.memoizedState||(u.flags|=4),typeof P.getSnapshotBeforeUpdate!="function"||O===l.memoizedProps&&X===l.memoizedState||(u.flags|=1024),y=!1)}return zE(l,u,f,y,C,b)}function zE(l,u,f,y,b,C){s3(l,u);var P=(u.flags&128)!==0;if(!y&&!P)return b&&SB(u,f,!1),iu(l,u,C);y=u.stateNode,S4.current=u;var O=P&&typeof f.getDerivedStateFromError!="function"?null:y.render();return u.flags|=1,l!==null&&P?(u.child=np(u,l.child,null,C),u.child=np(u,null,O,C)):Co(l,u,O,C),u.memoizedState=y.state,b&&SB(u,f,!0),u.child}function a3(l){var u=l.stateNode;u.pendingContext?CB(l,u.pendingContext,u.pendingContext!==u.context):u.context&&CB(l,u.context,!1),ST(l,u.containerInfo)}function jB(l,u,f,y,b){return ep(),wT(b),u.flags|=256,Co(l,u,f,y),u.child}var OE={dehydrated:null,treeContext:null,retryLane:0};function NE(l){return{baseLanes:l,cachePool:null,transitions:null}}function l3(l,u,f){var y=u.pendingProps,b=Xr.current,C=!1,P=(u.flags&128)!==0,O;if((O=P)||(O=l!==null&&l.memoizedState===null?!1:(b&2)!==0),O?(C=!0,u.flags&=-129):(l===null||l.memoizedState!==null)&&(b|=1),Lr(Xr,b&1),l===null)return DE(u),l=u.memoizedState,l!==null&&(l=l.dehydrated,l!==null)?(u.mode&1?l.data==="$!"?u.lanes=8:u.lanes=1073741824:u.lanes=1,null):(P=y.children,l=y.fallback,C?(y=u.mode,C=u.child,P={mode:"hidden",children:P},!(y&1)&&C!==null?(C.childLanes=0,C.pendingProps=P):C=Vv(P,y,0,null),l=Uh(l,y,f,null),C.return=u,l.return=u,C.sibling=l,u.child=C,u.child.memoizedState=NE(f),u.memoizedState=OE,l):kT(u,P));if(b=l.memoizedState,b!==null&&(O=b.dehydrated,O!==null))return M4(l,u,P,y,O,b,f);if(C){C=y.fallback,P=u.mode,b=l.child,O=b.sibling;var F={mode:"hidden",children:y.children};return!(P&1)&&u.child!==b?(y=u.child,y.childLanes=0,y.pendingProps=F,u.deletions=null):(y=Ac(b,F),y.subtreeFlags=b.subtreeFlags&14680064),O!==null?C=Ac(O,C):(C=Uh(C,P,f,null),C.flags|=2),C.return=u,y.return=u,y.sibling=C,u.child=y,y=C,C=u.child,P=l.child.memoizedState,P=P===null?NE(f):{baseLanes:P.baseLanes|f,cachePool:null,transitions:P.transitions},C.memoizedState=P,C.childLanes=l.childLanes&~f,u.memoizedState=OE,y}return C=l.child,l=C.sibling,y=Ac(C,{mode:"visible",children:y.children}),!(u.mode&1)&&(y.lanes=f),y.return=u,y.sibling=null,l!==null&&(f=u.deletions,f===null?(u.deletions=[l],u.flags|=16):f.push(l)),u.child=y,u.memoizedState=null,y}function kT(l,u){return u=Vv({mode:"visible",children:u},l.mode,0,null),u.return=l,l.child=u}function Fx(l,u,f,y){return y!==null&&wT(y),np(u,l.child,null,f),l=kT(u,u.pendingProps.children),l.flags|=2,u.memoizedState=null,l}function M4(l,u,f,y,b,C,P){if(f)return u.flags&256?(u.flags&=-257,y=XA(Error(he(422))),Fx(l,u,P,y)):u.memoizedState!==null?(u.child=l.child,u.flags|=128,null):(C=y.fallback,b=u.mode,y=Vv({mode:"visible",children:y.children},b,0,null),C=Uh(C,b,P,null),C.flags|=2,y.return=u,C.return=u,y.sibling=C,u.child=y,u.mode&1&&np(u,l.child,null,P),u.child.memoizedState=NE(P),u.memoizedState=OE,C);if(!(u.mode&1))return Fx(l,u,P,null);if(b.data==="$!"){if(y=b.nextSibling&&b.nextSibling.dataset,y)var O=y.dgst;return y=O,C=Error(he(419)),y=XA(C,y,void 0),Fx(l,u,P,y)}if(O=(P&l.childLanes)!==0,Jo||O){if(y=Oi,y!==null){switch(P&-P){case 4:b=2;break;case 16:b=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:b=32;break;case 536870912:b=268435456;break;default:b=0}b=b&(y.suspendedLanes|P)?0:b,b!==0&&b!==C.retryLane&&(C.retryLane=b,ru(l,b),Ca(y,l,b,-1))}return VT(),y=XA(Error(he(421))),Fx(l,u,P,y)}return b.data==="$?"?(u.flags|=128,u.child=l.child,u=V4.bind(null,l),b._reactRetry=u,null):(l=C.treeContext,ls=xc(b.nextSibling),us=u,jr=!0,Ea=null,l!==null&&(Ns[Us++]=Yl,Ns[Us++]=Ql,Ns[Us++]=Gh,Yl=l.id,Ql=l.overflow,Gh=u),u=kT(u,y.children),u.flags|=4096,u)}function HB(l,u,f){l.lanes|=u;var y=l.alternate;y!==null&&(y.lanes|=u),PE(l.return,u,f)}function YA(l,u,f,y,b){var C=l.memoizedState;C===null?l.memoizedState={isBackwards:u,rendering:null,renderingStartTime:0,last:y,tail:f,tailMode:b}:(C.isBackwards=u,C.rendering=null,C.renderingStartTime=0,C.last=y,C.tail=f,C.tailMode=b)}function u3(l,u,f){var y=u.pendingProps,b=y.revealOrder,C=y.tail;if(Co(l,u,y.children,f),y=Xr.current,y&2)y=y&1|2,u.flags|=128;else{if(l!==null&&l.flags&128)t:for(l=u.child;l!==null;){if(l.tag===13)l.memoizedState!==null&&HB(l,f,u);else if(l.tag===19)HB(l,f,u);else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===u)break t;for(;l.sibling===null;){if(l.return===null||l.return===u)break t;l=l.return}l.sibling.return=l.return,l=l.sibling}y&=1}if(Lr(Xr,y),!(u.mode&1))u.memoizedState=null;else switch(b){case"forwards":for(f=u.child,b=null;f!==null;)l=f.alternate,l!==null&&gv(l)===null&&(b=f),f=f.sibling;f=b,f===null?(b=u.child,u.child=null):(b=f.sibling,f.sibling=null),YA(u,!1,b,f,C);break;case"backwards":for(f=null,b=u.child,u.child=null;b!==null;){if(l=b.alternate,l!==null&&gv(l)===null){u.child=b;break}l=b.sibling,b.sibling=f,f=b,b=l}YA(u,!0,f,null,C);break;case"together":YA(u,!1,null,null,void 0);break;default:u.memoizedState=null}return u.child}function $x(l,u){!(u.mode&1)&&l!==null&&(l.alternate=null,u.alternate=null,u.flags|=2)}function iu(l,u,f){if(l!==null&&(u.dependencies=l.dependencies),Hh|=u.lanes,!(f&u.childLanes))return null;if(l!==null&&u.child!==l.child)throw Error(he(153));if(u.child!==null){for(l=u.child,f=Ac(l,l.pendingProps),u.child=f,f.return=u;l.sibling!==null;)l=l.sibling,f=f.sibling=Ac(l,l.pendingProps),f.return=u;f.sibling=null}return u.child}function I4(l,u,f){switch(u.tag){case 3:a3(u),ep();break;case 5:F5(u);break;case 1:Ko(u.type)&&cv(u);break;case 4:ST(u,u.stateNode.containerInfo);break;case 10:var y=u.type._context,b=u.memoizedProps.value;Lr(dv,y._currentValue),y._currentValue=b;break;case 13:if(y=u.memoizedState,y!==null)return y.dehydrated!==null?(Lr(Xr,Xr.current&1),u.flags|=128,null):f&u.child.childLanes?l3(l,u,f):(Lr(Xr,Xr.current&1),l=iu(l,u,f),l!==null?l.sibling:null);Lr(Xr,Xr.current&1);break;case 19:if(y=(f&u.childLanes)!==0,l.flags&128){if(y)return u3(l,u,f);u.flags|=128}if(b=u.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),Lr(Xr,Xr.current),y)break;return null;case 22:case 23:return u.lanes=0,o3(l,u,f)}return iu(l,u,f)}var c3,UE,h3,f3;c3=function(l,u){for(var f=u.child;f!==null;){if(f.tag===5||f.tag===6)l.appendChild(f.stateNode);else if(f.tag!==4&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===u)break;for(;f.sibling===null;){if(f.return===null||f.return===u)return;f=f.return}f.sibling.return=f.return,f=f.sibling}};UE=function(){};h3=function(l,u,f,y){var b=l.memoizedProps;if(b!==y){l=u.stateNode,Oh(cl.current);var C=null;switch(f){case"input":b=lE(l,b),y=lE(l,y),C=[];break;case"select":b=Qr({},b,{value:void 0}),y=Qr({},y,{value:void 0}),C=[];break;case"textarea":b=hE(l,b),y=hE(l,y),C=[];break;default:typeof b.onClick!="function"&&typeof y.onClick=="function"&&(l.onclick=lv)}dE(f,y);var P;f=null;for(k in b)if(!y.hasOwnProperty(k)&&b.hasOwnProperty(k)&&b[k]!=null)if(k==="style"){var O=b[k];for(P in O)O.hasOwnProperty(P)&&(f||(f={}),f[P]="")}else k!=="dangerouslySetInnerHTML"&&k!=="children"&&k!=="suppressContentEditableWarning"&&k!=="suppressHydrationWarning"&&k!=="autoFocus"&&(c_.hasOwnProperty(k)?C||(C=[]):(C=C||[]).push(k,null));for(k in y){var F=y[k];if(O=b!=null?b[k]:void 0,y.hasOwnProperty(k)&&F!==O&&(F!=null||O!=null))if(k==="style")if(O){for(P in O)!O.hasOwnProperty(P)||F&&F.hasOwnProperty(P)||(f||(f={}),f[P]="");for(P in F)F.hasOwnProperty(P)&&O[P]!==F[P]&&(f||(f={}),f[P]=F[P])}else f||(C||(C=[]),C.push(k,f)),f=F;else k==="dangerouslySetInnerHTML"?(F=F?F.__html:void 0,O=O?O.__html:void 0,F!=null&&O!==F&&(C=C||[]).push(k,F)):k==="children"?typeof F!="string"&&typeof F!="number"||(C=C||[]).push(k,""+F):k!=="suppressContentEditableWarning"&&k!=="suppressHydrationWarning"&&(c_.hasOwnProperty(k)?(F!=null&&k==="onScroll"&&zr("scroll",l),C||O===F||(C=[])):(C=C||[]).push(k,F))}f&&(C=C||[]).push("style",f);var k=C;(u.updateQueue=k)&&(u.flags|=4)}};f3=function(l,u,f,y){f!==y&&(u.flags|=4)};function Wg(l,u){if(!jr)switch(l.tailMode){case"hidden":u=l.tail;for(var f=null;u!==null;)u.alternate!==null&&(f=u),u=u.sibling;f===null?l.tail=null:f.sibling=null;break;case"collapsed":f=l.tail;for(var y=null;f!==null;)f.alternate!==null&&(y=f),f=f.sibling;y===null?u||l.tail===null?l.tail=null:l.tail.sibling=null:y.sibling=null}}function ho(l){var u=l.alternate!==null&&l.alternate.child===l.child,f=0,y=0;if(u)for(var b=l.child;b!==null;)f|=b.lanes|b.childLanes,y|=b.subtreeFlags&14680064,y|=b.flags&14680064,b.return=l,b=b.sibling;else for(b=l.child;b!==null;)f|=b.lanes|b.childLanes,y|=b.subtreeFlags,y|=b.flags,b.return=l,b=b.sibling;return l.subtreeFlags|=y,l.childLanes=f,u}function B4(l,u,f){var y=u.pendingProps;switch(vT(u),u.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ho(u),null;case 1:return Ko(u.type)&&uv(),ho(u),null;case 3:return y=u.stateNode,rp(),Or($o),Or(po),IT(),y.pendingContext&&(y.context=y.pendingContext,y.pendingContext=null),(l===null||l.child===null)&&(Rx(u)?u.flags|=4:l===null||l.memoizedState.isDehydrated&&!(u.flags&256)||(u.flags|=1024,Ea!==null&&(JE(Ea),Ea=null))),UE(l,u),ho(u),null;case 5:MT(u);var b=Oh(b_.current);if(f=u.type,l!==null&&u.stateNode!=null)h3(l,u,f,y,b),l.ref!==u.ref&&(u.flags|=512,u.flags|=2097152);else{if(!y){if(u.stateNode===null)throw Error(he(166));return ho(u),null}if(l=Oh(cl.current),Rx(u)){y=u.stateNode,f=u.type;var C=u.memoizedProps;switch(y[al]=u,y[v_]=C,l=(u.mode&1)!==0,f){case"dialog":zr("cancel",y),zr("close",y);break;case"iframe":case"object":case"embed":zr("load",y);break;case"video":case"audio":for(b=0;b<Qg.length;b++)zr(Qg[b],y);break;case"source":zr("error",y);break;case"img":case"image":case"link":zr("error",y),zr("load",y);break;case"details":zr("toggle",y);break;case"input":QI(y,C),zr("invalid",y);break;case"select":y._wrapperState={wasMultiple:!!C.multiple},zr("invalid",y);break;case"textarea":eB(y,C),zr("invalid",y)}dE(f,C),b=null;for(var P in C)if(C.hasOwnProperty(P)){var O=C[P];P==="children"?typeof O=="string"?y.textContent!==O&&(C.suppressHydrationWarning!==!0&&Lx(y.textContent,O,l),b=["children",O]):typeof O=="number"&&y.textContent!==""+O&&(C.suppressHydrationWarning!==!0&&Lx(y.textContent,O,l),b=["children",""+O]):c_.hasOwnProperty(P)&&O!=null&&P==="onScroll"&&zr("scroll",y)}switch(f){case"input":Tx(y),tB(y,C,!0);break;case"textarea":Tx(y),nB(y);break;case"select":case"option":break;default:typeof C.onClick=="function"&&(y.onclick=lv)}y=b,u.updateQueue=y,y!==null&&(u.flags|=4)}else{P=b.nodeType===9?b:b.ownerDocument,l==="http://www.w3.org/1999/xhtml"&&(l=ND(f)),l==="http://www.w3.org/1999/xhtml"?f==="script"?(l=P.createElement("div"),l.innerHTML="<script><\/script>",l=l.removeChild(l.firstChild)):typeof y.is=="string"?l=P.createElement(f,{is:y.is}):(l=P.createElement(f),f==="select"&&(P=l,y.multiple?P.multiple=!0:y.size&&(P.size=y.size))):l=P.createElementNS(l,f),l[al]=u,l[v_]=y,c3(l,u,!1,!1),u.stateNode=l;t:{switch(P=pE(f,y),f){case"dialog":zr("cancel",l),zr("close",l),b=y;break;case"iframe":case"object":case"embed":zr("load",l),b=y;break;case"video":case"audio":for(b=0;b<Qg.length;b++)zr(Qg[b],l);b=y;break;case"source":zr("error",l),b=y;break;case"img":case"image":case"link":zr("error",l),zr("load",l),b=y;break;case"details":zr("toggle",l),b=y;break;case"input":QI(l,y),b=lE(l,y),zr("invalid",l);break;case"option":b=y;break;case"select":l._wrapperState={wasMultiple:!!y.multiple},b=Qr({},y,{value:void 0}),zr("invalid",l);break;case"textarea":eB(l,y),b=hE(l,y),zr("invalid",l);break;default:b=y}dE(f,b),O=b;for(C in O)if(O.hasOwnProperty(C)){var F=O[C];C==="style"?GD(l,F):C==="dangerouslySetInnerHTML"?(F=F?F.__html:void 0,F!=null&&UD(l,F)):C==="children"?typeof F=="string"?(f!=="textarea"||F!=="")&&h_(l,F):typeof F=="number"&&h_(l,""+F):C!=="suppressContentEditableWarning"&&C!=="suppressHydrationWarning"&&C!=="autoFocus"&&(c_.hasOwnProperty(C)?F!=null&&C==="onScroll"&&zr("scroll",l):F!=null&&oT(l,C,F,P))}switch(f){case"input":Tx(l),tB(l,y,!1);break;case"textarea":Tx(l),nB(l);break;case"option":y.value!=null&&l.setAttribute("value",""+Ec(y.value));break;case"select":l.multiple=!!y.multiple,C=y.value,C!=null?qd(l,!!y.multiple,C,!1):y.defaultValue!=null&&qd(l,!!y.multiple,y.defaultValue,!0);break;default:typeof b.onClick=="function"&&(l.onclick=lv)}switch(f){case"button":case"input":case"select":case"textarea":y=!!y.autoFocus;break t;case"img":y=!0;break t;default:y=!1}}y&&(u.flags|=4)}u.ref!==null&&(u.flags|=512,u.flags|=2097152)}return ho(u),null;case 6:if(l&&u.stateNode!=null)f3(l,u,l.memoizedProps,y);else{if(typeof y!="string"&&u.stateNode===null)throw Error(he(166));if(f=Oh(b_.current),Oh(cl.current),Rx(u)){if(y=u.stateNode,f=u.memoizedProps,y[al]=u,(C=y.nodeValue!==f)&&(l=us,l!==null))switch(l.tag){case 3:Lx(y.nodeValue,f,(l.mode&1)!==0);break;case 5:l.memoizedProps.suppressHydrationWarning!==!0&&Lx(y.nodeValue,f,(l.mode&1)!==0)}C&&(u.flags|=4)}else y=(f.nodeType===9?f:f.ownerDocument).createTextNode(y),y[al]=u,u.stateNode=y}return ho(u),null;case 13:if(Or(Xr),y=u.memoizedState,l===null||l.memoizedState!==null&&l.memoizedState.dehydrated!==null){if(jr&&ls!==null&&u.mode&1&&!(u.flags&128))I5(),ep(),u.flags|=98560,C=!1;else if(C=Rx(u),y!==null&&y.dehydrated!==null){if(l===null){if(!C)throw Error(he(318));if(C=u.memoizedState,C=C!==null?C.dehydrated:null,!C)throw Error(he(317));C[al]=u}else ep(),!(u.flags&128)&&(u.memoizedState=null),u.flags|=4;ho(u),C=!1}else Ea!==null&&(JE(Ea),Ea=null),C=!0;if(!C)return u.flags&65536?u:null}return u.flags&128?(u.lanes=f,u):(y=y!==null,y!==(l!==null&&l.memoizedState!==null)&&y&&(u.child.flags|=8192,u.mode&1&&(l===null||Xr.current&1?Si===0&&(Si=3):VT())),u.updateQueue!==null&&(u.flags|=4),ho(u),null);case 4:return rp(),UE(l,u),l===null&&y_(u.stateNode.containerInfo),ho(u),null;case 10:return ET(u.type._context),ho(u),null;case 17:return Ko(u.type)&&uv(),ho(u),null;case 19:if(Or(Xr),C=u.memoizedState,C===null)return ho(u),null;if(y=(u.flags&128)!==0,P=C.rendering,P===null)if(y)Wg(C,!1);else{if(Si!==0||l!==null&&l.flags&128)for(l=u.child;l!==null;){if(P=gv(l),P!==null){for(u.flags|=128,Wg(C,!1),y=P.updateQueue,y!==null&&(u.updateQueue=y,u.flags|=4),u.subtreeFlags=0,y=f,f=u.child;f!==null;)C=f,l=y,C.flags&=14680066,P=C.alternate,P===null?(C.childLanes=0,C.lanes=l,C.child=null,C.subtreeFlags=0,C.memoizedProps=null,C.memoizedState=null,C.updateQueue=null,C.dependencies=null,C.stateNode=null):(C.childLanes=P.childLanes,C.lanes=P.lanes,C.child=P.child,C.subtreeFlags=0,C.deletions=null,C.memoizedProps=P.memoizedProps,C.memoizedState=P.memoizedState,C.updateQueue=P.updateQueue,C.type=P.type,l=P.dependencies,C.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext}),f=f.sibling;return Lr(Xr,Xr.current&1|2),u.child}l=l.sibling}C.tail!==null&&ui()>op&&(u.flags|=128,y=!0,Wg(C,!1),u.lanes=4194304)}else{if(!y)if(l=gv(P),l!==null){if(u.flags|=128,y=!0,f=l.updateQueue,f!==null&&(u.updateQueue=f,u.flags|=4),Wg(C,!0),C.tail===null&&C.tailMode==="hidden"&&!P.alternate&&!jr)return ho(u),null}else 2*ui()-C.renderingStartTime>op&&f!==1073741824&&(u.flags|=128,y=!0,Wg(C,!1),u.lanes=4194304);C.isBackwards?(P.sibling=u.child,u.child=P):(f=C.last,f!==null?f.sibling=P:u.child=P,C.last=P)}return C.tail!==null?(u=C.tail,C.rendering=u,C.tail=u.sibling,C.renderingStartTime=ui(),u.sibling=null,f=Xr.current,Lr(Xr,y?f&1|2:f&1),u):(ho(u),null);case 22:case 23:return UT(),y=u.memoizedState!==null,l!==null&&l.memoizedState!==null!==y&&(u.flags|=8192),y&&u.mode&1?as&1073741824&&(ho(u),u.subtreeFlags&6&&(u.flags|=8192)):ho(u),null;case 24:return null;case 25:return null}throw Error(he(156,u.tag))}function D4(l,u){switch(vT(u),u.tag){case 1:return Ko(u.type)&&uv(),l=u.flags,l&65536?(u.flags=l&-65537|128,u):null;case 3:return rp(),Or($o),Or(po),IT(),l=u.flags,l&65536&&!(l&128)?(u.flags=l&-65537|128,u):null;case 5:return MT(u),null;case 13:if(Or(Xr),l=u.memoizedState,l!==null&&l.dehydrated!==null){if(u.alternate===null)throw Error(he(340));ep()}return l=u.flags,l&65536?(u.flags=l&-65537|128,u):null;case 19:return Or(Xr),null;case 4:return rp(),null;case 10:return ET(u.type._context),null;case 22:case 23:return UT(),null;case 24:return null;default:return null}}var zx=!1,fo=!1,P4=typeof WeakSet=="function"?WeakSet:Set,Fe=null;function Zd(l,u){var f=l.ref;if(f!==null)if(typeof f=="function")try{f(null)}catch(y){ii(l,u,y)}else f.current=null}function VE(l,u,f){try{f()}catch(y){ii(l,u,y)}}var ZB=!1;function L4(l,u){if(EE=ov,l=g5(),yT(l)){if("selectionStart"in l)var f={start:l.selectionStart,end:l.selectionEnd};else t:{f=(f=l.ownerDocument)&&f.defaultView||window;var y=f.getSelection&&f.getSelection();if(y&&y.rangeCount!==0){f=y.anchorNode;var b=y.anchorOffset,C=y.focusNode;y=y.focusOffset;try{f.nodeType,C.nodeType}catch{f=null;break t}var P=0,O=-1,F=-1,k=0,ot=0,ft=l,X=null;e:for(;;){for(var zt;ft!==f||b!==0&&ft.nodeType!==3||(O=P+b),ft!==C||y!==0&&ft.nodeType!==3||(F=P+y),ft.nodeType===3&&(P+=ft.nodeValue.length),(zt=ft.firstChild)!==null;)X=ft,ft=zt;for(;;){if(ft===l)break e;if(X===f&&++k===b&&(O=P),X===C&&++ot===y&&(F=P),(zt=ft.nextSibling)!==null)break;ft=X,X=ft.parentNode}ft=zt}f=O===-1||F===-1?null:{start:O,end:F}}else f=null}f=f||{start:0,end:0}}else f=null;for(TE={focusedElem:l,selectionRange:f},ov=!1,Fe=u;Fe!==null;)if(u=Fe,l=u.child,(u.subtreeFlags&1028)!==0&&l!==null)l.return=u,Fe=l;else for(;Fe!==null;){u=Fe;try{var Lt=u.alternate;if(u.flags&1024)switch(u.tag){case 0:case 11:case 15:break;case 1:if(Lt!==null){var Ht=Lt.memoizedProps,we=Lt.memoizedState,mt=u.stateNode,at=mt.getSnapshotBeforeUpdate(u.elementType===u.type?Ht:ba(u.type,Ht),we);mt.__reactInternalSnapshotBeforeUpdate=at}break;case 3:var xt=u.stateNode.containerInfo;xt.nodeType===1?xt.textContent="":xt.nodeType===9&&xt.documentElement&&xt.removeChild(xt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(he(163))}}catch(It){ii(u,u.return,It)}if(l=u.sibling,l!==null){l.return=u.return,Fe=l;break}Fe=u.return}return Lt=ZB,ZB=!1,Lt}function s_(l,u,f){var y=u.updateQueue;if(y=y!==null?y.lastEffect:null,y!==null){var b=y=y.next;do{if((b.tag&l)===l){var C=b.destroy;b.destroy=void 0,C!==void 0&&VE(u,f,C)}b=b.next}while(b!==y)}}function Nv(l,u){if(u=u.updateQueue,u=u!==null?u.lastEffect:null,u!==null){var f=u=u.next;do{if((f.tag&l)===l){var y=f.create;f.destroy=y()}f=f.next}while(f!==u)}}function GE(l){var u=l.ref;if(u!==null){var f=l.stateNode;switch(l.tag){case 5:l=f;break;default:l=f}typeof u=="function"?u(l):u.current=l}}function d3(l){var u=l.alternate;u!==null&&(l.alternate=null,d3(u)),l.child=null,l.deletions=null,l.sibling=null,l.tag===5&&(u=l.stateNode,u!==null&&(delete u[al],delete u[v_],delete u[ME],delete u[m4],delete u[g4])),l.stateNode=null,l.return=null,l.dependencies=null,l.memoizedProps=null,l.memoizedState=null,l.pendingProps=null,l.stateNode=null,l.updateQueue=null}function p3(l){return l.tag===5||l.tag===3||l.tag===4}function WB(l){t:for(;;){for(;l.sibling===null;){if(l.return===null||p3(l.return))return null;l=l.return}for(l.sibling.return=l.return,l=l.sibling;l.tag!==5&&l.tag!==6&&l.tag!==18;){if(l.flags&2||l.child===null||l.tag===4)continue t;l.child.return=l,l=l.child}if(!(l.flags&2))return l.stateNode}}function jE(l,u,f){var y=l.tag;if(y===5||y===6)l=l.stateNode,u?f.nodeType===8?f.parentNode.insertBefore(l,u):f.insertBefore(l,u):(f.nodeType===8?(u=f.parentNode,u.insertBefore(l,f)):(u=f,u.appendChild(l)),f=f._reactRootContainer,f!=null||u.onclick!==null||(u.onclick=lv));else if(y!==4&&(l=l.child,l!==null))for(jE(l,u,f),l=l.sibling;l!==null;)jE(l,u,f),l=l.sibling}function HE(l,u,f){var y=l.tag;if(y===5||y===6)l=l.stateNode,u?f.insertBefore(l,u):f.appendChild(l);else if(y!==4&&(l=l.child,l!==null))for(HE(l,u,f),l=l.sibling;l!==null;)HE(l,u,f),l=l.sibling}var to=null,Aa=!1;function uc(l,u,f){for(f=f.child;f!==null;)m3(l,u,f),f=f.sibling}function m3(l,u,f){if(ul&&typeof ul.onCommitFiberUnmount=="function")try{ul.onCommitFiberUnmount(Dv,f)}catch{}switch(f.tag){case 5:fo||Zd(f,u);case 6:var y=to,b=Aa;to=null,uc(l,u,f),to=y,Aa=b,to!==null&&(Aa?(l=to,f=f.stateNode,l.nodeType===8?l.parentNode.removeChild(f):l.removeChild(f)):to.removeChild(f.stateNode));break;case 18:to!==null&&(Aa?(l=to,f=f.stateNode,l.nodeType===8?ZA(l.parentNode,f):l.nodeType===1&&ZA(l,f),m_(l)):ZA(to,f.stateNode));break;case 4:y=to,b=Aa,to=f.stateNode.containerInfo,Aa=!0,uc(l,u,f),to=y,Aa=b;break;case 0:case 11:case 14:case 15:if(!fo&&(y=f.updateQueue,y!==null&&(y=y.lastEffect,y!==null))){b=y=y.next;do{var C=b,P=C.destroy;C=C.tag,P!==void 0&&(C&2||C&4)&&VE(f,u,P),b=b.next}while(b!==y)}uc(l,u,f);break;case 1:if(!fo&&(Zd(f,u),y=f.stateNode,typeof y.componentWillUnmount=="function"))try{y.props=f.memoizedProps,y.state=f.memoizedState,y.componentWillUnmount()}catch(O){ii(f,u,O)}uc(l,u,f);break;case 21:uc(l,u,f);break;case 22:f.mode&1?(fo=(y=fo)||f.memoizedState!==null,uc(l,u,f),fo=y):uc(l,u,f);break;default:uc(l,u,f)}}function qB(l){var u=l.updateQueue;if(u!==null){l.updateQueue=null;var f=l.stateNode;f===null&&(f=l.stateNode=new P4),u.forEach(function(y){var b=G4.bind(null,l,y);f.has(y)||(f.add(y),y.then(b,b))})}}function wa(l,u){var f=u.deletions;if(f!==null)for(var y=0;y<f.length;y++){var b=f[y];try{var C=l,P=u,O=P;t:for(;O!==null;){switch(O.tag){case 5:to=O.stateNode,Aa=!1;break t;case 3:to=O.stateNode.containerInfo,Aa=!0;break t;case 4:to=O.stateNode.containerInfo,Aa=!0;break t}O=O.return}if(to===null)throw Error(he(160));m3(C,P,b),to=null,Aa=!1;var F=b.alternate;F!==null&&(F.return=null),b.return=null}catch(k){ii(b,u,k)}}if(u.subtreeFlags&12854)for(u=u.child;u!==null;)g3(u,l),u=u.sibling}function g3(l,u){var f=l.alternate,y=l.flags;switch(l.tag){case 0:case 11:case 14:case 15:if(wa(u,l),ol(l),y&4){try{s_(3,l,l.return),Nv(3,l)}catch(Ht){ii(l,l.return,Ht)}try{s_(5,l,l.return)}catch(Ht){ii(l,l.return,Ht)}}break;case 1:wa(u,l),ol(l),y&512&&f!==null&&Zd(f,f.return);break;case 5:if(wa(u,l),ol(l),y&512&&f!==null&&Zd(f,f.return),l.flags&32){var b=l.stateNode;try{h_(b,"")}catch(Ht){ii(l,l.return,Ht)}}if(y&4&&(b=l.stateNode,b!=null)){var C=l.memoizedProps,P=f!==null?f.memoizedProps:C,O=l.type,F=l.updateQueue;if(l.updateQueue=null,F!==null)try{O==="input"&&C.type==="radio"&&C.name!=null&&zD(b,C),pE(O,P);var k=pE(O,C);for(P=0;P<F.length;P+=2){var ot=F[P],ft=F[P+1];ot==="style"?GD(b,ft):ot==="dangerouslySetInnerHTML"?UD(b,ft):ot==="children"?h_(b,ft):oT(b,ot,ft,k)}switch(O){case"input":uE(b,C);break;case"textarea":OD(b,C);break;case"select":var X=b._wrapperState.wasMultiple;b._wrapperState.wasMultiple=!!C.multiple;var zt=C.value;zt!=null?qd(b,!!C.multiple,zt,!1):X!==!!C.multiple&&(C.defaultValue!=null?qd(b,!!C.multiple,C.defaultValue,!0):qd(b,!!C.multiple,C.multiple?[]:"",!1))}b[v_]=C}catch(Ht){ii(l,l.return,Ht)}}break;case 6:if(wa(u,l),ol(l),y&4){if(l.stateNode===null)throw Error(he(162));b=l.stateNode,C=l.memoizedProps;try{b.nodeValue=C}catch(Ht){ii(l,l.return,Ht)}}break;case 3:if(wa(u,l),ol(l),y&4&&f!==null&&f.memoizedState.isDehydrated)try{m_(u.containerInfo)}catch(Ht){ii(l,l.return,Ht)}break;case 4:wa(u,l),ol(l);break;case 13:wa(u,l),ol(l),b=l.child,b.flags&8192&&(C=b.memoizedState!==null,b.stateNode.isHidden=C,!C||b.alternate!==null&&b.alternate.memoizedState!==null||(OT=ui())),y&4&&qB(l);break;case 22:if(ot=f!==null&&f.memoizedState!==null,l.mode&1?(fo=(k=fo)||ot,wa(u,l),fo=k):wa(u,l),ol(l),y&8192){if(k=l.memoizedState!==null,(l.stateNode.isHidden=k)&&!ot&&l.mode&1)for(Fe=l,ot=l.child;ot!==null;){for(ft=Fe=ot;Fe!==null;){switch(X=Fe,zt=X.child,X.tag){case 0:case 11:case 14:case 15:s_(4,X,X.return);break;case 1:Zd(X,X.return);var Lt=X.stateNode;if(typeof Lt.componentWillUnmount=="function"){y=X,f=X.return;try{u=y,Lt.props=u.memoizedProps,Lt.state=u.memoizedState,Lt.componentWillUnmount()}catch(Ht){ii(y,f,Ht)}}break;case 5:Zd(X,X.return);break;case 22:if(X.memoizedState!==null){$B(ft);continue}}zt!==null?(zt.return=X,Fe=zt):$B(ft)}ot=ot.sibling}t:for(ot=null,ft=l;;){if(ft.tag===5){if(ot===null){ot=ft;try{b=ft.stateNode,k?(C=b.style,typeof C.setProperty=="function"?C.setProperty("display","none","important"):C.display="none"):(O=ft.stateNode,F=ft.memoizedProps.style,P=F!=null&&F.hasOwnProperty("display")?F.display:null,O.style.display=VD("display",P))}catch(Ht){ii(l,l.return,Ht)}}}else if(ft.tag===6){if(ot===null)try{ft.stateNode.nodeValue=k?"":ft.memoizedProps}catch(Ht){ii(l,l.return,Ht)}}else if((ft.tag!==22&&ft.tag!==23||ft.memoizedState===null||ft===l)&&ft.child!==null){ft.child.return=ft,ft=ft.child;continue}if(ft===l)break t;for(;ft.sibling===null;){if(ft.return===null||ft.return===l)break t;ot===ft&&(ot=null),ft=ft.return}ot===ft&&(ot=null),ft.sibling.return=ft.return,ft=ft.sibling}}break;case 19:wa(u,l),ol(l),y&4&&qB(l);break;case 21:break;default:wa(u,l),ol(l)}}function ol(l){var u=l.flags;if(u&2){try{t:{for(var f=l.return;f!==null;){if(p3(f)){var y=f;break t}f=f.return}throw Error(he(160))}switch(y.tag){case 5:var b=y.stateNode;y.flags&32&&(h_(b,""),y.flags&=-33);var C=WB(l);HE(l,C,b);break;case 3:case 4:var P=y.stateNode.containerInfo,O=WB(l);jE(l,O,P);break;default:throw Error(he(161))}}catch(F){ii(l,l.return,F)}l.flags&=-3}u&4096&&(l.flags&=-4097)}function R4(l,u,f){Fe=l,_3(l)}function _3(l,u,f){for(var y=(l.mode&1)!==0;Fe!==null;){var b=Fe,C=b.child;if(b.tag===22&&y){var P=b.memoizedState!==null||zx;if(!P){var O=b.alternate,F=O!==null&&O.memoizedState!==null||fo;O=zx;var k=fo;if(zx=P,(fo=F)&&!k)for(Fe=b;Fe!==null;)P=Fe,F=P.child,P.tag===22&&P.memoizedState!==null?KB(b):F!==null?(F.return=P,Fe=F):KB(b);for(;C!==null;)Fe=C,_3(C),C=C.sibling;Fe=b,zx=O,fo=k}JB(l)}else b.subtreeFlags&8772&&C!==null?(C.return=b,Fe=C):JB(l)}}function JB(l){for(;Fe!==null;){var u=Fe;if(u.flags&8772){var f=u.alternate;try{if(u.flags&8772)switch(u.tag){case 0:case 11:case 15:fo||Nv(5,u);break;case 1:var y=u.stateNode;if(u.flags&4&&!fo)if(f===null)y.componentDidMount();else{var b=u.elementType===u.type?f.memoizedProps:ba(u.type,f.memoizedProps);y.componentDidUpdate(b,f.memoizedState,y.__reactInternalSnapshotBeforeUpdate)}var C=u.updateQueue;C!==null&&DB(u,C,y);break;case 3:var P=u.updateQueue;if(P!==null){if(f=null,u.child!==null)switch(u.child.tag){case 5:f=u.child.stateNode;break;case 1:f=u.child.stateNode}DB(u,P,f)}break;case 5:var O=u.stateNode;if(f===null&&u.flags&4){f=O;var F=u.memoizedProps;switch(u.type){case"button":case"input":case"select":case"textarea":F.autoFocus&&f.focus();break;case"img":F.src&&(f.src=F.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(u.memoizedState===null){var k=u.alternate;if(k!==null){var ot=k.memoizedState;if(ot!==null){var ft=ot.dehydrated;ft!==null&&m_(ft)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(he(163))}fo||u.flags&512&&GE(u)}catch(X){ii(u,u.return,X)}}if(u===l){Fe=null;break}if(f=u.sibling,f!==null){f.return=u.return,Fe=f;break}Fe=u.return}}function $B(l){for(;Fe!==null;){var u=Fe;if(u===l){Fe=null;break}var f=u.sibling;if(f!==null){f.return=u.return,Fe=f;break}Fe=u.return}}function KB(l){for(;Fe!==null;){var u=Fe;try{switch(u.tag){case 0:case 11:case 15:var f=u.return;try{Nv(4,u)}catch(F){ii(u,f,F)}break;case 1:var y=u.stateNode;if(typeof y.componentDidMount=="function"){var b=u.return;try{y.componentDidMount()}catch(F){ii(u,b,F)}}var C=u.return;try{GE(u)}catch(F){ii(u,C,F)}break;case 5:var P=u.return;try{GE(u)}catch(F){ii(u,P,F)}}}catch(F){ii(u,u.return,F)}if(u===l){Fe=null;break}var O=u.sibling;if(O!==null){O.return=u.return,Fe=O;break}Fe=u.return}}var k4=Math.ceil,xv=ou.ReactCurrentDispatcher,FT=ou.ReactCurrentOwner,Gs=ou.ReactCurrentBatchConfig,Yn=0,Oi=null,gi=null,eo=0,as=0,Wd=Sc(0),Si=0,C_=null,Hh=0,Uv=0,zT=0,a_=null,qo=null,OT=0,op=1/0,Kl=null,vv=!1,ZE=null,wc=null,Ox=!1,mc=null,wv=0,l_=0,WE=null,Kx=-1,Xx=0;function So(){return Yn&6?ui():Kx!==-1?Kx:Kx=ui()}function bc(l){return l.mode&1?Yn&2&&eo!==0?eo&-eo:y4.transition!==null?(Xx===0&&(Xx=t5()),Xx):(l=vr,l!==0||(l=window.event,l=l===void 0?16:a5(l.type)),l):1}function Ca(l,u,f,y){if(50<l_)throw l_=0,WE=null,Error(he(185));B_(l,f,y),(!(Yn&2)||l!==Oi)&&(l===Oi&&(!(Yn&2)&&(Uv|=f),Si===4&&dc(l,eo)),Xo(l,y),f===1&&Yn===0&&!(u.mode&1)&&(op=ui()+500,Fv&&Mc()))}function Xo(l,u){var f=l.callbackNode;yO(l,u);var y=iv(l,l===Oi?eo:0);if(y===0)f!==null&&oB(f),l.callbackNode=null,l.callbackPriority=0;else if(u=y&-y,l.callbackPriority!==u){if(f!=null&&oB(f),u===1)l.tag===0?_4(XB.bind(null,l)):C5(XB.bind(null,l)),d4(function(){!(Yn&6)&&Mc()}),f=null;else{switch(e5(y)){case 1:f=cT;break;case 4:f=YD;break;case 16:f=rv;break;case 536870912:f=QD;break;default:f=rv}f=T3(f,y3.bind(null,l))}l.callbackPriority=u,l.callbackNode=f}}function y3(l,u){if(Kx=-1,Xx=0,Yn&6)throw Error(he(327));var f=l.callbackNode;if(Yd()&&l.callbackNode!==f)return null;var y=iv(l,l===Oi?eo:0);if(y===0)return null;if(y&30||y&l.expiredLanes||u)u=bv(l,y);else{u=y;var b=Yn;Yn|=2;var C=v3();(Oi!==l||eo!==u)&&(Kl=null,op=ui()+500,Nh(l,u));do try{O4();break}catch(O){x3(l,O)}while(!0);AT(),xv.current=C,Yn=b,gi!==null?u=0:(Oi=null,eo=0,u=Si)}if(u!==0){if(u===2&&(b=xE(l),b!==0&&(y=b,u=qE(l,b))),u===1)throw f=C_,Nh(l,0),dc(l,y),Xo(l,ui()),f;if(u===6)dc(l,y);else{if(b=l.current.alternate,!(y&30)&&!F4(b)&&(u=bv(l,y),u===2&&(C=xE(l),C!==0&&(y=C,u=qE(l,C))),u===1))throw f=C_,Nh(l,0),dc(l,y),Xo(l,ui()),f;switch(l.finishedWork=b,l.finishedLanes=y,u){case 0:case 1:throw Error(he(345));case 2:kh(l,qo,Kl);break;case 3:if(dc(l,y),(y&130023424)===y&&(u=OT+500-ui(),10<u)){if(iv(l,0)!==0)break;if(b=l.suspendedLanes,(b&y)!==y){So(),l.pingedLanes|=l.suspendedLanes&b;break}l.timeoutHandle=SE(kh.bind(null,l,qo,Kl),u);break}kh(l,qo,Kl);break;case 4:if(dc(l,y),(y&4194240)===y)break;for(u=l.eventTimes,b=-1;0<y;){var P=31-Ta(y);C=1<<P,P=u[P],P>b&&(b=P),y&=~C}if(y=b,y=ui()-y,y=(120>y?120:480>y?480:1080>y?1080:1920>y?1920:3e3>y?3e3:4320>y?4320:1960*k4(y/1960))-y,10<y){l.timeoutHandle=SE(kh.bind(null,l,qo,Kl),y);break}kh(l,qo,Kl);break;case 5:kh(l,qo,Kl);break;default:throw Error(he(329))}}}return Xo(l,ui()),l.callbackNode===f?y3.bind(null,l):null}function qE(l,u){var f=a_;return l.current.memoizedState.isDehydrated&&(Nh(l,u).flags|=256),l=bv(l,u),l!==2&&(u=qo,qo=f,u!==null&&JE(u)),l}function JE(l){qo===null?qo=l:qo.push.apply(qo,l)}function F4(l){for(var u=l;;){if(u.flags&16384){var f=u.updateQueue;if(f!==null&&(f=f.stores,f!==null))for(var y=0;y<f.length;y++){var b=f[y],C=b.getSnapshot;b=b.value;try{if(!Sa(C(),b))return!1}catch{return!1}}}if(f=u.child,u.subtreeFlags&16384&&f!==null)f.return=u,u=f;else{if(u===l)break;for(;u.sibling===null;){if(u.return===null||u.return===l)return!0;u=u.return}u.sibling.return=u.return,u=u.sibling}}return!0}function dc(l,u){for(u&=~zT,u&=~Uv,l.suspendedLanes|=u,l.pingedLanes&=~u,l=l.expirationTimes;0<u;){var f=31-Ta(u),y=1<<f;l[f]=-1,u&=~y}}function XB(l){if(Yn&6)throw Error(he(327));Yd();var u=iv(l,0);if(!(u&1))return Xo(l,ui()),null;var f=bv(l,u);if(l.tag!==0&&f===2){var y=xE(l);y!==0&&(u=y,f=qE(l,y))}if(f===1)throw f=C_,Nh(l,0),dc(l,u),Xo(l,ui()),f;if(f===6)throw Error(he(345));return l.finishedWork=l.current.alternate,l.finishedLanes=u,kh(l,qo,Kl),Xo(l,ui()),null}function NT(l,u){var f=Yn;Yn|=1;try{return l(u)}finally{Yn=f,Yn===0&&(op=ui()+500,Fv&&Mc())}}function Zh(l){mc!==null&&mc.tag===0&&!(Yn&6)&&Yd();var u=Yn;Yn|=1;var f=Gs.transition,y=vr;try{if(Gs.transition=null,vr=1,l)return l()}finally{vr=y,Gs.transition=f,Yn=u,!(Yn&6)&&Mc()}}function UT(){as=Wd.current,Or(Wd)}function Nh(l,u){l.finishedWork=null,l.finishedLanes=0;var f=l.timeoutHandle;if(f!==-1&&(l.timeoutHandle=-1,f4(f)),gi!==null)for(f=gi.return;f!==null;){var y=f;switch(vT(y),y.tag){case 1:y=y.type.childContextTypes,y!=null&&uv();break;case 3:rp(),Or($o),Or(po),IT();break;case 5:MT(y);break;case 4:rp();break;case 13:Or(Xr);break;case 19:Or(Xr);break;case 10:ET(y.type._context);break;case 22:case 23:UT()}f=f.return}if(Oi=l,gi=l=Ac(l.current,null),eo=as=u,Si=0,C_=null,zT=Uv=Hh=0,qo=a_=null,zh!==null){for(u=0;u<zh.length;u++)if(f=zh[u],y=f.interleaved,y!==null){f.interleaved=null;var b=y.next,C=f.pending;if(C!==null){var P=C.next;C.next=b,y.next=P}f.pending=y}zh=null}return l}function x3(l,u){do{var f=gi;try{if(AT(),qx.current=yv,_v){for(var y=Yr.memoizedState;y!==null;){var b=y.queue;b!==null&&(b.pending=null),y=y.next}_v=!1}if(jh=0,zi=Ci=Yr=null,o_=!1,A_=0,FT.current=null,f===null||f.return===null){Si=1,C_=u,gi=null;break}t:{var C=l,P=f.return,O=f,F=u;if(u=eo,O.flags|=32768,F!==null&&typeof F=="object"&&typeof F.then=="function"){var k=F,ot=O,ft=ot.tag;if(!(ot.mode&1)&&(ft===0||ft===11||ft===15)){var X=ot.alternate;X?(ot.updateQueue=X.updateQueue,ot.memoizedState=X.memoizedState,ot.lanes=X.lanes):(ot.updateQueue=null,ot.memoizedState=null)}var zt=OB(P);if(zt!==null){zt.flags&=-257,NB(zt,P,O,C,u),zt.mode&1&&zB(C,k,u),u=zt,F=k;var Lt=u.updateQueue;if(Lt===null){var Ht=new Set;Ht.add(F),u.updateQueue=Ht}else Lt.add(F);break t}else{if(!(u&1)){zB(C,k,u),VT();break t}F=Error(he(426))}}else if(jr&&O.mode&1){var we=OB(P);if(we!==null){!(we.flags&65536)&&(we.flags|=256),NB(we,P,O,C,u),wT(ip(F,O));break t}}C=F=ip(F,O),Si!==4&&(Si=2),a_===null?a_=[C]:a_.push(C),C=P;do{switch(C.tag){case 3:C.flags|=65536,u&=-u,C.lanes|=u;var mt=n3(C,F,u);BB(C,mt);break t;case 1:O=F;var at=C.type,xt=C.stateNode;if(!(C.flags&128)&&(typeof at.getDerivedStateFromError=="function"||xt!==null&&typeof xt.componentDidCatch=="function"&&(wc===null||!wc.has(xt)))){C.flags|=65536,u&=-u,C.lanes|=u;var It=r3(C,O,u);BB(C,It);break t}}C=C.return}while(C!==null)}b3(f)}catch(Xt){u=Xt,gi===f&&f!==null&&(gi=f=f.return);continue}break}while(!0)}function v3(){var l=xv.current;return xv.current=yv,l===null?yv:l}function VT(){(Si===0||Si===3||Si===2)&&(Si=4),Oi===null||!(Hh&268435455)&&!(Uv&268435455)||dc(Oi,eo)}function bv(l,u){var f=Yn;Yn|=2;var y=v3();(Oi!==l||eo!==u)&&(Kl=null,Nh(l,u));do try{z4();break}catch(b){x3(l,b)}while(!0);if(AT(),Yn=f,xv.current=y,gi!==null)throw Error(he(261));return Oi=null,eo=0,Si}function z4(){for(;gi!==null;)w3(gi)}function O4(){for(;gi!==null&&!uO();)w3(gi)}function w3(l){var u=E3(l.alternate,l,as);l.memoizedProps=l.pendingProps,u===null?b3(l):gi=u,FT.current=null}function b3(l){var u=l;do{var f=u.alternate;if(l=u.return,u.flags&32768){if(f=D4(f,u),f!==null){f.flags&=32767,gi=f;return}if(l!==null)l.flags|=32768,l.subtreeFlags=0,l.deletions=null;else{Si=6,gi=null;return}}else if(f=B4(f,u,as),f!==null){gi=f;return}if(u=u.sibling,u!==null){gi=u;return}gi=u=l}while(u!==null);Si===0&&(Si=5)}function kh(l,u,f){var y=vr,b=Gs.transition;try{Gs.transition=null,vr=1,N4(l,u,f,y)}finally{Gs.transition=b,vr=y}return null}function N4(l,u,f,y){do Yd();while(mc!==null);if(Yn&6)throw Error(he(327));f=l.finishedWork;var b=l.finishedLanes;if(f===null)return null;if(l.finishedWork=null,l.finishedLanes=0,f===l.current)throw Error(he(177));l.callbackNode=null,l.callbackPriority=0;var C=f.lanes|f.childLanes;if(xO(l,C),l===Oi&&(gi=Oi=null,eo=0),!(f.subtreeFlags&2064)&&!(f.flags&2064)||Ox||(Ox=!0,T3(rv,function(){return Yd(),null})),C=(f.flags&15990)!==0,f.subtreeFlags&15990||C){C=Gs.transition,Gs.transition=null;var P=vr;vr=1;var O=Yn;Yn|=4,FT.current=null,L4(l,f),g3(f,l),o4(TE),ov=!!EE,TE=EE=null,l.current=f,R4(f),cO(),Yn=O,vr=P,Gs.transition=C}else l.current=f;if(Ox&&(Ox=!1,mc=l,wv=b),C=l.pendingLanes,C===0&&(wc=null),dO(f.stateNode),Xo(l,ui()),u!==null)for(y=l.onRecoverableError,f=0;f<u.length;f++)b=u[f],y(b.value,{componentStack:b.stack,digest:b.digest});if(vv)throw vv=!1,l=ZE,ZE=null,l;return wv&1&&l.tag!==0&&Yd(),C=l.pendingLanes,C&1?l===WE?l_++:(l_=0,WE=l):l_=0,Mc(),null}function Yd(){if(mc!==null){var l=e5(wv),u=Gs.transition,f=vr;try{if(Gs.transition=null,vr=16>l?16:l,mc===null)var y=!1;else{if(l=mc,mc=null,wv=0,Yn&6)throw Error(he(331));var b=Yn;for(Yn|=4,Fe=l.current;Fe!==null;){var C=Fe,P=C.child;if(Fe.flags&16){var O=C.deletions;if(O!==null){for(var F=0;F<O.length;F++){var k=O[F];for(Fe=k;Fe!==null;){var ot=Fe;switch(ot.tag){case 0:case 11:case 15:s_(8,ot,C)}var ft=ot.child;if(ft!==null)ft.return=ot,Fe=ft;else for(;Fe!==null;){ot=Fe;var X=ot.sibling,zt=ot.return;if(d3(ot),ot===k){Fe=null;break}if(X!==null){X.return=zt,Fe=X;break}Fe=zt}}}var Lt=C.alternate;if(Lt!==null){var Ht=Lt.child;if(Ht!==null){Lt.child=null;do{var we=Ht.sibling;Ht.sibling=null,Ht=we}while(Ht!==null)}}Fe=C}}if(C.subtreeFlags&2064&&P!==null)P.return=C,Fe=P;else t:for(;Fe!==null;){if(C=Fe,C.flags&2048)switch(C.tag){case 0:case 11:case 15:s_(9,C,C.return)}var mt=C.sibling;if(mt!==null){mt.return=C.return,Fe=mt;break t}Fe=C.return}}var at=l.current;for(Fe=at;Fe!==null;){P=Fe;var xt=P.child;if(P.subtreeFlags&2064&&xt!==null)xt.return=P,Fe=xt;else t:for(P=at;Fe!==null;){if(O=Fe,O.flags&2048)try{switch(O.tag){case 0:case 11:case 15:Nv(9,O)}}catch(Xt){ii(O,O.return,Xt)}if(O===P){Fe=null;break t}var It=O.sibling;if(It!==null){It.return=O.return,Fe=It;break t}Fe=O.return}}if(Yn=b,Mc(),ul&&typeof ul.onPostCommitFiberRoot=="function")try{ul.onPostCommitFiberRoot(Dv,l)}catch{}y=!0}return y}finally{vr=f,Gs.transition=u}}return!1}function YB(l,u,f){u=ip(f,u),u=n3(l,u,1),l=vc(l,u,1),u=So(),l!==null&&(B_(l,1,u),Xo(l,u))}function ii(l,u,f){if(l.tag===3)YB(l,l,f);else for(;u!==null;){if(u.tag===3){YB(u,l,f);break}else if(u.tag===1){var y=u.stateNode;if(typeof u.type.getDerivedStateFromError=="function"||typeof y.componentDidCatch=="function"&&(wc===null||!wc.has(y))){l=ip(f,l),l=r3(u,l,1),u=vc(u,l,1),l=So(),u!==null&&(B_(u,1,l),Xo(u,l));break}}u=u.return}}function U4(l,u,f){var y=l.pingCache;y!==null&&y.delete(u),u=So(),l.pingedLanes|=l.suspendedLanes&f,Oi===l&&(eo&f)===f&&(Si===4||Si===3&&(eo&130023424)===eo&&500>ui()-OT?Nh(l,0):zT|=f),Xo(l,u)}function A3(l,u){u===0&&(l.mode&1?(u=Mx,Mx<<=1,!(Mx&130023424)&&(Mx=4194304)):u=1);var f=So();l=ru(l,u),l!==null&&(B_(l,u,f),Xo(l,f))}function V4(l){var u=l.memoizedState,f=0;u!==null&&(f=u.retryLane),A3(l,f)}function G4(l,u){var f=0;switch(l.tag){case 13:var y=l.stateNode,b=l.memoizedState;b!==null&&(f=b.retryLane);break;case 19:y=l.stateNode;break;default:throw Error(he(314))}y!==null&&y.delete(u),A3(l,f)}var E3;E3=function(l,u,f){if(l!==null)if(l.memoizedProps!==u.pendingProps||$o.current)Jo=!0;else{if(!(l.lanes&f)&&!(u.flags&128))return Jo=!1,I4(l,u,f);Jo=!!(l.flags&131072)}else Jo=!1,jr&&u.flags&1048576&&S5(u,fv,u.index);switch(u.lanes=0,u.tag){case 2:var y=u.type;$x(l,u),l=u.pendingProps;var b=tp(u,po.current);Xd(u,f),b=DT(null,u,y,l,b,f);var C=PT();return u.flags|=1,typeof b=="object"&&b!==null&&typeof b.render=="function"&&b.$$typeof===void 0?(u.tag=1,u.memoizedState=null,u.updateQueue=null,Ko(y)?(C=!0,cv(u)):C=!1,u.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,CT(u),b.updater=zv,u.stateNode=b,b._reactInternals=u,RE(u,y,l,f),u=zE(null,u,y,!0,C,f)):(u.tag=0,jr&&C&&xT(u),Co(null,u,b,f),u=u.child),u;case 16:y=u.elementType;t:{switch($x(l,u),l=u.pendingProps,b=y._init,y=b(y._payload),u.type=y,b=u.tag=H4(y),l=ba(y,l),b){case 0:u=FE(null,u,y,l,f);break t;case 1:u=GB(null,u,y,l,f);break t;case 11:u=UB(null,u,y,l,f);break t;case 14:u=VB(null,u,y,ba(y.type,l),f);break t}throw Error(he(306,y,""))}return u;case 0:return y=u.type,b=u.pendingProps,b=u.elementType===y?b:ba(y,b),FE(l,u,y,b,f);case 1:return y=u.type,b=u.pendingProps,b=u.elementType===y?b:ba(y,b),GB(l,u,y,b,f);case 3:t:{if(a3(u),l===null)throw Error(he(387));y=u.pendingProps,C=u.memoizedState,b=C.element,D5(l,u),mv(u,y,null,f);var P=u.memoizedState;if(y=P.element,C.isDehydrated)if(C={element:y,isDehydrated:!1,cache:P.cache,pendingSuspenseBoundaries:P.pendingSuspenseBoundaries,transitions:P.transitions},u.updateQueue.baseState=C,u.memoizedState=C,u.flags&256){b=ip(Error(he(423)),u),u=jB(l,u,y,f,b);break t}else if(y!==b){b=ip(Error(he(424)),u),u=jB(l,u,y,f,b);break t}else for(ls=xc(u.stateNode.containerInfo.firstChild),us=u,jr=!0,Ea=null,f=k5(u,null,y,f),u.child=f;f;)f.flags=f.flags&-3|4096,f=f.sibling;else{if(ep(),y===b){u=iu(l,u,f);break t}Co(l,u,y,f)}u=u.child}return u;case 5:return F5(u),l===null&&DE(u),y=u.type,b=u.pendingProps,C=l!==null?l.memoizedProps:null,P=b.children,CE(y,b)?P=null:C!==null&&CE(y,C)&&(u.flags|=32),s3(l,u),Co(l,u,P,f),u.child;case 6:return l===null&&DE(u),null;case 13:return l3(l,u,f);case 4:return ST(u,u.stateNode.containerInfo),y=u.pendingProps,l===null?u.child=np(u,null,y,f):Co(l,u,y,f),u.child;case 11:return y=u.type,b=u.pendingProps,b=u.elementType===y?b:ba(y,b),UB(l,u,y,b,f);case 7:return Co(l,u,u.pendingProps,f),u.child;case 8:return Co(l,u,u.pendingProps.children,f),u.child;case 12:return Co(l,u,u.pendingProps.children,f),u.child;case 10:t:{if(y=u.type._context,b=u.pendingProps,C=u.memoizedProps,P=b.value,Lr(dv,y._currentValue),y._currentValue=P,C!==null)if(Sa(C.value,P)){if(C.children===b.children&&!$o.current){u=iu(l,u,f);break t}}else for(C=u.child,C!==null&&(C.return=u);C!==null;){var O=C.dependencies;if(O!==null){P=C.child;for(var F=O.firstContext;F!==null;){if(F.context===y){if(C.tag===1){F=tu(-1,f&-f),F.tag=2;var k=C.updateQueue;if(k!==null){k=k.shared;var ot=k.pending;ot===null?F.next=F:(F.next=ot.next,ot.next=F),k.pending=F}}C.lanes|=f,F=C.alternate,F!==null&&(F.lanes|=f),PE(C.return,f,u),O.lanes|=f;break}F=F.next}}else if(C.tag===10)P=C.type===u.type?null:C.child;else if(C.tag===18){if(P=C.return,P===null)throw Error(he(341));P.lanes|=f,O=P.alternate,O!==null&&(O.lanes|=f),PE(P,f,u),P=C.sibling}else P=C.child;if(P!==null)P.return=C;else for(P=C;P!==null;){if(P===u){P=null;break}if(C=P.sibling,C!==null){C.return=P.return,P=C;break}P=P.return}C=P}Co(l,u,b.children,f),u=u.child}return u;case 9:return b=u.type,y=u.pendingProps.children,Xd(u,f),b=js(b),y=y(b),u.flags|=1,Co(l,u,y,f),u.child;case 14:return y=u.type,b=ba(y,u.pendingProps),b=ba(y.type,b),VB(l,u,y,b,f);case 15:return i3(l,u,u.type,u.pendingProps,f);case 17:return y=u.type,b=u.pendingProps,b=u.elementType===y?b:ba(y,b),$x(l,u),u.tag=1,Ko(y)?(l=!0,cv(u)):l=!1,Xd(u,f),L5(u,y,b),RE(u,y,b,f),zE(null,u,y,!0,l,f);case 19:return u3(l,u,f);case 22:return o3(l,u,f)}throw Error(he(156,u.tag))};function T3(l,u){return XD(l,u)}function j4(l,u,f,y){this.tag=l,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=u,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=y,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Vs(l,u,f,y){return new j4(l,u,f,y)}function GT(l){return l=l.prototype,!(!l||!l.isReactComponent)}function H4(l){if(typeof l=="function")return GT(l)?1:0;if(l!=null){if(l=l.$$typeof,l===aT)return 11;if(l===lT)return 14}return 2}function Ac(l,u){var f=l.alternate;return f===null?(f=Vs(l.tag,u,l.key,l.mode),f.elementType=l.elementType,f.type=l.type,f.stateNode=l.stateNode,f.alternate=l,l.alternate=f):(f.pendingProps=u,f.type=l.type,f.flags=0,f.subtreeFlags=0,f.deletions=null),f.flags=l.flags&14680064,f.childLanes=l.childLanes,f.lanes=l.lanes,f.child=l.child,f.memoizedProps=l.memoizedProps,f.memoizedState=l.memoizedState,f.updateQueue=l.updateQueue,u=l.dependencies,f.dependencies=u===null?null:{lanes:u.lanes,firstContext:u.firstContext},f.sibling=l.sibling,f.index=l.index,f.ref=l.ref,f}function Yx(l,u,f,y,b,C){var P=2;if(y=l,typeof l=="function")GT(l)&&(P=1);else if(typeof l=="string")P=5;else t:switch(l){case Fd:return Uh(f.children,b,C,u);case sT:P=8,b|=8;break;case iE:return l=Vs(12,f,u,b|2),l.elementType=iE,l.lanes=C,l;case oE:return l=Vs(13,f,u,b),l.elementType=oE,l.lanes=C,l;case sE:return l=Vs(19,f,u,b),l.elementType=sE,l.lanes=C,l;case RD:return Vv(f,b,C,u);default:if(typeof l=="object"&&l!==null)switch(l.$$typeof){case PD:P=10;break t;case LD:P=9;break t;case aT:P=11;break t;case lT:P=14;break t;case cc:P=16,y=null;break t}throw Error(he(130,l==null?l:typeof l,""))}return u=Vs(P,f,u,b),u.elementType=l,u.type=y,u.lanes=C,u}function Uh(l,u,f,y){return l=Vs(7,l,y,u),l.lanes=f,l}function Vv(l,u,f,y){return l=Vs(22,l,y,u),l.elementType=RD,l.lanes=f,l.stateNode={isHidden:!1},l}function QA(l,u,f){return l=Vs(6,l,null,u),l.lanes=f,l}function tE(l,u,f){return u=Vs(4,l.children!==null?l.children:[],l.key,u),u.lanes=f,u.stateNode={containerInfo:l.containerInfo,pendingChildren:null,implementation:l.implementation},u}function Z4(l,u,f,y,b){this.tag=u,this.containerInfo=l,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=RA(0),this.expirationTimes=RA(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=RA(0),this.identifierPrefix=y,this.onRecoverableError=b,this.mutableSourceEagerHydrationData=null}function jT(l,u,f,y,b,C,P,O,F){return l=new Z4(l,u,f,O,F),u===1?(u=1,C===!0&&(u|=8)):u=0,C=Vs(3,null,null,u),l.current=C,C.stateNode=l,C.memoizedState={element:y,isDehydrated:f,cache:null,transitions:null,pendingSuspenseBoundaries:null},CT(C),l}function W4(l,u,f){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:kd,key:y==null?null:""+y,children:l,containerInfo:u,implementation:f}}function C3(l){if(!l)return Tc;l=l._reactInternals;t:{if(qh(l)!==l||l.tag!==1)throw Error(he(170));var u=l;do{switch(u.tag){case 3:u=u.stateNode.context;break t;case 1:if(Ko(u.type)){u=u.stateNode.__reactInternalMemoizedMergedChildContext;break t}}u=u.return}while(u!==null);throw Error(he(171))}if(l.tag===1){var f=l.type;if(Ko(f))return T5(l,f,u)}return u}function S3(l,u,f,y,b,C,P,O,F){return l=jT(f,y,!0,l,b,C,P,O,F),l.context=C3(null),f=l.current,y=So(),b=bc(f),C=tu(y,b),C.callback=u??null,vc(f,C,b),l.current.lanes=b,B_(l,b,y),Xo(l,y),l}function Gv(l,u,f,y){var b=u.current,C=So(),P=bc(b);return f=C3(f),u.context===null?u.context=f:u.pendingContext=f,u=tu(C,P),u.payload={element:l},y=y===void 0?null:y,y!==null&&(u.callback=y),l=vc(b,u,P),l!==null&&(Ca(l,b,P,C),Wx(l,b,P)),P}function Av(l){if(l=l.current,!l.child)return null;switch(l.child.tag){case 5:return l.child.stateNode;default:return l.child.stateNode}}function QB(l,u){if(l=l.memoizedState,l!==null&&l.dehydrated!==null){var f=l.retryLane;l.retryLane=f!==0&&f<u?f:u}}function HT(l,u){QB(l,u),(l=l.alternate)&&QB(l,u)}function q4(){return null}var M3=typeof reportError=="function"?reportError:function(l){console.error(l)};function ZT(l){this._internalRoot=l}jv.prototype.render=ZT.prototype.render=function(l){var u=this._internalRoot;if(u===null)throw Error(he(409));Gv(l,u,null,null)};jv.prototype.unmount=ZT.prototype.unmount=function(){var l=this._internalRoot;if(l!==null){this._internalRoot=null;var u=l.containerInfo;Zh(function(){Gv(null,l,null,null)}),u[nu]=null}};function jv(l){this._internalRoot=l}jv.prototype.unstable_scheduleHydration=function(l){if(l){var u=i5();l={blockedOn:null,target:l,priority:u};for(var f=0;f<fc.length&&u!==0&&u<fc[f].priority;f++);fc.splice(f,0,l),f===0&&s5(l)}};function WT(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)}function Hv(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11&&(l.nodeType!==8||l.nodeValue!==" react-mount-point-unstable "))}function tD(){}function J4(l,u,f,y,b){if(b){if(typeof y=="function"){var C=y;y=function(){var k=Av(P);C.call(k)}}var P=S3(u,y,l,0,null,!1,!1,"",tD);return l._reactRootContainer=P,l[nu]=P.current,y_(l.nodeType===8?l.parentNode:l),Zh(),P}for(;b=l.lastChild;)l.removeChild(b);if(typeof y=="function"){var O=y;y=function(){var k=Av(F);O.call(k)}}var F=jT(l,0,!1,null,null,!1,!1,"",tD);return l._reactRootContainer=F,l[nu]=F.current,y_(l.nodeType===8?l.parentNode:l),Zh(function(){Gv(u,F,f,y)}),F}function Zv(l,u,f,y,b){var C=f._reactRootContainer;if(C){var P=C;if(typeof b=="function"){var O=b;b=function(){var F=Av(P);O.call(F)}}Gv(u,P,l,b)}else P=J4(f,u,l,b,y);return Av(P)}n5=function(l){switch(l.tag){case 3:var u=l.stateNode;if(u.current.memoizedState.isDehydrated){var f=Yg(u.pendingLanes);f!==0&&(hT(u,f|1),Xo(u,ui()),!(Yn&6)&&(op=ui()+500,Mc()))}break;case 13:Zh(function(){var y=ru(l,1);if(y!==null){var b=So();Ca(y,l,1,b)}}),HT(l,1)}};fT=function(l){if(l.tag===13){var u=ru(l,134217728);if(u!==null){var f=So();Ca(u,l,134217728,f)}HT(l,134217728)}};r5=function(l){if(l.tag===13){var u=bc(l),f=ru(l,u);if(f!==null){var y=So();Ca(f,l,u,y)}HT(l,u)}};i5=function(){return vr};o5=function(l,u){var f=vr;try{return vr=l,u()}finally{vr=f}};gE=function(l,u,f){switch(u){case"input":if(uE(l,f),u=f.name,f.type==="radio"&&u!=null){for(f=l;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll("input[name="+JSON.stringify(""+u)+'][type="radio"]'),u=0;u<f.length;u++){var y=f[u];if(y!==l&&y.form===l.form){var b=kv(y);if(!b)throw Error(he(90));FD(y),uE(y,b)}}}break;case"textarea":OD(l,f);break;case"select":u=f.value,u!=null&&qd(l,!!f.multiple,u,!1)}};ZD=NT;WD=Zh;var $4={usingClientEntryPoint:!1,Events:[P_,Ud,kv,jD,HD,NT]},qg={findFiberByHostInstance:Fh,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},K4={bundleType:qg.bundleType,version:qg.version,rendererPackageName:qg.rendererPackageName,rendererConfig:qg.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ou.ReactCurrentDispatcher,findHostInstanceByFiber:function(l){return l=$D(l),l===null?null:l.stateNode},findFiberByHostInstance:qg.findFiberByHostInstance||q4,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Nx=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Nx.isDisabled&&Nx.supportsFiber)try{Dv=Nx.inject(K4),ul=Nx}catch{}}hs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$4;hs.createPortal=function(l,u){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!WT(u))throw Error(he(200));return W4(l,u,null,f)};hs.createRoot=function(l,u){if(!WT(l))throw Error(he(299));var f=!1,y="",b=M3;return u!=null&&(u.unstable_strictMode===!0&&(f=!0),u.identifierPrefix!==void 0&&(y=u.identifierPrefix),u.onRecoverableError!==void 0&&(b=u.onRecoverableError)),u=jT(l,1,!1,null,null,f,!1,y,b),l[nu]=u.current,y_(l.nodeType===8?l.parentNode:l),new ZT(u)};hs.findDOMNode=function(l){if(l==null)return null;if(l.nodeType===1)return l;var u=l._reactInternals;if(u===void 0)throw typeof l.render=="function"?Error(he(188)):(l=Object.keys(l).join(","),Error(he(268,l)));return l=$D(u),l=l===null?null:l.stateNode,l};hs.flushSync=function(l){return Zh(l)};hs.hydrate=function(l,u,f){if(!Hv(u))throw Error(he(200));return Zv(null,l,u,!0,f)};hs.hydrateRoot=function(l,u,f){if(!WT(l))throw Error(he(405));var y=f!=null&&f.hydratedSources||null,b=!1,C="",P=M3;if(f!=null&&(f.unstable_strictMode===!0&&(b=!0),f.identifierPrefix!==void 0&&(C=f.identifierPrefix),f.onRecoverableError!==void 0&&(P=f.onRecoverableError)),u=S3(u,null,l,1,f??null,b,!1,C,P),l[nu]=u.current,y_(l),y)for(l=0;l<y.length;l++)f=y[l],b=f._getVersion,b=b(f._source),u.mutableSourceEagerHydrationData==null?u.mutableSourceEagerHydrationData=[f,b]:u.mutableSourceEagerHydrationData.push(f,b);return new jv(u)};hs.render=function(l,u,f){if(!Hv(u))throw Error(he(200));return Zv(null,l,u,!1,f)};hs.unmountComponentAtNode=function(l){if(!Hv(l))throw Error(he(40));return l._reactRootContainer?(Zh(function(){Zv(null,null,l,!1,function(){l._reactRootContainer=null,l[nu]=null})}),!0):!1};hs.unstable_batchedUpdates=NT;hs.unstable_renderSubtreeIntoContainer=function(l,u,f,y){if(!Hv(f))throw Error(he(200));if(l==null||l._reactInternals===void 0)throw Error(he(38));return Zv(l,u,f,!1,y)};hs.version="18.2.0-next-9e3b772b8-20220608";function I3(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(I3)}catch(l){console.error(l)}}I3(),SD.exports=hs;var X4=SD.exports,eD=X4;nE.createRoot=eD.createRoot,nE.hydrateRoot=eD.hydrateRoot;var Ev={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */Ev.exports;(function(l,u){(function(){var f,y="4.17.21",b=200,C="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",P="Expected a function",O="Invalid `variable` option passed into `_.template`",F="__lodash_hash_undefined__",k=500,ot="__lodash_placeholder__",ft=1,X=2,zt=4,Lt=1,Ht=2,we=1,mt=2,at=4,xt=8,It=16,Xt=32,ue=64,oe=128,me=256,Nn=512,nt=30,Re="...",ds=800,Ni=16,Ae=1,dr=2,Bo=3,si=1/0,fe=9007199254740991,He=17976931348623157e292,We=NaN,hn=4294967295,$t=hn-1,Ui=hn>>>1,ci=[["ary",oe],["bind",we],["bindKey",mt],["curry",xt],["curryRight",It],["flip",Nn],["partial",Xt],["partialRight",ue],["rearg",me]],Mi="[object Arguments]",hi="[object Array]",re="[object AsyncFunction]",fi="[object Boolean]",hl="[object Date]",su="[object DOMException]",fl="[object Error]",dl="[object Function]",Ic="[object GeneratorFunction]",Jn="[object Map]",ps="[object Number]",au="[object Null]",Ot="[object Object]",q="[object Promise]",K="[object Proxy]",rt="[object RegExp]",St="[object Set]",Dt="[object String]",te="[object Symbol]",de="[object Undefined]",Pt="[object WeakMap]",xe="[object WeakSet]",be="[object ArrayBuffer]",Ee="[object DataView]",Un="[object Float32Array]",Qn="[object Float64Array]",Nr="[object Int8Array]",tr="[object Int16Array]",pr="[object Int32Array]",Hn="[object Uint8Array]",ai="[object Uint8ClampedArray]",_i="[object Uint16Array]",yi="[object Uint32Array]",Yo=/\b__p \+= '';/g,lu=/\b(__p \+=) '' \+/g,ro=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ms=/&(?:amp|lt|gt|quot|#39);/g,Zs=/[&<>"']/g,uu=RegExp(ms.source),At=RegExp(Zs.source),Ct=/<%-([\s\S]+?)%>/g,kt=/<%([\s\S]+?)%>/g,Ut=/<%=([\s\S]+?)%>/g,jt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Kt=/^\w*$/,Qt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Zt=/[\\^$.*+?()[\]{}|]/g,ce=RegExp(Zt.source),Wt=/^\s+/,Ze=/\s/,Ln=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ve=/\{\n\/\* \[wrapped with (.+)\] \*/,Sn=/,? & /,mr=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,wr=/[()=,{}\[\]\/\s]/,Rr=/\\(\\)?/g,xi=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,mo=/\w*$/,Hr=/^[-+]0x[0-9a-f]+$/i,Vi=/^0b[01]+$/i,vi=/^\[object .+?Constructor\]$/,cu=/^0o[0-7]+$/i,Ma=/^(?:0|[1-9]\d*)$/,hu=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,fu=/($^)/,R_=/['\n\r\u2028\u2029\\]/g,Jh="\\ud800-\\udfff",k_="\\u0300-\\u036f",qv="\\ufe20-\\ufe2f",F_="\\u20d0-\\u20ff",z_=k_+qv+F_,Bc="\\u2700-\\u27bf",up="a-z\\xdf-\\xf6\\xf8-\\xff",$h="\\xac\\xb1\\xd7\\xf7",O_="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Jv="\\u2000-\\u206f",$v=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",cp="A-Z\\xc0-\\xd6\\xd8-\\xde",hp="\\ufe0e\\ufe0f",Kh=$h+O_+Jv+$v,Dc="[']",fp="["+Jh+"]",Pc="["+Kh+"]",du="["+z_+"]",Lc="\\d+",pl="["+Bc+"]",dp="["+up+"]",ze="[^"+Jh+Kh+Lc+Bc+up+cp+"]",Fn="\\ud83c[\\udffb-\\udfff]",Ws="(?:"+du+"|"+Fn+")",Ia="[^"+Jh+"]",ml="(?:\\ud83c[\\udde6-\\uddff]){2}",Xh="[\\ud800-\\udbff][\\udc00-\\udfff]",gl="["+cp+"]",pp="\\u200d",Yh="(?:"+dp+"|"+ze+")",mp="(?:"+gl+"|"+ze+")",pu="(?:"+Dc+"(?:d|ll|m|re|s|t|ve))?",Rc="(?:"+Dc+"(?:D|LL|M|RE|S|T|VE))?",gp=Ws+"?",_p="["+hp+"]?",N_="(?:"+pp+"(?:"+[Ia,ml,Xh].join("|")+")"+_p+gp+")*",yp="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Nt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ie=_p+gp+N_,Sr="(?:"+[pl,ml,Xh].join("|")+")"+Ie,ut="(?:"+[Ia+du+"?",du,ml,Xh,fp].join("|")+")",ae=RegExp(Dc,"g"),_l=RegExp(du,"g"),Qo=RegExp(Fn+"(?="+Fn+")|"+ut+Ie,"g"),kr=RegExp([gl+"?"+dp+"+"+pu+"(?="+[Pc,gl,"$"].join("|")+")",mp+"+"+Rc+"(?="+[Pc,gl+Yh,"$"].join("|")+")",gl+"?"+Yh+"+"+pu,gl+"+"+Rc,Nt,yp,Lc,Sr].join("|"),"g"),qs=RegExp("["+pp+Jh+z_+hp+"]"),Kv=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,gs=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],xp=-1,br={};br[Un]=br[Qn]=br[Nr]=br[tr]=br[pr]=br[Hn]=br[ai]=br[_i]=br[yi]=!0,br[Mi]=br[hi]=br[be]=br[fi]=br[Ee]=br[hl]=br[fl]=br[dl]=br[Jn]=br[ps]=br[Ot]=br[rt]=br[St]=br[Dt]=br[Pt]=!1;var $n={};$n[Mi]=$n[hi]=$n[be]=$n[Ee]=$n[fi]=$n[hl]=$n[Un]=$n[Qn]=$n[Nr]=$n[tr]=$n[pr]=$n[Jn]=$n[ps]=$n[Ot]=$n[rt]=$n[St]=$n[Dt]=$n[te]=$n[Hn]=$n[ai]=$n[_i]=$n[yi]=!0,$n[fl]=$n[dl]=$n[Pt]=!1;var ie={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},fn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},vn={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Do={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},mu=parseFloat,gn=parseInt,kc=typeof Rd=="object"&&Rd&&Rd.Object===Object&&Rd,Fc=typeof self=="object"&&self&&self.Object===Object&&self,Zr=kc||Fc||Function("return this")(),Ii=u&&!u.nodeType&&u,er=Ii&&!0&&l&&!l.nodeType&&l,U_=er&&er.exports===Ii,yl=U_&&kc.process,io=function(){try{var yt=er&&er.require&&er.require("util").types;return yt||yl&&yl.binding&&yl.binding("util")}catch{}}(),gu=io&&io.isArrayBuffer,Qh=io&&io.isDate,vp=io&&io.isMap,zc=io&&io.isRegExp,tf=io&&io.isSet,Oc=io&&io.isTypedArray;function Gi(yt,Ft,Tt){switch(Tt.length){case 0:return yt.call(Ft);case 1:return yt.call(Ft,Tt[0]);case 2:return yt.call(Ft,Tt[0],Tt[1]);case 3:return yt.call(Ft,Tt[0],Tt[1],Tt[2])}return yt.apply(Ft,Tt)}function oo(yt,Ft,Tt,Te){for(var on=-1,Zn=yt==null?0:yt.length;++on<Zn;){var Mr=yt[on];Ft(Te,Mr,Tt(Mr),yt)}return Te}function Me(yt,Ft){for(var Tt=-1,Te=yt==null?0:yt.length;++Tt<Te&&Ft(yt[Tt],Tt,yt)!==!1;);return yt}function wp(yt,Ft){for(var Tt=yt==null?0:yt.length;Tt--&&Ft(yt[Tt],Tt,yt)!==!1;);return yt}function ef(yt,Ft){for(var Tt=-1,Te=yt==null?0:yt.length;++Tt<Te;)if(!Ft(yt[Tt],Tt,yt))return!1;return!0}function Wr(yt,Ft){for(var Tt=-1,Te=yt==null?0:yt.length,on=0,Zn=[];++Tt<Te;){var Mr=yt[Tt];Ft(Mr,Tt,yt)&&(Zn[on++]=Mr)}return Zn}function ji(yt,Ft){var Tt=yt==null?0:yt.length;return!!Tt&&ys(yt,Ft,0)>-1}function nf(yt,Ft,Tt){for(var Te=-1,on=yt==null?0:yt.length;++Te<on;)if(Tt(Ft,yt[Te]))return!0;return!1}function sr(yt,Ft){for(var Tt=-1,Te=yt==null?0:yt.length,on=Array(Te);++Tt<Te;)on[Tt]=Ft(yt[Tt],Tt,yt);return on}function gr(yt,Ft){for(var Tt=-1,Te=Ft.length,on=yt.length;++Tt<Te;)yt[on+Tt]=Ft[Tt];return yt}function xl(yt,Ft,Tt,Te){var on=-1,Zn=yt==null?0:yt.length;for(Te&&Zn&&(Tt=yt[++on]);++on<Zn;)Tt=Ft(Tt,yt[on],on,yt);return Tt}function bp(yt,Ft,Tt,Te){var on=yt==null?0:yt.length;for(Te&&on&&(Tt=yt[--on]);on--;)Tt=Ft(Tt,yt[on],on,yt);return Tt}function vl(yt,Ft){for(var Tt=-1,Te=yt==null?0:yt.length;++Tt<Te;)if(Ft(yt[Tt],Tt,yt))return!0;return!1}var ti=Js("length");function Ap(yt){return yt.split("")}function Ep(yt){return yt.match(mr)||[]}function _s(yt,Ft,Tt){var Te;return Tt(yt,function(on,Zn,Mr){if(Ft(on,Zn,Mr))return Te=Zn,!1}),Te}function Ba(yt,Ft,Tt,Te){for(var on=yt.length,Zn=Tt+(Te?1:-1);Te?Zn--:++Zn<on;)if(Ft(yt[Zn],Zn,yt))return Zn;return-1}function ys(yt,Ft,Tt){return Ft===Ft?W_(yt,Ft,Tt):Ba(yt,V_,Tt)}function Mn(yt,Ft,Tt,Te){for(var on=Tt-1,Zn=yt.length;++on<Zn;)if(Te(yt[on],Ft))return on;return-1}function V_(yt){return yt!==yt}function rf(yt,Ft){var Tt=yt==null?0:yt.length;return Tt?Sp(yt,Ft)/Tt:We}function Js(yt){return function(Ft){return Ft==null?f:Ft[yt]}}function Tp(yt){return function(Ft){return yt==null?f:yt[Ft]}}function Cp(yt,Ft,Tt,Te,on){return on(yt,function(Zn,Mr,ar){Tt=Te?(Te=!1,Zn):Ft(Tt,Zn,Mr,ar)}),Tt}function wl(yt,Ft){var Tt=yt.length;for(yt.sort(Ft);Tt--;)yt[Tt]=yt[Tt].value;return yt}function Sp(yt,Ft){for(var Tt,Te=-1,on=yt.length;++Te<on;){var Zn=Ft(yt[Te]);Zn!==f&&(Tt=Tt===f?Zn:Tt+Zn)}return Tt}function Po(yt,Ft){for(var Tt=-1,Te=Array(yt);++Tt<yt;)Te[Tt]=Ft(Tt);return Te}function of(yt,Ft){return sr(Ft,function(Tt){return[Tt,yt[Tt]]})}function Mp(yt){return yt&&yt.slice(0,lf(yt)+1).replace(Wt,"")}function go(yt){return function(Ft){return yt(Ft)}}function Ip(yt,Ft){return sr(Ft,function(Tt){return yt[Tt]})}function $s(yt,Ft){return yt.has(Ft)}function _u(yt,Ft){for(var Tt=-1,Te=yt.length;++Tt<Te&&ys(Ft,yt[Tt],0)>-1;);return Tt}function G_(yt,Ft){for(var Tt=yt.length;Tt--&&ys(Ft,yt[Tt],0)>-1;);return Tt}function yu(yt,Ft){for(var Tt=yt.length,Te=0;Tt--;)yt[Tt]===Ft&&++Te;return Te}var j_=Tp(ie),sf=Tp(fn);function Da(yt){return"\\"+Do[yt]}function Xv(yt,Ft){return yt==null?f:yt[Ft]}function xu(yt){return qs.test(yt)}function Yv(yt){return Kv.test(yt)}function H_(yt){for(var Ft,Tt=[];!(Ft=yt.next()).done;)Tt.push(Ft.value);return Tt}function Bp(yt){var Ft=-1,Tt=Array(yt.size);return yt.forEach(function(Te,on){Tt[++Ft]=[on,Te]}),Tt}function af(yt,Ft){return function(Tt){return yt(Ft(Tt))}}function Ks(yt,Ft){for(var Tt=-1,Te=yt.length,on=0,Zn=[];++Tt<Te;){var Mr=yt[Tt];(Mr===Ft||Mr===ot)&&(yt[Tt]=ot,Zn[on++]=Tt)}return Zn}function Nc(yt){var Ft=-1,Tt=Array(yt.size);return yt.forEach(function(Te){Tt[++Ft]=Te}),Tt}function Z_(yt){var Ft=-1,Tt=Array(yt.size);return yt.forEach(function(Te){Tt[++Ft]=[Te,Te]}),Tt}function W_(yt,Ft,Tt){for(var Te=Tt-1,on=yt.length;++Te<on;)if(yt[Te]===Ft)return Te;return-1}function Uc(yt,Ft,Tt){for(var Te=Tt+1;Te--;)if(yt[Te]===Ft)return Te;return Te}function Pa(yt){return xu(yt)?Dp(yt):ti(yt)}function Lo(yt){return xu(yt)?gt(yt):Ap(yt)}function lf(yt){for(var Ft=yt.length;Ft--&&Ze.test(yt.charAt(Ft)););return Ft}var q_=Tp(vn);function Dp(yt){for(var Ft=Qo.lastIndex=0;Qo.test(yt);)++Ft;return Ft}function gt(yt){return yt.match(Qo)||[]}function J_(yt){return yt.match(kr)||[]}var Pp=function yt(Ft){Ft=Ft==null?Zr:La.defaults(Zr.Object(),Ft,La.pick(Zr,gs));var Tt=Ft.Array,Te=Ft.Date,on=Ft.Error,Zn=Ft.Function,Mr=Ft.Math,ar=Ft.Object,Lp=Ft.RegExp,$_=Ft.String,_o=Ft.TypeError,vu=Tt.prototype,Qv=Zn.prototype,wu=ar.prototype,uf=Ft["__core-js_shared__"],cf=Qv.toString,nr=wu.hasOwnProperty,tw=0,Vc=function(){var p=/[^.]+$/.exec(uf&&uf.keys&&uf.keys.IE_PROTO||"");return p?"Symbol(src)_1."+p:""}(),hf=wu.toString,K_=cf.call(ar),Rp=Zr._,ff=Lp("^"+cf.call(nr).replace(Zt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),bu=U_?Ft.Buffer:f,Ro=Ft.Symbol,Au=Ft.Uint8Array,bl=bu?bu.allocUnsafe:f,Ra=af(ar.getPrototypeOf,ar),df=ar.create,Al=wu.propertyIsEnumerable,Eu=vu.splice,kp=Ro?Ro.isConcatSpreadable:f,El=Ro?Ro.iterator:f,ka=Ro?Ro.toStringTag:f,Tu=function(){try{var p=vo(ar,"defineProperty");return p({},"",{}),p}catch{}}(),pf=Ft.clearTimeout!==Zr.clearTimeout&&Ft.clearTimeout,Fp=Te&&Te.now!==Zr.Date.now&&Te.now,zp=Ft.setTimeout!==Zr.setTimeout&&Ft.setTimeout,Ce=Mr.ceil,Gc=Mr.floor,Cu=ar.getOwnPropertySymbols,X_=bu?bu.isBuffer:f,Op=Ft.isFinite,Y_=vu.join,Su=af(ar.keys,ar),ei=Mr.max,Bi=Mr.min,ew=Te.now,nw=Ft.parseInt,mf=Mr.random,Np=vu.reverse,jc=vo(Ft,"DataView"),Tl=vo(Ft,"Map"),gf=vo(Ft,"Promise"),Cl=vo(Ft,"Set"),Hc=vo(Ft,"WeakMap"),Xs=vo(ar,"create"),Fa=Hc&&new Hc,Sl={},_f=Bt(jc),Up=Bt(Tl),xs=Bt(gf),Vp=Bt(Cl),Q_=Bt(Hc),Mu=Ro?Ro.prototype:f,Iu=Mu?Mu.valueOf:f,yf=Mu?Mu.toString:f;function Z(p){if(Gr(p)&&!_n(p)&&!(p instanceof Vn)){if(p instanceof Hi)return p;if(nr.call(p,"__wrapped__"))return Ve(p)}return new Hi(p)}var za=function(){function p(){}return function(_){if(!En(_))return{};if(df)return df(_);p.prototype=_;var T=new p;return p.prototype=f,T}}();function xf(){}function Hi(p,_){this.__wrapped__=p,this.__actions__=[],this.__chain__=!!_,this.__index__=0,this.__values__=f}Z.templateSettings={escape:Ct,evaluate:kt,interpolate:Ut,variable:"",imports:{_:Z}},Z.prototype=xf.prototype,Z.prototype.constructor=Z,Hi.prototype=za(xf.prototype),Hi.prototype.constructor=Hi;function Vn(p){this.__wrapped__=p,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=hn,this.__views__=[]}function Gp(){var p=new Vn(this.__wrapped__);return p.__actions__=pi(this.__actions__),p.__dir__=this.__dir__,p.__filtered__=this.__filtered__,p.__iteratees__=pi(this.__iteratees__),p.__takeCount__=this.__takeCount__,p.__views__=pi(this.__views__),p}function rw(){if(this.__filtered__){var p=new Vn(this);p.__dir__=-1,p.__filtered__=!0}else p=this.clone(),p.__dir__*=-1;return p}function jp(){var p=this.__wrapped__.value(),_=this.__dir__,T=_n(p),L=_<0,U=T?p.length:0,W=uh(0,U,this.__views__),it=W.start,ht=W.end,vt=ht-it,Vt=L?ht:it-1,Gt=this.__iteratees__,Yt=Gt.length,ye=0,ke=Bi(vt,this.__takeCount__);if(!T||!L&&U==vt&&ke==vt)return sm(p,this.__actions__);var nn=[];t:for(;vt--&&ye<ke;){Vt+=_;for(var An=-1,Ye=p[Vt];++An<Yt;){var Dn=Gt[An],jn=Dn.iteratee,Qi=Dn.type,Ti=jn(Ye);if(Qi==dr)Ye=Ti;else if(!Ti){if(Qi==Ae)continue t;break t}}nn[ye++]=Ye}return nn}Vn.prototype=za(xf.prototype),Vn.prototype.constructor=Vn;function Ml(p){var _=-1,T=p==null?0:p.length;for(this.clear();++_<T;){var L=p[_];this.set(L[0],L[1])}}function vf(){this.__data__=Xs?Xs(null):{},this.size=0}function iw(p){var _=this.has(p)&&delete this.__data__[p];return this.size-=_?1:0,_}function t0(p){var _=this.__data__;if(Xs){var T=_[p];return T===F?f:T}return nr.call(_,p)?_[p]:f}function e0(p){var _=this.__data__;return Xs?_[p]!==f:nr.call(_,p)}function Bu(p,_){var T=this.__data__;return this.size+=this.has(p)?0:1,T[p]=Xs&&_===f?F:_,this}Ml.prototype.clear=vf,Ml.prototype.delete=iw,Ml.prototype.get=t0,Ml.prototype.has=e0,Ml.prototype.set=Bu;function Ys(p){var _=-1,T=p==null?0:p.length;for(this.clear();++_<T;){var L=p[_];this.set(L[0],L[1])}}function ow(){this.__data__=[],this.size=0}function sw(p){var _=this.__data__,T=wf(_,p);if(T<0)return!1;var L=_.length-1;return T==L?_.pop():Eu.call(_,T,1),--this.size,!0}function aw(p){var _=this.__data__,T=wf(_,p);return T<0?f:_[T][1]}function lw(p){return wf(this.__data__,p)>-1}function uw(p,_){var T=this.__data__,L=wf(T,p);return L<0?(++this.size,T.push([p,_])):T[L][1]=_,this}Ys.prototype.clear=ow,Ys.prototype.delete=sw,Ys.prototype.get=aw,Ys.prototype.has=lw,Ys.prototype.set=uw;function ts(p){var _=-1,T=p==null?0:p.length;for(this.clear();++_<T;){var L=p[_];this.set(L[0],L[1])}}function Hp(){this.size=0,this.__data__={hash:new Ml,map:new(Tl||Ys),string:new Ml}}function Zp(p){var _=Uu(this,p).delete(p);return this.size-=_?1:0,_}function n0(p){return Uu(this,p).get(p)}function r0(p){return Uu(this,p).has(p)}function i0(p,_){var T=Uu(this,p),L=T.size;return T.set(p,_),this.size+=T.size==L?0:1,this}ts.prototype.clear=Hp,ts.prototype.delete=Zp,ts.prototype.get=n0,ts.prototype.has=r0,ts.prototype.set=i0;function Oa(p){var _=-1,T=p==null?0:p.length;for(this.__data__=new ts;++_<T;)this.add(p[_])}function Wp(p){return this.__data__.set(p,F),this}function o0(p){return this.__data__.has(p)}Oa.prototype.add=Oa.prototype.push=Wp,Oa.prototype.has=o0;function ko(p){var _=this.__data__=new Ys(p);this.size=_.size}function s0(){this.__data__=new Ys,this.size=0}function Il(p){var _=this.__data__,T=_.delete(p);return this.size=_.size,T}function Zc(p){return this.__data__.get(p)}function a0(p){return this.__data__.has(p)}function Bl(p,_){var T=this.__data__;if(T instanceof Ys){var L=T.__data__;if(!Tl||L.length<b-1)return L.push([p,_]),this.size=++T.size,this;T=this.__data__=new ts(L)}return T.set(p,_),this.size=T.size,this}ko.prototype.clear=s0,ko.prototype.delete=Il,ko.prototype.get=Zc,ko.prototype.has=a0,ko.prototype.set=Bl;function qp(p,_){var T=_n(p),L=!T&&Ha(p),U=!T&&!L&&Bs(p),W=!T&&!L&&!U&&sn(p),it=T||L||U||W,ht=it?Po(p.length,$_):[],vt=ht.length;for(var Vt in p)(_||nr.call(p,Vt))&&!(it&&(Vt=="length"||U&&(Vt=="offset"||Vt=="parent")||W&&(Vt=="buffer"||Vt=="byteLength"||Vt=="byteOffset")||Cs(Vt,vt)))&&ht.push(Vt);return ht}function Na(p){var _=p.length;return _?p[Xc(0,_-1)]:f}function l0(p,_){return Ul(pi(p),Dl(_,0,p.length))}function Jp(p){return Ul(pi(p))}function Wc(p,_,T){(T!==f&&!Uo(p[_],T)||T===f&&!(_ in p))&&Qs(p,_,T)}function Ua(p,_,T){var L=p[_];(!(nr.call(p,_)&&Uo(L,T))||T===f&&!(_ in p))&&Qs(p,_,T)}function wf(p,_){for(var T=p.length;T--;)if(Uo(p[T][0],_))return T;return-1}function u0(p,_,T,L){return vs(p,function(U,W,it){_(L,U,T(U),it)}),L}function Du(p,_){return p&&ns(_,Ar(_),p)}function cw(p,_){return p&&ns(_,Ri(_),p)}function Qs(p,_,T){_=="__proto__"&&Tu?Tu(p,_,{configurable:!0,enumerable:!0,value:T,writable:!0}):p[_]=T}function bf(p,_){for(var T=-1,L=_.length,U=Tt(L),W=p==null;++T<L;)U[T]=W?f:yh(p,_[T]);return U}function Dl(p,_,T){return p===p&&(T!==f&&(p=p<=T?p:T),_!==f&&(p=p>=_?p:_)),p}function so(p,_,T,L,U,W){var it,ht=_&ft,vt=_&X,Vt=_&zt;if(T&&(it=U?T(p,L,U,W):T(p)),it!==f)return it;if(!En(p))return p;var Gt=_n(p);if(Gt){if(it=vm(p),!ht)return pi(p,it)}else{var Yt=Ur(p),ye=Yt==dl||Yt==Ic;if(Bs(p))return ra(p,ht);if(Yt==Ot||Yt==Mi||ye&&!U){if(it=vt||ye?{}:wm(p),!ht)return vt?gw(p,cw(it,p)):T0(p,Du(it,p))}else{if(!$n[Yt])return U?p:{};it=bm(p,Yt,ht)}}W||(W=new ko);var ke=W.get(p);if(ke)return ke;W.set(p,it),zy(p)?p.forEach(function(Ye){it.add(so(Ye,_,T,Ye,p,W))}):Ry(p)&&p.forEach(function(Ye,Dn){it.set(Dn,so(Ye,_,T,Dn,p,W))});var nn=Vt?vt?Ou:sh:vt?Ri:Ar,An=Gt?f:nn(p);return Me(An||p,function(Ye,Dn){An&&(Dn=Ye,Ye=p[Dn]),Ua(it,Dn,so(Ye,_,T,Dn,p,W))}),it}function Af(p){var _=Ar(p);return function(T){return ta(T,p,_)}}function ta(p,_,T){var L=T.length;if(p==null)return!L;for(p=ar(p);L--;){var U=T[L],W=_[U],it=p[U];if(it===f&&!(U in p)||!W(it))return!1}return!0}function Ef(p,_,T){if(typeof p!="function")throw new _o(P);return Ol(function(){p.apply(f,T)},_)}function Fo(p,_,T,L){var U=-1,W=ji,it=!0,ht=p.length,vt=[],Vt=_.length;if(!ht)return vt;T&&(_=sr(_,go(T))),L?(W=nf,it=!1):_.length>=b&&(W=$s,it=!1,_=new Oa(_));t:for(;++U<ht;){var Gt=p[U],Yt=T==null?Gt:T(Gt);if(Gt=L||Gt!==0?Gt:0,it&&Yt===Yt){for(var ye=Vt;ye--;)if(_[ye]===Yt)continue t;vt.push(Gt)}else W(_,Yt,L)||vt.push(Gt)}return vt}var vs=Rt(yo),qc=Rt(Jc,!0);function Tf(p,_){var T=!0;return vs(p,function(L,U,W){return T=!!_(L,U,W),T}),T}function Zi(p,_,T){for(var L=-1,U=p.length;++L<U;){var W=p[L],it=_(W);if(it!=null&&(ht===f?it===it&&!Yi(it):T(it,ht)))var ht=it,vt=W}return vt}function c0(p,_,T,L){var U=p.length;for(T=bn(T),T<0&&(T=-T>U?0:U+T),L=L===f||L>U?U:bn(L),L<0&&(L+=U),L=T>L?0:Rs(L);T<L;)p[T++]=_;return p}function $p(p,_){var T=[];return vs(p,function(L,U,W){_(L,U,W)&&T.push(L)}),T}function di(p,_,T,L,U){var W=-1,it=p.length;for(T||(T=M0),U||(U=[]);++W<it;){var ht=p[W];_>0&&T(ht)?_>1?di(ht,_-1,T,L,U):gr(U,ht):L||(U[U.length]=ht)}return U}var ea=ge(),Kp=ge(!0);function yo(p,_){return p&&ea(p,_,Ar)}function Jc(p,_){return p&&Kp(p,_,Ar)}function Pl(p,_){return Wr(_,function(T){return ha(p[T])})}function Va(p,_){_=As(_,p);for(var T=0,L=_.length;p!=null&&T<L;)p=p[Oe(_[T++])];return T&&T==L?p:f}function Xp(p,_,T){var L=_(p);return _n(p)?L:gr(L,T(p))}function ni(p){return p==null?p===f?de:au:ka&&ka in ar(p)?ym(p):Gf(p)}function Yp(p,_){return p>_}function hw(p,_){return p!=null&&nr.call(p,_)}function h0(p,_){return p!=null&&_ in ar(p)}function Cf(p,_,T){return p>=Bi(_,T)&&p<ei(_,T)}function $c(p,_,T){for(var L=T?nf:ji,U=p[0].length,W=p.length,it=W,ht=Tt(W),vt=1/0,Vt=[];it--;){var Gt=p[it];it&&_&&(Gt=sr(Gt,go(_))),vt=Bi(Gt.length,vt),ht[it]=!T&&(_||U>=120&&Gt.length>=120)?new Oa(it&&Gt):f}Gt=p[0];var Yt=-1,ye=ht[0];t:for(;++Yt<U&&Vt.length<vt;){var ke=Gt[Yt],nn=_?_(ke):ke;if(ke=T||ke!==0?ke:0,!(ye?$s(ye,nn):L(Vt,nn,T))){for(it=W;--it;){var An=ht[it];if(!(An?$s(An,nn):L(p[it],nn,T)))continue t}ye&&ye.push(nn),Vt.push(ke)}}return Vt}function f0(p,_,T,L){return yo(p,function(U,W,it){_(L,T(U),W,it)}),L}function Pu(p,_,T){_=As(_,p),p=R0(p,_);var L=p==null?p:p[Oe(wo(_))];return L==null?f:Gi(L,p,T)}function Kc(p){return Gr(p)&&ni(p)==Mi}function Qp(p){return Gr(p)&&ni(p)==be}function d0(p){return Gr(p)&&ni(p)==hl}function Lu(p,_,T,L,U){return p===_?!0:p==null||_==null||!Gr(p)&&!Gr(_)?p!==p&&_!==_:p0(p,_,T,L,Lu,U)}function p0(p,_,T,L,U,W){var it=_n(p),ht=_n(_),vt=it?hi:Ur(p),Vt=ht?hi:Ur(_);vt=vt==Mi?Ot:vt,Vt=Vt==Mi?Ot:Vt;var Gt=vt==Ot,Yt=Vt==Ot,ye=vt==Vt;if(ye&&Bs(p)){if(!Bs(_))return!1;it=!0,Gt=!1}if(ye&&!Gt)return W||(W=new ko),it||sn(p)?Nf(p,_,T,L,U,W):gm(p,_,vt,T,L,U,W);if(!(T&Lt)){var ke=Gt&&nr.call(p,"__wrapped__"),nn=Yt&&nr.call(_,"__wrapped__");if(ke||nn){var An=ke?p.value():p,Ye=nn?_.value():_;return W||(W=new ko),U(An,Ye,T,L,W)}}return ye?(W||(W=new ko),_m(p,_,T,L,U,W)):!1}function m0(p){return Gr(p)&&Ur(p)==Jn}function Sf(p,_,T,L){var U=T.length,W=U,it=!L;if(p==null)return!W;for(p=ar(p);U--;){var ht=T[U];if(it&&ht[2]?ht[1]!==p[ht[0]]:!(ht[0]in p))return!1}for(;++U<W;){ht=T[U];var vt=ht[0],Vt=p[vt],Gt=ht[1];if(it&&ht[2]){if(Vt===f&&!(vt in p))return!1}else{var Yt=new ko;if(L)var ye=L(Vt,Gt,vt,p,_,Yt);if(!(ye===f?Lu(Gt,Vt,Lt|Ht,L,Yt):ye))return!1}}return!0}function Ll(p){if(!En(p)||B0(p))return!1;var _=ha(p)?ff:vi;return _.test(Bt(p))}function g0(p){return Gr(p)&&ni(p)==rt}function _0(p){return Gr(p)&&Ur(p)==St}function fw(p){return Gr(p)&&Qf(p.length)&&!!br[ni(p)]}function tm(p){return typeof p=="function"?p:p==null?ki:typeof p=="object"?_n(p)?ri(p[0],p[1]):nm(p):c1(p)}function Mf(p){if(!hh(p))return Su(p);var _=[];for(var T in ar(p))nr.call(p,T)&&T!="constructor"&&_.push(T);return _}function y0(p){if(!En(p))return yw(p);var _=hh(p),T=[];for(var L in p)L=="constructor"&&(_||!nr.call(p,L))||T.push(L);return T}function If(p,_){return p<_}function em(p,_){var T=-1,L=$i(p)?Tt(p.length):[];return vs(p,function(U,W,it){L[++T]=_(U,W,it)}),L}function nm(p){var _=zl(p);return _.length==1&&_[0][2]?Cn(_[0][0],_[0][1]):function(T){return T===p||Sf(T,p,_)}}function ri(p,_){return Uf(p)&&P0(_)?Cn(Oe(p),_):function(T){var L=yh(T,p);return L===f&&L===_?Ei(T,p):Lu(_,L,Lt|Ht)}}function Bf(p,_,T,L,U){p!==_&&ea(_,function(W,it){if(U||(U=new ko),En(W))x0(p,_,it,T,Bf,L,U);else{var ht=L?L(jf(p,it),W,it+"",p,_,U):f;ht===f&&(ht=W),Wc(p,it,ht)}},Ri)}function x0(p,_,T,L,U,W,it){var ht=jf(p,T),vt=jf(_,T),Vt=it.get(vt);if(Vt){Wc(p,T,Vt);return}var Gt=W?W(ht,vt,T+"",p,_,it):f,Yt=Gt===f;if(Yt){var ye=_n(vt),ke=!ye&&Bs(vt),nn=!ye&&!ke&&sn(vt);Gt=vt,ye||ke||nn?_n(ht)?Gt=ht:Vr(ht)?Gt=pi(ht):ke?(Yt=!1,Gt=ra(vt,!0)):nn?(Yt=!1,Gt=fm(vt,!0)):Gt=[]:Zu(vt)||Ha(vt)?(Gt=ht,Ha(ht)?Gt=Wu(ht):(!En(ht)||ha(ht))&&(Gt=wm(vt))):Yt=!1}Yt&&(it.set(vt,Gt),U(Gt,vt,L,W,it),it.delete(vt)),Wc(p,T,Gt)}function Rl(p,_){var T=p.length;if(T)return _+=_<0?T:0,Cs(_,T)?p[_]:f}function v0(p,_,T){_.length?_=sr(_,function(W){return _n(W)?function(it){return Va(it,W.length===1?W[0]:W)}:W}):_=[ki];var L=-1;_=sr(_,go(Xe()));var U=em(p,function(W,it,ht){var vt=sr(_,function(Vt){return Vt(W)});return{criteria:vt,index:++L,value:W}});return wl(U,function(W,it){return rr(W,it,T)})}function dw(p,_){return w0(p,_,function(T,L){return Ei(p,L)})}function w0(p,_,T){for(var L=-1,U=_.length,W={};++L<U;){var it=_[L],ht=Va(p,it);T(ht,it)&&Yc(W,As(it,p),ht)}return W}function pw(p){return function(_){return Va(_,p)}}function rm(p,_,T,L){var U=L?Mn:ys,W=-1,it=_.length,ht=p;for(p===_&&(_=pi(_)),T&&(ht=sr(p,go(T)));++W<it;)for(var vt=0,Vt=_[W],Gt=T?T(Vt):Vt;(vt=U(ht,Gt,vt,L))>-1;)ht!==p&&Eu.call(ht,vt,1),Eu.call(p,vt,1);return p}function b0(p,_){for(var T=p?_.length:0,L=T-1;T--;){var U=_[T];if(T==L||U!==W){var W=U;Cs(U)?Eu.call(p,U,1):om(p,U)}}return p}function Xc(p,_){return p+Gc(mf()*(_-p+1))}function mw(p,_,T,L){for(var U=-1,W=ei(Ce((_-p)/(T||1)),0),it=Tt(W);W--;)it[L?W:++U]=p,p+=T;return it}function im(p,_){var T="";if(!p||_<1||_>fe)return T;do _%2&&(T+=p),_=Gc(_/2),_&&(p+=p);while(_);return T}function In(p,_){return Nl(Am(p,_,ki),p+"")}function es(p){return Na(Wa(p))}function Df(p,_){var T=Wa(p);return Ul(T,Dl(_,0,T.length))}function Yc(p,_,T,L){if(!En(p))return p;_=As(_,p);for(var U=-1,W=_.length,it=W-1,ht=p;ht!=null&&++U<W;){var vt=Oe(_[U]),Vt=T;if(vt==="__proto__"||vt==="constructor"||vt==="prototype")return p;if(U!=it){var Gt=ht[vt];Vt=L?L(Gt,vt,ht):f,Vt===f&&(Vt=En(Gt)?Gt:Cs(_[U+1])?[]:{})}Ua(ht,vt,Vt),ht=ht[vt]}return p}var na=Fa?function(p,_){return Fa.set(p,_),p}:ki,ws=Tu?function(p,_){return Tu(p,"toString",{configurable:!0,enumerable:!1,value:Fs(_),writable:!0})}:ki;function Ru(p){return Ul(Wa(p))}function Wi(p,_,T){var L=-1,U=p.length;_<0&&(_=-_>U?0:U+_),T=T>U?U:T,T<0&&(T+=U),U=_>T?0:T-_>>>0,_>>>=0;for(var W=Tt(U);++L<U;)W[L]=p[L+_];return W}function le(p,_){var T;return vs(p,function(L,U,W){return T=_(L,U,W),!T}),!!T}function Qc(p,_,T){var L=0,U=p==null?L:p.length;if(typeof _=="number"&&_===_&&U<=Ui){for(;L<U;){var W=L+U>>>1,it=p[W];it!==null&&!Yi(it)&&(T?it<=_:it<_)?L=W+1:U=W}return U}return Pf(p,_,ki,T)}function Pf(p,_,T,L){var U=0,W=p==null?0:p.length;if(W===0)return 0;_=T(_);for(var it=_!==_,ht=_===null,vt=Yi(_),Vt=_===f;U<W;){var Gt=Gc((U+W)/2),Yt=T(p[Gt]),ye=Yt!==f,ke=Yt===null,nn=Yt===Yt,An=Yi(Yt);if(it)var Ye=L||nn;else Vt?Ye=nn&&(L||ye):ht?Ye=nn&&ye&&(L||!ke):vt?Ye=nn&&ye&&!ke&&(L||!An):ke||An?Ye=!1:Ye=L?Yt<=_:Yt<_;Ye?U=Gt+1:W=Gt}return Bi(W,$t)}function kl(p,_){for(var T=-1,L=p.length,U=0,W=[];++T<L;){var it=p[T],ht=_?_(it):it;if(!T||!Uo(ht,vt)){var vt=ht;W[U++]=it===0?0:it}}return W}function Fl(p){return typeof p=="number"?p:Yi(p)?We:+p}function ee(p){if(typeof p=="string")return p;if(_n(p))return sr(p,ee)+"";if(Yi(p))return yf?yf.call(p):"";var _=p+"";return _=="0"&&1/p==-si?"-0":_}function bs(p,_,T){var L=-1,U=ji,W=p.length,it=!0,ht=[],vt=ht;if(T)it=!1,U=nf;else if(W>=b){var Vt=_?null:mm(p);if(Vt)return Nc(Vt);it=!1,U=$s,vt=new Oa}else vt=_?[]:ht;t:for(;++L<W;){var Gt=p[L],Yt=_?_(Gt):Gt;if(Gt=T||Gt!==0?Gt:0,it&&Yt===Yt){for(var ye=vt.length;ye--;)if(vt[ye]===Yt)continue t;_&&vt.push(Yt),ht.push(Gt)}else U(vt,Yt,T)||(vt!==ht&&vt.push(Yt),ht.push(Gt))}return ht}function om(p,_){return _=As(_,p),p=R0(p,_),p==null||delete p[Oe(wo(_))]}function A0(p,_,T,L){return Yc(p,_,T(Va(p,_)),L)}function ku(p,_,T,L){for(var U=p.length,W=L?U:-1;(L?W--:++W<U)&&_(p[W],W,p););return T?Wi(p,L?0:W,L?W+1:U):Wi(p,L?W+1:0,L?U:W)}function sm(p,_){var T=p;return T instanceof Vn&&(T=T.value()),xl(_,function(L,U){return U.func.apply(U.thisArg,gr([L],U.args))},T)}function Lf(p,_,T){var L=p.length;if(L<2)return L?bs(p[0]):[];for(var U=-1,W=Tt(L);++U<L;)for(var it=p[U],ht=-1;++ht<L;)ht!=U&&(W[U]=Fo(W[U]||it,p[ht],_,T));return bs(di(W,1),_,T)}function E0(p,_,T){for(var L=-1,U=p.length,W=_.length,it={};++L<U;){var ht=L<W?_[L]:f;T(it,p[L],ht)}return it}function am(p){return Vr(p)?p:[]}function th(p){return typeof p=="function"?p:ki}function As(p,_){return _n(p)?p:Uf(p,_)?[p]:Ss(dn(p))}var lm=In;function Es(p,_,T){var L=p.length;return T=T===f?L:T,!_&&T>=L?p:Wi(p,_,T)}var qi=pf||function(p){return Zr.clearTimeout(p)};function ra(p,_){if(_)return p.slice();var T=p.length,L=bl?bl(T):new p.constructor(T);return p.copy(L),L}function Rf(p){var _=new p.constructor(p.byteLength);return new Au(_).set(new Au(p)),_}function um(p,_){var T=_?Rf(p.buffer):p.buffer;return new p.constructor(T,p.byteOffset,p.byteLength)}function cm(p){var _=new p.constructor(p.source,mo.exec(p));return _.lastIndex=p.lastIndex,_}function hm(p){return Iu?ar(Iu.call(p)):{}}function fm(p,_){var T=_?Rf(p.buffer):p.buffer;return new p.constructor(T,p.byteOffset,p.length)}function xo(p,_){if(p!==_){var T=p!==f,L=p===null,U=p===p,W=Yi(p),it=_!==f,ht=_===null,vt=_===_,Vt=Yi(_);if(!ht&&!Vt&&!W&&p>_||W&&it&&vt&&!ht&&!Vt||L&&it&&vt||!T&&vt||!U)return 1;if(!L&&!W&&!Vt&&p<_||Vt&&T&&U&&!L&&!W||ht&&T&&U||!it&&U||!vt)return-1}return 0}function rr(p,_,T){for(var L=-1,U=p.criteria,W=_.criteria,it=U.length,ht=T.length;++L<it;){var vt=xo(U[L],W[L]);if(vt){if(L>=ht)return vt;var Vt=T[L];return vt*(Vt=="desc"?-1:1)}}return p.index-_.index}function eh(p,_,T,L){for(var U=-1,W=p.length,it=T.length,ht=-1,vt=_.length,Vt=ei(W-it,0),Gt=Tt(vt+Vt),Yt=!L;++ht<vt;)Gt[ht]=_[ht];for(;++U<it;)(Yt||U<W)&&(Gt[T[U]]=p[U]);for(;Vt--;)Gt[ht++]=p[U++];return Gt}function kf(p,_,T,L){for(var U=-1,W=p.length,it=-1,ht=T.length,vt=-1,Vt=_.length,Gt=ei(W-ht,0),Yt=Tt(Gt+Vt),ye=!L;++U<Gt;)Yt[U]=p[U];for(var ke=U;++vt<Vt;)Yt[ke+vt]=_[vt];for(;++it<ht;)(ye||U<W)&&(Yt[ke+T[it]]=p[U++]);return Yt}function pi(p,_){var T=-1,L=p.length;for(_||(_=Tt(L));++T<L;)_[T]=p[T];return _}function ns(p,_,T,L){var U=!T;T||(T={});for(var W=-1,it=_.length;++W<it;){var ht=_[W],vt=L?L(T[ht],p[ht],ht,T,p):f;vt===f&&(vt=p[ht]),U?Qs(T,ht,vt):Ua(T,ht,vt)}return T}function T0(p,_){return ns(p,lh(p),_)}function gw(p,_){return ns(p,Vu(p),_)}function ia(p,_){return function(T,L){var U=_n(T)?oo:u0,W=_?_():{};return U(T,p,Xe(L,2),W)}}function Ts(p){return In(function(_,T){var L=-1,U=T.length,W=U>1?T[U-1]:f,it=U>2?T[2]:f;for(W=p.length>3&&typeof W=="function"?(U--,W):f,it&&Li(T[0],T[1],it)&&(W=U<3?f:W,U=1),_=ar(_);++L<U;){var ht=T[L];ht&&p(_,ht,L,W)}return _})}function Rt(p,_){return function(T,L){if(T==null)return T;if(!$i(T))return p(T,L);for(var U=T.length,W=_?U:-1,it=ar(T);(_?W--:++W<U)&&L(it[W],W,it)!==!1;);return T}}function ge(p){return function(_,T,L){for(var U=-1,W=ar(_),it=L(_),ht=it.length;ht--;){var vt=it[p?ht:++U];if(T(W[vt],vt,W)===!1)break}return _}}function nh(p,_,T){var L=_&we,U=Fu(p);function W(){var it=this&&this!==Zr&&this instanceof W?U:p;return it.apply(L?T:this,arguments)}return W}function lr(p){return function(_){_=dn(_);var T=xu(_)?Lo(_):f,L=T?T[0]:_.charAt(0),U=T?Es(T,1).join(""):_.slice(1);return L[p]()+U}}function oa(p){return function(_){return xl(ad(Fr(_).replace(ae,"")),p,"")}}function Fu(p){return function(){var _=arguments;switch(_.length){case 0:return new p;case 1:return new p(_[0]);case 2:return new p(_[0],_[1]);case 3:return new p(_[0],_[1],_[2]);case 4:return new p(_[0],_[1],_[2],_[3]);case 5:return new p(_[0],_[1],_[2],_[3],_[4]);case 6:return new p(_[0],_[1],_[2],_[3],_[4],_[5]);case 7:return new p(_[0],_[1],_[2],_[3],_[4],_[5],_[6])}var T=za(p.prototype),L=p.apply(T,_);return En(L)?L:T}}function wi(p,_,T){var L=Fu(p);function U(){for(var W=arguments.length,it=Tt(W),ht=W,vt=ur(U);ht--;)it[ht]=arguments[ht];var Vt=W<3&&it[0]!==vt&&it[W-1]!==vt?[]:Ks(it,vt);if(W-=Vt.length,W<T)return ih(p,_,Di,U.placeholder,f,it,Vt,f,f,T-W);var Gt=this&&this!==Zr&&this instanceof U?L:p;return Gi(Gt,this,it)}return U}function rh(p){return function(_,T,L){var U=ar(_);if(!$i(_)){var W=Xe(T,3);_=Ar(_),T=function(ht){return W(U[ht],ht,U)}}var it=p(_,T,L);return it>-1?U[W?_[it]:it]:f}}function dm(p){return Pi(function(_){var T=_.length,L=T,U=Hi.prototype.thru;for(p&&_.reverse();L--;){var W=_[L];if(typeof W!="function")throw new _o(P);if(U&&!it&&Nu(W)=="wrapper")var it=new Hi([],!0)}for(L=it?L:T;++L<T;){W=_[L];var ht=Nu(W),vt=ht=="wrapper"?ah(W):f;vt&&Vf(vt[0])&&vt[1]==(oe|xt|Xt|me)&&!vt[4].length&&vt[9]==1?it=it[Nu(vt[0])].apply(it,vt[3]):it=W.length==1&&Vf(W)?it[ht]():it.thru(W)}return function(){var Vt=arguments,Gt=Vt[0];if(it&&Vt.length==1&&_n(Gt))return it.plant(Gt).value();for(var Yt=0,ye=T?_[Yt].apply(this,Vt):Gt;++Yt<T;)ye=_[Yt].call(this,ye);return ye}})}function Di(p,_,T,L,U,W,it,ht,vt,Vt){var Gt=_&oe,Yt=_&we,ye=_&mt,ke=_&(xt|It),nn=_&Nn,An=ye?f:Fu(p);function Ye(){for(var Dn=arguments.length,jn=Tt(Dn),Qi=Dn;Qi--;)jn[Qi]=arguments[Qi];if(ke)var Ti=ur(Ye),Fi=yu(jn,Ti);if(L&&(jn=eh(jn,L,U,ke)),W&&(jn=kf(jn,W,it,ke)),Dn-=Fi,ke&&Dn<Vt){var Kr=Ks(jn,Ti);return ih(p,_,Di,Ye.placeholder,T,jn,Kr,ht,vt,Vt-Dn)}var os=Yt?T:this,pa=ye?os[p]:p;return Dn=jn.length,ht?jn=k0(jn,ht):nn&&Dn>1&&jn.reverse(),Gt&&vt<Dn&&(jn.length=vt),this&&this!==Zr&&this instanceof Ye&&(pa=An||Fu(pa)),pa.apply(os,jn)}return Ye}function C0(p,_){return function(T,L){return f0(T,p,_(L),{})}}function Ff(p,_){return function(T,L){var U;if(T===f&&L===f)return _;if(T!==f&&(U=T),L!==f){if(U===f)return L;typeof T=="string"||typeof L=="string"?(T=ee(T),L=ee(L)):(T=Fl(T),L=Fl(L)),U=p(T,L)}return U}}function zu(p){return Pi(function(_){return _=sr(_,go(Xe())),In(function(T){var L=this;return p(_,function(U){return Gi(U,L,T)})})})}function qn(p,_){_=_===f?" ":ee(_);var T=_.length;if(T<2)return T?im(_,p):_;var L=im(_,Ce(p/Pa(_)));return xu(_)?Es(Lo(L),0,p).join(""):L.slice(0,p)}function wn(p,_,T,L){var U=_&we,W=Fu(p);function it(){for(var ht=-1,vt=arguments.length,Vt=-1,Gt=L.length,Yt=Tt(Gt+vt),ye=this&&this!==Zr&&this instanceof it?W:p;++Vt<Gt;)Yt[Vt]=L[Vt];for(;vt--;)Yt[Vt++]=arguments[++ht];return Gi(ye,U?T:this,Yt)}return it}function pm(p){return function(_,T,L){return L&&typeof L!="number"&&Li(_,T,L)&&(T=L=f),_=Ls(_),T===f?(T=_,_=0):T=Ls(T),L=L===f?_<T?1:-1:Ls(L),mw(_,T,L,p)}}function bi(p){return function(_,T){return typeof _=="string"&&typeof T=="string"||(_=yn(_),T=yn(T)),p(_,T)}}function ih(p,_,T,L,U,W,it,ht,vt,Vt){var Gt=_&xt,Yt=Gt?it:f,ye=Gt?f:it,ke=Gt?W:f,nn=Gt?f:W;_|=Gt?Xt:ue,_&=~(Gt?ue:Xt),_&at||(_&=~(we|mt));var An=[p,_,U,ke,Yt,nn,ye,ht,vt,Vt],Ye=T.apply(f,An);return Vf(p)&&F0(Ye,An),Ye.placeholder=L,Em(Ye,p,_)}function sa(p){var _=Mr[p];return function(T,L){if(T=yn(T),L=L==null?0:Bi(bn(L),292),L&&Op(T)){var U=(dn(T)+"e").split("e"),W=_(U[0]+"e"+(+U[1]+L));return U=(dn(W)+"e").split("e"),+(U[0]+"e"+(+U[1]-L))}return _(T)}}var mm=Cl&&1/Nc(new Cl([,-0]))[1]==si?function(p){return new Cl(p)}:hg;function zf(p){return function(_){var T=Ur(_);return T==Jn?Bp(_):T==St?Z_(_):of(_,p(_))}}function Ai(p,_,T,L,U,W,it,ht){var vt=_&mt;if(!vt&&typeof p!="function")throw new _o(P);var Vt=L?L.length:0;if(Vt||(_&=~(Xt|ue),L=U=f),it=it===f?it:ei(bn(it),0),ht=ht===f?ht:bn(ht),Vt-=U?U.length:0,_&ue){var Gt=L,Yt=U;L=U=f}var ye=vt?f:ah(p),ke=[p,_,T,L,U,Gt,Yt,W,it,ht];if(ye&&_w(ke,ye),p=ke[0],_=ke[1],T=ke[2],L=ke[3],U=ke[4],ht=ke[9]=ke[9]===f?vt?0:p.length:ei(ke[9]-Vt,0),!ht&&_&(xt|It)&&(_&=~(xt|It)),!_||_==we)var nn=nh(p,_,T);else _==xt||_==It?nn=wi(p,_,ht):(_==Xt||_==(we|Xt))&&!U.length?nn=wn(p,_,T,L):nn=Di.apply(f,ke);var An=ye?na:F0;return Em(An(nn,ke),p,_)}function aa(p,_,T,L){return p===f||Uo(p,wu[T])&&!nr.call(L,T)?_:p}function oh(p,_,T,L,U,W){return En(p)&&En(_)&&(W.set(_,p),Bf(p,_,f,oh,W),W.delete(_)),p}function Of(p){return Zu(p)?f:p}function Nf(p,_,T,L,U,W){var it=T&Lt,ht=p.length,vt=_.length;if(ht!=vt&&!(it&&vt>ht))return!1;var Vt=W.get(p),Gt=W.get(_);if(Vt&&Gt)return Vt==_&&Gt==p;var Yt=-1,ye=!0,ke=T&Ht?new Oa:f;for(W.set(p,_),W.set(_,p);++Yt<ht;){var nn=p[Yt],An=_[Yt];if(L)var Ye=it?L(An,nn,Yt,_,p,W):L(nn,An,Yt,p,_,W);if(Ye!==f){if(Ye)continue;ye=!1;break}if(ke){if(!vl(_,function(Dn,jn){if(!$s(ke,jn)&&(nn===Dn||U(nn,Dn,T,L,W)))return ke.push(jn)})){ye=!1;break}}else if(!(nn===An||U(nn,An,T,L,W))){ye=!1;break}}return W.delete(p),W.delete(_),ye}function gm(p,_,T,L,U,W,it){switch(T){case Ee:if(p.byteLength!=_.byteLength||p.byteOffset!=_.byteOffset)return!1;p=p.buffer,_=_.buffer;case be:return!(p.byteLength!=_.byteLength||!W(new Au(p),new Au(_)));case fi:case hl:case ps:return Uo(+p,+_);case fl:return p.name==_.name&&p.message==_.message;case rt:case Dt:return p==_+"";case Jn:var ht=Bp;case St:var vt=L&Lt;if(ht||(ht=Nc),p.size!=_.size&&!vt)return!1;var Vt=it.get(p);if(Vt)return Vt==_;L|=Ht,it.set(p,_);var Gt=Nf(ht(p),ht(_),L,U,W,it);return it.delete(p),Gt;case te:if(Iu)return Iu.call(p)==Iu.call(_)}return!1}function _m(p,_,T,L,U,W){var it=T&Lt,ht=sh(p),vt=ht.length,Vt=sh(_),Gt=Vt.length;if(vt!=Gt&&!it)return!1;for(var Yt=vt;Yt--;){var ye=ht[Yt];if(!(it?ye in _:nr.call(_,ye)))return!1}var ke=W.get(p),nn=W.get(_);if(ke&&nn)return ke==_&&nn==p;var An=!0;W.set(p,_),W.set(_,p);for(var Ye=it;++Yt<vt;){ye=ht[Yt];var Dn=p[ye],jn=_[ye];if(L)var Qi=it?L(jn,Dn,ye,_,p,W):L(Dn,jn,ye,p,_,W);if(!(Qi===f?Dn===jn||U(Dn,jn,T,L,W):Qi)){An=!1;break}Ye||(Ye=ye=="constructor")}if(An&&!Ye){var Ti=p.constructor,Fi=_.constructor;Ti!=Fi&&"constructor"in p&&"constructor"in _&&!(typeof Ti=="function"&&Ti instanceof Ti&&typeof Fi=="function"&&Fi instanceof Fi)&&(An=!1)}return W.delete(p),W.delete(_),An}function Pi(p){return Nl(Am(p,f,la),p+"")}function sh(p){return Xp(p,Ar,lh)}function Ou(p){return Xp(p,Ri,Vu)}var ah=Fa?function(p){return Fa.get(p)}:hg;function Nu(p){for(var _=p.name+"",T=Sl[_],L=nr.call(Sl,_)?T.length:0;L--;){var U=T[L],W=U.func;if(W==null||W==p)return U.name}return _}function ur(p){var _=nr.call(Z,"placeholder")?Z:p;return _.placeholder}function Xe(){var p=Z.iteratee||Ka;return p=p===Ka?tm:p,arguments.length?p(arguments[0],arguments[1]):p}function Uu(p,_){var T=p.__data__;return I0(_)?T[typeof _=="string"?"string":"hash"]:T.map}function zl(p){for(var _=Ar(p),T=_.length;T--;){var L=_[T],U=p[L];_[T]=[L,U,P0(U)]}return _}function vo(p,_){var T=Xv(p,_);return Ll(T)?T:f}function ym(p){var _=nr.call(p,ka),T=p[ka];try{p[ka]=f;var L=!0}catch{}var U=hf.call(p);return L&&(_?p[ka]=T:delete p[ka]),U}var lh=Cu?function(p){return p==null?[]:(p=ar(p),Wr(Cu(p),function(_){return Al.call(p,_)}))}:ud,Vu=Cu?function(p){for(var _=[];p;)gr(_,lh(p)),p=Ra(p);return _}:ud,Ur=ni;(jc&&Ur(new jc(new ArrayBuffer(1)))!=Ee||Tl&&Ur(new Tl)!=Jn||gf&&Ur(gf.resolve())!=q||Cl&&Ur(new Cl)!=St||Hc&&Ur(new Hc)!=Pt)&&(Ur=function(p){var _=ni(p),T=_==Ot?p.constructor:f,L=T?Bt(T):"";if(L)switch(L){case _f:return Ee;case Up:return Jn;case xs:return q;case Vp:return St;case Q_:return Pt}return _});function uh(p,_,T){for(var L=-1,U=T.length;++L<U;){var W=T[L],it=W.size;switch(W.type){case"drop":p+=it;break;case"dropRight":_-=it;break;case"take":_=Bi(_,p+it);break;case"takeRight":p=ei(p,_-it);break}}return{start:p,end:_}}function xm(p){var _=p.match(ve);return _?_[1].split(Sn):[]}function ch(p,_,T){_=As(_,p);for(var L=-1,U=_.length,W=!1;++L<U;){var it=Oe(_[L]);if(!(W=p!=null&&T(p,it)))break;p=p[it]}return W||++L!=U?W:(U=p==null?0:p.length,!!U&&Qf(U)&&Cs(it,U)&&(_n(p)||Ha(p)))}function vm(p){var _=p.length,T=new p.constructor(_);return _&&typeof p[0]=="string"&&nr.call(p,"index")&&(T.index=p.index,T.input=p.input),T}function wm(p){return typeof p.constructor=="function"&&!hh(p)?za(Ra(p)):{}}function bm(p,_,T){var L=p.constructor;switch(_){case be:return Rf(p);case fi:case hl:return new L(+p);case Ee:return um(p,T);case Un:case Qn:case Nr:case tr:case pr:case Hn:case ai:case _i:case yi:return fm(p,T);case Jn:return new L;case ps:case Dt:return new L(p);case rt:return cm(p);case St:return new L;case te:return hm(p)}}function S0(p,_){var T=_.length;if(!T)return p;var L=T-1;return _[L]=(T>1?"& ":"")+_[L],_=_.join(T>2?", ":" "),p.replace(Ln,`{
/* [wrapped with `+_+`] */
`)}function M0(p){return _n(p)||Ha(p)||!!(kp&&p&&p[kp])}function Cs(p,_){var T=typeof p;return _=_??fe,!!_&&(T=="number"||T!="symbol"&&Ma.test(p))&&p>-1&&p%1==0&&p<_}function Li(p,_,T){if(!En(T))return!1;var L=typeof _;return(L=="number"?$i(T)&&Cs(_,T.length):L=="string"&&_ in T)?Uo(T[_],p):!1}function Uf(p,_){if(_n(p))return!1;var T=typeof p;return T=="number"||T=="symbol"||T=="boolean"||p==null||Yi(p)?!0:Kt.test(p)||!jt.test(p)||_!=null&&p in ar(_)}function I0(p){var _=typeof p;return _=="string"||_=="number"||_=="symbol"||_=="boolean"?p!=="__proto__":p===null}function Vf(p){var _=Nu(p),T=Z[_];if(typeof T!="function"||!(_ in Vn.prototype))return!1;if(p===T)return!0;var L=ah(T);return!!L&&p===L[0]}function B0(p){return!!Vc&&Vc in p}var D0=uf?ha:bh;function hh(p){var _=p&&p.constructor,T=typeof _=="function"&&_.prototype||wu;return p===T}function P0(p){return p===p&&!En(p)}function Cn(p,_){return function(T){return T==null?!1:T[p]===_&&(_!==f||p in ar(T))}}function L0(p){var _=Xf(p,function(L){return T.size===k&&T.clear(),L}),T=_.cache;return _}function _w(p,_){var T=p[1],L=_[1],U=T|L,W=U<(we|mt|oe),it=L==oe&&T==xt||L==oe&&T==me&&p[7].length<=_[8]||L==(oe|me)&&_[7].length<=_[8]&&T==xt;if(!(W||it))return p;L&we&&(p[2]=_[2],U|=T&we?0:at);var ht=_[3];if(ht){var vt=p[3];p[3]=vt?eh(vt,ht,_[4]):ht,p[4]=vt?Ks(p[3],ot):_[4]}return ht=_[5],ht&&(vt=p[5],p[5]=vt?kf(vt,ht,_[6]):ht,p[6]=vt?Ks(p[5],ot):_[6]),ht=_[7],ht&&(p[7]=ht),L&oe&&(p[8]=p[8]==null?_[8]:Bi(p[8],_[8])),p[9]==null&&(p[9]=_[9]),p[0]=_[0],p[1]=U,p}function yw(p){var _=[];if(p!=null)for(var T in ar(p))_.push(T);return _}function Gf(p){return hf.call(p)}function Am(p,_,T){return _=ei(_===f?p.length-1:_,0),function(){for(var L=arguments,U=-1,W=ei(L.length-_,0),it=Tt(W);++U<W;)it[U]=L[_+U];U=-1;for(var ht=Tt(_+1);++U<_;)ht[U]=L[U];return ht[_]=T(it),Gi(p,this,ht)}}function R0(p,_){return _.length<2?p:Va(p,Wi(_,0,-1))}function k0(p,_){for(var T=p.length,L=Bi(_.length,T),U=pi(p);L--;){var W=_[L];p[L]=Cs(W,T)?U[W]:f}return p}function jf(p,_){if(!(_==="constructor"&&typeof p[_]=="function")&&_!="__proto__")return p[_]}var F0=Hf(na),Ol=zp||function(p,_){return Zr.setTimeout(p,_)},Nl=Hf(ws);function Em(p,_,T){var L=_+"";return Nl(p,S0(L,$e(xm(L),T)))}function Hf(p){var _=0,T=0;return function(){var L=ew(),U=Ni-(L-T);if(T=L,U>0){if(++_>=ds)return arguments[0]}else _=0;return p.apply(f,arguments)}}function Ul(p,_){var T=-1,L=p.length,U=L-1;for(_=_===f?L:_;++T<_;){var W=Xc(T,U),it=p[W];p[W]=p[T],p[T]=it}return p.length=_,p}var Ss=L0(function(p){var _=[];return p.charCodeAt(0)===46&&_.push(""),p.replace(Qt,function(T,L,U,W){_.push(U?W.replace(Rr,"$1"):L||T)}),_});function Oe(p){if(typeof p=="string"||Yi(p))return p;var _=p+"";return _=="0"&&1/p==-si?"-0":_}function Bt(p){if(p!=null){try{return cf.call(p)}catch{}try{return p+""}catch{}}return""}function $e(p,_){return Me(ci,function(T){var L="_."+T[0];_&T[1]&&!ji(p,L)&&p.push(L)}),p.sort()}function Ve(p){if(p instanceof Vn)return p.clone();var _=new Hi(p.__wrapped__,p.__chain__);return _.__actions__=pi(p.__actions__),_.__index__=p.__index__,_.__values__=p.__values__,_}function ao(p,_,T){(T?Li(p,_,T):_===f)?_=1:_=ei(bn(_),0);var L=p==null?0:p.length;if(!L||_<1)return[];for(var U=0,W=0,it=Tt(Ce(L/_));U<L;)it[W++]=Wi(p,U,U+=_);return it}function Gu(p){for(var _=-1,T=p==null?0:p.length,L=0,U=[];++_<T;){var W=p[_];W&&(U[L++]=W)}return U}function xw(){var p=arguments.length;if(!p)return[];for(var _=Tt(p-1),T=arguments[0],L=p;L--;)_[L-1]=arguments[L];return gr(_n(T)?pi(T):[T],di(_,1))}var Ne=In(function(p,_){return Vr(p)?Fo(p,di(_,1,Vr,!0)):[]}),vw=In(function(p,_){var T=wo(_);return Vr(T)&&(T=f),Vr(p)?Fo(p,di(_,1,Vr,!0),Xe(T,2)):[]}),Tm=In(function(p,_){var T=wo(_);return Vr(T)&&(T=f),Vr(p)?Fo(p,di(_,1,Vr,!0),f,T):[]});function ww(p,_,T){var L=p==null?0:p.length;return L?(_=T||_===f?1:bn(_),Wi(p,_<0?0:_,L)):[]}function Cm(p,_,T){var L=p==null?0:p.length;return L?(_=T||_===f?1:bn(_),_=L-_,Wi(p,0,_<0?0:_)):[]}function Sm(p,_){return p&&p.length?ku(p,Xe(_,3),!0,!0):[]}function fh(p,_){return p&&p.length?ku(p,Xe(_,3),!0):[]}function ju(p,_,T,L){var U=p==null?0:p.length;return U?(T&&typeof T!="number"&&Li(p,_,T)&&(T=0,L=U),c0(p,_,T,L)):[]}function Ms(p,_,T){var L=p==null?0:p.length;if(!L)return-1;var U=T==null?0:bn(T);return U<0&&(U=ei(L+U,0)),Ba(p,Xe(_,3),U)}function zo(p,_,T){var L=p==null?0:p.length;if(!L)return-1;var U=L-1;return T!==f&&(U=bn(T),U=T<0?ei(L+U,0):Bi(U,L-1)),Ba(p,Xe(_,3),U,!0)}function la(p){var _=p==null?0:p.length;return _?di(p,1):[]}function Vl(p){var _=p==null?0:p.length;return _?di(p,si):[]}function Ga(p,_){var T=p==null?0:p.length;return T?(_=_===f?1:bn(_),di(p,_)):[]}function bw(p){for(var _=-1,T=p==null?0:p.length,L={};++_<T;){var U=p[_];L[U[0]]=U[1]}return L}function z0(p){return p&&p.length?p[0]:f}function Aw(p,_,T){var L=p==null?0:p.length;if(!L)return-1;var U=T==null?0:bn(T);return U<0&&(U=ei(L+U,0)),ys(p,_,U)}function Ew(p){var _=p==null?0:p.length;return _?Wi(p,0,-1):[]}var O0=In(function(p){var _=sr(p,am);return _.length&&_[0]===p[0]?$c(_):[]}),lo=In(function(p){var _=wo(p),T=sr(p,am);return _===wo(T)?_=f:T.pop(),T.length&&T[0]===p[0]?$c(T,Xe(_,2)):[]}),qr=In(function(p){var _=wo(p),T=sr(p,am);return _=typeof _=="function"?_:f,_&&T.pop(),T.length&&T[0]===p[0]?$c(T,f,_):[]});function Jr(p,_){return p==null?"":Y_.call(p,_)}function wo(p){var _=p==null?0:p.length;return _?p[_-1]:f}function N0(p,_,T){var L=p==null?0:p.length;if(!L)return-1;var U=L;return T!==f&&(U=bn(T),U=U<0?ei(L+U,0):Bi(U,L-1)),_===_?Uc(p,_,U):Ba(p,V_,U,!0)}function Tw(p,_){return p&&p.length?Rl(p,bn(_)):f}var Cw=In(Kn);function Kn(p,_){return p&&p.length&&_&&_.length?rm(p,_):p}function Mm(p,_,T){return p&&p.length&&_&&_.length?rm(p,_,Xe(T,2)):p}function ja(p,_,T){return p&&p.length&&_&&_.length?rm(p,_,f,T):p}var U0=Pi(function(p,_){var T=p==null?0:p.length,L=bf(p,_);return b0(p,sr(_,function(U){return Cs(U,T)?+U:U}).sort(xo)),L});function V0(p,_){var T=[];if(!(p&&p.length))return T;var L=-1,U=[],W=p.length;for(_=Xe(_,3);++L<W;){var it=p[L];_(it,L,p)&&(T.push(it),U.push(L))}return b0(p,U),T}function Zf(p){return p==null?p:Np.call(p)}function cr(p,_,T){var L=p==null?0:p.length;return L?(T&&typeof T!="number"&&Li(p,_,T)?(_=0,T=L):(_=_==null?0:bn(_),T=T===f?L:bn(T)),Wi(p,_,T)):[]}function Im(p,_){return Qc(p,_)}function Is(p,_,T){return Pf(p,_,Xe(T,2))}function G0(p,_){var T=p==null?0:p.length;if(T){var L=Qc(p,_);if(L<T&&Uo(p[L],_))return L}return-1}function j0(p,_){return Qc(p,_,!0)}function H0(p,_,T){return Pf(p,_,Xe(T,2),!0)}function zn(p,_){var T=p==null?0:p.length;if(T){var L=Qc(p,_,!0)-1;if(Uo(p[L],_))return L}return-1}function Bm(p){return p&&p.length?kl(p):[]}function bo(p,_){return p&&p.length?kl(p,Xe(_,2)):[]}function Z0(p){var _=p==null?0:p.length;return _?Wi(p,1,_):[]}function W0(p,_,T){return p&&p.length?(_=T||_===f?1:bn(_),Wi(p,0,_<0?0:_)):[]}function q0(p,_,T){var L=p==null?0:p.length;return L?(_=T||_===f?1:bn(_),_=L-_,Wi(p,_<0?0:_,L)):[]}function je(p,_){return p&&p.length?ku(p,Xe(_,3),!1,!0):[]}function Dm(p,_){return p&&p.length?ku(p,Xe(_,3)):[]}var yr=In(function(p){return bs(di(p,1,Vr,!0))}),J0=In(function(p){var _=wo(p);return Vr(_)&&(_=f),bs(di(p,1,Vr,!0),Xe(_,2))}),$0=In(function(p){var _=wo(p);return _=typeof _=="function"?_:f,bs(di(p,1,Vr,!0),f,_)});function K0(p){return p&&p.length?bs(p):[]}function X0(p,_){return p&&p.length?bs(p,Xe(_,2)):[]}function Y0(p,_){return _=typeof _=="function"?_:f,p&&p.length?bs(p,f,_):[]}function Wf(p){if(!(p&&p.length))return[];var _=0;return p=Wr(p,function(T){if(Vr(T))return _=ei(T.length,_),!0}),Po(_,function(T){return sr(p,Js(T))})}function Pm(p,_){if(!(p&&p.length))return[];var T=Wf(p);return _==null?T:sr(T,function(L){return Gi(_,f,L)})}var Q0=In(function(p,_){return Vr(p)?Fo(p,_):[]}),Ue=In(function(p){return Lf(Wr(p,Vr))}),Ge=In(function(p){var _=wo(p);return Vr(_)&&(_=f),Lf(Wr(p,Vr),Xe(_,2))}),Lm=In(function(p){var _=wo(p);return _=typeof _=="function"?_:f,Lf(Wr(p,Vr),f,_)}),ua=In(Wf);function ty(p,_){return E0(p||[],_||[],Ua)}function ey(p,_){return E0(p||[],_||[],Yc)}var ny=In(function(p){var _=p.length,T=_>1?p[_-1]:f;return T=typeof T=="function"?(p.pop(),T):f,Pm(p,T)});function Rm(p){var _=Z(p);return _.__chain__=!0,_}function ry(p,_){return _(p),p}function dh(p,_){return _(p)}var iy=Pi(function(p){var _=p.length,T=_?p[0]:0,L=this.__wrapped__,U=function(W){return bf(W,p)};return _>1||this.__actions__.length||!(L instanceof Vn)||!Cs(T)?this.thru(U):(L=L.slice(T,+T+(_?1:0)),L.__actions__.push({func:dh,args:[U],thisArg:f}),new Hi(L,this.__chain__).thru(function(W){return _&&!W.length&&W.push(f),W}))});function oy(){return Rm(this)}function sy(){return new Hi(this.value(),this.__chain__)}function ay(){this.__values__===f&&(this.__values__=Km(this.value()));var p=this.__index__>=this.__values__.length,_=p?f:this.__values__[this.__index__++];return{done:p,value:_}}function ca(){return this}function Sw(p){for(var _,T=this;T instanceof xf;){var L=Ve(T);L.__index__=0,L.__values__=f,_?U.__wrapped__=L:_=L;var U=L;T=T.__wrapped__}return U.__wrapped__=p,_}function tn(){var p=this.__wrapped__;if(p instanceof Vn){var _=p;return this.__actions__.length&&(_=new Vn(this)),_=_.reverse(),_.__actions__.push({func:dh,args:[Zf],thisArg:f}),new Hi(_,this.__chain__)}return this.thru(Zf)}function km(){return sm(this.__wrapped__,this.__actions__)}var Oo=ia(function(p,_,T){nr.call(p,T)?++p[T]:Qs(p,T,1)});function ly(p,_,T){var L=_n(p)?ef:Tf;return T&&Li(p,_,T)&&(_=f),L(p,Xe(_,3))}function uy(p,_){var T=_n(p)?Wr:$p;return T(p,Xe(_,3))}var cy=rh(Ms),hy=rh(zo);function fy(p,_){return di(No(p,_),1)}function dy(p,_){return di(No(p,_),si)}function py(p,_,T){return T=T===f?1:bn(T),di(No(p,_),T)}function Fm(p,_){var T=_n(p)?Me:vs;return T(p,Xe(_,3))}function zm(p,_){var T=_n(p)?wp:qc;return T(p,Xe(_,3))}var Mw=ia(function(p,_,T){nr.call(p,T)?p[T].push(_):Qs(p,T,[_])});function Om(p,_,T,L){p=$i(p)?p:Wa(p),T=T&&!L?bn(T):0;var U=p.length;return T<0&&(T=ei(U+T,0)),Xi(p)?T<=U&&p.indexOf(_,T)>-1:!!U&&ys(p,_,T)>-1}var Gl=In(function(p,_,T){var L=-1,U=typeof _=="function",W=$i(p)?Tt(p.length):[];return vs(p,function(it){W[++L]=U?Gi(_,it,T):Pu(it,_,T)}),W}),Iw=ia(function(p,_,T){Qs(p,T,_)});function No(p,_){var T=_n(p)?sr:em;return T(p,Xe(_,3))}function Ao(p,_,T,L){return p==null?[]:(_n(_)||(_=_==null?[]:[_]),T=L?f:T,_n(T)||(T=T==null?[]:[T]),v0(p,_,T))}var my=ia(function(p,_,T){p[T?0:1].push(_)},function(){return[[],[]]});function qf(p,_,T){var L=_n(p)?xl:Cp,U=arguments.length<3;return L(p,Xe(_,4),T,U,vs)}function Nm(p,_,T){var L=_n(p)?bp:Cp,U=arguments.length<3;return L(p,Xe(_,4),T,U,qc)}function gy(p,_){var T=_n(p)?Wr:$p;return T(p,en(Xe(_,3)))}function _y(p){var _=_n(p)?Na:es;return _(p)}function yy(p,_,T){(T?Li(p,_,T):_===f)?_=1:_=bn(_);var L=_n(p)?l0:Df;return L(p,_)}function xy(p){var _=_n(p)?Jp:Ru;return _(p)}function Jf(p){if(p==null)return 0;if($i(p))return Xi(p)?Pa(p):p.length;var _=Ur(p);return _==Jn||_==St?p.size:Mf(p).length}function vy(p,_,T){var L=_n(p)?vl:le;return T&&Li(p,_,T)&&(_=f),L(p,Xe(_,3))}var wy=In(function(p,_){if(p==null)return[];var T=_.length;return T>1&&Li(p,_[0],_[1])?_=[]:T>2&&Li(_[0],_[1],_[2])&&(_=[_[0]]),v0(p,di(_,1),[])}),ph=Fp||function(){return Zr.Date.now()};function by(p,_){if(typeof _!="function")throw new _o(P);return p=bn(p),function(){if(--p<1)return _.apply(this,arguments)}}function Um(p,_,T){return _=T?f:_,_=p&&_==null?p.length:_,Ai(p,oe,f,f,f,f,_)}function $f(p,_){var T;if(typeof _!="function")throw new _o(P);return p=bn(p),function(){return--p>0&&(T=_.apply(this,arguments)),p<=1&&(_=f),T}}var Eo=In(function(p,_,T){var L=we;if(T.length){var U=Ks(T,ur(Eo));L|=Xt}return Ai(p,L,_,T,U)}),Vm=In(function(p,_,T){var L=we|mt;if(T.length){var U=Ks(T,ur(Vm));L|=Xt}return Ai(_,L,p,T,U)});function Gm(p,_,T){_=T?f:_;var L=Ai(p,xt,f,f,f,f,f,_);return L.placeholder=Gm.placeholder,L}function Ay(p,_,T){_=T?f:_;var L=Ai(p,It,f,f,f,f,f,_);return L.placeholder=Ay.placeholder,L}function Kf(p,_,T){var L,U,W,it,ht,vt,Vt=0,Gt=!1,Yt=!1,ye=!0;if(typeof p!="function")throw new _o(P);_=yn(_)||0,En(T)&&(Gt=!!T.leading,Yt="maxWait"in T,W=Yt?ei(yn(T.maxWait)||0,_):W,ye="trailing"in T?!!T.trailing:ye);function ke(Kr){var os=L,pa=U;return L=U=f,Vt=Kr,it=p.apply(pa,os),it}function nn(Kr){return Vt=Kr,ht=Ol(Dn,_),Gt?ke(Kr):it}function An(Kr){var os=Kr-vt,pa=Kr-Vt,m1=_-os;return Yt?Bi(m1,W-pa):m1}function Ye(Kr){var os=Kr-vt,pa=Kr-Vt;return vt===f||os>=_||os<0||Yt&&pa>=W}function Dn(){var Kr=ph();if(Ye(Kr))return jn(Kr);ht=Ol(Dn,An(Kr))}function jn(Kr){return ht=f,ye&&L?ke(Kr):(L=U=f,it)}function Qi(){ht!==f&&qi(ht),Vt=0,L=vt=U=ht=f}function Ti(){return ht===f?it:jn(ph())}function Fi(){var Kr=ph(),os=Ye(Kr);if(L=arguments,U=this,vt=Kr,os){if(ht===f)return nn(vt);if(Yt)return qi(ht),ht=Ol(Dn,_),ke(vt)}return ht===f&&(ht=Ol(Dn,_)),it}return Fi.cancel=Qi,Fi.flush=Ti,Fi}var jm=In(function(p,_){return Ef(p,1,_)}),Bw=In(function(p,_,T){return Ef(p,yn(_)||0,T)});function rs(p){return Ai(p,Nn)}function Xf(p,_){if(typeof p!="function"||_!=null&&typeof _!="function")throw new _o(P);var T=function(){var L=arguments,U=_?_.apply(this,L):L[0],W=T.cache;if(W.has(U))return W.get(U);var it=p.apply(this,L);return T.cache=W.set(U,it)||W,it};return T.cache=new(Xf.Cache||ts),T}Xf.Cache=ts;function en(p){if(typeof p!="function")throw new _o(P);return function(){var _=arguments;switch(_.length){case 0:return!p.call(this);case 1:return!p.call(this,_[0]);case 2:return!p.call(this,_[0],_[1]);case 3:return!p.call(this,_[0],_[1],_[2])}return!p.apply(this,_)}}function Hm(p){return $f(2,p)}var Ji=lm(function(p,_){_=_.length==1&&_n(_[0])?sr(_[0],go(Xe())):sr(di(_,1),go(Xe()));var T=_.length;return In(function(L){for(var U=-1,W=Bi(L.length,T);++U<W;)L[U]=_[U].call(this,L[U]);return Gi(p,this,L)})}),is=In(function(p,_){var T=Ks(_,ur(is));return Ai(p,Xt,f,_,T)}),Zm=In(function(p,_){var T=Ks(_,ur(Zm));return Ai(p,ue,f,_,T)}),Ey=Pi(function(p,_){return Ai(p,me,f,f,f,_)});function Wm(p,_){if(typeof p!="function")throw new _o(P);return _=_===f?_:bn(_),In(p,_)}function Ty(p,_){if(typeof p!="function")throw new _o(P);return _=_==null?0:ei(bn(_),0),In(function(T){var L=T[_],U=Es(T,0,_);return L&&gr(U,L),Gi(p,this,U)})}function Cy(p,_,T){var L=!0,U=!0;if(typeof p!="function")throw new _o(P);return En(T)&&(L="leading"in T?!!T.leading:L,U="trailing"in T?!!T.trailing:U),Kf(p,_,{leading:L,maxWait:_,trailing:U})}function Sy(p){return Um(p,1)}function My(p,_){return is(th(_),p)}function Iy(){if(!arguments.length)return[];var p=arguments[0];return _n(p)?p:[p]}function Yf(p){return so(p,zt)}function qe(p,_){return _=typeof _=="function"?_:f,so(p,zt,_)}function qm(p){return so(p,ft|zt)}function jl(p,_){return _=typeof _=="function"?_:f,so(p,ft|zt,_)}function By(p,_){return _==null||ta(p,_,Ar(_))}function Uo(p,_){return p===_||p!==p&&_!==_}var Dy=bi(Yp),Py=bi(function(p,_){return p>=_}),Ha=Kc(function(){return arguments}())?Kc:function(p){return Gr(p)&&nr.call(p,"callee")&&!Al.call(p,"callee")},_n=Tt.isArray,Ly=gu?go(gu):Qp;function $i(p){return p!=null&&Qf(p.length)&&!ha(p)}function Vr(p){return Gr(p)&&$i(p)}function Dw(p){return p===!0||p===!1||Gr(p)&&ni(p)==fi}var Bs=X_||bh,Bn=Qh?go(Qh):d0;function Pw(p){return Gr(p)&&p.nodeType===1&&!Zu(p)}function Lw(p){if(p==null)return!0;if($i(p)&&(_n(p)||typeof p=="string"||typeof p.splice=="function"||Bs(p)||sn(p)||Ha(p)))return!p.length;var _=Ur(p);if(_==Jn||_==St)return!p.size;if(hh(p))return!Mf(p).length;for(var T in p)if(nr.call(p,T))return!1;return!0}function Hu(p,_){return Lu(p,_)}function Rw(p,_,T){T=typeof T=="function"?T:f;var L=T?T(p,_):f;return L===f?Lu(p,_,f,T):!!L}function Jm(p){if(!Gr(p))return!1;var _=ni(p);return _==fl||_==su||typeof p.message=="string"&&typeof p.name=="string"&&!Zu(p)}function Ki(p){return typeof p=="number"&&Op(p)}function ha(p){if(!En(p))return!1;var _=ni(p);return _==dl||_==Ic||_==re||_==K}function lt(p){return typeof p=="number"&&p==bn(p)}function Qf(p){return typeof p=="number"&&p>-1&&p%1==0&&p<=fe}function En(p){var _=typeof p;return p!=null&&(_=="object"||_=="function")}function Gr(p){return p!=null&&typeof p=="object"}var Ry=vp?go(vp):m0;function kw(p,_){return p===_||Sf(p,_,zl(_))}function J(p,_,T){return T=typeof T=="function"?T:f,Sf(p,_,zl(_),T)}function Fw(p){return mh(p)&&p!=+p}function ky(p){if(D0(p))throw new on(C);return Ll(p)}function Ds(p){return p===null}function zw(p){return p==null}function mh(p){return typeof p=="number"||Gr(p)&&ni(p)==ps}function Zu(p){if(!Gr(p)||ni(p)!=Ot)return!1;var _=Ra(p);if(_===null)return!0;var T=nr.call(_,"constructor")&&_.constructor;return typeof T=="function"&&T instanceof T&&cf.call(T)==K_}var Ps=zc?go(zc):g0;function Fy(p){return lt(p)&&p>=-fe&&p<=fe}var zy=tf?go(tf):_0;function Xi(p){return typeof p=="string"||!_n(p)&&Gr(p)&&ni(p)==Dt}function Yi(p){return typeof p=="symbol"||Gr(p)&&ni(p)==te}var sn=Oc?go(Oc):fw;function gh(p){return p===f}function Oy(p){return Gr(p)&&Ur(p)==Pt}function td(p){return Gr(p)&&ni(p)==xe}var $m=bi(If),_h=bi(function(p,_){return p<=_});function Km(p){if(!p)return[];if($i(p))return Xi(p)?Lo(p):pi(p);if(El&&p[El])return H_(p[El]());var _=Ur(p),T=_==Jn?Bp:_==St?Nc:Wa;return T(p)}function Ls(p){if(!p)return p===0?p:0;if(p=yn(p),p===si||p===-si){var _=p<0?-1:1;return _*He}return p===p?p:0}function bn(p){var _=Ls(p),T=_%1;return _===_?T?_-T:_:0}function Rs(p){return p?Dl(bn(p),0,hn):0}function yn(p){if(typeof p=="number")return p;if(Yi(p))return We;if(En(p)){var _=typeof p.valueOf=="function"?p.valueOf():p;p=En(_)?_+"":_}if(typeof p!="string")return p===0?p:+p;p=Mp(p);var T=Vi.test(p);return T||cu.test(p)?gn(p.slice(2),T?2:8):Hr.test(p)?We:+p}function Wu(p){return ns(p,Ri(p))}function Za(p){return p?Dl(bn(p),-fe,fe):p===0?p:0}function dn(p){return p==null?"":ee(p)}var Ow=Ts(function(p,_){if(hh(_)||$i(_)){ns(_,Ar(_),p);return}for(var T in _)nr.call(_,T)&&Ua(p,T,_[T])}),Hl=Ts(function(p,_){ns(_,Ri(_),p)}),qu=Ts(function(p,_,T,L){ns(_,Ri(_),p,L)}),Vo=Ts(function(p,_,T,L){ns(_,Ar(_),p,L)}),Go=Pi(bf);function Nw(p,_){var T=za(p);return _==null?T:Du(T,_)}var ed=In(function(p,_){p=ar(p);var T=-1,L=_.length,U=L>2?_[2]:f;for(U&&Li(_[0],_[1],U)&&(L=1);++T<L;)for(var W=_[T],it=Ri(W),ht=-1,vt=it.length;++ht<vt;){var Vt=it[ht],Gt=p[Vt];(Gt===f||Uo(Gt,wu[Vt])&&!nr.call(p,Vt))&&(p[Vt]=W[Vt])}return p}),Ny=In(function(p){return p.push(f,oh),Gi(tg,f,p)});function Uw(p,_){return _s(p,Xe(_,3),yo)}function Xm(p,_){return _s(p,Xe(_,3),Jc)}function To(p,_){return p==null?p:ea(p,Xe(_,3),Ri)}function fa(p,_){return p==null?p:Kp(p,Xe(_,3),Ri)}function Uy(p,_){return p&&yo(p,Xe(_,3))}function Vy(p,_){return p&&Jc(p,Xe(_,3))}function Ym(p){return p==null?[]:Pl(p,Ar(p))}function nd(p){return p==null?[]:Pl(p,Ri(p))}function yh(p,_,T){var L=p==null?f:Va(p,_);return L===f?T:L}function Ju(p,_){return p!=null&&ch(p,_,hw)}function Ei(p,_){return p!=null&&ch(p,_,h0)}var xh=C0(function(p,_,T){_!=null&&typeof _.toString!="function"&&(_=hf.call(_)),p[_]=T},Fs(ki)),rd=C0(function(p,_,T){_!=null&&typeof _.toString!="function"&&(_=hf.call(_)),nr.call(p,_)?p[_].push(T):p[_]=[T]},Xe),Gy=In(Pu);function Ar(p){return $i(p)?qp(p):Mf(p)}function Ri(p){return $i(p)?qp(p,!0):y0(p)}function Qm(p,_){var T={};return _=Xe(_,3),yo(p,function(L,U,W){Qs(T,_(L,U,W),L)}),T}function jy(p,_){var T={};return _=Xe(_,3),yo(p,function(L,U,W){Qs(T,U,_(L,U,W))}),T}var Hy=Ts(function(p,_,T){Bf(p,_,T)}),tg=Ts(function(p,_,T,L){Bf(p,_,T,L)}),$r=Pi(function(p,_){var T={};if(p==null)return T;var L=!1;_=sr(_,function(W){return W=As(W,p),L||(L=W.length>1),W}),ns(p,Ou(p),T),L&&(T=so(T,ft|X|zt,Of));for(var U=_.length;U--;)om(T,_[U]);return T});function Zy(p,_){return eg(p,en(Xe(_)))}var Wy=Pi(function(p,_){return p==null?{}:dw(p,_)});function eg(p,_){if(p==null)return{};var T=sr(Ou(p),function(L){return[L]});return _=Xe(_),w0(p,T,function(L,U){return _(L,U[0])})}function Vw(p,_,T){_=As(_,p);var L=-1,U=_.length;for(U||(U=1,p=f);++L<U;){var W=p==null?f:p[Oe(_[L])];W===f&&(L=U,W=T),p=ha(W)?W.call(p):W}return p}function qy(p,_,T){return p==null?p:Yc(p,_,T)}function Jy(p,_,T,L){return L=typeof L=="function"?L:f,p==null?p:Yc(p,_,T,L)}var vh=zf(Ar),ng=zf(Ri);function Gw(p,_,T){var L=_n(p),U=L||Bs(p)||sn(p);if(_=Xe(_,4),T==null){var W=p&&p.constructor;U?T=L?new W:[]:En(p)?T=ha(W)?za(Ra(p)):{}:T={}}return(U?Me:yo)(p,function(it,ht,vt){return _(T,it,ht,vt)}),T}function jw(p,_){return p==null?!0:om(p,_)}function Hw(p,_,T){return p==null?p:A0(p,_,th(T))}function $u(p,_,T,L){return L=typeof L=="function"?L:f,p==null?p:A0(p,_,th(T),L)}function Wa(p){return p==null?[]:Ip(p,Ar(p))}function qa(p){return p==null?[]:Ip(p,Ri(p))}function Be(p,_,T){return T===f&&(T=_,_=f),T!==f&&(T=yn(T),T=T===T?T:0),_!==f&&(_=yn(_),_=_===_?_:0),Dl(yn(p),_,T)}function Zw(p,_,T){return _=Ls(_),T===f?(T=_,_=0):T=Ls(T),p=yn(p),Cf(p,_,T)}function Ww(p,_,T){if(T&&typeof T!="boolean"&&Li(p,_,T)&&(_=T=f),T===f&&(typeof _=="boolean"?(T=_,_=f):typeof p=="boolean"&&(T=p,p=f)),p===f&&_===f?(p=0,_=1):(p=Ls(p),_===f?(_=p,p=0):_=Ls(_)),p>_){var L=p;p=_,_=L}if(T||p%1||_%1){var U=mf();return Bi(p+U*(_-p+mu("1e-"+((U+"").length-1))),_)}return Xc(p,_)}var id=oa(function(p,_,T){return _=_.toLowerCase(),p+(T?Ir(_):_)});function Ir(p){return lg(dn(p).toLowerCase())}function Fr(p){return p=dn(p),p&&p.replace(hu,j_).replace(_l,"")}function Rn(p,_,T){p=dn(p),_=ee(_);var L=p.length;T=T===f?L:Dl(bn(T),0,L);var U=T;return T-=_.length,T>=0&&p.slice(T,U)==_}function uo(p){return p=dn(p),p&&At.test(p)?p.replace(Zs,sf):p}function Br(p){return p=dn(p),p&&ce.test(p)?p.replace(Zt,"\\$&"):p}var $y=oa(function(p,_,T){return p+(T?"-":"")+_.toLowerCase()}),xr=oa(function(p,_,T){return p+(T?" ":"")+_.toLowerCase()}),Ky=lr("toLowerCase");function Ja(p,_,T){p=dn(p),_=bn(_);var L=_?Pa(p):0;if(!_||L>=_)return p;var U=(_-L)/2;return qn(Gc(U),T)+p+qn(Ce(U),T)}function rg(p,_,T){p=dn(p),_=bn(_);var L=_?Pa(p):0;return _&&L<_?p+qn(_-L,T):p}function wh(p,_,T){p=dn(p),_=bn(_);var L=_?Pa(p):0;return _&&L<_?qn(_-L,T)+p:p}function an(p,_,T){return T||_==null?_=0:_&&(_=+_),nw(dn(p).replace(Wt,""),_||0)}function ig(p,_,T){return(T?Li(p,_,T):_===f)?_=1:_=bn(_),im(dn(p),_)}function Xy(){var p=arguments,_=dn(p[0]);return p.length<3?_:_.replace(p[1],p[2])}var og=oa(function(p,_,T){return p+(T?"_":"")+_.toLowerCase()});function qw(p,_,T){return T&&typeof T!="number"&&Li(p,_,T)&&(_=T=f),T=T===f?hn:T>>>0,T?(p=dn(p),p&&(typeof _=="string"||_!=null&&!Ps(_))&&(_=ee(_),!_&&xu(p))?Es(Lo(p),0,T):p.split(_,T)):[]}var sg=oa(function(p,_,T){return p+(T?" ":"")+lg(_)});function Yy(p,_,T){return p=dn(p),T=T==null?0:Dl(bn(T),0,p.length),_=ee(_),p.slice(T,T+_.length)==_}function Jw(p,_,T){var L=Z.templateSettings;T&&Li(p,_,T)&&(_=f),p=dn(p),_=qu({},_,L,aa);var U=qu({},_.imports,L.imports,aa),W=Ar(U),it=Ip(U,W),ht,vt,Vt=0,Gt=_.interpolate||fu,Yt="__p += '",ye=Lp((_.escape||fu).source+"|"+Gt.source+"|"+(Gt===Ut?xi:fu).source+"|"+(_.evaluate||fu).source+"|$","g"),ke="//# sourceURL="+(nr.call(_,"sourceURL")?(_.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++xp+"]")+`
`;p.replace(ye,function(Ye,Dn,jn,Qi,Ti,Fi){return jn||(jn=Qi),Yt+=p.slice(Vt,Fi).replace(R_,Da),Dn&&(ht=!0,Yt+=`' +
__e(`+Dn+`) +
'`),Ti&&(vt=!0,Yt+=`';
`+Ti+`;
__p += '`),jn&&(Yt+=`' +
((__t = (`+jn+`)) == null ? '' : __t) +
'`),Vt=Fi+Ye.length,Ye}),Yt+=`';
`;var nn=nr.call(_,"variable")&&_.variable;if(!nn)Yt=`with (obj) {
`+Yt+`
}
`;else if(wr.test(nn))throw new on(O);Yt=(vt?Yt.replace(Yo,""):Yt).replace(lu,"$1").replace(ro,"$1;"),Yt="function("+(nn||"obj")+`) {
`+(nn?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(ht?", __e = _.escape":"")+(vt?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Yt+`return __p
}`;var An=e1(function(){return Zn(W,ke+"return "+Yt).apply(f,it)});if(An.source=Yt,Jm(An))throw An;return An}function ks(p){return dn(p).toLowerCase()}function $a(p){return dn(p).toUpperCase()}function od(p,_,T){if(p=dn(p),p&&(T||_===f))return Mp(p);if(!p||!(_=ee(_)))return p;var L=Lo(p),U=Lo(_),W=_u(L,U),it=G_(L,U)+1;return Es(L,W,it).join("")}function sd(p,_,T){if(p=dn(p),p&&(T||_===f))return p.slice(0,lf(p)+1);if(!p||!(_=ee(_)))return p;var L=Lo(p),U=G_(L,Lo(_))+1;return Es(L,0,U).join("")}function ag(p,_,T){if(p=dn(p),p&&(T||_===f))return p.replace(Wt,"");if(!p||!(_=ee(_)))return p;var L=Lo(p),U=_u(L,Lo(_));return Es(L,U).join("")}function Qy(p,_){var T=nt,L=Re;if(En(_)){var U="separator"in _?_.separator:U;T="length"in _?bn(_.length):T,L="omission"in _?ee(_.omission):L}p=dn(p);var W=p.length;if(xu(p)){var it=Lo(p);W=it.length}if(T>=W)return p;var ht=T-Pa(L);if(ht<1)return L;var vt=it?Es(it,0,ht).join(""):p.slice(0,ht);if(U===f)return vt+L;if(it&&(ht+=vt.length-ht),Ps(U)){if(p.slice(ht).search(U)){var Vt,Gt=vt;for(U.global||(U=Lp(U.source,dn(mo.exec(U))+"g")),U.lastIndex=0;Vt=U.exec(Gt);)var Yt=Vt.index;vt=vt.slice(0,Yt===f?ht:Yt)}}else if(p.indexOf(ee(U),ht)!=ht){var ye=vt.lastIndexOf(U);ye>-1&&(vt=vt.slice(0,ye))}return vt+L}function $w(p){return p=dn(p),p&&uu.test(p)?p.replace(ms,q_):p}var t1=oa(function(p,_,T){return p+(T?" ":"")+_.toUpperCase()}),lg=lr("toUpperCase");function ad(p,_,T){return p=dn(p),_=T?f:_,_===f?Yv(p)?J_(p):Ep(p):p.match(_)||[]}var e1=In(function(p,_){try{return Gi(p,f,_)}catch(T){return Jm(T)?T:new on(T)}}),ug=Pi(function(p,_){return Me(_,function(T){T=Oe(T),Qs(p,T,Eo(p[T],p))}),p});function n1(p){var _=p==null?0:p.length,T=Xe();return p=_?sr(p,function(L){if(typeof L[1]!="function")throw new _o(P);return[T(L[0]),L[1]]}):[],In(function(L){for(var U=-1;++U<_;){var W=p[U];if(Gi(W[0],this,L))return Gi(W[1],this,L)}})}function r1(p){return Af(so(p,ft))}function Fs(p){return function(){return p}}function i1(p,_){return p==null||p!==p?_:p}var Kw=dm(),Ku=dm(!0);function ki(p){return p}function Ka(p){return tm(typeof p=="function"?p:so(p,ft))}function ld(p){return nm(so(p,ft))}function o1(p,_){return ri(p,so(_,ft))}var s1=In(function(p,_){return function(T){return Pu(T,p,_)}}),Xw=In(function(p,_){return function(T){return Pu(p,T,_)}});function cg(p,_,T){var L=Ar(_),U=Pl(_,L);T==null&&!(En(_)&&(U.length||!L.length))&&(T=_,_=p,p=this,U=Pl(_,Ar(_)));var W=!(En(T)&&"chain"in T)||!!T.chain,it=ha(p);return Me(U,function(ht){var vt=_[ht];p[ht]=vt,it&&(p.prototype[ht]=function(){var Vt=this.__chain__;if(W||Vt){var Gt=p(this.__wrapped__),Yt=Gt.__actions__=pi(this.__actions__);return Yt.push({func:vt,args:arguments,thisArg:p}),Gt.__chain__=Vt,Gt}return vt.apply(p,gr([this.value()],arguments))})}),p}function Yw(){return Zr._===this&&(Zr._=Rp),this}function hg(){}function a1(p){return p=bn(p),In(function(_){return Rl(_,p)})}var l1=zu(sr),Qw=zu(ef),u1=zu(vl);function c1(p){return Uf(p)?Js(Oe(p)):pw(p)}function tb(p){return function(_){return p==null?f:Va(p,_)}}var h1=pm(),f1=pm(!0);function ud(){return[]}function bh(){return!1}function da(){return{}}function Er(){return""}function d1(){return!0}function eb(p,_){if(p=bn(p),p<1||p>fe)return[];var T=hn,L=Bi(p,hn);_=Xe(_),p-=hn;for(var U=Po(L,_);++T<p;)_(T);return U}function nb(p){return _n(p)?sr(p,Oe):Yi(p)?[p]:pi(Ss(dn(p)))}function cd(p){var _=++tw;return dn(p)+_}var rb=Ff(function(p,_){return p+_},0),ib=sa("ceil"),ob=Ff(function(p,_){return p/_},1),sb=sa("floor");function fg(p){return p&&p.length?Zi(p,ki,Yp):f}function hd(p,_){return p&&p.length?Zi(p,Xe(_,2),Yp):f}function p1(p){return rf(p,ki)}function Zl(p,_){return rf(p,Xe(_,2))}function Ah(p){return p&&p.length?Zi(p,ki,If):f}function ab(p,_){return p&&p.length?Zi(p,Xe(_,2),If):f}var lb=Ff(function(p,_){return p*_},1),ub=sa("round"),cb=Ff(function(p,_){return p-_},0);function hb(p){return p&&p.length?Sp(p,ki):0}function fb(p,_){return p&&p.length?Sp(p,Xe(_,2)):0}return Z.after=by,Z.ary=Um,Z.assign=Ow,Z.assignIn=Hl,Z.assignInWith=qu,Z.assignWith=Vo,Z.at=Go,Z.before=$f,Z.bind=Eo,Z.bindAll=ug,Z.bindKey=Vm,Z.castArray=Iy,Z.chain=Rm,Z.chunk=ao,Z.compact=Gu,Z.concat=xw,Z.cond=n1,Z.conforms=r1,Z.constant=Fs,Z.countBy=Oo,Z.create=Nw,Z.curry=Gm,Z.curryRight=Ay,Z.debounce=Kf,Z.defaults=ed,Z.defaultsDeep=Ny,Z.defer=jm,Z.delay=Bw,Z.difference=Ne,Z.differenceBy=vw,Z.differenceWith=Tm,Z.drop=ww,Z.dropRight=Cm,Z.dropRightWhile=Sm,Z.dropWhile=fh,Z.fill=ju,Z.filter=uy,Z.flatMap=fy,Z.flatMapDeep=dy,Z.flatMapDepth=py,Z.flatten=la,Z.flattenDeep=Vl,Z.flattenDepth=Ga,Z.flip=rs,Z.flow=Kw,Z.flowRight=Ku,Z.fromPairs=bw,Z.functions=Ym,Z.functionsIn=nd,Z.groupBy=Mw,Z.initial=Ew,Z.intersection=O0,Z.intersectionBy=lo,Z.intersectionWith=qr,Z.invert=xh,Z.invertBy=rd,Z.invokeMap=Gl,Z.iteratee=Ka,Z.keyBy=Iw,Z.keys=Ar,Z.keysIn=Ri,Z.map=No,Z.mapKeys=Qm,Z.mapValues=jy,Z.matches=ld,Z.matchesProperty=o1,Z.memoize=Xf,Z.merge=Hy,Z.mergeWith=tg,Z.method=s1,Z.methodOf=Xw,Z.mixin=cg,Z.negate=en,Z.nthArg=a1,Z.omit=$r,Z.omitBy=Zy,Z.once=Hm,Z.orderBy=Ao,Z.over=l1,Z.overArgs=Ji,Z.overEvery=Qw,Z.overSome=u1,Z.partial=is,Z.partialRight=Zm,Z.partition=my,Z.pick=Wy,Z.pickBy=eg,Z.property=c1,Z.propertyOf=tb,Z.pull=Cw,Z.pullAll=Kn,Z.pullAllBy=Mm,Z.pullAllWith=ja,Z.pullAt=U0,Z.range=h1,Z.rangeRight=f1,Z.rearg=Ey,Z.reject=gy,Z.remove=V0,Z.rest=Wm,Z.reverse=Zf,Z.sampleSize=yy,Z.set=qy,Z.setWith=Jy,Z.shuffle=xy,Z.slice=cr,Z.sortBy=wy,Z.sortedUniq=Bm,Z.sortedUniqBy=bo,Z.split=qw,Z.spread=Ty,Z.tail=Z0,Z.take=W0,Z.takeRight=q0,Z.takeRightWhile=je,Z.takeWhile=Dm,Z.tap=ry,Z.throttle=Cy,Z.thru=dh,Z.toArray=Km,Z.toPairs=vh,Z.toPairsIn=ng,Z.toPath=nb,Z.toPlainObject=Wu,Z.transform=Gw,Z.unary=Sy,Z.union=yr,Z.unionBy=J0,Z.unionWith=$0,Z.uniq=K0,Z.uniqBy=X0,Z.uniqWith=Y0,Z.unset=jw,Z.unzip=Wf,Z.unzipWith=Pm,Z.update=Hw,Z.updateWith=$u,Z.values=Wa,Z.valuesIn=qa,Z.without=Q0,Z.words=ad,Z.wrap=My,Z.xor=Ue,Z.xorBy=Ge,Z.xorWith=Lm,Z.zip=ua,Z.zipObject=ty,Z.zipObjectDeep=ey,Z.zipWith=ny,Z.entries=vh,Z.entriesIn=ng,Z.extend=Hl,Z.extendWith=qu,cg(Z,Z),Z.add=rb,Z.attempt=e1,Z.camelCase=id,Z.capitalize=Ir,Z.ceil=ib,Z.clamp=Be,Z.clone=Yf,Z.cloneDeep=qm,Z.cloneDeepWith=jl,Z.cloneWith=qe,Z.conformsTo=By,Z.deburr=Fr,Z.defaultTo=i1,Z.divide=ob,Z.endsWith=Rn,Z.eq=Uo,Z.escape=uo,Z.escapeRegExp=Br,Z.every=ly,Z.find=cy,Z.findIndex=Ms,Z.findKey=Uw,Z.findLast=hy,Z.findLastIndex=zo,Z.findLastKey=Xm,Z.floor=sb,Z.forEach=Fm,Z.forEachRight=zm,Z.forIn=To,Z.forInRight=fa,Z.forOwn=Uy,Z.forOwnRight=Vy,Z.get=yh,Z.gt=Dy,Z.gte=Py,Z.has=Ju,Z.hasIn=Ei,Z.head=z0,Z.identity=ki,Z.includes=Om,Z.indexOf=Aw,Z.inRange=Zw,Z.invoke=Gy,Z.isArguments=Ha,Z.isArray=_n,Z.isArrayBuffer=Ly,Z.isArrayLike=$i,Z.isArrayLikeObject=Vr,Z.isBoolean=Dw,Z.isBuffer=Bs,Z.isDate=Bn,Z.isElement=Pw,Z.isEmpty=Lw,Z.isEqual=Hu,Z.isEqualWith=Rw,Z.isError=Jm,Z.isFinite=Ki,Z.isFunction=ha,Z.isInteger=lt,Z.isLength=Qf,Z.isMap=Ry,Z.isMatch=kw,Z.isMatchWith=J,Z.isNaN=Fw,Z.isNative=ky,Z.isNil=zw,Z.isNull=Ds,Z.isNumber=mh,Z.isObject=En,Z.isObjectLike=Gr,Z.isPlainObject=Zu,Z.isRegExp=Ps,Z.isSafeInteger=Fy,Z.isSet=zy,Z.isString=Xi,Z.isSymbol=Yi,Z.isTypedArray=sn,Z.isUndefined=gh,Z.isWeakMap=Oy,Z.isWeakSet=td,Z.join=Jr,Z.kebabCase=$y,Z.last=wo,Z.lastIndexOf=N0,Z.lowerCase=xr,Z.lowerFirst=Ky,Z.lt=$m,Z.lte=_h,Z.max=fg,Z.maxBy=hd,Z.mean=p1,Z.meanBy=Zl,Z.min=Ah,Z.minBy=ab,Z.stubArray=ud,Z.stubFalse=bh,Z.stubObject=da,Z.stubString=Er,Z.stubTrue=d1,Z.multiply=lb,Z.nth=Tw,Z.noConflict=Yw,Z.noop=hg,Z.now=ph,Z.pad=Ja,Z.padEnd=rg,Z.padStart=wh,Z.parseInt=an,Z.random=Ww,Z.reduce=qf,Z.reduceRight=Nm,Z.repeat=ig,Z.replace=Xy,Z.result=Vw,Z.round=ub,Z.runInContext=yt,Z.sample=_y,Z.size=Jf,Z.snakeCase=og,Z.some=vy,Z.sortedIndex=Im,Z.sortedIndexBy=Is,Z.sortedIndexOf=G0,Z.sortedLastIndex=j0,Z.sortedLastIndexBy=H0,Z.sortedLastIndexOf=zn,Z.startCase=sg,Z.startsWith=Yy,Z.subtract=cb,Z.sum=hb,Z.sumBy=fb,Z.template=Jw,Z.times=eb,Z.toFinite=Ls,Z.toInteger=bn,Z.toLength=Rs,Z.toLower=ks,Z.toNumber=yn,Z.toSafeInteger=Za,Z.toString=dn,Z.toUpper=$a,Z.trim=od,Z.trimEnd=sd,Z.trimStart=ag,Z.truncate=Qy,Z.unescape=$w,Z.uniqueId=cd,Z.upperCase=t1,Z.upperFirst=lg,Z.each=Fm,Z.eachRight=zm,Z.first=z0,cg(Z,function(){var p={};return yo(Z,function(_,T){nr.call(Z.prototype,T)||(p[T]=_)}),p}(),{chain:!1}),Z.VERSION=y,Me(["bind","bindKey","curry","curryRight","partial","partialRight"],function(p){Z[p].placeholder=Z}),Me(["drop","take"],function(p,_){Vn.prototype[p]=function(T){T=T===f?1:ei(bn(T),0);var L=this.__filtered__&&!_?new Vn(this):this.clone();return L.__filtered__?L.__takeCount__=Bi(T,L.__takeCount__):L.__views__.push({size:Bi(T,hn),type:p+(L.__dir__<0?"Right":"")}),L},Vn.prototype[p+"Right"]=function(T){return this.reverse()[p](T).reverse()}}),Me(["filter","map","takeWhile"],function(p,_){var T=_+1,L=T==Ae||T==Bo;Vn.prototype[p]=function(U){var W=this.clone();return W.__iteratees__.push({iteratee:Xe(U,3),type:T}),W.__filtered__=W.__filtered__||L,W}}),Me(["head","last"],function(p,_){var T="take"+(_?"Right":"");Vn.prototype[p]=function(){return this[T](1).value()[0]}}),Me(["initial","tail"],function(p,_){var T="drop"+(_?"":"Right");Vn.prototype[p]=function(){return this.__filtered__?new Vn(this):this[T](1)}}),Vn.prototype.compact=function(){return this.filter(ki)},Vn.prototype.find=function(p){return this.filter(p).head()},Vn.prototype.findLast=function(p){return this.reverse().find(p)},Vn.prototype.invokeMap=In(function(p,_){return typeof p=="function"?new Vn(this):this.map(function(T){return Pu(T,p,_)})}),Vn.prototype.reject=function(p){return this.filter(en(Xe(p)))},Vn.prototype.slice=function(p,_){p=bn(p);var T=this;return T.__filtered__&&(p>0||_<0)?new Vn(T):(p<0?T=T.takeRight(-p):p&&(T=T.drop(p)),_!==f&&(_=bn(_),T=_<0?T.dropRight(-_):T.take(_-p)),T)},Vn.prototype.takeRightWhile=function(p){return this.reverse().takeWhile(p).reverse()},Vn.prototype.toArray=function(){return this.take(hn)},yo(Vn.prototype,function(p,_){var T=/^(?:filter|find|map|reject)|While$/.test(_),L=/^(?:head|last)$/.test(_),U=Z[L?"take"+(_=="last"?"Right":""):_],W=L||/^find/.test(_);U&&(Z.prototype[_]=function(){var it=this.__wrapped__,ht=L?[1]:arguments,vt=it instanceof Vn,Vt=ht[0],Gt=vt||_n(it),Yt=function(Dn){var jn=U.apply(Z,gr([Dn],ht));return L&&ye?jn[0]:jn};Gt&&T&&typeof Vt=="function"&&Vt.length!=1&&(vt=Gt=!1);var ye=this.__chain__,ke=!!this.__actions__.length,nn=W&&!ye,An=vt&&!ke;if(!W&&Gt){it=An?it:new Vn(this);var Ye=p.apply(it,ht);return Ye.__actions__.push({func:dh,args:[Yt],thisArg:f}),new Hi(Ye,ye)}return nn&&An?p.apply(this,ht):(Ye=this.thru(Yt),nn?L?Ye.value()[0]:Ye.value():Ye)})}),Me(["pop","push","shift","sort","splice","unshift"],function(p){var _=vu[p],T=/^(?:push|sort|unshift)$/.test(p)?"tap":"thru",L=/^(?:pop|shift)$/.test(p);Z.prototype[p]=function(){var U=arguments;if(L&&!this.__chain__){var W=this.value();return _.apply(_n(W)?W:[],U)}return this[T](function(it){return _.apply(_n(it)?it:[],U)})}}),yo(Vn.prototype,function(p,_){var T=Z[_];if(T){var L=T.name+"";nr.call(Sl,L)||(Sl[L]=[]),Sl[L].push({name:_,func:T})}}),Sl[Di(f,mt).name]=[{name:"wrapper",func:f}],Vn.prototype.clone=Gp,Vn.prototype.reverse=rw,Vn.prototype.value=jp,Z.prototype.at=iy,Z.prototype.chain=oy,Z.prototype.commit=sy,Z.prototype.next=ay,Z.prototype.plant=Sw,Z.prototype.reverse=tn,Z.prototype.toJSON=Z.prototype.valueOf=Z.prototype.value=km,Z.prototype.first=Z.prototype.head,El&&(Z.prototype[El]=ca),Z},La=Pp();er?((er.exports=La)._=La,Ii._=La):Zr._=La}).call(Rd)})(Ev,Ev.exports);var Y4=Ev.exports;const mn=Iv(Y4),Q4=`s_no	route_number	from_en	from_kn	to_en	to_kn	routings_en	routings_kn	metros	schedule_count	timings_from	timings_to\r
1	VMF1C	KR Puram Metro Station	..   	Central Silk Board	  	Marathahalli Bridge, Agara	 , 	25	22	0640, 0650, 0700, 0710, 0720, 0730, 0740, 0750, 0800, 0805, 0810, 0815, 0820, 0825, 0830, 0835, 0840, 0845, 0850, 0855, 0900, 0905, 0910, 0915, 0920, 0925, 0930, 0935, 0940, 0950, 1000, 1015, 1025, 1035, 1050, 1100, 1110, 1115, 1120, 1130, 1135, 1140, 1150, 1155, 1200, 1215, 1235, 1300, 1315, 1325, 1345, 1355, 1400, 1405, 1415, 1420, 1425, 1430, 1435, 1440, 1450, 1455, 1500, 1505, 1510, 1520, 1525, 1535, 1545, 1555, 1605, 1620, 1630, 1640, 1650, 1655, 1705, 1710, 1720, 1725, 1735, 1745, 1755, 1805, 1820, 1830, 1840, 1850, 1900, 1910, 1920, 1930, 1940, 1950, 2000, 2010, 2020, 2030, 2040, 2050, 2100, 2110, 2120, 2130,2140,  2150, 2200.	0540, 0550, 0600, 0610, 0620, 0630, 0640, 0650, 0700, 0710, 0720, 0730, 0740, 0745, 0750, 0800, 0805, 0810, 0820, 0825, 0835, 0840, 0855, 0905, 0915, 0925, 0935, 0950, 0955, 1000, 1005, 1010, 1015, 1020, 1025, 1030, 1035, 1040, 1045, 1050, 1055, 1100, 1110, 1120, 1130,1140, 1150, 1200, 1210, 1220, 1230, 1240, 1245, 1250, 1300, 1310, 1315, 1320, 1335, 1350, 1400, 1420, 1425, 1435, 1500, 1510, 1520, 1530, 1540, 1545, 1555, 1600, 1605, 1615, 1625, 1635, 1645, 1650, 1655, 1700, 1705, 1710, 1715, 1720, 1725, 1730, 1735, 1740, 1745, 1750, 1755, 1805, 1815, 1825, 1840, 1855, 1910, 1925, 1935, 1945, 1955, 2005, 2015, 2025, 2035, 2045, 2055.\r
2	MF1E	SMV railway station	...  	Channasandra		SV Metro station, Baiyappanahalli, Tinfactory, Hoodi	..  , ,  , 	54, 2, 3, 25, 51, 12, 15, 42, 23, 16	2	0535, 0615	1705,  1735, 2030, 2100\r
3	MF1F	S.V Metro Station	..  	Rameshanagar		S.V Metro Station, BEML Gate, Malleshpalya, Basavanagar, Rameshanagara	..  , .... , , , 	54	3	0555, 0610, 0630, 0655, 0720, 0740, 0805, 0825, 845, 0910, 0935, 0955, 1020, 1110, 1130, 1155, 1220, 1240, 1330, 1350, 1410, 1440, 1500, 1525, 1545, 1605, 1630, 1720, 1740, 1805, 1830, 1850, 1915, 1940, 2000, 2025, 2200	0530, 0625, 0645, 0705, 0730, 0755, 0815, 0840, 0900, 0920, 0945, 1015, 1045, 1120, 1145, 1205, 1230, 1255, 1315, 1405, 1425, 1450, 1515, 1535, 1600, 1630, 1705, 1730, 1755, 1815, 1840, 1905, 1925, 1950, 2020, 2040, 2105\r
4	MF1G	ITPL Metro Station	....  	ITPL Metro Station	....  	Hope Farm, Channasandra, Nagondanahalli, Whitefield	 , , ,  	42, 23, 16	1	0530, 0605, 0640, 0715, 0755, 0845, 0940, 1055, 1500, 1610, 1705, 1800, 1900, 1955, 2050, 2210\r
5	MF1GA	ITPL Metro Station	....  	ITPL Metro Station	....  	Hope Farm, Whitefield, Nagondanahalli, Channasandra	 ,  , ,  	42, 23, 16	1	0545, 0620, 0655, 0730, 0815, 0910, 1005, 1120, 1525, 1640, 1730, 1830, 1930, 2025, 2120, 2240\r
6	MF1K	Kadugodi Metro Station	  	Kannamangala		Seegehalli, Kannamangala Gate	,  	65	2	0625, 0715, 0805, 0830, 0855, 0920, 0945, 1035, 1100, 1125, 1230, 1315, 1405, 1505, 1530, 1620, 1645, 1710, 1735, 1800, 1825, 1915, 2030, 2145	0600, 0650, 0740, 0830, 0855, 0920, 1010, 1035, 1100, 1120, 1205, 1250, 1340, 1430, 1530, 1555, 1620, 1645, 1710, 1735, 1800, 1850, 2005, 2055\r
7	MF3	Kadugodi Metro Station	  	Marathahalli		ITPL, Kundalahalli Gate	....,  	29, 38, 57, 42, 23, 16, 65	7	0530, 0600, 0705, 0720, 0735, 0820, 0910, 0925, 0940, 1020, 1035, 1055, 1105, 1155, 1220, 1235, 1305, 1420, 1440, 1500, 1530, 1540, 1545, 1615, 1645, 1655, 1710, 1740, 1815, 820, 1850, 1920, 2030, 2100	0615, 0645, 0720, 0805, 0820, 0835, 0850, 0905, 0925, 0935, 1040, 1055, 1110, 1120, 1135, 1155, 1205, 1320, 1335, 1405, 1440, 1445, 1515, 1540, 1550, 1605, 1635, 1645, 1715, 1745, 1815, 1920, 1925, 1955, 2150, 2220\r
8	MF4	Kadugodi Metro Station	  	Marathahalli		Varthuru Kodi, Siddapura	 , 	16, 65	4	0545, 0615, 0720, 0750, 0920, 0950, 1045, 1115, 1235, 1305, 1450, 1500, 1520, 1530, 1640, 1650, 1710, 1720, 1910, 1940, 2055,  2120	0630, 0700, 0820, 0850, 0920, 0950, 1045, 1115, 1140, 1210, 1330, 1400, 1545, 1555, 1615, 1625, 1740, 1810, 1815, 1845, 2005, 2035, 2205\r
9	MF3A	Kadugodi Metro Station	  	Kadugodi Metro Station	  	Hope farm, ITPL, Whitefiled TTMC, Graphite India, Kundalahalli gate, Varthur kodi, whitefield post office	 , ....,  ....,  ,  ,  ,   		2	0545, 0645, 0800, 0830, 0925, 1020, 1145, 1310, 1505, 1530, 1625, 1815, 1940, 2130\r
10	MF4A	Kadugodi Metro Station	  	Kadugodi Metro Station	  	Hope farm, whitefield post office, Varthur kodi, Kundalahalli gate, Graphite India, Whitefiled TTMC. ITPL	 ,   ,  ,  ,  ,  ...., ....		2	0600, 0700, 0815, 0845, 0940, 1035, 1130, 1200, 1325, 1520, 1545, 1640, 1830, 1955, 2145\r
11	MF5	Madiwala		Sir. M.Vishweshwaraih Railway Station	. .  	SV Road Metro Station. Indiranagara Metro Station, Inner Ring Road, Koramangala Water Tank	..   ,   ,   ,   	54, 18	17	0505, 0550, 0600, 0610, 0620, 0630, 0640, 0650, 0655, 0700, 0710, 0720, 0730, 0740, 0750, 0800, 0810, 0820, 0835, 0845, 0850, 0855, 0905, 0915, 0925, 0930, 0940, 0945, 0950, 1000, 1010, 1020, 1030, 1040, 1055, 1110, 1125, 1135, 1140, 1145, 1150, 1205, 1210, 1215, 1220, 1225, 1235, 1245, 1255, 1305, 1325, 1350, 1400, 1410, 1420, 1430, 1440, 1445, 1450, 1505, 1520, 1525, 1535, 1545, 1555, 1605, 1610, 1615, 1620, 1625, 1635, 1645, 1655, 1700, 1705, 1720, 1725, 1730, 1740, 1750, 1800, 1815, 1820, 1825, 1830, 1835, 1845, 1855, 1905, 1910, 1915, 1930, 1940, 1950, 2000, 2010, 2020, 2035, 2050, 2110, 2130, 2150, 2210, 2230	0430, 530, 0545, 0600, 0605, 0610, 0620, 0630, 0640, 0650, 0700, 0710, 0720, 0725, 0730, 0740, 0745, 0750, 0800, 0810, 0825, 0835, 0840, 0845, 0855, 0905, 0915, 0925, 0935, 0940, 0950, 1000, 1010, 1020, 1030, 1045, 1055, 1100, 1110, 1120, 1130, 1140, 1150, 1200, 1205, 1215, 1220, 1225, 1235, 1240, 1255, 1305, 1310, 1325, 1340, 1350, 1400, 1410, 1425, 1440, 1455, 1500, 1510, 1520, 1525, 1530, 1535, 1540, 1545, 1555, 1605, 1615, 1620, 1625, 1635, 1645, 1655, 1710, 1715, 1720, 1725, 1730, 1740, 1750, 1800, 1805, 1810, 1825, 1835, 1845, 1855, 1905, 1920, 1925, 1935, 1950, 2005, 2015, 2025, 2035, 2045, 2105, 2130, 2155, 2225\r
12	VMF6	Central silk board	  	SV Metro station	..  	Indiranagara metro, Dommalur bridge, Koramangala water tank	 ,  ,   	54, 16	5	0600, 0630, 0700, 0730, 0800, 0900, 0930, 1000, 1030, 1055, 1125, 1155, 1355, 1530, 1615, 1635, 1705, 1735, 1805, 1805, 1835, 1905, 2000, 2030, 2100, 2130, 2200	0645, 0715, 0745, 0815, 0845, 0915, 1010, 1040, 1110, 1140, 1210, 1240, 1310, 1440, 1650, 1720, 1720, 1750, 1820, 1850, 1920, 1935, 1950, 2050, 2120, 2145, 2215\r
13	MF7	Baiyappanahalli Metro Station	  	Kanakagiri		B.Channasandra Bridge, Horamavu, Kalkere	. , , 	2	1	0835, 1010, 1120, 1220, 1330, 1440, 1615, 1725	0800, 0910, 1045, 1255, 1405, 1540, 1650\r
14	MF8	Cubbon Park Metro	  	Cubbon Park Metro	  	Vasanthanagara, Raj Bhavan	, 	8	2	0730, 0745, 0800, 0815, 0835, 0850, 0910, 0925, 1130, 1145, 1205, 1220, 1445, 1500, 1520, 1535, 1555, 1610, 1630, 1645, 1730, 1745, 1810\r
15	MF9	Hoodi Metro	 	KR Puram	.. 	Ayyappa Nagara, Devasandra	 , 	15	2	0845, 0925, 1040, 1120, 1150, 1230, 1300, 1340, 1435, 1515, 1545, 1625, 1715, 1755	0800, 0840, 0930, 1010, 1115, 1155, 1225, 1305, 1335, 1415, 1510, 1550, 1630, 1710.\r
16	MF12	Vijayanagara		Banashankari TTMC	 ....	Attiguppe Metro, Mysore Road Metro, Kathriguppe	 ,   , 	62, 1, 10, 36, 4	11	0620, 0630, 0655, 0705, 0720, 0735, 0745, 0755, 0810, 0820, 0840, 0845, 0850, 0905, 0905, 0920, 0925, 0935, 0945,1000, 1010, 1030, 1040, 1055, 1055, 1100,  1105, 1125, 1145, 1155, 1205, 1220, 1240,  1240, 1305, 1315, 1340, 1345, 1350,, 1420, 1430, 1435, 1445, 1445, 1455, 1510, 1520, 1540, 1555, 1625, 1635, 1640, 1650, 1655, 1700, 1710, 1725, 1730, 1730, 1755, 1810, 1820, 1835, 1855, 1940, 1950, 2000, 2010, 2025, 2045	0615, 0630, 0645, 0705, 0720, 0745, 0755, 0810, 0825, 0840, 0850, 0905, 0915, 0935, 0940, 0945, 1000, 1000, 1015, 1020, 1040, 1105, 1115, 1130, 1150, 1150,  1150, 1200, 1215, 1220, 1225, 1235, 1245, 1300, 1315, 1330, 1330, 1355,1430, 1430, 1430, 1440, 1510, 1520, 1525, 1535, 1540, 1545, 1605,1630, 1635, 1700, 1715, 1725, 1735, 1740, 1750, 1755, 1810, 1820, 1825, 1850, 1905, 1915, 1930, 1950, 2035, 2045, 2055, 2115, 2130, 2140\r
17	MF-13	Vijayanagara Metro Station	  	Shankarnag Bus Stand	  	Vijayanagara Metro Station, Basaveshwaranagara Bus Stand, Kamalanagar Market, Shankarnag Bs stand	  ,    ,  ,    		2	0815, 0840, 0905, 0930, 0955, 1020, 1110, 1135, 1225, 1250, 1315, 1340, 1405, 1430, 1520, 1545, 1635, 1700, 1725, 1750, 1815, 1840	0840, 0905, 0930, 0955, 1045, 1110, 1135, 1200, 1250, 1315, 1340, 1405, 1455, 1520, 1610, 1635, 1700, 1725, 1750, 1815, 1840, 1905\r
18	MF14	Rajarajeshwari Metro Station	  	Srinivasapura Cross	 	Halagevaderahalli, Srinivasapura Cross, Channasandra, BEML Layout 5th Phase	,  , , ....  5 	46	3	0620, 0710, 0725, 0800, 0815, 0835, 0850, 0905, 0925, 0940, 0955, 1015, 1055, 1110, 1130, 1145, 1235, 1250, 1310, 1340, 1400, 1455, 1510, 1530, 1545, 1600, 1620, 1700, 1715, 1735, 1750, 1805, 1825, 1840, 1915, 1930, 2020, 2110, 2200	0645, 0735, 0750, 0825, 0840, 0900, 0915, 0930, 0950, 1005, 1020, 1040, 1120, 1135, 1155, 1210, 1315, 1335, 1405, 1425, 1520, 1535, 1555, 1635, 1650, 1710, 1725, 1740, 1800, 1815, 1850, 1905, 1955, 2045, 2135\r
19	MF15	JP Nagara Metro	..  	JP Nagara 7th Block	..  7 	JP Nagara 6th Phase, RV Dental, Brigade Millennium	.. 6 , .. ,  	21	2	0700, 0730, 0755, 0825, 0855, 0925, 1020, 1050, 1120, 1150, 1220, 1250, 1310, 1340, 1405, 1435, 1455, 1525, 1545, 1615, 1700, 1730, 1800, 1830, 1900, 1930, 2000, 2030, 2100, 2130.	0635, 0705, 0725, 0755, 0825, 0855, 0925, 0955, 1050, 1120, 1150, 1220, 1245, 1315, 1335, 1405, 1430, 1500, 1520, 1550, 1610, 1640, 1730, 1800, 1830, 1900, 1930, 2000, 2030, 2100.\r
20	MF17	Jayanagara Metro Station	  	Vaddarapalya JP Nagara 8th Phase	 .. 8 	RV Road Metro, Jayanagara 5th Block, JP Nagara, Jambusavari Dinne	.. ,  5 , ..,  	20	2	0615, 0745, 0815, 0915, 0945, 1110, 1145, 1350, 1520, 1625, 1820, 1950, 2200, 2310, 2415	0700, 0830, 0900, 1025, 1100, 1155, 1230, 1435, 1630, 1735, 1905, 2040.\r
21	MF18	Shanthinagar TTMC	 ....	Shanthinagar TTMC	 ....	Shanthinagar TTMC, Lal bag Main Road, Mahila Seva Samaja, K R Market, Corporation	 ....,   ,   , .. , 	24, 39, 30	1	0620, 0650, 0725, 0805, 0840, 0925, 1030, 1115, 1200, 1235, 1310, 1345, 1420, 1500, 1535, 1645, 1725, 1810, 1855, 1940, 2025, 2105\r
22	MF18A	Shanthinagar TTMC	 ....	Shanthinagar TTMC	 ....	Shanthinagar TTMC, Purnima Theatre, K R Market, Mahila Seva Samaja, Lal bag Main Gate	 ....,  , .. ,   ,   	24, 39, 30	1	0635, 0710, 0745, 0825, 0900, 0945, 1055, 1140, 1220, 1255, 1330, 1405, 1445, 1550, 1630, 1745, 1830, 1915, 2000, 2040\r
23	MF19	Jayanagara 9th Block	 9 	Jayanagara 9th Block	 9 	Jayanagara Metro, Jayanagara 4th Block	 ,  4 	47	1	0610, 0635, 0700, 0725, 0750, 0820, 0850, 0925, 1000, 1055, 1125, 1155, 1220, 1245, 1315, 1345, 1410, 1435, 1500, 1525, 1615, 1645, 1720, 1715, 1825, 1855, 1930, 2000, 2035, 2100.\r
24	MF21	Banashankari		BTM layout (Kuvempunagara)	...  ()	JP Nagara 6th phase, R V Dental college, Delmia, JP Nagara 3rd phase, Mahadeshwara layout.	  6 ,    , ,   3 ,  .	4	2	0640, 0710, 0740, 0815, 0850, 0930, 1010, 1115, 1155, 1230, 1305, 1345, 1420, 1455, 1530, 1605, 1710, 1750, 1830, 1910, 1950, 2025.	0640, 0710, 0740, 0815, 0850, 0930, 1010, 1115, 1155, 1230, 1305, 1345, 1420, 1455, 1530, 1605, 1710, 1750, 1830, 1910, 1950, 2025.\r
25	MF23	Jalahalli Metro Station	  	Jalahalli Metro Station	  	Ayyappa Temple, K.G.Halli, Abbigere, Chikkabanavara, Bagalagunte, Dasarahalli Metro	 , .., , , ,  	19, 9	1	0550, 0635, 0740, 0835, 0930, 1025,  1120, 1505, 1600, 1700, 1820, 1915, 2010, 2130\r
26	MF23A	Jalahalli Metro Station	  	Jalahalli Metro Station	  	Dasarahalli Metro, Bagalagunte, Chikkabanavara, Abbigere, KG Halli, Ayyappa Temple	 , , , , ..,  	19, 9	1	0830, 0930, 1055, 1150, 1245, 1340, 1500, 1555, 1650, 1745\r
27	MF23B	Jalahalli Metro Station	  	BEL Circle	... 	Chikkabanawara, Abbigere Cross, Gangamma Circle	,  ,  	19, 9	8	0555, 0620, 0645, 0710, 0740, 0755, 0805, 0835, 0850, 0900, 0930,0945, 0955, 1050, 1105, 1115, 1145, 1200, 1210, 1255, 1305, 1350, 1400, 1455, 1510, 1525, 1550, 1600, 1645, 1655, 1710, 1740, 1740, 1805, 1845, 1910, 1940, 2005, 2035, 2100, 2130, 2245\r
28	MF23E	Jalahalli Metro Station	  	MS Palya	.. 	Chikkabanavara, Ganigarahalli, Guni Agrahara	, ,  	19, 9	3	0715, 0735, 0755, 0920, 0940, 1000, 1125, 1145, 1205, 1255, 1315, 1335, 1425, 1445, 1505, 1555, 1615, 1635, 1850, 1910, 1930, 2030, 2050, 2110	0630, 0650, 0710, 0800, 0820, 0840, 1010, 1030, 1050, 1210, 1230, 1250, 1340, 1400, 1420, 1510, 1530, 1550, 1730, 1750, 1810, 1940, 2000, 2020\r
29	MF24	Jalahalli Metro Station	  	Laggere		Rajagopalanagara Police Station, TVS Cross	  , ... 	19	3	0545, 0635, 0640, 0725, 0730, 0805, 0815, 0820, 0905, 0910, 0955, 1020, 1110, 1200, 1250, 1325, 1340, 1420, 1445, 1510, 1535, 1650, 1705, 1740, 1755, 1835, 1925, 2000, 2025, 2050\r
30	MF25	8th Mile	8 	Thippenahalli		Nagasandra		37	1	0700, 0740, 0820, 0900, 0940, 1045, 1125, 1205, 1325, 1405, 1445, 1525, 1630, 1710, 1750, 1830, 1910, 1950, 2030	0720, 0800, 0840, 0920, 1025, 1105, 1145, 1225, 1305, 1345, 1425, 1505, 1610, 1650, 1730, 1810, 1850, 1930, 2010, 2050\r
31	MF25A	8th Mile	8 	Suvarna Nagara	 	Nagasandra, Rockline Studio	,  		1	0650, 0730, 0810, 0850, 1720, 1800, 1840, 1920	0710, 0750, 0830, 0910, 1740, 1820, 1900, 1940\r
32	MF26	Jalahalli Metro Station	  	Jalahalli Metro Station	  	Rajagopalanagara Police Station, Chowdeshwarinagara, Kanteerava Studio	  , ,  	43, 44, 19	3	0610, 0700, 0750, 0825, 0850, 0925, 0955, 1015, 1050, 1105, 1125, 1140, 1155, 1215, 1245, 1335, 1520, 1530, 1555, 1620, 1640, 1645, 1710, 1810, 2015, 2100, 2130, 2215, 2220\r
33	MF27	Jalahalli Metro Staion	  	Makali		Bagalagunte, Acharya College, Aluru	,  , 	19, 9	3	0625, 0645, 0705, 0805, 0825, 0845, 0945, 1005, 1025, 1150, 1210, 1230, 1330, 1350, 1410, 1510, 1530, 1550, 1650, 1710, 1730, 1910, 1930, 1950	0715, 0735, 0755, 0855, 0915, 0935, 1100, 1120, 1140, 1240, 1300, 1320, 1420, 1440, 1500, 1600, 1620, 1640, 1820, 1840, 1900, 2000, 2020, 2040.\r
34	MF28	Vidyaranyapura		Laggere		Ramachandrapura, BEL Circle, HMT Auditorium, Jalahalli Cross	, ... , ... ,  	43, 44, 19	3	0610, 0640, 0710, 0830, 0850, 0910, 1040, 1100, 1135, 1240, 1320, 1350, 1420, 1530, 1620, 1645, 1730, 1820, 1900, 1940, 2020, 2055	0715, 0745, 0810, 0940, 1000, 1035, 1140, 1200, 1235, 1455, 1525, 1630, 1720, 1745, 1830, 1920, 2000, 2040\r
35	MF29	Jalahalli Metro Station	  	Madanayakanahalli		Siddedahalli, Kuduregere Colony	,  		3	0615, 0645, 0715, 0750, 0820, 0850, 0920, 0950, 1020, 1145, 1215, 1245, 1340, 1410, 1440, 1620, 1650, 1710, 1750, 1820, 1850, 1920, 1950, 2020	0705, 0735, 0805, 0835, 0905, 0935, 1005, 1035, 1105, 1230, 1300, 1330, 1425, 1455, 1525, 1705, 1735, 1805, 1835, 1905, 1935, 2005, 2035, 2105\r
36	MF30	Jalahalli Metro Station	  	Jalahalli Metro Station	  	Kanteerva Studio, Sumanahalli, Sukadakatte, Herohalli Cross, Andrahalli	 , , ,  , 		2	0530, 0600, 0645, 0715, 0810, 0840, 0935, 1005, 1125, 1155, 1450, 1520, 1615, 1645, 1805, 1835, 1930, 2000, 2055, 2125\r
37	MF31	Jalahalli Metro Station	  	Jalahalli Metro Station	  	Andrahalli, Herohalli Cross, Sunkadakatte, Sumanahalli, Kanteerava Studio	,  , , ,  		2	0530, 0600, 0645, 0715, 0810, 0840, 0935, 1005, 1125, 1155, 1450, 1520, 1615, 1645, 1805, 1835, 1930, 2000, 2055, 2125\r
38	MF34	Kengeri TTMC	 ....	Thalaghattpura		Vajarahalli Metro, Chikkegowdanapalya, Kodipalya	 , , 	27, 58	3	0640, 0720, 0805, 0845, 0905, 0925, 1005, 1025, 1110, 1150, 1220, 1225, 1440, 1505, 1545, 1600, 1625, 1735, 1745, 1815, 1905, 1945, 2035	0720, 0800, 0825, 0845, 0925, 0945, 1005, 1110, 1140, 1150, 1230, 1505, 1520, 1545, 1650, 1705, 1730, 1820, 1900, 1950, 2030, 2200\r
39	MF36	Silk Institute Metro Station	   	Kumbalagodu		Tataguni, Agara, Devagere	, , 	52	1	0710, 0830, 0950, 1135, 1450, 1635, 1755, 1940, 2100	0630, 0750, 0910, 1055, 1530, 1715, 1835, 2020\r
40	MF39	Jnanabharathi Metro Station	  	Ramasandra		BUC Admin Office, Sonnenahalli, Chikkabasthi	..  , , 	22	2	0730, 0830, 0930, 1005, 1100, 1140, 1205, 1245, 1300, 1400, 1505, 1535, 1645, 1715, 1825, 1935, 2015, 2045	0700, 0710, 0800, 0900, 1000, 1105, 1135, 1215, 1230, 1330, 1430, 1445, 1610, 1615, 1720, 1750, 1900,  2010\r
41	MF40	Jnanabharathi Metro Station	  	Ullalu Satellite Town	  	Bengaluru University, Vidyanikethana Public School	 ,   	22	3	0700, 735, 0755, 0825, 0845, 0910,  0935, 1000, 1025, 1120, 1140, 1210, 1245, 1300, 1335, 1400, 1450, 1540, 1550, 1610, 1630, 1700, 1720, 1745, 1810, 1820, 1845, 1910, 1930, 1945, 2010, 2020, 2105, 2205	0630, 710, 0730, 800, 0820, 0845, 0910, 935, 1000,  1030, 1115, 1145, 1225, 1235, 1310, 1330, 1425, 1500, 1515, 1545, 1605, 1615, 1635, 1655, 1725, 1745, 1820, 1845, 1900, 1910, 1935, 1955, 2035, 2135, 1205, 2020, 2045\r
42	MF42	Kengeri TTMC	 ....	Tavarekere		Kengeri Bus Terminal Metro, Kommaghatta, Sulikere, Yalachaguppe	   , , , 	52	5	0615, 0820, 0900, 0705, 0755, 0845, 0930, 0935, 1000, 1045, 1050, 1135, 1140, 1205, 1230, 1315, 1325, 1350, 1445, 1510, 1520, 1525, 1535, 1630, 1705, 1715, 1805, 1830, 1855, 1945, 2100	0615, 0705, 0755, 0835, 0845, 0910, 0935, 0950, 1045, 1050, 1115, 1145, 1225, 1230, 1250, 1355, 1420, 1420, 1430, 1435, 1540, 1600, 1615, 1710, 1730, 1805, 1820, 1855, 1920, 1945, 2040\r
43	MF45	Banashankari TTMC	 ....	Vijayanagara TTMC	 ....	Kathariguppe, Nayandanahalli Metro, Nagarabhavi Circle, Mudalapalaya, Vijayanagara Metro	,  ,  , ,  	62, 36, 4	3	0615, 0745, 1050, 1210, 1225, 1245, 1345, 1355, 1445, 1635, 1700, 1940	0715, 0855, 0925, 1120, 1150, 1255, 1325, 1540, 1600, 1730, 1805, 1840, 2040, 2045\r
`;var B3={exports:{}};(function(l){var u={};function f(b,C){b=Math.round(b*C),b<<=1,b<0&&(b=~b);for(var P="";b>=32;)P+=String.fromCharCode((32|b&31)+63),b>>=5;return P+=String.fromCharCode(b+63),P}u.decode=function(b,C){for(var P=0,O=0,F=0,k=[],ot=0,ft=0,X=null,zt,Lt,Ht=Math.pow(10,C||5);P<b.length;){X=null,ot=0,ft=0;do X=b.charCodeAt(P++)-63,ft|=(X&31)<<ot,ot+=5;while(X>=32);zt=ft&1?~(ft>>1):ft>>1,ot=ft=0;do X=b.charCodeAt(P++)-63,ft|=(X&31)<<ot,ot+=5;while(X>=32);Lt=ft&1?~(ft>>1):ft>>1,O+=zt,F+=Lt,k.push([O/Ht,F/Ht])}return k},u.encode=function(b,C){if(!b.length)return"";for(var P=Math.pow(10,C||5),O=f(b[0][0],P)+f(b[0][1],P),F=1;F<b.length;F++){var k=b[F],ot=b[F-1];O+=f(k[0]-ot[0],P),O+=f(k[1]-ot[1],P)}return O};function y(b){for(var C=[],P=0;P<b.length;P++)C.push(b[P].slice().reverse());return C}u.fromGeoJSON=function(b,C){if(b&&b.type==="Feature"&&(b=b.geometry),!b||b.type!=="LineString")throw new Error("Input must be a GeoJSON LineString");return u.encode(y(b.coordinates),C)},u.toGeoJSON=function(b,C){var P=u.decode(b,C);return{type:"LineString",coordinates:y(P)}},l.exports&&(l.exports=u)})(B3);var tN=B3.exports;const $E=Iv(tN),D3=[{coordinates:[77.54985871019599,13.023310768146636],line:"green",name_en:"Yeshwanthpur",name_kn:"",id:64},{coordinates:[77.74683954673206,12.985703468891176],line:"purple",name_en:"Kadugodi Tree Park",name_kn:"  ",id:23},{coordinates:[77.50012095084863,13.048113754119699],line:"green",name_en:"Nagasandra",name_kn:"",id:37},{coordinates:[77.757859,12.9956461],line:"purple",name_en:"Whitefield (Kadugodi)",name_kn:" ()",id:65},{coordinates:[77.7538033,12.9873426],line:"purple",name_en:"Hopefarm Channasandra",name_kn:"  ",id:16},{coordinates:[77.7377718,12.9876393],line:"purple",name_en:"Pattandur Agrahara",name_kn:" ",id:42},{coordinates:[77.7275361,12.9811949],line:"purple",name_en:"Sri Sathya Sai Hospital",name_kn:"   ",id:57},{coordinates:[77.7248845,12.9766408],line:"purple",name_en:"Nallurhalli",name_kn:"",id:38},{coordinates:[77.7155586,12.977594],line:"purple",name_en:"Kundalahalli",name_kn:"",id:29},{coordinates:[77.7087854,12.9808558],line:"purple",name_en:"Seetharampalya",name_kn:" ",id:50},{coordinates:[77.711326,12.9888029],line:"purple",name_en:"Hoodi",name_kn:"",id:15},{coordinates:[77.7036768,12.9934505],line:"purple",name_en:"Garudacharapalya",name_kn:" ",id:12},{coordinates:[77.6927176,12.9965445],line:"purple",name_en:"Singayyanapalya",name_kn:"",id:51},{coordinates:[77.6776703,12.9999024],line:"purple",name_en:"Krishnarajapura (K.R.Pura)",name_kn:" (..)",id:25},{coordinates:[77.6684619,12.9965158],line:"purple",name_en:"Benniganahalli",name_kn:"",id:3},{coordinates:[77.5125535,13.0432607],line:"green",name_en:"Dasarahalli",name_kn:"",id:9},{coordinates:[77.5197351,13.0394104],line:"green",name_en:"Jalahalli",name_kn:"",id:19},{coordinates:[77.5631963,12.9965253],line:"green",name_en:"Srirampura",name_kn:"",id:56},{coordinates:[77.6523612,12.9907594],line:"purple",name_en:"Baiyyappanahalli",name_kn:"  ",id:2},{coordinates:[77.644897,12.9859306],line:"purple",name_en:"Swami Vivekananda Road",name_kn:"  ",id:54},{coordinates:[77.6386612,12.9783325],line:"purple",name_en:"Indiranagar",name_kn:"",id:18},{coordinates:[77.626686,12.9764992],line:"purple",name_en:"Halasuru",name_kn:"",id:14},{coordinates:[77.6170205,12.9730218],line:"purple",name_en:"Trinity",name_kn:"  ",id:59},{coordinates:[77.6067902,12.9755264],line:"purple",name_en:"Mahatma Gandhi Road",name_kn:"  ",id:35},{coordinates:[77.5975756,12.9809575],line:"purple",name_en:"Cubbon Park",name_kn:" ",id:8},{coordinates:[77.5916385,12.9787419],line:"purple",name_en:"Dr. B R Ambedkar Station, Vidhana Soudha",name_kn:"...  , ",id:61},{coordinates:[77.58422,12.9745197],line:"purple",name_en:"Sir M Vishweshwariah - Central College",name_kn:"   -  ",id:53},{coordinates:[77.5728757,12.9757079],line:"purple_green",name_en:"Nadaprabhu Kempegowda Station, Majestic",name_kn:"  , ",id:34},{coordinates:[77.5653767,12.9758768],line:"purple",name_en:"Krantivira Sangolli Rayanna Railway Station",name_kn:"    ",id:5},{coordinates:[77.5553523,12.975632],line:"purple",name_en:"Magadi Road",name_kn:"  ",id:31},{coordinates:[77.5456215,12.9742933],line:"purple",name_en:"Sri Balagangadharanatha Swamiji Station, Hosahalli",name_kn:"   , ",id:17},{coordinates:[77.5374044,12.9709559],line:"purple",name_en:"Vijayanagar",name_kn:"",id:62},{coordinates:[77.5335788,12.9618931],line:"purple",name_en:"Attiguppe",name_kn:" ",id:1},{coordinates:[77.5370122,12.9520578],line:"purple",name_en:"Deepanjali Nagar",name_kn:" ",id:10},{coordinates:[77.5301588,12.9467183],line:"purple",name_en:"Mysore Road",name_kn:"  ",id:36},{coordinates:[77.5707293,12.9904629],line:"green",name_en:"Mantri Square Sampige Road",name_kn:"   ",id:48},{coordinates:[77.5568986,12.9985297],line:"green",name_en:"Mahakavi Kuvempu Road",name_kn:"  ",id:33},{coordinates:[77.5496568,13.0005247],line:"green",name_en:"Rajajinagar",name_kn:"",id:45},{coordinates:[77.5487134,13.0080952],line:"green",name_en:"Mahalakshmi",name_kn:"",id:32},{coordinates:[77.5539839,13.0146544],line:"green",name_en:"Sandal Soap Factory",name_kn:"  ",i:49},{coordinates:[77.5408961,13.0284078],line:"green",name_en:"Goraguntepalya",name_kn:"",id:13},{coordinates:[77.533201,13.0330189],line:"green",name_en:"Peenya",name_kn:"",id:43},{coordinates:[77.5254924,13.0363176],line:"green",name_en:"Peenya Industry",name_kn:" ",id:44},{coordinates:[77.5701194,12.8960498],line:"green",name_en:"Yelachenahalli",name_kn:"",id:63},{coordinates:[77.5731279,12.9074747],line:"green",name_en:"Jayaprakash Nagar",name_kn:" ",id:21},{coordinates:[77.573598,12.9152208],line:"green",name_en:"Banashankari",name_kn:"",id:4},{coordinates:[77.5802659,12.921331],line:"green",name_en:"Rashtreeya Vidyalaya Road",name_kn:"  ",id:47},{coordinates:[77.5801439,12.9295069],line:"green",name_en:"Jayanagar",name_kn:"",id:20},{coordinates:[77.5800556,12.9382573],line:"green",name_en:"South End Circle",name_kn:"  ",id:55},{coordinates:[77.580016,12.9465265],line:"green",name_en:"Lalbagh",name_kn:" ",id:30},{coordinates:[77.5736794,12.9505161],line:"green",name_en:"National College",name_kn:" ",id:39},{coordinates:[77.5746578,12.9608788],line:"green",name_en:"Krishna Rajendra Market",name_kn:" ",id:24},{coordinates:[77.5745663,12.9668935],line:"green",name_en:"Chickpete",name_kn:"",id:7},{coordinates:[77.5124063,12.9354357],line:"purple",name_en:"Jnanabharathi",name_kn:" ",id:22},{coordinates:[77.5251166,12.9416715],line:"purple",name_en:"Pantharapalya - Nayandahalli",name_kn:" - ",id:40},{coordinates:[77.4878557,12.914689],line:"purple",name_en:"Kengeri Bus Terminal",name_kn:"  ",id:27},{coordinates:[77.4765784,12.9079105],line:"purple",name_en:"Kengeri",name_kn:"",id:26},{coordinates:[77.5196788,12.9365996],line:"purple",name_en:"Rajarajeshwari Nagar",name_kn:" ",id:46},{coordinates:[77.4983509,12.9242505],line:"purple",name_en:"Pattanagere",name_kn:"",id:41},{coordinates:[77.4612877,12.8973539],line:"purple",name_en:"Challaghatta",name_kn:"",id:6},{coordinates:[77.5299545,12.8617298],line:"green",name_en:"Silk Institute",name_kn:" ",id:52},{coordinates:[77.5383958,12.8714097],line:"green",name_en:"Thalaghattapura",name_kn:"",id:58},{coordinates:[77.5447414,12.8774369],line:"green",name_en:"Vajarahalli",name_kn:"",id:60},{coordinates:[77.5527546,12.8846435],line:"green",name_en:"Doddakallasandra",name_kn:"",id:11},{coordinates:[77.5626665,12.8889671],line:"green",name_en:"Konanakunte Cross",name_kn:" ",id:28}],eN=l=>({type:"geojson",data:{type:"FeatureCollection",features:l.map(u=>({type:"Feature",properties:{name:u.route_number},geometry:{type:"LineString",coordinates:$E.decode(decodeURIComponent(lN[u.route_number]))}}))}}),nN=l=>{if(!l||l.nodeType!==1)return!1;const u=document.documentElement,f=l.getBoundingClientRect();return!!f&&f.bottom>=0&&f.right>=0&&f.left<=u.clientWidth&&f.top<=u.clientHeight},rN=l=>{const[u,...f]=mn.split(l,`\r
`),y=mn.split(u,"	");return mn.map(f,b=>{const C=mn.split(b,"	"),P={};return mn.each(y,(O,F)=>{const k=C[F];P[O]=k}),P})},nD=l=>l.length===4?`${l[0]}${l[1]}:${l[2]}${l[3]}`:l.length===3?`0${l[0]}:${l[1]}${l[2]}`:null,iN=l=>mn.map(mn.filter(l,u=>!!u.route_number),u=>{const f=mn.map(mn.split(u.timings_from,","),P=>nD(mn.trim(P))),y=mn.map(mn.split(u.timings_to,","),P=>nD(mn.trim(P))),b=u.metros?mn.map(mn.split(u.metros||"",","),P=>mn.toNumber(mn.trim(P))):[],C=mn.map(b,P=>mn.find(D3,{id:P}));return{...u,s_no:mn.toNumber(u.s_no),schedule_count:mn.toNumber(u.schedule_count),timings_from:mn.uniqBy(mn.compact(f)),timings_to:mn.uniqBy(mn.compact(y)),metroDetails:C}}),oN="pk.eyJ1Ijoic2VhZGVlcCIsImEiOiJjbDliYW1wZzUwczJtM29xdHpzcnEyMjFpIn0.t_6sNxBfaIvu6C5XqjT5ww",sN=rN(Q4),aN=[{code:"en",text:"English"},{code:"kn",text:""}],Jg=iN(sN),lN={MF1C:"ebbyMobjnAiA_@c@Eg@@iABaBBwB@gCCoBGmCGcB@y@Fq@Rg@`@g@v@aIxOs^~i@_I`PmNdXwZfl@gIjPsChGmHzN{C~FeB|C[zAMpALfJ\\fDhAjPd@pGh@|GE`GXrCxElXtCvXbEnPrBxIbAtDtFdKjDxGbAnAvQhQtN`MbXrVjFdBb\\lMxeA~`@~KpDlBr@xBFnDUnOwCzViFtKmCfKsAlJiAnGe@pEBfDZ|@HbCf@nAl@fBt@vBfBpZh^nHhGvBvA~BXrC`@rA?p`@kBrSs@tBGzCy@jIsAfAQpCAdGb@jFl@tBn@nCx@pIpA|FD",MF1E:"cf{xMayinAy@vAq@nAaBnCmD~FIHA@ABCLE@E@EBy@P[JOHKJa@t@ABEJMXEDONOVMVEJGPCHITABAn@?`@?j@?T@R@h@?L@F?FPh@Lb@Nj@BPNp@ThAH^H^Nv@RxAFZBVD^Fl@F|@JfBJzALtAD`@D`@J|@BXBPJ`AB\\RhBDd@Fh@Fp@BPFd@LlADXD`@gBe@o@Q{@YeB_@UEMSMMQMa@Qe@M_@MkBi@i@Ik@IWCQAAFyC_AkFaBUGa@Ok@QgA_@aBi@MG[MkHmCuBw@uFoBSGiAc@a@MCAEASGsEeBe@QoE}AyEkBmCcAaBo@gHsCcC_A]OqCiAyCeA]M_Cs@cA_@YOUI[OsAc@KC_@OWIOE[Ii@MkBs@[K{@[WIGCUQCASKCCKGQIOGWIWI_@OA?oDmAqDmAa@OaA[m@Sg@QSUMIMGi@QEAi@SsAg@w@Y}CiAaBo@wHuC{Ak@aA]oBs@oAa@YIgBu@IEQIC?ICIAEAi@DG?C?m@AC?K?c@AiA@e@?c@@A?k@?g@Ay@EcAIiAAQKUCc@Cs@Ca@?m@@m@Bc@@m@Bg@@W@s@BkCDg@@{C@_A?gC@o@@o@?_BDyADW@]D{@Ho@Je@J_@LIDw@\\UL}@l@g@\\g@d@m@p@eAhAGFOPWVURMHUJ_@Ng@N]PaBp@}@^eA\\wBr@{FvAoFnAaAZkBj@_@L{@Xg@NQBUDc@HS@E?g@DYDiCRgAH{BZo@J_@J[H{@Tg@Nc@Nu@L[FgAPsBXs@Nc@H}AToARy@NQBw@NuB`@e@Fm@JgBXQD}AXw@LYFQBi@D]BWB_ABK?A?Q@mBB}@@[@kABc@?a@@qA@oB@kA?U?[@iA@y@@u@B]@S@eAF_AHwEt@{Cr@i@NaAV[JKBmAVI@O@]@KAe@EqASKCkCe@SEYEUEMAMASA_@?q@@iA@_BB[@{A?m@?K?m@?SAg@?U?S@[@M@OBSBQDwAl@_@RuAt@qAp@KDkAh@o@VSH[HYFm@La@JMBMBUDi@JMBeARmB^A?gCf@k@LCBYHYNYLSJOFYPMF[RQHMFODQDSDi@H_ANkAPqBVgD^]DkALwBVE?K@WB{ANyD\\WBa@BQBQ@[B[Ds@FoBNE@Y@a@D_@@Y@S?iCTg@Di@FmBNI?g@Bu@Bc@@mB?_C?S?kC?sC?w@?A?k@?g@?[?y@@c@?M@UBC@eANc@F_Dh@e@FgBZoARa@H]DiFx@{AP]FQBqCl@c@LYFcAXaHnBSFgGzAoEhA_B`@q@No@Nm@Ps@Re@Jm@No@L]FM?U@a@BkAHi@Bk@Fs@DUBUBk@FE@K@SDIB[HC@_AXKDqBp@WJi@NYHYD]DQBA?]Da@DwANmCTq@@O@E?[C_BIoBMaCQ{BQaAKi@KE?s@IGAS?CAS@O@S@]HUBg@JA?o@Jq@Fu@Bm@?sAGgCOUEC?KCAAE?_@QEEUOGEAAIISMMGOEg@Im@Is@IWEW@]DaAJc@BO@C?S?q@Cc@Ae@CYCMAq@Eo@QKCQAQG{@WCA",MF1F:"c`|xMiignAoA]i@Ik@IWCQAAFyC_AkFaBUG?T@f@@VAx@A\\Mz@Of@M\\Qd@Wl@CB{@jBa@|@w@zAS^u@|A{@`Be@|@y@zAu@vAGHy@pAeB|BkBzBWX_C`CiEpEkAlAeBfBKJg@j@mAnAYZe@f@[\\qAzAUZ[b@aArA_AxAy@tAs@rAeCdGs@rBYb@aAYWGq@I{@CaAAyAAE?C?i@AeAE]AOAGAGCECCECE?G?M?O?S?EBo@Ai@?K?_@?OAQCQMOWSMM[Yy@q@IEu@o@yAwAECWYc@]m@[uAs@GCIEICIAQAeAB]?a@@Q?Q?A?u@?Q?M?k@CMAUGKCEAWI]O_@MSIiAUcAGUAw@?k@@Y@eAHo@Fa@Fm@LaAXKDsCv@OFe@N]Ho@JcB^y@PaDt@m@L[JSHo@PI@i@JC@i@H{@NA?_@Nm@NQD}@NoAPqBTgBXiGt@mAN]?i@J[D[Du@Lg@HsCh@SBgB\\UFWFm@Lc@JI@yBf@GF?BAB?H?FANAL?Z?J?\\@NALAFAJCRELIVMZcA`BMZCNGTCJCNCNANANAHAPAP?D?v@?HCx@AX?ZA\\@h@@XGb@CLAHCVGTEJ_@bAIVKf@CV?TBVH^Rf@JRrA~BZl@H^F^@PFb@RlB@BDPLl@ZlAHf@DNBN",MF1G:"k`nyMctgnAE?S?kC?sC?w@?A?k@?g@?[?y@@c@?M@UBC@eANc@F_Dh@e@FgBZoARa@HgG~@{AP]FQBqCl@c@LYFcAXaHnBSFgGzAoEhA_B`@q@No@Nm@Ps@Re@Jm@No@L]FM?U@a@BkAHi@Bk@Fs@DUBUBk@FE@K@SDIB[HC@_AXKDqBp@WJi@NYHYD]DQBA?]Da@DwANmCTq@@O@E?[C_BIoBMaCQ{BQaAKi@KE?s@IGAS?CAS@O@S@]HUBg@JA?o@Jq@Fu@Bm@?sAGgCOUEC?KCAAE?_@QEEUOGEAAIISMMGOEg@Im@Is@IWEW@]DaAJc@BO@C?S?q@Cc@Ae@CYCMAq@ECHBzBB`ADr@?D?LBT@\\BNB^@Z?BAB?DA@ABCBGDMFQPC@IFc@d@IHGRCFCHGXCZ?FADCn@AJA@CJe@jA[p@k@zACHOd@EJELWr@KXKVe@jAEHa@r@}@|Ak@hA[l@s@zAEFCFCFADAF?H?L?RBP@J?@DTBZDVHZPd@DLBHDLl@fAb@l@DFTXTVJJRRdAbAPRp@n@r@p@DD|@z@`Av@Z\\^`@j@j@BBb@^BDJJRPTLNLXRNN^Xb@`@PLr@f@NLDBTPHFPRHLDBJNNPFHHLf@z@BBRb@FJBHFJT`@JRRVR^h@v@`@n@LPRPBBDBB@NFf@P|@b@r@`@j@Zb@@\\?D?D@^CjAEb@Cj@?NAzAQLAVEPCPCl@Kt@KTCh@KDAPEZE\\GZGLA\\GRGn@Ib@GRC\\GJArAUNAd@ERE\\EREFABAPCPGNEFAZKjAa@d@O~@Wb@Kb@M@A`@KNEnAa@t@Ub@KXK^KRGLE|@_@PETGDAREDArB]b@G`@I`@G\\EVCh@Az@?V?dCKh@AJ?d@CX?`@Av@CNAGuAMoBEa@?CGeAWiD_@kGGaAOqBM_AEk@AKOiAIu@CWMcACQK{@QqAQsAg@aEKy@MoAQ{AOwACM?KSgBI}@EYY}Bc@uDAQCWEg@@A@A@C@E@C?G@ICMESK_@COAEAC?A?A@A@EDEDENShDs@bFmAvCq@dHiB\\MjD_A@?rBi@LE`AY@?b@MfAWHCtAYVE~B]`C_@nB[n@KlASfHkAfAQd@E@?VENA^?lD?v@?hGAL@TA",MF1GA:"k`nyMctgnAE?S?kC?sC?w@?A?k@?g@?[?y@@c@?M@UBC@eANc@F_Dh@e@FgBZoARa@HgG~@{AP]FQBqCl@c@LYFcAXaHnBSFgGzAoEhA_B`@q@No@Nm@Ps@Re@Jm@No@L]FM?U@a@BkAHi@Bk@Fs@DUBUBk@FE@K@SDIB[HC@_AXKDqBp@WJi@NYHYD]DQBA?]Da@DwANmCTq@@O@E?[C_BIoBMaCQ{BQaAKi@KE?s@IGAS?CAS@O@S@]HUBg@JA?o@Jq@Fu@Bm@?sAGgCOUEC?KCAAE?_@QEEUOGEAAIISMMGOEg@Im@Is@IWEW@]DaAJc@BO@C?S?q@Cc@Ae@CYCMAq@ECHBzBB`ADr@?D?LBT@\\BNB^@Z?BAB?DA@ABCBGDMFQPC@IFc@d@IHGRCFCHGXCZ?FADCn@AJA@CJe@jA[p@k@zACHOd@EJELWr@KXKVe@jAEHa@r@}@|Ak@hA[l@s@zAEFCFCFADAF?H?L?RBP@J?@DTBZDVHZPd@DLBHDLl@fAb@l@DFTXTVJJRRdAbAPRp@n@r@p@DD|@z@`Av@Z\\^`@j@j@BBb@^BDJJRPTLNLXRNN^Xb@`@PLr@f@NLDBTPHFPRHLDBJNNPFHHLf@z@BBRb@FJBHFJT`@JRRVR^h@v@`@n@LPRPBBDBB@NFf@P|@b@r@`@j@Zb@@\\?D?D@^CjAEb@Cj@?NAzAQLAVEPCPCl@Kt@KTCh@KDAPEZE\\GZGLA\\GRGn@Ib@GRC\\GJArAUNAd@ERE\\EREFABAPCPGNEFAZKjAa@d@O~@Wb@Kb@M@A`@KNEnAa@t@Ub@KXK^KRGLE|@_@PETGDAREDArB]b@G`@I`@G\\EVCh@Az@?V?dCKh@AJ?d@CX?`@Av@CNAGuAMoBEa@?CGeAWiD_@kGGaAOqBM_AEk@AKOiAIu@CWMcACQK{@QqAQsAg@aEKy@MoAQ{AOwACM?KSgBI}@EYY}Bc@uDAQCWEg@@A@A@C@E@C?G@ICMESK_@COAEAC?A?A@A@EDEDENShDs@bFmAvCq@dHiB\\MjD_A@?rBi@LE`AY@?b@MfAWHCtAYVE~B]`C_@nB[n@KlASfHkAfAQd@E@?VENA^?lD?v@?hGAL@TA",MF3:"kdryMqfinALh@BJDL@D\\jAN^Nb@LPLj@V~@BZ?H@R?TFt@B\\BHDP@@HNNTNRvAjBb@j@BBRVz@fA`@j@fA|Ah@t@n@bA\\j@Zr@Pd@JX?BJXNj@Rt@\\hAX~@n@zB`B|ENh@HZJ\\j@dBJXJZ`@~A@Dx@pCDNLAz@QhDs@bFmAvCq@dHiB\\MjD_A@?rBi@LE`AY@?b@MfAWHCrAYVE`C]`C_@nB[n@KlASfHkAfAQd@E@?VENA^?lD?v@?hGAL@TAzAAtAA|@@hCEj@EdAKlEa@JA\\ClARXH?@@?PFNJLFPNLNRVf@z@RXNTb@h@LLZTPJTJhCjA|@d@l@\\ZTf@f@JLPRvAbB|@fAX^@DLTNZLVP`@JVbAdCRb@Xt@JVLh@Lr@n@tFFd@FJHpAB`B@P?bA@j@HxK?L?Hb@ArBCh@?l@AzAETArDMnDSp@GB?`DMfDOVAPAx@E~FWbESVCXAnBMdCGjFOvAG~BSfAM\\E|@KjAItAInBO^C|DUdDUbAGPARAVAR@j@Dz@FD@F@B@B@@@@B@@@B@B?B?B?FuAlGYbAMf@W|@gA~Da@vAe@fBI\\w@xCQp@E^CLA@ETCFKVEJITq@hCMd@K^[tASd@K\\_@dAwAdEM^e@pAQXSXUVWNIBIDUDO@_@@W@WBaADgABg@@yDJG@IBIAYH_@HODgA^_A`@c@VUR[ZWXQZITABK\\G`@EVEf@Cd@BVD\\HXF^HRd@dA^t@Xr@Pb@LXh@~@HN`@r@LTb@v@JTFVJ`@FhA@JD|@Lt@Fj@D`@BPBTDVT~@DRd@~BDRl@~BJZDPBLn@pBHXBJDLl@|Bh@fBNv@BVBVTA^?j@CzCIb@ERGJAhAAbAErBEtBG|@At@GZAxAGh@AzAGxAKb@Ad@CtDOd@AbMe@r@Ch@C@?D?@AF?jBGfAEh@?h@Cf@AlAEP?p@Cb@APAf@CVA@?@?j@Ef@CJ?t@Ar@Cv@AH?j@?L?lAExAGRAN?T?T?T@TBP@hCZXBPBdAHb@BbAH@?dBNJ@bBPTBZBj@H\\FJ@",MF4:"kdryMqfinALh@BJDL@D\\jAN^Nb@LPLj@V~@BZ?H@R?TFt@B\\BHDP@@HNNTNRvAjBb@j@BBRVz@fA`@j@fA|Ah@t@n@bA\\j@Zr@Pd@JX?BJXNj@Rt@\\hAX~@n@zB`B|ENh@HZJ\\j@dBJXJZ`@~A@Dx@pCDNH`@Rv@Fd@@F?@D\\D`@H~@Ht@LbANhAJ~@Ff@\\jD?@@FRpB?BDZNnAJz@@@Hv@Hj@ZjCp@`FT`CDT?BRdBD`@ZnDF`A@NDn@Hx@Fz@@NDfABXLbB@VBTFbA?BDl@J|A?D@XFz@RtBHz@D\\Ft@Jp@@LJn@F\\DRFd@d@bC^nBNj@j@lCd@rBj@hCP~@R|@Jb@J`@Lj@H\\TfAFVZxADZBp@?N?NBH@DDHDHb@fA~@|BJVFJPb@h@fA@BN\\\\r@`@`AFJVj@Th@Nb@J^Pn@Np@Dd@Lp@T`@NDLBP@VAp@@J?JAF?N?TA^An@GdASZEVEXCf@Az@?x@AB?T?N?^Ab@?L?P?v@?pA?J?t@A`@?^AJ?PAtB@hBCb@@bAAL?nBATAlDCt@?f@@\\BR@rAL`@DtCZP@bCTF@rAJnK~@`EXfCFnAB~ADp@@fCHlCHjCBpA@l@?`C@fF@dFB`@@r@@n@@`@?|@@j@Dl@AvD@xB@bB?xC@^@~A?bB?H?nB?T?H?P@v@?D?b@?NATCXEXAZAx@EpAClAE`@Ad@Ab@Cb@CzAGBAZ?T?RBJAhAAbAErBEtBG|@At@GZAxAGh@AzAGxAKb@Ad@CtDOd@AbMe@r@Ch@C@?D?@AF?jBGfAEh@?h@Cf@AlAEP?p@Cb@APAf@CVA@?@?j@Ef@CJ?t@Ar@Cv@AH?j@?L?lAExAGRAN?T?T?T@TBP@hCZXBPBdAHb@BbAH@?dBNJ@bBPTBZBj@H\\FJ@",MF5:"_d{xMc}inA]z@e@dAy@vAq@nAaBnCmD~FIHA@ABCLE@E@EBy@P[JOHKJa@t@ABEJMXEDONOVMVEJGPCHITABAn@?`@?j@?T@RBh@?N@F@FPl@ZhAZhAXbAH\\J\\Lx@P~A@J@HF^BXFv@Dj@JlBH`BJxABb@NdBB`@@DF|@BRTjBFd@Fh@Fp@BPFd@NlADXD`@gBe@o@Q{@YeB_@UEaA[gAWm@OMEGPCRk@bEi@fEEV[jCCJYfCIh@]rCu@fEg@hDQhCANP?pDDlBBD?zDDlBBtCB`GFdCDGdCGdBCjBEjBC~AGfDIpDCnAAb@M|FEtBM`F?PKvCCrBBp@GvC?dAGhBCVA~AAz@An@WvK?`@AN?X?NAf@C~A@ZCp@CZ?FAHAHAPAR@r@AfA?d@A^?B@\\@D@RHx@Lt@Hn@Df@Dp@Dp@JxC@P?B@R?L?ZA\\EbAAHAf@?R?t@BfABzABjBB~BDf@@d@@DBP@DPb@x@lBR^BHP`@Xl@p@rAh@bAHN\\j@\\|@p@dBr@lBDl@En@Oh@a@r@}@z@u@n@y@n@_@ZMJMNMVA@IPEREPG^?NAP?J?R@L?D@F@FBNFLR`@FJTf@Zn@`@v@Zn@HLLVNVjAzBP\\p@nAHJb@z@@@x@~Av@zAj@bA`@v@bAnBfArBHPl@dAt@zAZl@r@nALPBDHHDHFDDFJJHHBDDDFDRN^ZJFFDHFFDPHFDHBFDHBFBHD\\LLDZHb@LD@XHTDd@Fb@Bv@@j@?p@Al@A`@ChA?|@@H?J?H?v@@|A@z@A~@@vA@jA?^?N@L?J@JBXD@?ZHXH\\JPFJBH@VH@?PFPFVJRHVJPHRJJDTLPJLFJHJHLHLHZXLHZVr@f@~@t@nCpBlA~@z@p@z@r@PLJHDDDDDDDDFFDFFHHJDHHLDFBFDFt@fBJXj@~Av@lC\\jAf@bBX`Ad@dBp@dC|@~CDJDLX~@d@|Af@xAf@dBFPeAXeEnAgA\\wBr@ODsIjC[H]LaInCiDdAyAb@q@Pe@LSDDXHLVPDB`C\\bCZJBtATRBzCd@TBvEn@rEn@v@L`@JVJv@\\bDfBdElBjC`Ae@`A[l@}@lBeAdBQ@SLQRMTYLEBSPYVUVMNGNIPCT?NARGLw@bBA@AB",VMF6:"eqwxMq`zmAZk@\\i@`@m@hAeBT_@BGHQDOBUlBwDz@gBDKFMJWRc@tAgCp@oAVe@HQb@s@dAkBTQDETc@d@{@HQLUHOg@W}Bm@kA_@UIMEg@OWIQIMGIGQSAAECAAKMKSGOo@kByAeFGKES_BmFoCqJ_A_DSo@g@cBi@gBs@eCoBcFMSEIEKEGGIMSIIEECEEEGEa@[cBqAy@o@i@c@_HcFMKs@i@ECa@WYSWMECQIMGGCWMICOGQISIAAWIICGEGAICOEWGOEGAKCKCGAGAGAGAGAEAGAEAG?GAE?KAa@Ac@?g@?aA@a@?s@G{@Ao@@e@AG?k@?O?C?G?E?K?K?I?K?I?{A@wA@k@@i@Ak@?K?QAa@EQC[GUCWGAAMEQEu@Wq@]ECs@a@u@o@YYKK_@e@e@u@Yg@}@eBYg@Q]CCOY_AgBu@qAc@{@a@y@aAkBwAqCa@s@Wg@Yk@KQ{@cBa@u@OYOWIMmA_CAA[u@CGQa@Oa@CW?EAU@WBYFWBKBIHUJSVYb@a@|@u@p@i@f@e@XYDGNUJULe@Fc@@e@Gi@Qk@[y@Wq@KWKUa@y@qAaCe@{@a@}@iB{DCGSg@GQCSGqACiCA[Ci@?EGqB?e@Ao@AU@Q?O@[DsA@I?G?G?G@U?G@a@?EAIGi@?CEmAC_A?GMyA?GIs@Mu@E[CQAQCa@AU@G?E?c@BgA?O@c@@c@Be@DgA?GF[?aB?k@AO?I?C?A?A?A?A?C?A?E?IDkBNkID{B@qABq@DmAPyE?}ABkABuC@QHsD@o@JuFF}CBqAFcDL_HNqFBcADeAB_A@SBoB?A@a@?ABeA?E?qAFgCDkBDkBHoCByA@}@@O?S?W?Q?K?M@aA@MUIeAUoAWcBk@iBk@u@S",MF7:"{o}xM{lhnAcDo@oFsBiEsB}CqAgH}CmPgIoCuAoGgDxE}LcDwAtQaf@|JmXoBsAqDmAaGwBuCq@eFgBTuPdA_FbHuCnUsGtFaBs@{AiB{BeAuAcCmDk@y@oAqEIq@{CeFcEkEcBmBqBeDaC_E_B]_JsFoHiCiDwB}D{A}CaAyDSeGkCuIsDcI{CeBi@cDYoAUMiIAyF",MF8:"}{rxMshfnA_@JWiAUeAEQUs@M_@EQAO?W@SBe@BMFUH_@Rc@P]l@y@HIl@k@BCl@k@REJEFCVMh@_@XOHQ?C@A@A@G?CBE@Cz@cAJK|@cANQNSNQz@gA^g@x@cA|@oATe@h@w@@ARYTWFIf@q@d@o@rAeBAAo@s@o@w@o@u@UWWYa@c@EGKGMISKYMMGEAYIqBo@YIKCw@Ua@SuBuAi@]\\i@tAwBzAuB\\e@Za@d@k@PQRQhAk@|CmAp@SfCoA^QdBi@ZKRETCZEr@QdAIdACD?PHnDHdCD@Dn@bBN`@nAhDZ`AJLBFh@`C@@BVFZDZDt@B^@v@?RAN?D?DEn@Eh@Ej@aAPSB_@BQ@Y?O?c@AsDOk@AO?y@?}A@Q@E?C?ODUDIDQJo@f@s@h@i@j@h@p@~@jATZLJ^\\PTnA`B|ArBTZdArAkA`@q@ToA\\cAXeCx@{Bt@^tA@FBFb@dBBFPbAH`@wFhAiE|@k@LeCf@]Hs@Rq@Va@LiBp@RbC?L@RO`A_@|AcATgB^",MF9:"y_iyMe}gnAECSKKEKEKAI?K?QBg@QYOk@Yg@W_A_@k@WAAUMc@WMGWSSs@AKE[Ai@?i@Fg@Pe@Xg@d@c@RGj@Q\\IlA[PE@?rCk@pCa@?CIQwEt@{Cr@i@NaAV[JKBmAVI@O@]@KAe@EqASKCkCe@SEYE{AqASQOU?C?AA?EGaAoAGIW_@CCMOW_@QWKUGMEQGYQk@GKEMGMIQE{@Cy@Ac@AO?[@QDMBOJUXk@DIR_@BEJYJSFSHQ@EDM@KBQ@YCaAEyBAe@AY@IBEDERGJED?L@H@Z@J?T@V?RCRCREJEHCFAPIXMl@WDAn@Yb@Q|As@HEBCBC@C@E?C@C@MDoDDw@@i@DqA@KBO@CDGFEBAHCNAl@GtAMd@Cb@EZC@?xAQTILGDC@A@E@K?KCKQg@Qm@EKAGAIAKAQ?O?y@Cw@DYHmA~AHf@DR@z@Df@BT?|@Bx@@X@\\?x@?|CDv@?H?p@?^@X?L?vABv@C`@E|@AbBD\\@VA^Cp@KbAQZG^Ef@K`@IrAYDCj@Kr@Kd@I`@I`@KHCj@Id@Gn@A^AF?ZCL?PCBADCHGV_@@CFGDARKZIRCFC@A^Of@OLGRGRGDC`@Gl@I@?bASp@Q@?p@ONIB?`@OPCDA^KVOTQTU\\S`@Sx@SNGf@KZOTMLGLIFCt@_@p@e@TIh@YJCZKRGl@KJCVMTFH@ZBj@B",MF12:"g`gxMqidnAbCfJfBtFjChIrBrFzAbEt@bClBvFhAbD\\~@HtAIhA[lAsC~HsA|E_@rBi@lDe@x@qBnCyCvBgAt@wEf@}Hp@eHZkANOp@rA~@zBlAlDzB|Ap@lDz@jBjAbBnAnBtCvHvErNlDbOrElBdAKtA_@dA{EpIsFdL{HfOqCrFg@fCo@r@{t@`b@}QpOoOtLcS|HkYnHsD`@cJrBgOtByAnE}AdBsDxA}CpFi@vA{HvVqFr@_IsGqBw@yB[gAiCuDs@}A@_FOmBu@DaC",MF13:"y~fxMijdnAs@iC_@qAGQIYIOMY[c@KOo@o@i@e@YMOISECAuBa@MCgAO_H}@kBWgAOB[VwBQkCg@uHG_AIaAGu@Ew@KgAdBOb@EFAZEd@Ix@Q`@Gn@SnA]bD_ARGx@WzBu@\\KnBo@LEF@n@MrBo@f@SRGSo@Yy@GUW_AIYCMCIAMAOEu@ASE]?Q?G?IBSDQBOLk@HWFY@O@I?IAIEo@Ay@Co@AYS}DAUOaFGuAG{@Iy@Im@|AMJAjBQ|CWnBGv@Er@MVMh@UvCiAhAYoAiA_@e@IKKQIQISM[AO@G@G?GAIUkCKcAAMMcAM}AK?PgAN{@Ny@?E?M?M?IAICKGo@M}@G}@K{@Q_AdDe@zAYNC|Cm@^Ih@MzCo@VEl@KnAUnAUj@M^IfEu@@?t@M`AOhB[Fr@J|@Jr@Lz@@r@Jv@Pz@RfA",MF14:"cqaxMqhwmAuQa@PkMn@kBLuAKaFkC}AqBcBK{Be@kS^{DLoGHeGH_FiAwHs@wAuA{DS}@CaD\\yBTkA{@cPG}@f@}C^sIwC_LoByEeEgHmCoEmDuCeAsG",MF15:"c_oxM}etmA}BAkGKO?wC@aA?sACIADaCB_C?OBiC@m@?G@_@@aA?]?E?EACCOAGCQA_ACeA?O?ODiABgADeA@s@BYD{@@QA[?O?O?KAg@?OCm@Cm@?O?aA?KEs@E{@Ks@Iw@GYAEM[MOUWg@w@W]IOAAAEACAC?E?G?E@E?CBEDEBADCBAFADAD?x@ENABABAFCBABCBC@EBE?E@E@]@a@Bk@b@oFH_A?KJiB?SAOAKCICECEGEIEy@SeAO[KMEIESMOQKMKQMUKYCCGG[So@k@gAi@QK_@_@IMMQKUe@w@IIGOQ]]w@[y@CGAG?GAqAAcA_A?mA@?yCAg@?e@?y@?S?i@@eEAm@@o@?g@DaFA{A~BA~AGt@?bAAvAAT?jDCRAzAAb@Ar@Cl@C~FUbEU`CMZAF?nAEjAAB?F?bACF?TAX?D?j@AD?d@AF?L?n@?D?`@EDAREd@Ij@E~@CJCF?f@ERCn@GHAp@MBAzAG\\?T@\\DL@?TAjAAv@C`BCxCGlBAt@CPCb@O~AGb@",MF17:"ckoxM}h|mAG{TyUJFpYhAdD?dC{@~DClAPx\\JnWoLf@H|g@OtYBtCtC?N`DvE|I`CxA~@xA~EtA^f@GbGo@tDF|CaC^s@j@xA|B`AxAb@hDVzEc@pPO`QGxKo@`I}BjHsDvN}AhIf@~NFlBg@vOdAtDlArHVbF|DG|@V^tRtAVtBrHtDf@pLsElAo@lCyI|CeBcBs\\",MF18:"utqxMyhanA^rAPr@Pj@f@xANl@jB|G\\bBA@?@A??@A@?@?@?@?@?@?@?@?@@@?@?@@??@@?@@@@@??@@?@?@@@?D?BAB?DC@CBC@E~@UtCw@^G|HoBTEdA[DCHCLEJGJGFENMPOPMn@g@x@s@|@w@XG\\EVEt@]`@GhDVLHLVBF@DNb@XbADRLZZz@Vj@LZ@BPh@Ll@LZb@x@^fAL\\Rn@j@~AFT\\bAJX@BDJHHHHLHTJ`@PjBd@\\JRHNFVPb@XTVPTHFHL?RX?J?X?xBBlBBhA@lB@jA@tA@P?zAAXArCCZJzA?b@?nB@bA?V?Ae@?EAcADcH@{@@y@ByD@sB?c@?c@AkB?[@eA@gA@s@CwB@a@BSDeJGs@?QIWY{@_@kAs@mC]_AUu@U{@Sw@Me@Kk@GQI]EMAGCKUs@g@cAIM]m@W_@_@e@e@c@SWaAoBWs@M_@k@cBM_@EIEQACAEAAAIGUwBSW@K?q@@wAD}BN}BVqCLoA@eADoAFs@DmADO?{ADi@@gBFYBu@@e@DI@GBSDK@K@O@OC_@Ag@Eg@EUGSKmAmAq@s@wBcCk@y@Ae@G[EQ]_@_@c@_@i@MSEGCQGe@COTkBEOCKIOkCJ]C[CC@EBC@EBCBC@CBCBCBCBADCBCHEHKd@MTc@vAYr@INiAvBIZCJAHAHALF^Jr@Pz@F\\H`A@LHv@@BF^H|@_AbACHKLOHo@LWHYBe@FQ@Q?S@a@@S?U@e@B}@JgAJ]?YBkANk@FM@MBi@Be@BM@S?Q@S?U?U?WAUAOAOCQCGAC?UEC\\@L?J@FBJTt@`@pALd@Tv@Pn@Jb@p@|BRp@FTDFFNdArDXlAVd@Z~ARn@r@fCXfABNLh@Nb@^pA",MF18A:"{sqxMohanA[gAKc@K]AEGQIW?KOg@K_@aBeGEOQ_@GMMe@Ia@[eAu@eC?G?EAG[uAdAW`@Ku@gCi@iBo@gCCIR?R@R?TAj@At@Gp@Ih@Iz@Ot@In@KD?r@In@Eh@Cd@CP?L?NAX@P@N@LBLBL@JBLDPJTLj@ZZ\\dA~@b@^dAbAX`@?@LN`@EdBOJ?tDSzAIlBKl@ChCMb@ChAGGQeAeC{@sBEKMe@Ke@AK?IHi@Pc@vAFj@FXF\\F|@Nn@HpBFn@@\\@dACbAIt@E\\LNBN?@?t@CxAGpBIlACb@AhAAv@EJAD?LALCLC|@StA]XIBFHT@D@H?TGh@[|AKz@M`AKxA?TAr@Br@@xAB|@Ad@At@A^?b@FtBAj@D`ABb@Hz@HdABL@LBl@B`@BX@HFtAD`@DR`Di@PCREPCd@KnAWzAY`Ca@NCfASj@K^EERCHAH?NAxA?F@nAAz@?B@lB?@AhB@`AAj@GbD@P@fA?fA@B?jC?J@rD@vB?P@fA@b@?b@@fA?|BS?yA@W?qBC]AS?YHQDc@?sACm@AC?{A?Q?eCCc@?}EEsD?k@?A]?I@G?y@?]AmA?O?o@?aD@wGCcA@s@AyB?I?MA]AiB?s@CmAAuAAQCMOQQM{@}@oBqBIIeAuAc@o@eByCgBnAaAdAgBrBGDg@ZkBl@c@HmAXm@POBm@PaAVL|@VxA\\hBEDKLKJg@d@_Ax@y@n@o@f@QNA@OJONGBKFKFMFIBkA\\UFA?wItByBj@a@HUFKB[D?AA??AA??AA?AAA??AA?A?A?AAGs@kAyDu@sCSm@i@iBYcASs@",MF19:"gzqxMyjzmAP~@FLJt@DnCHtFEVCRz@?r@AjACLAzBHzCGpCGNAd@?dAAhAAhA?hAA~DIxA?fBCL?jBA~FAn@?PAr@?xGAD?dCAn@?fC?P?@U?Y?gB?_A?mA?M?w@@cA?A@mCBkB?C@c@@gB?G@[@}AC}DAkBAI?A?E?A?M[?sAByA@_CA}A@wA@cEHQ@yABuB?sBBaB?OA?NBvCgABcD?{A?_BDE_D?Q_B@gA@uA?c@@O?iBD{AB_AB]AsA@iA?iA?mA?G?sCBQ?@L?bA@z@@x@@r@A`ABjA?bA?`@HN?T^?V`@JPJPDLJh@Nn@~A?l@?",MF21:"adnxM}yymADNH`@Dt@BP@@BFPPCbABfA?JFdABZHzBHv@@LN`AJl@^hBRbAPnAF~@@fAOAWEUAG?W?{AFC@q@JI?aALo@JI@C?k@DE@S@E?U@A?E?A@{@JG@_@DC@g@@Y?Q?Y?E?y@?G?s@@I@o@?E?}CLG?_@Ba@@c@BaADoAFmBJqFNmBJk@@sGHsD@iA@kBDqABI?M@wB@aB@uDCuABsADC?o@@uFRcA@}@Aq@?wA@oDHiAF}@Bo@@w@D}@@I?m@AeBGqBIMAoBGE?eAE_FOyDKkBKc@AwACmBEALAF?JCb@CXWnFQ@UHEPGz@Kr@AJCVCTCTETQt@GTCFABe@x@aDpEiAAq@AeAA_EAe@ABb@wAFaELe@?_@Be@BU@y@@}@C}@CeAEq@AeAGm@I_@GUEMAM?Q?m@LYFm@Vy@b@ODOFMDSDMBoALa@B_BJy@FmAJuBP]BI?CACAEACCACAEOo@Yw@Us@W{@Uk@c@wAOg@Qo@Su@Qm@Me@a@mAUs@Oc@EQCGGUQm@]w@ISK]GMGQACAI?I?G?YKcBAGAMAQUcA?A[cBI]Eg@CYKqCI_DIkBKyCQoE",MF23:"wvcxMsqqnAxL{GbK{IpPcEjOsDvL_FhIqByC}JpAsMk@sHK{Hn@kHv@oOlBkTGkEbTm`@uAi[|CwMiIqKnOaRhByBoEkHc@SmIhAmBf@kEpDaAV_PcEeKFiI^qQxAyB~@o@r@eFn@qCK}Jr@uAr@gk@vj@cOzO_AxK?xI?xI}BhJuCvOsClIgBpKlBb@jG^pCvElDhC`CdBdBx@xCpAzEx@~EzDpCdBbE`BhApCf@`C|BfFpBdD|FdKJb@qXbEdOl^xIyC",MF23B:"uwjxMy~rnA@?HTA@A@?@A??@?@?@A@?@?@@@?@?@@@?@@??@B@BBD?B?D?@A@??A@?@A@A?A@??A?A?A@??A?A?A?AA??A?AAAv@mA@CLWbBgDdAiB~@oBf@{@f@s@l@eAnAwBfBkCTWXYDCrCcD^m@Vc@d@w@`A{AdBkCHQb@]XUh@c@\\UjEwC\\UhA_AJIxAqAr@k@pAkAhA}@p@s@JGFGDE~AzAnDjDJHb@`@PNXJJFPFXBR@`@?zFEn@@X?P?`ADv@FhAND@VBh@Fh@FRB|@LVDdD\\fAL`AFf@?lGc@lHk@D?vAKl@EhCGAYLg@Pq@lADjBFt@BJ?HAF?BA@A@A@C@CBKJo@VqAd@kCReADQFU`@gAFQDONi@?AL_@J_@J[X{@t@uC@_@@ODKJc@Lc@FQBIBKDOVqABMDW@I@M@MHc@BQBSLkABUZkBNw@DGH]@G?C@C?I?y@?OAm@DMCi@?WAWAa@@k@@S@WBK@MDMFa@@G@MAu@AKImAAMAm@?Y@W@KF_@V{AJQHcAHcACSPSd@g@F}@Da@Jg@B[D_@Bg@@OBsABw@?MlAM|Fm@\\Ch@CRCf@E`AM`@GVGbAI|@GHCHADAFCFCJGLGNKZUDCDEDEDCFCFAFEHEBA`@QdAYr@Mv@Od@MRE|@OhAQx@KTGpBc@VE\\Ir@SdAUTGrD{@XGHAJ?L?J?L?`@@D?@?HADAFAlA[VIv@Ql@OvBk@f@Q@?^M`@Ud@]n@g@HMBG@C@C@E@IGi@SgBKy@?AM}@Ga@Ca@AOAWAO?G?i@?M?_@?a@@_@BUBMDMDMLSDIHMRW\\_@\\]LKLOHMn@_@LEdAm@`@Wt@O`@GNAd@ETAHA^Ef@EHABA^GXGVCTA\\?P?\\@L?X?^Al@Cv@IB?D?n@CbACJ?b@A^A|@Ej@CJAp@EnAKdCMp@?R@H?F@F@PDRFrHpCXB`@Dr@DhBN`A_@LId@[h@a@^Wp@e@LIb@S`@QRGh@Md@ITEd@IrBYTABAHAPAN?TFVDHFRLTb@HLHFFBHJV^h@x@V^FJBBl@j@PNAD?B?BGJIJGFKLeA~@{@t@]\\KJIHSR]ZQR[Zo@|@cA~Aa@d@STONOLIHEBUT}ApACBCB?BAB?F@F@JNV@BRVHJ^f@JLRXV\\TZV^`@h@RXJLDFFHLRHPDHBJBHBJ@HBH?PAH?F?BCHAHG\\GTKb@ELIVELO`@Qb@ADIR]x@GRGPCLCHAHAFAH?D?JANBPF`ADz@d@tFHn@Dp@Hv@B^Hl@Fr@F`@Ft@D\\@t@?HAD?BABEJc@r@a@v@g@x@ETcC`Ea@v@U^[n@GLa@r@eAnBC@C@C@AB_AfBo@nAYf@ILOXy@hBM\\?JANARC`@AT?TCXCb@EfBE~AC`BI|@AXE`AGt@Ip@SrAE`@I\\EZ?@G^CVCNEr@?DA\\G|AIfA?@C\\Cj@ADAZEl@ItAGt@Gr@G|@Cd@?Z@r@?VBjAD|BDdA@PFbAJ|A@V?P?RARCVCRERCNGVMx@Mz@I|@G^GXAd@@R@P@FDXFRRp@^fALb@HVNf@?BFPPp@BHs@N_@Fy@PA?m@NSF_@Jk@Rg@Tm@Vc@R_@PE@iAf@yAl@kA`@iAd@k@R{@VE@u@TaB^eCj@[Hc@JcATc@J}Bh@AIm@LeAV]HSDc@JUHmAd@OFOH_@P_@T]TA@YT]Xs@p@a@^e@b@SNSPYVGDWRk@b@MH_Ab@y@\\IDA@_@PMF",MF23E:"wpcxM{vqnAw@\\kAf@uD~AOFcCfAR^~As@`Bu@~E{B`CeAr@[rAq@RMv@i@^[LKXW@?r@q@b@a@dA}@f@a@b@[ZONIPI^Qb@OJENEj@Qj@Mp@QvA[x@Sb@K`@KdAUTGrA[bAWZGpA[t@SdAWHEXIh@SlAe@lBy@bCeAb@SZMh@Ur@Wb@OFCb@M^MLCTG`@IBAt@On@MREKa@AIM_@IYUw@Qk@Ma@Ma@[eACMEQAO?O?O?CCS?O?GBMXuBH{@Ns@DWBMHu@@Y?SAc@KqBEq@?MA_@CaBAq@ASAw@C}@?s@?K?M@[FaAVuDBa@Bc@?CFiA?EHgABs@Bi@BY@k@@MBQBYF]J{@Fa@T}AJaBPyCL}DHiBDaB?IB_@Bi@L_@@GBIN_@\\s@bBaDbAkB?A?A@A?AACdAoB`@s@FMZo@T_@`@w@bCaEPOjAuBf@}@BI?A?C@CAG?w@E_@Gu@Ea@Gu@Im@C_@Ec@Ea@KqAw@oJ?Q@a@@I@G@IFWFQFSj@uAZw@DMPg@DMJc@FULq@@S@[EUCIIUEKIOOS[_@U[a@g@_BqBKM]g@IKSS]UAKAG?G@C?CBCBC|AqATUDCHINMNORU`@e@bA_Bn@}@Z[PS\\[RSHIJK\\]z@u@dA_AJMFGHKFK?C?C@EQOm@k@CCGKW_@i@y@W_@IKAI_@y@SQSIB]@]JeAGWEKEGGEYMMGa@KYKIGKICCQWKQEGMWc@}@CCIQ_@u@GQYi@O_@ACg@wA?AEK]eAScACQWyAAGGUOw@Qo@KQGEIEICWAIA_@CQAKEKESMMKSIiAc@ME[MGECA?ACGCIC[?ACU?U?MCKEEEGWS_Ak@gC{A{@g@_Ai@KGMIg@a@e@Yi@M_@GKAa@G}@Ia@CQ?mAKs@Gy@GIAk@GqAIeBEU?_@Bg@CQCUGWKECUMQOWSi@g@[WQC]Aa@EkACy@KsAQIAoASc@GGC]GyA[GCECCCAE?G?I@KD]D_@@U@S?IAE?AACAAECECMEOCs@IsDa@cBSqAOcBSE?}AQeBO[EC?sAQq@Gs@I[CQA}@IaBSIAcCSUCM?a@Gq@IMAOCA?]CQAG?g@?k@?M?A?m@@aBDg@@W?a@?E?U@_@@A?K?]?A?OASAOA?AOC_@IMEOCEA[IGEGEEGEEMOCEQ[IOuCz@gCt@c@JEBi@LE@y@RUDUDWDWDi@Ds@Hc@Du@Fc@De@DwAPSBmBRyBN]BI@c@DM?Q@CJGTGPEFA@IJIHMFm@NMD_ALQBi@Hg@BUBC?uBVc@FiBTOB_@DeBRe@Fq@HoAROBA?m@FYB_AJwAPaCX{APo@HYFkDl@g@FWFw@J{@LE@a@FG?G@cC\\s@Jc@HK@w@LUBOBiAPUDQDKDSFgAh@_@PULKHIFa@Xc@^INCDOBcAnA}ApBkAzAIJaAtAi@|@KNINABABCHAD?B?D?DBHHZPh@BNBN@PANGVENGTOd@ADAL@^?X?LJ`AJ|@?DH^Hn@Fj@D\\BNRtAFd@ATAAA?A?A?A?A?A@A??@A?A@?@A??@?@A??@?@?@?@@??@?@@@@@@@@??@@?@?@?@?@?@?@?BD@@BJBH@NFb@",MF24:"iqcxMewqnAkBz@c@PkBx@eAd@A?KDqB`A_@P]PSJBFP`@RK`Ac@BFjBy@FE`Ac@~@a@bEmB`EiBL?N@F@FBJD@@Dv@BX@X?F?J?J@h@?f@?x@?j@EhAGlA?D?RAl@?pA@LDbA@J@BBV`@fBDd@DPb@hE@hA?j@?RC`@CFId@e@`BQr@M\\YbAs@hCUv@e@nASp@ERITc@tAGNw@bCOd@]nAY`A[`AGPM^]jAe@|AAHYfA?BENg@xASr@g@bBOl@O^S`@Ub@GFEFMLQLUJcB~@sAr@i@Vg@Vg@PDJn@r@n@n@VVZZpAhA~AvAt@l@n@d@ZXZZd@\\XXJLFNb@pA@BTt@X|@Vt@KJCHAHADATCr@?HAp@A|@CpA?bA?V?VAj@CtAGn@AFQrAWrAKj@G\\Ib@Ml@S`AIl@AHu@nC_@PEBSRCDAB[b@EDCDIFGDSXMPEHGNGX?@AX@XDjAEHqATu@Lw@BcAH_@@K@O?Q@I?i@@G?I?G@QByAVo@J",MF25:"ofaxMqzrnA`@Ib@IPCRELCv@On@MBAz@Qt@Oh@Kp@Kd@Kt@On@Mp@OLENC@AbAW|Cu@NEhAY@Ap@Qf@Kf@Ol@OBAjBc@ZKpA[j@O`@K`@K\\KJC\\Gh@MTEZI`@Kf@KBAf@Kn@OPEfAW`@K`@KfBe@bAWZI\\IDChA[TGb@Kf@K^Gh@Gz@Kn@Ij@G`@E\\I~@UNEb@QXKf@SJEdAa@BAn@WdBq@XMBJBHBPJ|E@fA@p@Bp@@H@HPt@ZpA`AvDDNPp@H`@V`Af@tBNn@J\\Rx@\\pAJ`@j@jBLX?BVl@Tn@Vp@BJbA~Br@xANn@Vr@Tj@@B@B@?@@@?@ADAl@UbEaBDJJETKd@QLCXGVGd@In@ITG@?^I@?nDcAJ`@DRF`@F`@@FLz@DTLp@`@tCDRDNDJP^HP@F@B@B@B@F@FD~@Dl@LlABTHXH`@FXDX@D@HBR?P@T@ZBn@?VLlC@R?LQ?{@BA?I@@pA@d@Bh@Fv@Df@JpA?@?Z@@@JBJDV@DDNHTHT@FXdAV~@BP@H@NTdE@\\JtC@VHvB@b@Bb@DBH@HBJ@R@D?T?d@CB?TA@?@AZ?JATAR@\\@J?v@?D?z@DJ@HBHDDDBDHLFNPf@`@lAFLBDPXp@x@^l@LTR`@LZ@D@@R^FPBFLb@BLJ^H\\FRFVL\\B@DDBB",MF26:"amcxMowqnAnAk@L?N@F@FBJD@@Dv@BX@X?F?J?J@h@?f@?x@?j@EhAGlA?D?RAl@?pA@LDbA@J@BBV`@fBDd@DPb@hE@hA?j@?RC`@CFId@e@`BQr@M\\YbAs@hCUv@e@nASp@ERITc@tAGNw@bCOd@]nAY`A[`AGPM^]jAe@|AAHYfA?BENg@xASr@g@bBOl@O^S`@Ub@GFEFMLQLUJcB~@sAr@i@Vg@Vg@PDJn@r@n@n@VVZZpAhA~AvAt@l@n@d@ZXZZd@\\XXJLFNb@pA@BTt@X|@Vt@KJCHAHADATCr@?HAp@A|@CpA?bA?V?VAj@CtAGn@AFQrAWrAKj@G\\Ib@Ml@S`AIl@AHu@nC_@PEBSRCDAB[b@EDCDIFGDSXMPEHGNGX?@AX@XDjAEHLfBCt@?H?F?F@^Hj@Fn@Fh@?DDb@@X@HH`ABNBf@BLJl@BHJh@DRFh@@F?X?LQ|@?t@Cz@?d@@v@@RBhAHnBJt@Jr@Nx@Dp@F`B_AJA@UB]H[Fa@FQDm@Ju@L}@Py@Lk@JKB{@LqAT[Fa@LG@uBp@Yu@Yw@?AWq@[}@AAIUO[Sg@SF[aAUy@WoAIg@Gk@C}@?GA}@?_@?c@?c@?c@@gA?c@?_A?k@?c@?M?}AAi@Ee@Ca@E]EYc@wBCMCMY{@Wk@Yg@IMQYe@k@c@g@_C{B_@c@q@w@Yc@g@{@i@{@_@k@KS_@o@IOUe@KSk@mAYu@a@mAAEc@}Ao@}BeAqFmAmGESIk@Gi@]wCE_@MgAOkBGo@Gc@CWKm@GWUcACISw@]aAGUo@cB_A_B{B_Fw@aBiAaCKU_AmBmAeCcC}E\\IhAi@dDwApAk@PI|BiArCuAXMDC?AEKSw@yBkGWk@fD_BbBy@hBcANKd@Y@?zAw@h@[TKNKz@_@v@WhA_@NG|Ba@n@Kv@KNCpAQ^Gh@G\\GfAOrAUVIhA_@n@Wd@Ud@ShAi@pAk@`Ae@dAe@NI~CwAdAg@r@_@f@Ux@_@f@WjBy@FE`Ac@~@a@bEmBrAm@",MF27:"kqcxMcwqnAiBx@c@PkBx@eAd@A?KDqB`A_@P]PSJBFP`@RK`Ac@~As@`Bu@~E{B`CeAr@[rAq@RMv@i@^[LKXW@?r@q@b@a@dA}@f@a@b@[ZONIPI^Qb@OJENEj@Qj@Mp@QvA[x@Sb@K`@KdAUTGrA[bAWZGpA[t@SdAWHEXIh@SlAe@lBy@bCeAb@SZMh@Ur@Wb@OFCb@M^MLCTG`@IBAt@On@MREKa@AIM_@IYUw@Qk@Ma@Ma@[eACMEQAO?O?O?CCS?O?GBMXuBH{@Ns@DWBMHu@@Y?SAc@KqBEq@?MA_@CaBAq@ASAw@C}@?s@?K?M@[FaAVuDBa@Bc@?CFiA?EHgABs@Bi@BY@k@@MBQBYF]J{@Fa@T}AJaBPyCL}DHiBDaB?IB_@Bi@L_@@GBIN_@\\s@bBaDbAkB?A?A@A?AACdAoB`@s@FMZo@T_@`@w@bCaEPOjAuBf@}@BI?A?C@CAG?w@E_@Gu@Ea@Gu@Im@C_@Ec@Ea@KqAw@oJ?Q@a@@I@G@IFWFQFSj@uAZw@DMPg@DMJc@FULq@@S@[LQFIj@i@r@s@@CNMBCDEFG@EDEHINWHQ`AgBX]LMHGHG|@a@`Cy@n@CXEv@Ij@IB?fAI|@CXCpAM\\CNCDCBA@A@C@A?ADQLg@Py@Li@DONi@Pk@@ANy@BKDY|@iDFWBMf@oBFKVq@Nk@@GRu@Ne@BMH_@@ETw@H]FY@Aj@_CNo@BKPs@FWl@}AJADAREnAKD?xAIZAz@Ap@?B?b@@H@@?nAIpAMB?RENCHEFEJILMRUPMTMPKh@UZIJAHAb@A@?B?^ARAdBArBEtAEx@CX?^Av@?R@~@@rADb@BrBFpA@v@JVFf@LTHj@JhARr@N@@z@LB@x@PD@VFD?|CK~@Gz@GnDShCKfAGn@C|AEfBBV?^?vAIXC`@Ct@IhAMd@IHAf@KpAWn@Kv@Mp@KhAONCrAONA@@D@B@BDBDDJ\\xAHx@N`ALdABXD`@D|@?b@lBCL?x@?P?l@@x@@H?n@@NANAn@IfAOTC`AOb@E^INGHELKPOTOJILIPIFCXKZKbCiANENGPGBATGREXETEXC@?n@CXAT?L?\\@h@?zAIzASb@CRAZA`BEX?^Af@AFADAHEDCDEBEBI@KBSBW@QHFNDRFd@LJBTHVNJLJRHPFHBD`@\\p@j@RNDB`@b@^\\LJDFRPNNn@j@VPB@LHDBD@DA\\CZ?R?@?RDJDn@d@@@hAp@RL@?d@Zl@`@~@r@NLjBvA@?x@b@LHHJFH@NBJD\\B`@Bh@@HDV@NDPBTHVJb@@DHTf@dBBHHZXbARt@?@TjAFZHNPh@HVBT?@?\\CTE\\EZEl@CX?N?X?BBNBPLn@Jh@Ff@FfA?HBZ@N@NFRHJNNRX@@BR@j@Dv@@^@XDVDV@HBN?@F^?BF^FR@HDL^fADNRb@@DT\\@BP`@BDd@pAJ`@Lb@f@fBN`@Xt@Pd@@@bApBDJrAvCP\\tAdCHLJVHNp@|A@@b@`ABF",MF28:"wokxMglznAVo@v@zE@BhAlGZnB`@pC@LX~Az@rE?D@BXtATtA@FdAfE?@p@zC`@nA~@tCf@tAXh@HRb@nAvArDTx@DHZv@j@|A`@dAP^n@fBb@hAd@~@nAvCb@lAd@fALZPj@Vh@?BTp@Xt@@DZbABFVr@V^t@QF?F?@?D?F?B@B@BB@BBFFNPt@Hp@@DR`ARx@Nj@Nt@JVHTHXNf@DP@B?J?TDRNt@@D@P?B@L?J?BBXARE|@A~@Dj@PfAHh@@DLl@\\lAR~@`@fA_@t@ET?D?@?BAL@b@?L@X@^Dv@Dl@?LFhAFdAAb@@XBZ@NXvCB`@Bd@F`BBb@HlBFbAHjBDfAFrAIPeBjCaAzAe@v@Wb@_@l@sCbDEBYXUVgBjCoAvBm@dAg@r@g@z@_AnBeAhBcBfDUPCB{@hAA?A?A?A?A?A?A@A??@A?A@A@?@A??@?@?@A@?@?@@@?@?@@@?@@??@B@BBD?B?D?@A@??A@?@A@A?A@??A?A?A@??A?A?A?AA??A?AAAv@mA@CLWbBgDdAiB~@oBf@{@f@s@l@eAnAwBfBkCTWZDHBF@F@FBRHj@\\jEdDp@f@ZN`@J^Dj@Bt@?f@@pACX?`@AfBCdHQpDItFKl@Ex@I?@@@?@@??@@??@@?@@@??@@?@?@?@@@?@?@?@A@?@?@A@??A@?@A@A@A?A@??A?A?A@A?ArJENzBBh@Dz@BXFh@b@bAJLT`@f@~@z@vAV`@fB~CJPf@z@V^`BpBHJJFVNp@`@XTPPZ\\FFBHBH@H?N?REt@CH]tAALA^@ZFXRt@\\`AHV@Zf@rAj@dBPf@dAfDb@rAX|@LTJRHFHLDBVNXJTJpB~@l@VvD`B^Rd@VFFDHDDDJBRjAvEp@vDzA|FVh@GPCLEJEFC@MJOHOJIFED?@A@CF?@?Xa@R_@Pe@Xm@n@}@h@{Ap@_Bv@_@PoCpAOHPZLIZKzBeALGnB_A`Ae@hB}@pBcA~@g@LCFANGh@WdBy@v@_@z@a@xEeCn@]f@YjAm@VK^QPGNGn@St@SNEpASXGbAQ@?hB[z@Mp@Ip@Il@KZE`@KREbAWt@Y`@Ob@SFEfD_B|FiCz@a@|As@@?dBy@RK`Ac@BFjBy@FE`Ac@~@a@bEmB`EiBL?N@F@FBJD@@Dv@BX@X?F?J?J@h@?f@?x@?j@EhAGlA?D?RAl@?pA@LDbA@J@BBV`@fBDd@DPb@hE@hA?j@?RC`@CFId@e@`BQr@M\\YbAs@hCUv@e@nASp@ERITc@tAGNw@bCOd@]nAY`A[`AGPM^]jAe@|AAHYfA?BENg@xASr@g@bBOl@O^S`@Ub@GFEFMLQLUJcB~@sAr@i@Vg@Vg@PDJn@r@n@n@VVZZpAhA~AvAt@l@n@d@ZXZZd@\\XXJLFNb@pA@BTt@X|@Vt@KJCHAHADATCr@?HAp@A|@CpA?bA?V?VAj@CtAGn@AFQrAWrAKj@G\\Ib@Ml@S`AIl@AHu@nC_@PEBSRCDAB[b@EDCDIFGDSXMPEHGNGX?@AX@XDjAEHqATu@Lw@BcAH_@@K@O?Q@I?i@@G?I?G@QByAVUD",MF34:"_fgxMi}pmAeFgHuEuEKe@fKoAvLwAlJiD`J}@~NCxHV`Cy@dBaAhD_AlCxB`B~@|B`CpBZxK{@dIaChBo@hAyAtQcEpImCzGmAfGc@pIWhIKfERjEs@vDeBxHsHhI_HbFcFdI{GtB}AzEeAtZsMjHuCtJuBnGqAtBuAvDeDzGeCaDy[FeAj@iAaDwGKyAOaC^kEb@}ByAkOeBiBNmBqBmKzFaBtA}B`AmHnFuJtAiCgHqF",MF36:"iqexMc`omAtA|Cl@nANXf@~@FHHPJRJRpA`CLNJRXf@JNTf@Vd@HLFJ\\d@RX?@b@n@p@v@XVRPHJRRHFNN~C~CVTzErEr@r@HHxAtAXZPHJJJJNP@@HJzAzB\\d@FPHVJf@Hh@BNDXBVBb@Dv@DfARjE@p@@RD\\BTDTHTJTFNRGHAR?b@?D?HAJAHADCNELINIJKNQ^i@FKFEHGDEHEDCFAZK^IXIZKLCLCLAD?H?`@?B?X?f@?f@BP@J@JBLBJDPFVLb@Lz@TB@LDPFPHNJTNTPPLFDNLRLLJDBFDHDXJRFTFTDXDXDr@FZDJBJBLDB@BBDDFL@@BJBJBd@H|@BVBLBPDPFPJVR\\BFd@j@\\b@BDV`@BDHRHVFVDJVz@DHLPNPNNl@r@XXHHNNRN\\VJJHHBDBFR^Vf@JP^n@NVLRFHFHFDB@B@@@B?F@H?NANCx@KTCRAR?J?x@J\\DH@J@N?V?TANANATC^GHCb@I|Ag@FALELELCJAHA`AEBAb@Ap@EFA~AKh@CJA@?HAPCLALEd@MDAXMb@OZKPE@A\\IXGVEVCRCDAXC`@CN?N?N?J@H?JBLBNFRHNHPJNJVPLLB@XZh@h@JJFJDFBHBFBH@H@LBR@RBL?@DPBFBFHLFFFFHHNJVNNFPFLBN@H@D?NAPAPCREPE\\QJKDGFMTc@LYHSDEDKHKDCBC\\YJKHGLQ\\e@f@k@HKJIJGJEJEFCx@Sd@KVGPE`@MZKVGHAJAH?J?H@F@J@PBx@Pz@Rf@Jh@Hb@HD?NB`@DNBP@t@Bd@?j@@B?N@|@FJ@V@f@BV?L?D?T?@?NAt@CPAlAAdADF?F@J@FBB@B@BBBBDLFHBBBB@BDBH@J@L?Z?rCKJ?VCJAVEn@O^GZEREVEnASb@Id@GPETCNCHAfAKTCh@Ex@KJAVEr@O`AQzAYFAH?H?X?x@CD?h@?b@@v@HL@D?D@B@FBFDDFBDBF@FRvAFh@DP@DBJ@DLd@DPHVJRf@j@FJDFHFFDH@nBDL@J?H@NDHDLFFBFFZV~@t@NJLDH@J@F@F@J?\\AdB@H@B@B@B@DB@D?F?j@DNBHDHBBBDDDFBLDP@P?V?`AC\\A\\AT@P?L@B?B?B@B@D@DBh@^NHVHZFXFPDF@FDFFPLb@d@@@NLDBHDF@HBF@F?^?dBB~@?@?^?TATCl@MJCJERG@AFCHEHCFGHGNOVW^e@d@q@^e@T[dAeB@CJOHGBCDCLELCf@Ib@K^KPKLIFEFGJCNMNKZ[hBkBh@[`@[x@m@`@WNK\\ULGHGVMb@SFCHGBCb@WPORQn@q@HI@?HININIDCFCPEhA[FCl@QRELEb@GJAJAb@A~@?j@GJENELGVK^Yh@_@VMBCPI`@QhAc@LGHGJEFENKPMTQ`@_@HOrAiCLWN]XiABMLw@Hc@Hi@Lo@Rs@Vy@Hc@DU@S@YBm@D}@Ho@F[BQ@ERcANo@J]HWHWLYr@iBPc@Nc@\\eALm@Ji@Fa@@O@IFg@Ju@Fa@Da@B[Bo@@E@GBG@EBE@A@ABEDCFEFCDCFCBAJEFE@AFE@AP_@Zs@FMHODIBEDCXWd@_@r@o@ZUJKNOd@c@d@_@ZYp@m@Z]b@c@NO^e@Za@NQZ]LMVULMVURQLMJIDEHIBALKNMl@g@|@w@fAcA@A|AuAjD{Cr@m@^Y^YVQDCNKXWLMJMX[VSFEDELEJELELE`@MDATEVEREPCLCZGHARC`@E\\ERADANCHAHCHCFGHGDI@CDKTc@HKXo@TYl@i@FEHMDG@I?UE}BE{@?K?CBK@K@CFKHILI@AHEJCNAVCrAGRAt@CPCVAZEh@GVAf@K`@O^W@A^[b@_@LQJQJSJQ?CLYl@iA^w@FQ@Aj@y@j@oAzAiCP[DEDGBCJOFGJMJIx@q@TSRSDGHIPUp@}@NUNQXc@v@gAXc@JMBGDIBGBGDK@M@OAUAQ?IEy@A_@?Q?O@M@MF[FWHYHSNY?AJQPSX[PQLMHGTQ^WPMTOVSNMBCNOJMFMNYR_@Ra@BE`@u@JQBEl@cATe@FIJS\\c@",MF39:"gcbxMkm}mAGA_@IgAYDI^cAJc@d@o@V[V_@TYPMHITOXQHCJGVKZKb@MrEsATITIp@Y^QRMTOb@Wb@YfFeF`AiAJMZ_@Z_@lBgCZk@NUDGBCR[PW@ET_@^OjDcGx@sA^m@nAuBHOzBwDDEj@aALQdAiBR[P[jB{C\\k@Xi@pA_CPg@|AgE`@qAPo@Po@Rw@DOHi@Jq@BUDW?E@CBE@?@?z@MDRBHBN@HBH@LBL?BBH@NDP@JBLDNDNDJBFFFHFHD~Az@JDb@TzAx@JFHFJFHHFD@@NPNNVb@Vf@LTHPRv@Jj@RnAFTHb@Px@Lf@BJDHDPFPHNHNLT@B`@t@@@`CjELPb@l@Vb@b@p@^r@@@b@x@@BNZXh@FJDJDJFJDJb@lADLHNFRTt@\\jA^rA`@bAJCv@A^CHA`AA`ABN?j@IBAZCb@Qx@a@HC@Al@WDCJEFCLCRE^GREFALCHAHCDAR?r@Gr@E`AAH?p@EP?n@?J?n@?RE\\GREBAHA`@GNCXIPCLAN?n@JVHZJbAXz@Tj@TnDLh@?P@H@r@FN@R@dDBdCEVAlBCzCA~A?rEG|A@d@?R@BOReBVaBDYDa@`AiGD_@D]Bk@`H{@tCa@rDe@rEq@vEq@hGy@NdBNzA@RPCj@Mh@Md@G`@Eh@Ah@Ab@MN@^Fl@L`APTDH@ZDTD`@DD?P@l@Bn@@H@B?B?FBD@DBHFVV",MF40:"czzwM{ubnA}Tj@mCbN_@n@PzDiBFZrFmAlI_ENgFtDiDReC~Fk@pBk@Ns@ZFrEgHN_E|BB?yDxBqD`CsF_AcGeBiCmByBeCaDr@{F?{E_@{D[wDs@aCo@y@OcFNeC^uCnLmA|CeBjEwFlJ_G`JgHdLyDjHkEfEeClCwDpCiA`AsGpBeCn@aD~DeAr@",MF42:"selwMekcnAqCjCqDtBa@D_Md@gIFyIfA}KpB}ANiIGuH^aE|AyBj@aDj@eJf@oD?gH~@uDfJeAlB{@fA}ApCs@tIg@zGiAtJF`IeA~EWv@eBhBo@hBGxBr@hPRvE_@pCmApDk@dBiC|BiBpDo@|As@fEqArEs@`AqClDyBtAaB|AeAxAwExAsGF}@lD}a@mBkGkFeQNii@pK{TnFyBlBWf@iCW[}BmCKaBdAeCtAqCSeC^w@J_FNyK[qBCsFiAk@?mAv@w@hBuApBc@~@qAn@uCb@gEpDiIxKy@hAeDb@eDj@qC^{Er@uDj@aBhCO|C_ApC_@tAiA|AkFhBqAr@wDtA{@~@[lB_@pAuBtC{FjHkEbFmAlDeBdDkF|Cq@r@zChJpAzG^tCWtA{@NyBMoD{@uEGaESWIgEwLgHqF",MF45:"m~fxMsjdnA{BmG{CeDrA]nJkCsBgJ`KJvLkAfHc@tA|Hl@jAf@^NnAfCzBrEVbA~DzFUnAhGjIKr@hCRvEtC~G`BhJNf@o@|D[lBGhDf@j@v@f@^dBtBn@dAv@vGOlAvGtCxAn@`ApB~GaClDc@tCFdJ{@~EyB~FsEvFmKzOoFlHgFtBaIhB{E`BwElCyPj\\sGvMmAjEaJbEyZvO_PxKsGrGyYrTsG|C{WzHaLtCaJlAuDfAgOtByAnE}AdBsDxAgEhI{HvVeB^kCRuD}CiCuBqBw@iAGo@SgAiCuDs@}A@_FOmBu@DaC",MF1K:"sbryM_dinAIWAEG]COCSEi@CSASCWGm@Gu@AK?Q@QDi@Dc@BYD[BYTsBXkCBWDWN}ANsAHi@Lw@b@oDF_@?GTgB\\cCLmANuALy@L{A@A@u@?u@Cu@Ee@K{@EOCOAAMc@KUEIKU]s@GMAEGIGKACg@aAgAyBcAyBc@aAgB_Eo@uA[s@o@sAg@cAe@_Ao@yAi@kAeA_CO[KYO]Qg@Us@K]GQQo@Ie@Os@QgAAKCMYmBI}@AEIw@Ge@Gm@C]?MAc@C_AAq@AW?KAk@?o@?OBgC@cA@_@@WHwA@[Bm@?QL}BHeDBq@HwABq@HsBB[@Q@OFi@@MB[BMD]D[DSJm@BSXqADUFSNm@`@iAHU^{@DIn@qA@?FSZq@FMBIJU\\s@Vm@j@uABEb@}@@C`@_AZo@Xq@`@_APc@Ja@Ja@Hc@Hk@Fi@Bo@B}@MCOAG?E@GBGDeC`BsAz@SLcC|A_C|Aa@VqAp@_@T{@d@GBm@\\[JkC|@o@X]PAB_Ah@_BfAq@h@y@n@UTONOTAB[`@SPODOHE@YFKBO@g@F_@B_BLa@D}@FUBk@DE@]Hm@VKFYNq@\\]J_@Hk@Di@DE?]?U?KCWKMKqAgACE",MF2:"kfbyMecjnAa@AC?K?c@AiA@e@?c@@A?k@?g@Ay@EcAIiAAiACc@?A?_@?i@@o@By@DMDSFUJIBQJMFCBMHSTOTQVeAnBcApBu@vA]n@CDkAvBu@rAg@~@[h@MRg@v@[h@oAnBk@|@i@x@iA~AQZ_ArAYb@QVU\\SVSXOROTiA`BsBxCSZ?@SZ]f@cAtAg@t@Yb@KPILOZu@zAk@hA_@|@i@bAc@`AO\\{@dBEJcAlBaAlBINu@vAk@dA_@r@wAnCoAdCaAdBQX[j@EFINEHW`@ILi@bAOV]n@GLs@tACDcAjBsAjC_@p@EJWf@A@k@lAKTKRy@zAwCvFgArBILk@jAOd@KTm@dAEH}@bBgAvBU`@y@zAEHaAlBMXS^EJ]r@q@rAi@dAWf@aBbDyApCCDiAxB{AdCk@fAQb@Q^]bAKXMn@Eb@InA?Z@`A@^@^@VFlA@XFjBH`APpCBb@D^JfALrAd@nFj@hFDf@KLKFEDINILCHCLAF?L@H@F?BFh@@@@H@J@H@F?@@D?F?F?N?F?F@dA@lA?`AEp@K^]@a@Be@@iCJu@BcABuABK?gADmBFA?q@B_ADkL^kIVkAN]Ba@BqCFuAFuBLaADA?c@BgABE?}CCM?]EU?qDLo@@W_Ak@oBOm@So@IWGOEUq@wBOe@GUCOG[Ma@UkAo@aCESOu@QcBCc@Gk@GmAAOG]Kq@Ia@IYKUMSUc@MQi@cAi@cAmAsCk@sAGQQw@G[CY@W@a@D]F[H_@L[P[V[TUJEXUd@Ud@SNGfA]PC`@ONGNCDA`AG~@CZ?hACfCErAIJ?@?JCPIDAXQXWV[BGP_@FSNa@Rm@Rm@Pm@Rm@BKZu@Vo@JYJ[Rk@Tw@?CJ[FURu@R{@b@wABKJW?CFUDMBG@]zAmF`@}A`@{AjA}DDQLi@f@mBfBsHZsAt@sC@GXkAFYTiAHYZkBh@wCJk@Lq@F]JeA@?B}@@OBs@?aA@_B?k@?A?a@@}BVkABM@GZwA`@kBxAoHJ[Jc@DMH]TeAReAVqAH_@Pw@\\{AFUTiANq@zAkHB_@NAb@A^CXA\\ELCNCZEp@MpB]@ArAS\\G|AW`AQ`AQjB[hASn@Kt@Mh@Ib@IlASx@OfAQr@OdBe@lA_@b@MfD[lDUB?dAKh@G\\Gf@Ih@M`@Ov@Wd@Q|CaAlAUv@Od@Kh@O~Bo@jCq@n@QtAg@hEcBh@QFELG~@a@DCLEZSNMPMVUt@u@TWBERURULMNM^]PKPOJIPIb@WVOf@UVIXKHANCVCB?x@GH?j@EbAEz@En@Eb@AX?b@A^?RAd@?n@AfA@`@?h@?nAAvDGp@?p@@H@D?LB\\D~@?dAAbA@nADj@Af@Bp@@b@BX@b@?xBEz@CN@L@d@HXJ",MF23A:"iqcxMewqnAkBz@c@PkBx@eAd@A?KDqB`A_@P]Pq@wASc@O]q@uAk@sAw@kBUg@_@_Am@_BKWo@}AAC_@{@EOu@sBQe@]w@KUe@sACE?AtA{@~@i@bBcArA}@x@g@@?p@c@r@c@n@a@dAs@CECEsAyBiA{BSm@U}@IY_@iAWu@IU[u@Uc@MOQOUMUMYMe@SYOqAi@c@UYU][}EiDIIMIKGICMEQEg@Ks@KCAeB[q@OSGUMUOi@]SOcBqA]W]Wa@YMIECm@Y]OMKIEGIGGEIOYo@yAWs@GMIOIMIKICICUEYCy@I_AGA?eBEWCKAMASEMEMEUESEWCWAsAEs@@i@AU?iCFm@DwAJE?mHj@mGb@g@?aAGgAMeD]WE}@MSCi@Gi@GWCEAiAOw@GaAEQ?Y?o@Ah@m@^a@FGdCeCb@g@z@}@zBsB~JoKh@q@nAsApAwApCsC`BiBjAoA|@cAb@e@l@m@FGj@i@\\]HKp@q@Z]TU`@a@|@aAp@w@l@m@l@q@`BiBl@q@HKp@u@|@cALMbAcAVYJIJKnAoA@CpAuAf@i@z@{@PSd@g@F}@Da@Jg@B[D_@Bg@@OBsABw@?MlAM|Fm@\\Ch@CRCf@E`AM`@GVGbAI|@GHCHADAFCFCJGLGNKZUDCDEDEDCFCFAFEHEBA`@QdAYr@Mv@Od@MRE|@OhAQx@KTGpBc@VE\\Ir@SdAUTGrD{@XGHAJ?L?J?L?`@@D?@?HADAFAlA[VIv@Ql@OvBk@f@Q@?^M`@Ud@]n@g@HMBG@C@C@E@IGi@SgBKy@?AM}@Ga@Ca@AOAWAO?G?i@?M?_@?a@@_@BUBMDMDMLSDIHMRW\\_@\\]LKLOHMn@_@LEdAm@`@Wt@O`@GNAd@ETAHA^Ef@EHABA^GXGVCTA\\?P?\\@L?X?^Al@Cv@IB?D?n@CbACJ?b@A^A|@Ej@CJAp@EnAKdCMp@?R@H?F@F@PDRFrHpCXB`@Dr@DhBN`A_@LId@[h@a@^Wp@e@LIb@S`@QRGh@Md@ITEd@IrBYTABAHAPAN?TFVDHFRLTb@HLHFFBHJV^h@x@V^FJBBl@j@PNAD?B?BGJIJGFKLeA~@{@t@]\\KJIHSR]ZQR[Zo@|@cA~Aa@d@STONOLIHEBUT}ApACBCB?BAB?F@F@JNV@BRVHJ^f@JLRXV\\TZV^`@h@RXJLDFFHLRHPDHBJBHBJ@HBH?PAH?F?BCHAHG\\GTKb@ELIVELO`@Qb@ADIR]x@GRGPCLCHAHAFAH?D?JANBPF`ADz@d@tFHn@Dp@Hv@B^Hl@Fr@F`@Ft@D\\@t@?HAD?BABEJc@r@a@v@g@x@ETcC`Ei@t@S^]n@IL_@r@cAlBE@C@A@AB_AfBq@nAYf@GLOVYh@Uf@MZI\\AJ?NARAb@?RAV?XCb@OfBG~AG~AC~@ATGz@Ev@Er@SvAI^I^EX?BE\\EVANCt@?DC^IzAEfA?BC\\Ch@ADC\\Gl@SjCGr@E|@Ad@@ZBr@@VDjAD|BDdA@PD~@FzABV?R?RARAXCRCTCNGVMx@Mz@I|@G^GXAd@@R@P@FDXFRRp@^fALb@HVNf@?BFPPp@BHs@N_@Fy@PA?m@NSF_@Jk@Rg@Tm@Vc@R_@PE@iAf@yAl@kA`@iAd@k@R{@VE@u@TaB^eCj@[Hc@JcATc@J}Bh@AIm@LeAV]HSDc@JUHmAd@OFOH_@P_@T]TA@YT]Xs@p@a@^e@b@SNSPYVGDWRk@b@MH_Ab@y@\\IDA@_@Pe@R[N"},uN="#4264fb",cN="#aaaaaa",S_={type:"line",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":cN,"line-width":{type:"exponential",base:1,stops:[[10,3],[14,8],[18,3]]}}},hN={...S_,paint:{...S_.paint,"line-color":uN}},fN={...S_,paint:{...S_.paint,"line-color":["get","colour"]}},dN={type:"circle",paint:{"circle-color":"#ffffff","circle-radius":{type:"exponential",base:1,stops:[[10,3],[14,8],[18,3]]},"circle-stroke-width":2,"circle-stroke-color":["get","colour"]}},pN="ccryMkiinAv@lE|@lEH`@|@fEHZHRJXHNLVPXhA`BfEfGXb@Vb@Xh@Xp@Tx@dBrFPj@hAjCZ`BdAhDj@hB`@~@Zd@Z\\\\X\\R`@PXH`@J^F^D\\@ZA`@C`@GpEiApD{@fD{@`FsAvAa@rCy@~@Ul@MlGeArUyD^EPARArCA~E@hDAtB?bD?x@Cp@E~@GhE_@hAG\\AV@`@F`@LPHPHRLd@d@bA`BNTXXPN\\Vj@XpDdBb@Vd@\\n@h@r@v@h@l@~ApBbArAj@x@f@x@b@bAh@bBJh@Hj@RtAXlBJv@LjAFd@D`@Bz@?ZAh@EhBAj@@n@@|@BpBBVDVDNJVJPJNNNJJLHJFNFVHTDVBV@Z?fBIvFSvCQ`AGRCPCXCZE\\ChEShJg@xFUtEKhDO`AEjBQrCS\\ElAKjGc@hDUx@GdDUzAKx@?^CPC^KVI\\O\\SX]FIRe@Tu@n@eDNu@RgAf@oCd@iCVqBB_@@Y@WDuBBaB?c@BkA@w@Is@I}@Mu@_@iAUaA_AyBg@m@Ya@o@m@c@[m@[eBu@sAs@_Bo@eBcAuAi@gB_AcBy@y@c@_@YWa@K[AWAU?_@@a@@e@LW^w@VUd@UnBq@hCk@dB_@dAOvAUj@Ch@?`A?xBAdDGtEG|BEfDGxAAlAGvAM|@Ul@KfB]NCbAMx@QbAQlB]dB_@n@KhC_@`C]fDu@~@W`Co@VI^GxD]~E[~@I~@QhBo@d@Q~CcAxHiBbCs@rCaAfAc@pDwAzB_An@m@zAaBv@{@l@i@pA}@n@_@b@URI^Kf@I^EnCKxDKpCClD?dA?b@AzACP?P@`@Dn@Ph@J|@Nl@F~@HpAHvCHrDFpA@zABlB@d@AVBLBf@Nj@PnBl@h@Tz@ZnAf@n@ThAb@|@\\jAd@dBp@b@P`A^\\Nr@V|Al@xAj@~Aj@ZFT@R?R?P?Z@VBVB`@Hl@L\\HXJ`@N`@Nx@Zr@VdBh@~Cx@jAXdARpAVZD^D^Db@Bh@@f@@f@?d@ANAbBQTCx@Of@GVCTAVAd@?b@@\\@V@VBb@F^FRDb@Lf@PtBz@vB|@dCdAtExBjD~Al@X|@b@n@\\p@^VLZRXTd@^^\\p@p@p@l@PNRJRJXJ\\Hd@J~@Pb@HzAXTDbCb@pF`AlB^l@JrATn@LZFTFVHRHPJLHLJLJLPJNHNFNFLFPDNDLn@fDFTDNFNFLHNHLHLHL`@l@p@`@r@ZvEpArC|@xBn@dCr@fDbArCz@pGlBl@V^^ZXPh@F`@Db@ApBe@lT@f@Ff@Xt@X^XTd@Vh@Lv@DnEBtDD`]\\x@A`Sy@r@Ed@D`@Jf@Vn@Xx@b@~@d@t@h@l@j@lBdDz@pAf@p@^j@`@d@tBpAbAl@fNfHxAh@bAXlAX~AVr@D`ADr@BnAB|ADz@Cj@Ef@EtG_AtYcEhASzAYbAOv@KvK_BlASfAUr@Sr@MfASfDe@`Fw@|B]bNoBn@Mf@Qp@[`@]b@w@\\eAxAyFZw@Tc@X_@Xa@RYRU\\Y\\Qb@M~EuAj@OhDo@rD_AdAYbASt@Mb@ENAt@Ez@@`@F\\HvAp@dAp@fBnAfA|@dAfAnDhF`CbDd@\\h@Z|@^bN~FbCv@fCt@PF~FnBf@PtCxAlGxCfBz@jAj@l@Rf@Rd@Fj@?t@O`Bo@fMiEjKaDpAUNClEg@~AUfGSnHWfEUhFOxL?d@@zCJnBHj@D|Id@xADx@BfAAtBMvBEbBCp@E~@ClA?~AAr@?lABfABtADh@@bABbABjA@x@@z@@t@?v@@pA@z@BnA@tA@v@D^Bj@Fb@Lh@Rd@V^Tf@Z~CzB|AfAh@Vd@H^Bb@?`@E\\GXKd@Yz@e@l@Y\\O\\K`@GZEXAf@Dl@JZFb@Fh@J\\D^@pABjAAzB?fA@r@@vAF~AFhCRxH|@bNdBbBZz@`@j@b@`@`@b@l@Tb@Pb@Pl@z@dDvA~Ft@~Cz@dCpErM`J|Wl@~B`@pAJl@Fj@?f@Gh@Sz@a@vAiAlD[v@k@|Ak@pBOx@U`BYdBQ|@Sh@Wb@_HbHc@h@KNKTcAzE_@`B[fAEX?BAd@@j@Fd@H^Xt@h@p@vBpB|@r@nE`Ch@T`AX|@PbHnA~IlB`DfAbDhAdB|@pAz@tBbBj@h@h@d@~@jA|@jAbAxBxBdDhAnBp@hAr@~A^p@xBhDvBbCfB~AVNdCxArAt@z@t@x@bAr@bA`Ap@tD~@~Bn@b@H\\F`@B`@@v@Cd@?l@?h@?h@?D?f@@l@Bl@DnE\\rADjDHnAN`AXfCr@pAZfDz@lA^bBdArJnJ\\V`@^jIlEt@h@ZZp@|A`@`Ah@`Ap@n@n@\\l@TxCp@t@PTJ~ApArA|A~AvA~HnF`C`BvEbEfDbDv@t@dBdBz@h@xAh@vC|@fIfDhB`Aj@d@`@n@Xf@nBjCt@r@fBnAjBnBr@nApBhFl@bB~@hAtAbAtAlAb@`@t@r@bBhAzAfAnBvAdEnChAt@nA|@`@^Xb@b@fAXzA^lBBLFRHRHPJPLNNLNLPJPHPFRFRDRBR@R?R?RAdCC\\@F?V@\\B\\D\\F\\FZH\\J\\LZLZNXPXPVRVPVNf@VXJPFfEjAb@JTD~AN^D^F^HZHZJXJrC|AtBjA^RTHLF^LZHdB\\vDd@TFTHRHPHPJPJNJzFrDtCjBp@h@d@j@^r@bCxElAxBxA`Bt@f@zNpGzC|AbDnBvIxE|F`D`BlAp@d@bA|@",mN="ybexMsinmA_AsA_FoJQ]Ua@_@u@cAqBYo@aAkBm@cA_Ao@{BqAaCuAqAcAiAeA_@c@sFuHyCiE{H}K[c@_FyGmBgC_BwB{DeFs@u@u@s@eAy@{@e@y@a@wEcBoBm@aBw@q@i@s@u@q@_Ao@}AiAqD_DyJwDgM{@mCe@gASYYSo@Yy@[cASoHiAwCg@wCm@iIaB[GiFcAgDs@uEkAq@M}Bc@mD{@o@MyEaAk@OaCo@{Ak@aDwB{@g@w@k@qBeB{@w@a@]aCiBWQqAgAuAoAOMoEwDoBaBuBgBwCmCqCqCoBoBwA_B_AgAwBeCiCuCsA}AqAcBsDwFg@eAWq@IOWoAKe@q@sDM_AEw@Aw@D}@`@{ED]@k@Ck@Eu@KqBEoA?o@Bk@De@Bs@JsAPgDTeCF{@FcBJyKBuAAo@GeAKkAIw@]}Ag@_DMeAMqAQeBKoBMmBOoAIc@Qe@]e@]Wm@[YIa@G]Ca@?eA@aHDe@@c@Da@Hi@Lc@Li@N]Fa@F_@Da@Bc@@]?YA]CYCYGOESISKOMMMMMKQIOEMGWESCQA[?YBgH@yD@_B@_D@gGBeH@cH@{CJuM@_DHsPByPBiM@mG@mB?_M@oF@iQ@iB@q@D]DULYR_@\\[j@[h@Od@GhOBdACx@Ct@Ev@EdAGv@If@MVKTOVSNURc@L_@F_@BYBqE@uH?aHDcNHaD?m@Cm@Ik@IYoA{ESaAq@kCg@sFi@yGGuE@s@Ds@Fm@ToAXeBLaCGwFAmBUsHAw@PmA~HqUR_ADiAEiK?mDRaF?kBL}@Pe@nAyCZq@LWJe@DUDwE@{@IuIK{LHgGBaBH}CJy@Lm@^gAn@kAz@mAbA{A~EwHlBwClBiDxCwElDuFj@o@\\Sd@O^Ej@@v@Fx@Jh@FT@VAZAjAIdAMnAOn@Ib@ElFYf@GZGTGn@QrFmB~DmAtHmBjCc@lBQzAEjA?`ADvANzNfB`C^|@Hp@?p@Mn@Sd@]d@g@Vo@NeAx@kIz@sKtAsNR{BTiBN_BBiAAiAGw@C[Gw@m@eDKcAOs@IYOc@Oa@OYOYU]QUSUSUSOQMSOg@YSKa@S_JaEuCqAy@_@a@W_@a@We@O[COCOCUBeABu@BuAHkCDuBFsADi@Fc@TqAx@sEf@cDJk@J[dAeCvAiDv@cBj@gAP[RUVYb@]XQ^SzFqCjI}DtCuAfD{AnOoHb@STMb@Y`@UpCqAdD}AtCsAnLoFrDgBvF}ChF_DzLeGzLaGhAc@hBm@v@S|GkA`Fy@t@QjA]dAc@rCoAfB_AnAk@lGqChO{GnDqAtFcCVQvJuIx@[zUwFlFsAtAg@`LwExB_AfRqD`TqFdBe@~EqAtBk@dI{BtNyD",gN={type:"FeatureCollection",features:[{type:"Feature",properties:{colour:"#e542de",name:"Purple Line","name:kn":" "},geometry:{type:"LineString",coordinates:$E.decode(decodeURIComponent(pN))}},{type:"Feature",properties:{colour:"#009933",name:"Green Line","name:kn":" "},geometry:{type:"LineString",coordinates:$E.decode(decodeURIComponent(mN))}}]},_N={type:"FeatureCollection",features:mn.map(D3,l=>({type:"Feature",properties:{colour:l.line==="purple"?"#e542de":"#009933",name:l.name,"name:kn":l.name_kn},geometry:{type:"Point",coordinates:l.coordinates}}))};var P3={exports:{}};(function(l,u){var f={};(function(y,b){l.exports=b()})(Rd,function(){var y,b,C;function P(F,k){if(!y)y=k;else if(!b)b=k;else{var ot="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+y+")(sharedChunk); ("+b+")(sharedChunk); self.onerror = null;",ft={};y(ft),C=k(ft),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(C.workerUrl=window.URL.createObjectURL(new Blob([ot],{type:"text/javascript"})))}}P(["exports"],function(F){var k=typeof self<"u"?self:{},ot="3.1.2";let ft;const X={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(ft==null){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ft=f.API_URL_REGEX!=null?new RegExp(f.API_URL_REGEX):e}catch{ft=e}}return ft},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!X.API_URL)return null;try{const e=new URL(X.API_URL);return e.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":e.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},zt={supported:!1,testSupport:function(e){!we&&Ht&&(mt?at(e):Lt=e)}};let Lt,Ht,we=!1,mt=!1;function at(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,Ht),e.isContextLost())return;zt.supported=!0}catch{}e.deleteTexture(t),we=!0}k.document&&(Ht=k.document.createElement("img"),Ht.onload=function(){Lt&&at(Lt),Lt=null,mt=!0},Ht.onerror=function(){we=!0,Lt=null},Ht.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const xt="01";function It(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Xt=ue;function ue(e,t,n,r){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=n,this.p2y=r}ue.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(t===void 0&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var n=e,r=0;r<8;r++){var i=this.sampleCurveX(n)-e;if(Math.abs(i)<t)return n;var o=this.sampleCurveDerivativeX(n);if(Math.abs(o)<1e-6)break;n-=i/o}var s=0,a=1;for(n=e,r=0;r<20&&(i=this.sampleCurveX(n),!(Math.abs(i-e)<t));r++)e>i?s=n:a=n,n=.5*(a-s)+s;return n},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var oe=It(Xt),me=Nn;function Nn(e,t){this.x=e,this.y=t}Nn.prototype={clone:function(){return new Nn(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=r,this},_rotateAround:function(e,t){var n=Math.cos(e),r=Math.sin(e),i=t.y+r*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-r*(this.y-t.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Nn.convert=function(e){return e instanceof Nn?e:Array.isArray(e)?new Nn(e[0],e[1]):e};var nt=It(me);function Re(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Re(e[n],t[n]))return!1;return!0}if(typeof e=="object"&&e!==null&&t!==null){if(typeof t!="object"||Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(!Re(e[n],t[n]))return!1;return!0}return e===t}const ds=Math.PI/180,Ni=180/Math.PI;function Ae(e){return e*ds}function dr(e){return e*Ni}const Bo=[[0,0],[1,0],[1,1],[0,1]];function si(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}function fe(e){let t=1/0,n=1/0,r=-1/0,i=-1/0;for(const o of e)t=Math.min(t,o.x),n=Math.min(n,o.y),r=Math.max(r,o.x),i=Math.max(i,o.y);return{min:new nt(t,n),max:new nt(r,i)}}function He(e,t,n=0,r=!0){const i=new nt(n,n),o=e.sub(i),s=t.add(i),a=[o,new nt(s.x,o.y),s,new nt(o.x,s.y)];return r&&a.push(o.clone()),a}function We(e,t,n,r){const i=new oe(e,t,n,r);return function(o){return i.solve(o)}}const hn=We(.25,.1,.25,1);function $t(e,t,n){return Math.min(n,Math.max(t,e))}function Ui(e,t,n){return(n=$t((n-e)/(t-e),0,1))*n*(3-2*n)}function ci(e,t,n){const r=n-t,i=((e-t)%r+r)%r+t;return i===t?n:i}function Mi(e,t,n){if(!e.length)return n(null,[]);let r=e.length;const i=new Array(e.length);let o=null;e.forEach((s,a)=>{t(s,(c,h)=>{c&&(o=c),i[a]=h,--r==0&&n(o,i)})})}function hi(e){const t=[];for(const n in e)t.push(e[n]);return t}function re(e,...t){for(const n of t)for(const r in n)e[r]=n[r];return e}function fi(e,t){const n={};for(let r=0;r<t.length;r++){const i=t[r];i in e&&(n[i]=e[i])}return n}let hl=1;function su(){return hl++}function fl(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function dl(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Ic(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function Jn(e,t){e.forEach(n=>{t[n]&&(t[n]=t[n].bind(t))})}function ps(e,t){return e.indexOf(t,e.length-t.length)!==-1}function au(e,t,n){const r={};for(const i in e)r[i]=t.call(n||this,e[i],i,e);return r}function Ot(e,t,n){const r={};for(const i in e)t.call(n||this,e[i],i,e)&&(r[i]=e[i]);return r}function q(e){return Array.isArray(e)?e.map(q):typeof e=="object"&&e?au(e,q):e}const K={};function rt(e){K[e]||(typeof console<"u"&&console.warn(e),K[e]=!0)}function St(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function Dt(e){let t=0;for(let n,r,i=0,o=e.length,s=o-1;i<o;s=i++)n=e[i],r=e[s],t+=(r.x-n.x)*(n.y+r.y);return t}function te([e,t,n]){const r=Ae(t+90),i=Ae(n);return{x:e*Math.cos(r)*Math.sin(i),y:e*Math.sin(r)*Math.sin(i),z:e*Math.cos(i),azimuthal:t,polar:n}}function de(e,t,n){const r=Math.sqrt(e*e+t*t+n*n),i=r>0?Math.acos(n/r)*Ni:0;let o=e!==0||t!==0?Math.atan2(-t,-e)*Ni+90:0;return o<0&&(o+=360),[r,o,i]}function Pt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function xe(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,r,i,o)=>{const s=i||o;return t[r]=!s||s.toLowerCase(),""}),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t}let be=null;function Ee(){return!!k.document.fullscreenElement||!!k.document.webkitFullscreenElement}function Un(e){try{const t=k[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function Qn(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function Nr(e,t,n){e[4*t+0]=n[0],e[4*t+1]=n[1],e[4*t+2]=n[2],e[4*t+3]=n[3]}function tr(e,t){return[Math.pow(e[0],2.2)*t,Math.pow(e[1],2.2)*t,Math.pow(e[2],2.2)*t]}function pr(e){return[Math.pow(e[0],1/2.2),Math.pow(e[1],1/2.2),Math.pow(e[2],1/2.2)]}const Hn="mapbox-tiles";let ai=500,_i=50,yi,Yo;function lu(){try{return k.caches}catch{}}function ro(){lu()&&!yi&&(yi=k.caches.open(Hn))}function ms(e){const t=e.indexOf("?");if(t<0)return e;const n=function(i){const o=i.indexOf("?");return o>0?i.slice(o+1).split("&"):[]}(e),r=n.filter(i=>{const o=i.split("=");return o[0]==="language"||o[0]==="worldview"});return r.length?`${e.slice(0,t)}?${r.join("&")}`:e.slice(0,t)}let Zs=1/0;function uu(e){Zs++,Zs>_i&&(e.getActor().send("enforceCacheSizeLimit",ai),Zs=0)}const At={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(At);class Ct extends Error{constructor(t,n,r){n===401&&mr(r)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=n,this.url=r}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const kt=Pt()?()=>self.worker&&self.worker.referrer:()=>(k.location.protocol==="blob:"?k.parent:k).location.href,Ut=function(e,t){if(!(/^file:/.test(n=e.url)||/^file:/.test(kt())&&!/^\w+:/.test(n))){if(k.fetch&&k.Request&&k.AbortController&&k.Request.prototype.hasOwnProperty("signal"))return function(r,i){const o=new k.AbortController,s=new k.Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,referrer:kt(),referrerPolicy:r.referrerPolicy,signal:o.signal});let a=!1,c=!1;const h=(d=s.url).indexOf("sku=")>0&&mr(d);var d;r.type==="json"&&s.headers.set("Accept","application/json");const m=(x,v,w)=>{if(c)return;if(x&&x.message!=="SecurityError"&&rt(x.toString()),v&&w)return g(v);const A=Date.now();k.fetch(s).then(E=>{if(E.ok){const S=h?E.clone():null;return g(E,S,A)}return i(new Ct(E.statusText,E.status,r.url))}).catch(E=>{E.name!=="AbortError"&&i(new Error(`${E.message} ${r.url}`))})},g=(x,v,w)=>{(r.type==="arrayBuffer"?x.arrayBuffer():r.type==="json"?x.json():x.text()).then(A=>{c||(v&&w&&function(E,S,I){if(ro(),!yi)return;const B={status:S.status,statusText:S.statusText,headers:new k.Headers};S.headers.forEach((R,z)=>B.headers.set(z,R));const M=xe(S.headers.get("Cache-Control")||"");if(M["no-store"])return;M["max-age"]&&B.headers.set("Expires",new Date(I+1e3*M["max-age"]).toUTCString());const D=B.headers.get("Expires");D&&(new Date(D).getTime()-I<42e4||function(R,z){if(Yo===void 0)try{new Response(new ReadableStream),Yo=!0}catch{Yo=!1}Yo?z(R.body):R.blob().then(z)}(S,R=>{const z=new k.Response(R,B);ro(),yi&&yi.then(N=>N.put(ms(E.url),z)).catch(N=>rt(N.message))}))}(s,v,w),a=!0,i(null,A,x.headers.get("Cache-Control"),x.headers.get("Expires")))}).catch(A=>{c||i(new Error(A.message))})};return h?function(x,v){if(ro(),!yi)return v(null);const w=ms(x.url);yi.then(A=>{A.match(w).then(E=>{const S=function(I){if(!I)return!1;const B=new Date(I.headers.get("Expires")||0),M=xe(I.headers.get("Cache-Control")||"");return B>Date.now()&&!M["no-cache"]}(E);A.delete(w),S&&A.put(w,E.clone()),v(null,E,S)}).catch(v)}).catch(v)}(s,m):m(null,null),{cancel:()=>{c=!0,a||o.abort()}}}(e,t);if(Pt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var n;return function(r,i){const o=new k.XMLHttpRequest;o.open(r.method||"GET",r.url,!0),r.type==="arrayBuffer"&&(o.responseType="arraybuffer");for(const s in r.headers)o.setRequestHeader(s,r.headers[s]);return r.type==="json"&&(o.responseType="text",o.setRequestHeader("Accept","application/json")),o.withCredentials=r.credentials==="include",o.onerror=()=>{i(new Error(o.statusText))},o.onload=()=>{if((o.status>=200&&o.status<300||o.status===0)&&o.response!==null){let s=o.response;if(r.type==="json")try{s=JSON.parse(o.response)}catch(a){return i(a)}i(null,s,o.getResponseHeader("Cache-Control"),o.getResponseHeader("Expires"))}else i(new Ct(o.statusText,o.status,r.url))},o.send(r.body),{cancel:()=>o.abort()}}(e,t)},jt=function(e,t){return Ut(re(e,{type:"json"}),t)},Kt=function(e,t){return Ut(re(e,{type:"arrayBuffer"}),t)};function Qt(e){const t=k.document.createElement("a");return t.href=e,t.protocol===k.document.location.protocol&&t.host===k.document.location.host}const Zt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ce,Wt;ce=[],Wt=0;const Ze=function(e,t){if(zt.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Wt>=X.MAX_PARALLEL_IMAGE_REQUESTS){const o={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return ce.push(o),o}Wt++;let n=!1;const r=()=>{if(!n)for(n=!0,Wt--;ce.length&&Wt<X.MAX_PARALLEL_IMAGE_REQUESTS;){const o=ce.shift(),{requestParameters:s,callback:a,cancelled:c}=o;c||(o.cancel=Ze(s,a).cancel)}},i=Kt(e,(o,s,a,c)=>{r(),o?t(o):s&&(k.createImageBitmap?function(h,d){const m=new k.Blob([new Uint8Array(h)],{type:"image/png"});k.createImageBitmap(m).then(g=>{d(null,g)}).catch(g=>{d(new Error(`Could not load image because of ${g.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(s,(h,d)=>t(h,d,a,c)):function(h,d){const m=new k.Image,g=k.URL;m.onload=()=>{d(null,m),g.revokeObjectURL(m.src),m.onload=null,k.requestAnimationFrame(()=>{m.src=Zt})},m.onerror=()=>d(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const x=new k.Blob([new Uint8Array(h)],{type:"image/png"});m.src=h.byteLength?g.createObjectURL(x):Zt}(s,(h,d)=>t(h,d,a,c)))});return{cancel:()=>{i.cancel(),r()}}},Ln="NO_ACCESS_TOKEN";class ve{constructor(t,n,r){this._transformRequestFn=t,this._customAccessToken=n,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const t=function(){let n="";for(let r=0;r<10;r++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",xt,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}normalizeStyleURL(t,n){if(!Sn(t))return t;const r=Hr(t);return r.params.push(`sdk=js-${ot}`),r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||n)}normalizeGlyphsURL(t,n){if(!Sn(t))return t;const r=Hr(t);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||n)}normalizeModelURL(t,n){if(!Sn(t))return t;const r=Hr(t);return r.path=`/models/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||n)}normalizeSourceURL(t,n,r,i){if(!Sn(t))return t;const o=Hr(t);return o.path=`/v4/${o.authority}.json`,o.params.push("secure"),r&&o.params.push(`language=${r}`),i&&o.params.push(`worldview=${i}`),this._makeAPIURL(o,this._customAccessToken||n)}normalizeSpriteURL(t,n,r,i){const o=Hr(t);return Sn(t)?(o.path=`/styles/v1${o.path}/sprite${n}${r}`,this._makeAPIURL(o,this._customAccessToken||i)):(o.path+=`${n}${r}`,Vi(o))}normalizeTileURL(t,n,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Sn(t))return t;const i=Hr(t);i.path=i.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||r&&i.authority!=="raster"&&r===512?"@2x":""}${zt.supported?".webp":"$1"}`),i.authority==="raster"?i.path=`/${X.RASTER_URL_PREFIX}${i.path}`:(i.path=i.path.replace(/^.+\/v4\//,"/"),i.path=`/${X.TILE_URL_VERSION}${i.path}`);const o=this._customAccessToken||function(s){for(const a of s){const c=a.match(/^access_token=(.*)$/);if(c)return c[1]}return null}(i.params)||X.ACCESS_TOKEN;return X.REQUIRE_ACCESS_TOKEN&&o&&this._skuToken&&i.params.push(`sku=${this._skuToken}`),this._makeAPIURL(i,o)}canonicalizeTileURL(t,n){const r=Hr(t);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return t;let i="mapbox://";r.path.match(/^\/raster\/v1\//)?i+=`raster/${r.path.replace(`/${X.RASTER_URL_PREFIX}/`,"")}`:i+=`tiles/${r.path.replace(`/${X.TILE_URL_VERSION}/`,"")}`;let o=r.params;return n&&(o=o.filter(s=>!s.match(/^access_token=/))),o.length&&(i+=`?${o.join("&")}`),i}canonicalizeTileset(t,n){const r=!!n&&Sn(n),i=[];for(const o of t.tiles||[])mr(o)?i.push(this.canonicalizeTileURL(o,r)):i.push(o);return i}_makeAPIURL(t,n){const r="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",i=Hr(X.API_URL);if(t.protocol=i.protocol,t.authority=i.authority,t.protocol==="http"){const o=t.params.indexOf("secure");o>=0&&t.params.splice(o,1)}if(i.path!=="/"&&(t.path=`${i.path}${t.path}`),!X.REQUIRE_ACCESS_TOKEN)return Vi(t);if(n=n||X.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(n[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return t.params=t.params.filter(o=>o.indexOf("access_token")===-1),t.params.push(`access_token=${n||""}`),Vi(t)}}function Sn(e){return e.indexOf("mapbox:")===0}function mr(e){return X.API_URL_REGEX.test(e)}function wr(e){return X.API_CDN_URL_REGEX.test(e)}function Rr(e){return X.API_STYLE_REGEX.test(e)&&!xi(e)}function xi(e){return X.API_SPRITE_REGEX.test(e)}const mo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Hr(e){const t=e.match(mo);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Vi(e){const t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}const vi="mapbox.eventData";function cu(e){if(!e)return null;const t=e.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(k.atob(t[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ma{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const n=cu(X.ACCESS_TOKEN);let r="";return r=n&&n.u?k.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(i,o)=>String.fromCharCode(+("0x"+o)))):X.ACCESS_TOKEN||"",t?`${vi}.${t}:${r}`:`${vi}:${r}`}fetchEventData(){const t=Un("localStorage"),n=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{const i=k.localStorage.getItem(n);i&&(this.eventData=JSON.parse(i));const o=k.localStorage.getItem(r);o&&(this.anonId=o)}catch{rt("Unable to read from LocalStorage")}}saveEventData(){const t=Un("localStorage"),n=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{k.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&k.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{rt("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,n,r,i){if(!X.EVENTS_URL)return;const o=Hr(X.EVENTS_URL);o.params.push(`access_token=${i||X.ACCESS_TOKEN||""}`);const s={event:this.type,created:new Date(t).toISOString()},a=n?re(s,n):s,c={url:Vi(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([a])};this.pendingRequest=function(h,d){return Ut(re(h,{method:"POST"}),d)}(c,h=>{this.pendingRequest=null,r(h),this.saveEventData(),this.processRequests(i)})}queueRequest(t,n){this.queue.push(t),this.processRequests(n)}}const hu=new class extends Ma{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){X.EVENTS_URL&&X.ACCESS_TOKEN&&Array.isArray(e)&&e.some(n=>Sn(n)||mr(n))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=cu(X.ACCESS_TOKEN),n=t?t.u:X.ACCESS_TOKEN;let r=n!==this.eventData.tokenU;Ic(this.anonId)||(this.anonId=fl(),r=!0);const i=this.queue.shift();if(this.eventData.lastSuccess){const o=new Date(this.eventData.lastSuccess),s=new Date(i),a=(i-this.eventData.lastSuccess)/864e5;r=r||a>=1||a<-1||o.getDate()!==s.getDate()}else r=!0;r?this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ot,skuId:xt,"enabled.telemetry":!1,userId:this.anonId},o=>{o||(this.eventData.lastSuccess=i,this.eventData.tokenU=n)},e):this.processRequests()}},fu=hu.postTurnstileEvent.bind(hu),R_=new class extends Ma{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,n,r){this.skuToken=t,this.errorCb=r,X.EVENTS_URL&&(n||X.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(Ln)))}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),Ic(this.anonId)||(this.anonId=fl()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ot,skuId:xt,skuToken:this.skuToken,userId:this.anonId},r=>{r?this.errorCb(r):t&&(this.success[t]=!0)},e))}},Jh=R_.postMapLoadEvent.bind(R_),k_=new class extends Ma{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){X.EVENTS_URL&&(e||X.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:n}=this.queue.shift(),r=function(i){const o=k.performance.getEntriesByType("resource"),s=k.performance.getEntriesByType("mark"),a=function(g){const x={};if(g){for(const v in g)if(v!=="other")for(const w of g[v]){const A=`${v}ResolveRangeMin`,E=`${v}ResolveRangeMax`,S=`${v}RequestCount`,I=`${v}RequestCachedCount`;x[A]=Math.min(x[A]||1/0,w.startTime),x[E]=Math.max(x[E]||-1/0,w.responseEnd);const B=M=>{x[M]===void 0&&(x[M]=0),++x[M]};w.transferSize!==void 0&&w.transferSize===0&&B(I),B(S)}}return x}(function(g,x){const v={};if(g)for(const w of g){const A=x(w);v[A]===void 0&&(v[A]=[]),v[A].push(w)}return v}(o,Jv)),c=k.devicePixelRatio,h=k.navigator.connection||k.navigator.mozConnection||k.navigator.webkitConnection,d={counters:[],metadata:[],attributes:[]},m=(g,x,v)=>{v!=null&&g.push({name:x,value:v.toString()})};for(const g in a)m(d.counters,g,a[g]);if(i.interactionRange[0]!==1/0&&i.interactionRange[1]!==-1/0&&(m(d.counters,"interactionRangeMin",i.interactionRange[0]),m(d.counters,"interactionRangeMax",i.interactionRange[1])),s)for(const g of Object.keys($h)){const x=$h[g],v=s.find(w=>w.name===x);v&&m(d.counters,x,v.startTime)}return m(d.counters,"visibilityHidden",i.visibilityHidden),m(d.attributes,"style",function(g){if(g)for(const x of g){const v=x.name.split("?")[0];if(Rr(v)){const w=v.split("/").slice(-2);if(w.length===2)return`mapbox://styles/${w[0]}/${w[1]}`}}}(o)),m(d.attributes,"terrainEnabled",i.terrainEnabled?"true":"false"),m(d.attributes,"fogEnabled",i.fogEnabled?"true":"false"),m(d.attributes,"projection",i.projection),m(d.attributes,"zoom",i.zoom),m(d.metadata,"devicePixelRatio",c),m(d.metadata,"connectionEffectiveType",h?h.effectiveType:void 0),m(d.metadata,"navigatorUserAgent",k.navigator.userAgent),m(d.metadata,"screenWidth",k.screen.width),m(d.metadata,"screenHeight",k.screen.height),m(d.metadata,"windowWidth",k.innerWidth),m(d.metadata,"windowHeight",k.innerHeight),m(d.metadata,"mapWidth",i.width/c),m(d.metadata,"mapHeight",i.height/c),m(d.metadata,"webglRenderer",i.renderer),m(d.metadata,"webglVendor",i.vendor),m(d.metadata,"sdkVersion",ot),m(d.metadata,"sdkIdentifier","mapbox-gl-js"),d}(n);for(const i of r.metadata);for(const i of r.counters);for(const i of r.attributes);this.postEvent(t,r,()=>{},e)}},qv=k_.postPerformanceEvent.bind(k_),F_=new class extends Ma{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,n,r){if(!X.API_URL||!X.SESSION_PATH)return;const i=Hr(X.API_URL+X.SESSION_PATH);i.params.push(`sku=${t||""}`),i.params.push(`access_token=${r||X.ACCESS_TOKEN||""}`);const o={url:Vi(i),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(s,a){return Ut(re(s,{method:"GET"}),a)}(o,s=>{this.pendingRequest=null,n(s),this.saveEventData(),this.processRequests(r)})}getSessionAPI(e,t,n,r){this.skuToken=t,this.errorCb=r,X.SESSION_PATH&&X.API_URL&&(n||X.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(Ln)))}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||this.getSession(n,this.skuToken,r=>{r?this.errorCb(r):t&&(this.success[t]=!0)},e)}},z_=F_.getSessionAPI.bind(F_),Bc=new Set;function up(e,t){t?Bc.add(e):Bc.delete(e)}const $h={create:"create",load:"load",fullLoad:"fullLoad"},O_={mark(e){k.performance.mark(e)},measure(e,t,n){k.performance.measure(e,t,n)}};function Jv(e){const t=e.name.split("?")[0];return wr(t)&&t.includes("mapbox-gl.js")?"javascript":wr(t)&&t.includes("mapbox-gl.css")?"css":function(n){return X.API_FONTS_REGEX.test(n)}(t)?"fontRange":xi(t)?"sprite":Rr(t)?"style":function(n){return X.API_TILEJSON_REGEX.test(n)}(t)?"tilejson":"other"}const $v=k.performance;function cp(e){const t=e?e.url.toString():void 0;return $v.getEntriesByName(t)}var hp=Kh;function Kh(e){return!function(t){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var r,i,o=new Blob([""],{type:"text/javascript"}),s=URL.createObjectURL(o);try{i=new Worker(s),r=!0}catch{r=!1}return i&&i.terminate(),URL.revokeObjectURL(s),r}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var r=document.createElement("canvas");r.width=r.height=1;var i=r.getContext("2d");if(!i)return!1;var o=i.getImageData(0,0,1,1);return o&&o.width===r.width}()?(Dc[n=t&&t.failIfMajorPerformanceCaveat]===void 0&&(Dc[n]=function(r){var i,o=function(s){var a=document.createElement("canvas"),c=Object.create(Kh.webGLContextAttributes);return c.failIfMajorPerformanceCaveat=s,a.getContext("webgl",c)||a.getContext("experimental-webgl",c)}(r);if(!o)return!1;try{i=o.createShader(o.VERTEX_SHADER)}catch{return!1}return!(!i||o.isContextLost())&&(o.shaderSource(i,"void main() {}"),o.compileShader(i),o.getShaderParameter(i,o.COMPILE_STATUS)===!0)}(n)),Dc[n]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var n}(e)}var Dc={};let fp,Pc,du,Lc,pl;function dp(){return fp==null&&(fp=k.OffscreenCanvas&&new k.OffscreenCanvas(1,1).getContext("2d")&&typeof k.createImageBitmap=="function"),fp}Kh.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ze={now:()=>Lc!==void 0?Lc:k.performance.now(),setNow(e){Lc=e},restoreNow(){Lc=void 0},frame(e){const t=k.requestAnimationFrame(e);return{cancel:()=>k.cancelAnimationFrame(t)}},getImageData(e,t=0){const{width:n,height:r}=e;pl||(pl=k.document.createElement("canvas"));const i=pl.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("failed to create canvas 2d context");return(n>pl.width||r>pl.height)&&(pl.width=n,pl.height=r),i.clearRect(-t,-t,n+2*t,r+2*t),i.drawImage(e,0,0,n,r),i.getImageData(-t,-t,n+2*t,r+2*t)},resolveURL:e=>(Pc||(Pc=k.document.createElement("a")),Pc.href=e,Pc.href),get devicePixelRatio(){return k.devicePixelRatio},get prefersReducedMotion(){return!!k.matchMedia&&(du==null&&(du=k.matchMedia("(prefers-reduced-motion: reduce)")),du.matches)},hasCanvasFingerprintNoise(){if(!dp())return!1;const e=new k.OffscreenCanvas(85,1),t=e.getContext("2d",{willReadFrequently:!0});let n=0;for(let i=0;i<e.width;++i)t.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,t.fillRect(i,0,1,1);const r=t.getImageData(0,0,e.width,e.height);n=0;for(let i=0;i<r.data.length;++i)if(i%4!=3&&n++!==r.data[i])return!0;return!1}};function Fn(e,t,n){const r=k.document.createElement(e);return t!==void 0&&(r.className=t),n&&n.appendChild(r),r}function Ws(e,t,n){const r=k.document.createElementNS("http://www.w3.org/2000/svg",e);for(const i of Object.keys(t))r.setAttributeNS(null,i,t[i]);return n&&n.appendChild(r),r}const Ia=k.document&&k.document.documentElement.style,ml=Ia&&Ia.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Xh;function gl(){Ia&&ml&&(Xh=Ia[ml],Ia[ml]="none")}function pp(){Ia&&ml&&(Ia[ml]=Xh)}function Yh(e){e.preventDefault(),e.stopPropagation(),k.removeEventListener("click",Yh,!0)}function mp(){k.addEventListener("click",Yh,!0),k.setTimeout(()=>{k.removeEventListener("click",Yh,!0)},0)}function pu(e,t){const n=e.getBoundingClientRect();return _p(e,n,t)}function Rc(e,t){const n=e.getBoundingClientRect(),r=[];for(let i=0;i<t.length;i++)r.push(_p(e,n,t[i]));return r}function gp(e){return k.InstallTrigger!==void 0&&e.button===2&&e.ctrlKey&&k.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button}function _p(e,t,n){const r=e.offsetWidth===t.width?1:e.offsetWidth/t.width;return new nt((n.clientX-t.left)*r,(n.clientY-t.top)*r)}function N_(e,t,n){n[e]&&n[e].indexOf(t)!==-1||(n[e]=n[e]||[],n[e].push(t))}function yp(e,t,n){if(n&&n[e]){const r=n[e].indexOf(t);r!==-1&&n[e].splice(r,1)}}class Nt{constructor(t,n={}){re(this,n),this.type=t}}class Ie extends Nt{constructor(t,n={}){super("error",re({error:t},n))}}class Sr{on(t,n){return this._listeners=this._listeners||{},N_(t,n,this._listeners),this}off(t,n){return yp(t,n,this._listeners),yp(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},N_(t,n,this._oneTimeListeners),this):new Promise(r=>this.once(t,r))}fire(t,n){typeof t=="string"&&(t=new Nt(t,n||{}));const r=t.type;if(this.listens(r)){t.target=this;const i=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];for(const a of i)a.call(this,t);const o=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];for(const a of o)yp(r,a,this._oneTimeListeners),a.call(this,t);const s=this._eventedParent;s&&(re(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),s.fire(t))}else t instanceof Ie&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var ut=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class ae{constructor(t,n,r,i){this.message=(t?`${t}: `:"")+r,i&&(this.identifier=i),n!=null&&n.__line__&&(this.line=n.__line__)}}class _l extends ae{}function Qo(e,...t){for(const n of t)for(const r in n)e[r]=n[r];return e}function kr(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function qs(e){if(Array.isArray(e))return e.map(qs);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const n in e)t[n]=qs(e[n]);return t}return kr(e)}class Kv extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}var gs=Kv;class xp{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[r,i]of n)this.bindings[r]=i}concat(t){return new xp(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var br=xp;const $n={kind:"null"},ie={kind:"number"},fn={kind:"string"},vn={kind:"boolean"},Do={kind:"color"},mu={kind:"object"},gn={kind:"value"},kc={kind:"collator"},Fc={kind:"formatted"},Zr={kind:"resolvedImage"};function Ii(e,t){return{kind:"array",itemType:e,N:t}}function er(e){if(e.kind==="array"){const t=er(e.itemType);return typeof e.N=="number"?`array<${t}, ${e.N}>`:e.itemType.kind==="value"?"array":`array<${t}>`}return e.kind}const U_=[$n,ie,fn,vn,Do,Fc,mu,Ii(gn),Zr];function yl(e,t){if(t.kind==="error")return null;if(e.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!yl(e.itemType,t.itemType))&&(typeof e.N!="number"||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind==="value"){for(const n of U_)if(!yl(n,t))return null}}return`Expected ${er(e)} but found ${er(t)} instead.`}function io(e,t){return t.some(n=>n.kind===e.kind)}function gu(e,t){return t.some(n=>n==="null"?e===null:n==="array"?Array.isArray(e):n==="object"?e&&!Array.isArray(e)&&typeof e=="object":n===typeof e)}var Qh,vp={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function zc(e){return(e=Math.round(e))<0?0:e>255?255:e}function tf(e){return zc(e[e.length-1]==="%"?parseFloat(e)/100*255:parseInt(e))}function Oc(e){return(t=e[e.length-1]==="%"?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function Gi(e,t,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?e+(t-e)*n*6:2*n<1?t:3*n<2?e+(t-e)*(2/3-n)*6:e}try{Qh={}.parseCSSColor=function(e){var t,n=e.replace(/ /g,"").toLowerCase();if(n in vp)return vp[n].slice();if(n[0]==="#")return n.length===4?(t=parseInt(n.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:n.length===7&&(t=parseInt(n.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var r=n.indexOf("("),i=n.indexOf(")");if(r!==-1&&i+1===n.length){var o=n.substr(0,r),s=n.substr(r+1,i-(r+1)).split(","),a=1;switch(o){case"rgba":if(s.length!==4)return null;a=Oc(s.pop());case"rgb":return s.length!==3?null:[tf(s[0]),tf(s[1]),tf(s[2]),a];case"hsla":if(s.length!==4)return null;a=Oc(s.pop());case"hsl":if(s.length!==3)return null;var c=(parseFloat(s[0])%360+360)%360/360,h=Oc(s[1]),d=Oc(s[2]),m=d<=.5?d*(h+1):d+h-d*h,g=2*d-m;return[zc(255*Gi(g,m,c+1/3)),zc(255*Gi(g,m,c)),zc(255*Gi(g,m,c-1/3)),a];default:return null}}return null}}catch{}class oo{constructor(t,n,r,i=1){this.r=t,this.g=n,this.b=r,this.a=i}static parse(t){if(!t)return;if(t instanceof oo)return t;if(typeof t!="string")return;const n=Qh(t);return n?new oo(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[t,n,r,i]=this.toArray();return`rgba(${Math.round(t)},${Math.round(n)},${Math.round(r)},${i})`}toArray(){const{r:t,g:n,b:r,a:i}=this;return i===0?[0,0,0,0]:[255*t/i,255*n/i,255*r/i,i]}toArray01(){const{r:t,g:n,b:r,a:i}=this;return i===0?[0,0,0,0]:[t/i,n/i,r/i,i]}toArray01Scaled(t){const{r:n,g:r,b:i,a:o}=this;return o===0?[0,0,0]:[n/o*t,r/o*t,i/o*t]}toArray01PremultipliedAlpha(){const{r:t,g:n,b:r,a:i}=this;return[t,n,r,i]}toArray01Linear(){const{r:t,g:n,b:r,a:i}=this;return i===0?[0,0,0,0]:[Math.pow(t/i,2.2),Math.pow(n/i,2.2),Math.pow(r/i,2.2),i]}}oo.black=new oo(0,0,0,1),oo.white=new oo(1,1,1,1),oo.transparent=new oo(0,0,0,0),oo.red=new oo(1,0,0,1),oo.blue=new oo(0,0,1,1);var Me=oo;class wp{constructor(t,n,r){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ef{constructor(t,n,r,i,o){this.text=t.normalize?t.normalize():t,this.image=n,this.scale=r,this.fontStack=i,this.textColor=o}}class Wr{constructor(t){this.sections=t}static fromString(t){return new Wr([new ef(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.namePrimary.length!==0)}static factory(t){return t instanceof Wr?t:Wr.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const n of this.sections){if(n.image){t.push(["image",n.image.namePrimary]);continue}t.push(n.text);const r={};n.fontStack&&(r["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(r["font-scale"]=n.scale),n.textColor&&(r["text-color"]=["rgba"].concat(n.textColor.toArray())),t.push(r)}return t}}class ji{constructor(t){this.namePrimary=t.namePrimary,t.nameSecondary&&(this.nameSecondary=t.nameSecondary),this.available=t.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(t,n){return t?new ji({namePrimary:t,nameSecondary:n,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function nf(e,t,n,r){return typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?r===void 0||typeof r=="number"&&r>=0&&r<=1?null:`Invalid rgba value [${[e,t,n,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof r=="number"?[e,t,n,r]:[e,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function sr(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof Me||e instanceof wp||e instanceof Wr||e instanceof ji)return!0;if(Array.isArray(e)){for(const t of e)if(!sr(t))return!1;return!0}if(typeof e=="object"){for(const t in e)if(!sr(e[t]))return!1;return!0}return!1}function gr(e){if(e===null)return $n;if(typeof e=="string")return fn;if(typeof e=="boolean")return vn;if(typeof e=="number")return ie;if(e instanceof Me)return Do;if(e instanceof wp)return kc;if(e instanceof Wr)return Fc;if(e instanceof ji)return Zr;if(Array.isArray(e)){const t=e.length;let n;for(const r of e){const i=gr(r);if(n){if(n===i)continue;n=gn;break}n=i}return Ii(n||gn,t)}return mu}function xl(e){const t=typeof e;return e===null?"":t==="string"||t==="number"||t==="boolean"?String(e):e instanceof Me||e instanceof Wr||e instanceof ji?e.toString():JSON.stringify(e)}class bp{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!sr(t[1]))return n.error("invalid value");const r=t[1];let i=gr(r);const o=n.expectedType;return i.kind!=="array"||i.N!==0||!o||o.kind!=="array"||typeof o.N=="number"&&o.N!==0||(i=o),new bp(i,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Me?["rgba"].concat(this.value.toArray()):this.value instanceof Wr?this.value.serialize():this.value}}var vl=bp,ti=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};const Ap={string:fn,number:ie,boolean:vn,object:mu};class Ep{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let r,i=1;const o=t[0];if(o==="array"){let a,c;if(t.length>2){const h=t[1];if(typeof h!="string"||!(h in Ap)||h==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);a=Ap[h],i++}else a=gn;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);c=t[2],i++}r=Ii(a,c)}else r=Ap[o];const s=[];for(;i<t.length;i++){const a=n.parse(t[i],i,gn);if(!a)return null;s.push(a)}return new Ep(r,s)}evaluate(t){for(let n=0;n<this.args.length;n++){const r=this.args[n].evaluate(t);if(!yl(this.type,gr(r)))return r;if(n===this.args.length-1)throw new ti(`Expected value to be of type ${er(this.type)}, but found ${er(gr(r))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,n=[t.kind];if(t.kind==="array"){const r=t.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){n.push(r.kind);const i=t.N;(typeof i=="number"||this.args.length>1)&&n.push(i)}}return n.concat(this.args.map(r=>r.serialize()))}}var _s=Ep;class Ba{constructor(t){this.type=Fc,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const r=t[1];if(!Array.isArray(r)&&typeof r=="object")return n.error("First argument must be an image or text section.");const i=[];let o=!1;for(let s=1;s<=t.length-1;++s){const a=t[s];if(o&&typeof a=="object"&&!Array.isArray(a)){o=!1;let c=null;if(a["font-scale"]&&(c=n.parse(a["font-scale"],1,ie),!c))return null;let h=null;if(a["text-font"]&&(h=n.parse(a["text-font"],1,Ii(fn)),!h))return null;let d=null;if(a["text-color"]&&(d=n.parse(a["text-color"],1,Do),!d))return null;const m=i[i.length-1];m.scale=c,m.font=h,m.textColor=d}else{const c=n.parse(t[s],1,gn);if(!c)return null;const h=c.type.kind;if(h!=="string"&&h!=="value"&&h!=="null"&&h!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");o=!0,i.push({content:c,scale:null,font:null,textColor:null})}}return new Ba(i)}evaluate(t){return new Wr(this.sections.map(n=>{const r=n.content.evaluate(t);return gr(r)===Zr?new ef("",r,null,null,null):new ef(xl(r),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null)}))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const n of this.sections){t.push(n.content.serialize());const r={};n.scale&&(r["font-scale"]=n.scale.serialize()),n.font&&(r["text-font"]=n.font.serialize()),n.textColor&&(r["text-color"]=n.textColor.serialize()),t.push(r)}return t}}class ys{constructor(t,n){this.type=Zr,this.inputPrimary=t,this.inputSecondary=n}static parse(t,n){if(t.length<2)return n.error("Expected two or more arguments.");const r=n.parse(t[1],1,fn);if(!r)return n.error("No image name provided.");if(t.length===2)return new ys(r);const i=n.parse(t[2],1,fn);return i?new ys(r,i):n.error("Secondary image variant is not a string.")}evaluate(t){const n=ji.fromString(this.inputPrimary.evaluate(t),this.inputSecondary?this.inputSecondary.evaluate(t):void 0);return n&&t.availableImages&&(n.available=t.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&t.availableImages&&(n.available=t.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(t){t(this.inputPrimary),this.inputSecondary&&t(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Mn(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}const V_={"to-boolean":vn,"to-color":Do,"to-number":ie,"to-string":fn};class rf{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const r=t[0],i=[];let o=$n;if(r==="to-array"){if(!Array.isArray(t[1]))return null;const s=t[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);o=Ii(n.expectedType.itemType,s)}else{if(!(s>0&&sr(t[1][0])))return null;o=Ii(gr(t[1][0]),s)}for(let a=0;a<s;a++){const c=t[1][a];let h;if(Mn(c)==="array")h=n.parse(c,void 0,o.itemType);else{const d=Mn(c);if(d!==o.itemType.kind)return n.error(`Expected ${o.itemType.kind} but found ${d}.`);h=n.registry.literal.parse(["literal",c===void 0?null:c],n)}if(!h)return null;i.push(h)}}else{if((r==="to-boolean"||r==="to-string")&&t.length!==2)return n.error("Expected one argument.");o=V_[r];for(let s=1;s<t.length;s++){const a=n.parse(t[s],s,gn);if(!a)return null;i.push(a)}}return new rf(o,i)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let n,r;for(const i of this.args){if(n=i.evaluate(t),r=null,n instanceof Me)return n;if(typeof n=="string"){const o=t.parseColor(n);if(o)return o}else if(Array.isArray(n)&&(r=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:nf(n[0],n[1],n[2],n[3]),!r))return new Me(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new ti(r||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(const r of this.args){if(n=r.evaluate(t),n===null)return 0;const i=Number(n);if(!isNaN(i))return i}throw new ti(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?Wr.fromString(xl(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?ji.fromString(xl(this.args[0].evaluate(t))):this.type.kind==="array"?this.args.map(n=>n.evaluate(t)):xl(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ba([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ys(this.args[0]).serialize();const t=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{t.push(n.serialize())}),t}}var Js=rf;const Tp=["Unknown","Point","LineString","Polygon"];var Cp=class{constructor(e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.options=e}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Tp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:n,y:r}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*t-e[0])+this.featureDistanceData.bearing[1]*(r*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Me.parse(e)),t}getConfig(e){return this.options?this.options.get(e):null}};class wl{constructor(t,n,r,i,o){this.name=t,this.type=n,this._evaluate=r,this.args=i,this._overloadIndex=o}evaluate(t){if(!this._evaluate){const n=wl.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,n){const r=t[0],i=wl.definitions[r];if(!i)return n.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const o=Array.isArray(i)?i[0]:i.type,s=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,a=[];let c=null,h=-1;for(const[d,m]of s){if(Array.isArray(d)&&d.length!==t.length-1)continue;a.push(d),h++,c=new ka(n.registry,n.path,null,n.scope,void 0,n.options);const g=[];let x=!1;for(let v=1;v<t.length;v++){const w=t[v],A=Array.isArray(d)?d[v-1]:d.type,E=c.parse(w,1+g.length,A);if(!E){x=!0;break}g.push(E)}if(!x)if(Array.isArray(d)&&d.length!==g.length)c.error(`Expected ${d.length} arguments, but found ${g.length} instead.`);else{for(let v=0;v<g.length;v++){const w=Array.isArray(d)?d[v]:d.type,A=g[v];c.concat(v+1).checkSubtype(w,A.type)}if(c.errors.length===0)return new wl(r,o,m,g,h)}}if(a.length===1)n.errors.push(...c.errors);else{const d=(a.length?a:s.map(([g])=>g)).map(Sp).join(" | "),m=[];for(let g=1;g<t.length;g++){const x=n.parse(t[g],1+m.length);if(!x)return null;m.push(er(x.type))}n.error(`Expected arguments of type ${d}, but found (${m.join(", ")}) instead.`)}return null}static register(t,n){wl.definitions=n;for(const r in n)t[r]=wl}}function Sp(e){return Array.isArray(e)?`(${e.map(er).join(", ")})`:`(${er(e.type)}...)`}var Po=wl;class of{constructor(t,n,r){this.type=kc,this.locale=r,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const r=t[1];if(typeof r!="object"||Array.isArray(r))return n.error("Collator options argument must be an object.");const i=n.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,vn);if(!i)return null;const o=n.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,vn);if(!o)return null;let s=null;return r.locale&&(s=n.parse(r.locale,1,fn),!s)?null:new of(i,o,s)}evaluate(t){return new wp(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}var Mp={exports:{}};Mp.exports=function(){function e(r,i,o,s,a){for(;s>o;){if(s-o>600){var c=s-o+1,h=i-o+1,d=Math.log(c),m=.5*Math.exp(2*d/3),g=.5*Math.sqrt(d*m*(c-m)/c)*(h-c/2<0?-1:1);e(r,i,Math.max(o,Math.floor(i-h*m/c+g)),Math.min(s,Math.floor(i+(c-h)*m/c+g)),a)}var x=r[i],v=o,w=s;for(t(r,o,i),a(r[s],x)>0&&t(r,o,s);v<w;){for(t(r,v,w),v++,w--;a(r[v],x)<0;)v++;for(;a(r[w],x)>0;)w--}a(r[o],x)===0?t(r,o,w):t(r,++w,s),w<=i&&(o=w+1),i<=w&&(s=w-1)}}function t(r,i,o){var s=r[i];r[i]=r[o],r[o]=s}function n(r,i){return r<i?-1:r>i?1:0}return function(r,i,o,s,a){e(r,i,o||0,s||r.length-1,a||n)}}();var go=It(Mp.exports);function Ip(e){let t=0;for(let n,r,i=0,o=e.length,s=o-1;i<o;s=i++)n=e[i],r=e[s],t+=(r.x-n.x)*(n.y+r.y);return t}function $s(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function _u(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function G_(e,t,n){const r=e[0]-t[0],i=e[1]-t[1],o=e[0]-n[0],s=e[1]-n[1];return r*s-o*i==0&&r*o<=0&&i*s<=0}function yu(e,t,n=!1){let r=!1;for(let a=0,c=t.length;a<c;a++){const h=t[a];for(let d=0,m=h.length,g=m-1;d<m;g=d++){const x=h[g],v=h[d];if(G_(e,x,v))return n;(o=x)[1]>(i=e)[1]!=(s=v)[1]>i[1]&&i[0]<(s[0]-o[0])*(i[1]-o[1])/(s[1]-o[1])+o[0]&&(r=!r)}}var i,o,s;return r}function j_(e,t,n,r){const i=r[0]-n[0],o=r[1]-n[1],s=(e[0]-n[0])*o-i*(e[1]-n[1]),a=(t[0]-n[0])*o-i*(t[1]-n[1]);return s>0&&a<0||s<0&&a>0}function sf(e,t,n,r){return(i=[r[0]-n[0],r[1]-n[1]])[0]*(o=[t[0]-e[0],t[1]-e[1]])[1]-i[1]*o[0]!=0&&!(!j_(e,t,n,r)||!j_(n,r,e,t));var i,o}const Da=8192;function Xv(e,t){const n=(180+e[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,i=Math.pow(2,t.z);return[Math.round(n*i*Da),Math.round(r*i*Da)]}function xu(e,t){for(let n=0;n<t.length;n++)if(yu(e,t[n]))return!0;return!1}function Yv(e,t,n){for(const r of n)for(let i=0,o=r.length,s=o-1;i<o;s=i++)if(sf(e,t,r[s],r[i]))return!0;return!1}function H_(e,t){for(let n=0;n<e.length;++n)if(!yu(e[n],t))return!1;for(let n=0;n<e.length-1;++n)if(Yv(e[n],e[n+1],t))return!1;return!0}function Bp(e,t){for(let n=0;n<t.length;n++)if(H_(e,t[n]))return!0;return!1}function af(e,t,n){const r=[];for(let i=0;i<e.length;i++){const o=[];for(let s=0;s<e[i].length;s++){const a=Xv(e[i][s],n);$s(t,a),o.push(a)}r.push(o)}return r}function Ks(e,t,n){const r=[];for(let i=0;i<e.length;i++){const o=af(e[i],t,n);r.push(o)}return r}function Nc(e,t,n,r){if(e[0]<n[0]||e[0]>n[2]){const i=.5*r;let o=e[0]-n[0]>i?-r:n[0]-e[0]>i?r:0;o===0&&(o=e[0]-n[2]>i?-r:n[2]-e[0]>i?r:0),e[0]+=o}$s(t,e)}function Z_(e,t,n,r){const i=Math.pow(2,r.z)*Da,o=[r.x*Da,r.y*Da],s=[];if(!e)return s;for(const a of e)for(const c of a){const h=[c.x+o[0],c.y+o[1]];Nc(h,t,n,i),s.push(h)}return s}function W_(e,t,n,r){const i=Math.pow(2,r.z)*Da,o=[r.x*Da,r.y*Da],s=[];if(!e)return s;for(const c of e){const h=[];for(const d of c){const m=[d.x+o[0],d.y+o[1]];$s(t,m),h.push(m)}s.push(h)}if(t[2]-t[0]<=i/2){(a=t)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const c of s)for(const h of c)Nc(h,t,n,i)}var a;return s}class Uc{constructor(t,n){this.type=vn,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(sr(t[1])){const r=t[1];if(r.type==="FeatureCollection")for(let i=0;i<r.features.length;++i){const o=r.features[i].geometry.type;if(o==="Polygon"||o==="MultiPolygon")return new Uc(r,r.features[i].geometry)}else if(r.type==="Feature"){const i=r.geometry.type;if(i==="Polygon"||i==="MultiPolygon")return new Uc(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new Uc(r,r)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,r){const i=[1/0,1/0,-1/0,-1/0],o=[1/0,1/0,-1/0,-1/0],s=n.canonicalID();if(!s)return!1;if(r.type==="Polygon"){const a=af(r.coordinates,o,s),c=Z_(n.geometry(),i,o,s);if(!_u(i,o))return!1;for(const h of c)if(!yu(h,a))return!1}if(r.type==="MultiPolygon"){const a=Ks(r.coordinates,o,s),c=Z_(n.geometry(),i,o,s);if(!_u(i,o))return!1;for(const h of c)if(!xu(h,a))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,r){const i=[1/0,1/0,-1/0,-1/0],o=[1/0,1/0,-1/0,-1/0],s=n.canonicalID();if(!s)return!1;if(r.type==="Polygon"){const a=af(r.coordinates,o,s),c=W_(n.geometry(),i,o,s);if(!_u(i,o))return!1;for(const h of c)if(!H_(h,a))return!1}if(r.type==="MultiPolygon"){const a=Ks(r.coordinates,o,s),c=W_(n.geometry(),i,o,s);if(!_u(i,o))return!1;for(const h of c)if(!Bp(h,a))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Pa=Uc,Lo={exports:{}};Lo.exports=function(){var e={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},t=1/298.257223563,n=t*(2-t),r=Math.PI/180,i=function(h,d){if(h===void 0)throw new Error("No latitude given.");if(d&&!e[d])throw new Error("Unknown unit "+d+". Use one of: "+Object.keys(e).join(", "));var m=6378.137*r*(d?e[d]:1),g=Math.cos(h*r),x=1/(1-n*(1-g*g)),v=Math.sqrt(x);this.kx=m*v*g,this.ky=m*v*x*(1-n)},o={units:{configurable:!0}};function s(h,d){return h[0]===d[0]&&h[1]===d[1]}function a(h,d,m){var g=c(d[0]-h[0]);return[h[0]+g*m,h[1]+(d[1]-h[1])*m]}function c(h){for(;h<-180;)h+=360;for(;h>180;)h-=360;return h}return i.fromTile=function(h,d,m){var g=Math.PI*(1-2*(h+.5)/Math.pow(2,d)),x=Math.atan(.5*(Math.exp(g)-Math.exp(-g)))/r;return new i(x,m)},o.units.get=function(){return e},i.prototype.distance=function(h,d){var m=c(h[0]-d[0])*this.kx,g=(h[1]-d[1])*this.ky;return Math.sqrt(m*m+g*g)},i.prototype.bearing=function(h,d){var m=c(d[0]-h[0])*this.kx;return Math.atan2(m,(d[1]-h[1])*this.ky)/r},i.prototype.destination=function(h,d,m){var g=m*r;return this.offset(h,Math.sin(g)*d,Math.cos(g)*d)},i.prototype.offset=function(h,d,m){return[h[0]+d/this.kx,h[1]+m/this.ky]},i.prototype.lineDistance=function(h){for(var d=0,m=0;m<h.length-1;m++)d+=this.distance(h[m],h[m+1]);return d},i.prototype.area=function(h){for(var d=0,m=0;m<h.length;m++)for(var g=h[m],x=0,v=g.length,w=v-1;x<v;w=x++)d+=c(g[x][0]-g[w][0])*(g[x][1]+g[w][1])*(m?-1:1);return Math.abs(d)/2*this.kx*this.ky},i.prototype.along=function(h,d){var m=0;if(d<=0)return h[0];for(var g=0;g<h.length-1;g++){var x=h[g],v=h[g+1],w=this.distance(x,v);if((m+=w)>d)return a(x,v,(d-(m-w))/w)}return h[h.length-1]},i.prototype.pointToSegmentDistance=function(h,d,m){var g=d[0],x=d[1],v=c(m[0]-g)*this.kx,w=(m[1]-x)*this.ky,A=0;return v===0&&w===0||((A=(c(h[0]-g)*this.kx*v+(h[1]-x)*this.ky*w)/(v*v+w*w))>1?(g=m[0],x=m[1]):A>0&&(g+=v/this.kx*A,x+=w/this.ky*A)),v=c(h[0]-g)*this.kx,w=(h[1]-x)*this.ky,Math.sqrt(v*v+w*w)},i.prototype.pointOnLine=function(h,d){for(var m,g,x,v,w=1/0,A=0;A<h.length-1;A++){var E=h[A][0],S=h[A][1],I=c(h[A+1][0]-E)*this.kx,B=(h[A+1][1]-S)*this.ky,M=0;I===0&&B===0||((M=(c(d[0]-E)*this.kx*I+(d[1]-S)*this.ky*B)/(I*I+B*B))>1?(E=h[A+1][0],S=h[A+1][1]):M>0&&(E+=I/this.kx*M,S+=B/this.ky*M));var D=(I=c(d[0]-E)*this.kx)*I+(B=(d[1]-S)*this.ky)*B;D<w&&(w=D,m=E,g=S,x=A,v=M)}return{point:[m,g],index:x,t:Math.max(0,Math.min(1,v))}},i.prototype.lineSlice=function(h,d,m){var g=this.pointOnLine(m,h),x=this.pointOnLine(m,d);if(g.index>x.index||g.index===x.index&&g.t>x.t){var v=g;g=x,x=v}var w=[g.point],A=g.index+1,E=x.index;!s(m[A],w[0])&&A<=E&&w.push(m[A]);for(var S=A+1;S<=E;S++)w.push(m[S]);return s(m[E],x.point)||w.push(x.point),w},i.prototype.lineSliceAlong=function(h,d,m){for(var g=0,x=[],v=0;v<m.length-1;v++){var w=m[v],A=m[v+1],E=this.distance(w,A);if((g+=E)>h&&x.length===0&&x.push(a(w,A,(h-(g-E))/E)),g>=d)return x.push(a(w,A,(d-(g-E))/E)),x;g>h&&x.push(A)}return x},i.prototype.bufferPoint=function(h,d){var m=d/this.ky,g=d/this.kx;return[h[0]-g,h[1]-m,h[0]+g,h[1]+m]},i.prototype.bufferBBox=function(h,d){var m=d/this.ky,g=d/this.kx;return[h[0]-g,h[1]-m,h[2]+g,h[3]+m]},i.prototype.insideBBox=function(h,d){return c(h[0]-d[0])>=0&&c(h[0]-d[2])<=0&&h[1]>=d[1]&&h[1]<=d[3]},Object.defineProperties(i,o),i}();var lf=It(Lo.exports),q_={exports:{}};q_.exports=function(){var e=function(n,r){if(n===void 0&&(n=[]),r===void 0&&(r=t),this.data=n,this.length=this.data.length,this.compare=r,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)};function t(n,r){return n<r?-1:n>r?1:0}return e.prototype.push=function(n){this.data.push(n),this.length++,this._up(this.length-1)},e.prototype.pop=function(){if(this.length!==0){var n=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),n}},e.prototype.peek=function(){return this.data[0]},e.prototype._up=function(n){for(var r=this.data,i=this.compare,o=r[n];n>0;){var s=n-1>>1,a=r[s];if(i(o,a)>=0)break;r[n]=a,n=s}r[n]=o},e.prototype._down=function(n){for(var r=this.data,i=this.compare,o=this.length>>1,s=r[n];n<o;){var a=1+(n<<1),c=r[a],h=a+1;if(h<this.length&&i(r[h],c)<0&&(a=h,c=r[h]),i(c,s)>=0)break;r[n]=c,n=a}r[n]=s},e}();var Dp=It(q_.exports),gt=8192;function J_(e,t){return t.dist-e.dist}const Pp=100,La=50;function yt(e){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Ft(e){return e[1]-e[0]+1}function Tt(e,t){const n=e[1]>=e[0]&&e[1]<t;return n||console.warn("Distance Expression: Index is out of range"),n}function Te(e,t){if(e[0]>e[1])return[null,null];const n=Ft(e);if(t){if(n===2)return[e,null];const r=Math.floor(n/2);return[[e[0],e[0]+r],[e[0]+r,e[1]]]}{if(n===1)return[e,null];const r=Math.floor(n/2)-1;return[[e[0],e[0]+r],[e[0]+r+1,e[1]]]}}function on(e,t){const n=[1/0,1/0,-1/0,-1/0];if(!Tt(t,e.length))return n;for(let r=t[0];r<=t[1];++r)$s(n,e[r]);return n}function Zn(e){const t=[1/0,1/0,-1/0,-1/0];for(let n=0;n<e.length;++n)for(let r=0;r<e[n].length;++r)$s(t,e[n][r]);return t}function Mr(e,t,n){if(yt(e)||yt(t))return NaN;let r=0,i=0;return e[2]<t[0]&&(r=t[0]-e[2]),e[0]>t[2]&&(r=e[0]-t[2]),e[1]>t[3]&&(i=e[1]-t[3]),e[3]<t[1]&&(i=t[1]-e[3]),n.distance([0,0],[r,i])}function ar(e,t){const n=Math.pow(2,t.z);return[(i=(e.x/gt+t.x)/n,360*i-180),(r=(e.y/gt+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90)];var r,i}function Lp(e,t){const n=[];for(let r=0;r<e.length;++r)n.push(ar(e[r],t));return n}function $_(e,t,n){const r=n.pointOnLine(t,e).point;return n.distance(e,r)}function _o(e,t,n,r,i){const o=n.slice(r[0],r[1]+1);let s=1/0;for(let a=t[0];a<=t[1];++a)if((s=Math.min(s,$_(e[a],o,i)))===0)return 0;return s}function vu(e,t,n,r,i){const o=Math.min(i.pointToSegmentDistance(e,n,r),i.pointToSegmentDistance(t,n,r)),s=Math.min(i.pointToSegmentDistance(n,e,t),i.pointToSegmentDistance(r,e,t));return Math.min(o,s)}function Qv(e,t,n,r,i){if(!Tt(t,e.length)||!Tt(r,n.length))return NaN;let o=1/0;for(let s=t[0];s<t[1];++s)for(let a=r[0];a<r[1];++a){if(sf(e[s],e[s+1],n[a],n[a+1]))return 0;o=Math.min(o,vu(e[s],e[s+1],n[a],n[a+1],i))}return o}function wu(e,t,n,r,i){if(!Tt(t,e.length)||!Tt(r,n.length))return NaN;let o=1/0;for(let s=t[0];s<=t[1];++s)for(let a=r[0];a<=r[1];++a)if((o=Math.min(o,i.distance(e[s],n[a])))===0)return o;return o}function uf(e,t,n){if(yu(e,t,!0))return 0;let r=1/0;for(const i of t){const o=i.length;if(o<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(i[0]!==i[o-1]&&(r=Math.min(r,n.pointToSegmentDistance(e,i[o-1],i[0])))===0||(r=Math.min(r,$_(e,i,n)))===0)return r}return r}function cf(e,t,n,r){if(!Tt(t,e.length))return NaN;for(let o=t[0];o<=t[1];++o)if(yu(e[o],n,!0))return 0;let i=1/0;for(let o=t[0];o<t[1];++o)for(const s of n)for(let a=0,c=s.length,h=c-1;a<c;h=a++){if(sf(e[o],e[o+1],s[h],s[a]))return 0;i=Math.min(i,vu(e[o],e[o+1],s[h],s[a],r))}return i}function nr(e,t){for(const n of e)for(let r=0;r<=n.length-1;++r)if(yu(n[r],t,!0))return!0;return!1}function tw(e,t,n,r=1/0){const i=Zn(e),o=Zn(t);if(r!==1/0&&Mr(i,o,n)>=r)return r;if(_u(i,o)){if(nr(e,t))return 0}else if(nr(t,e))return 0;let s=r;for(const a of e)for(let c=0,h=a.length,d=h-1;c<h;d=c++)for(const m of t)for(let g=0,x=m.length,v=x-1;g<x;v=g++){if(sf(a[d],a[c],m[v],m[g]))return 0;s=Math.min(s,vu(a[d],a[c],m[v],m[g],n))}return s}function Vc(e,t,n,r,i,o,s){if(o===null||s===null)return;const a=Mr(on(r,o),on(i,s),n);a<t&&e.push({dist:a,range1:o,range2:s})}function hf(e,t,n,r,i=1/0){let o=Math.min(r.distance(e[0],n[0][0]),i);if(o===0)return o;const s=new Dp([{dist:0,range1:[0,e.length-1],range2:[0,0]}],J_),a=t?La:Pp,c=Zn(n);for(;s.length;){const h=s.pop();if(h.dist>=o)continue;const d=h.range1;if(Ft(d)<=a){if(!Tt(d,e.length))return NaN;if(t){const m=cf(e,d,n,r);if((o=Math.min(o,m))===0)return o}else for(let m=d[0];m<=d[1];++m){const g=uf(e[m],n,r);if((o=Math.min(o,g))===0)return o}}else{const m=Te(d,t);if(m[0]!==null){const g=Mr(on(e,m[0]),c,r);g<o&&s.push({dist:g,range1:m[0],range2:[0,0]})}if(m[1]!==null){const g=Mr(on(e,m[1]),c,r);g<o&&s.push({dist:g,range1:m[1],range2:[0,0]})}}}return o}function K_(e,t,n,r,i,o=1/0){let s=Math.min(o,i.distance(e[0],n[0]));if(s===0)return s;const a=new Dp([{dist:0,range1:[0,e.length-1],range2:[0,n.length-1]}],J_),c=t?La:Pp,h=r?La:Pp;for(;a.length;){const d=a.pop();if(d.dist>=s)continue;const m=d.range1,g=d.range2;if(Ft(m)<=c&&Ft(g)<=h){if(!Tt(m,e.length)||!Tt(g,n.length))return NaN;if(t&&r?s=Math.min(s,Qv(e,m,n,g,i)):t||r?t&&!r?s=Math.min(s,_o(n,g,e,m,i)):!t&&r&&(s=Math.min(s,_o(e,m,n,g,i))):s=Math.min(s,wu(e,m,n,g,i)),s===0)return s}else{const x=Te(m,t),v=Te(g,r);Vc(a,s,i,e,n,x[0],v[0]),Vc(a,s,i,e,n,x[0],v[1]),Vc(a,s,i,e,n,x[1],v[0]),Vc(a,s,i,e,n,x[1],v[1])}}return s}function Rp(e,t,n,r,i=1/0){let o=i;const s=on(e,[0,e.length-1]);for(const a of n)if(!(o!==1/0&&Mr(s,on(a,[0,a.length-1]),r)>=o)&&(o=Math.min(o,K_(e,t,a,!0,r,o)),o===0))return o;return o}function ff(e,t,n,r,i=1/0){let o=i;const s=on(e,[0,e.length-1]);for(const a of n){if(o!==1/0&&Mr(s,Zn(a),r)>=o)continue;const c=hf(e,t,a,r,o);if(isNaN(c))return c;if((o=Math.min(o,c))===0)return o}return o}function bu(e){return e==="Point"||e==="MultiPoint"||e==="LineString"||e==="MultiLineString"||e==="Polygon"||e==="MultiPolygon"}class Ro{constructor(t,n){this.type=ie,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(sr(t[1])){const r=t[1];if(r.type==="FeatureCollection"){for(let i=0;i<r.features.length;++i)if(bu(r.features[i].geometry.type))return new Ro(r,r.features[i].geometry)}else if(r.type==="Feature"){if(bu(r.geometry.type))return new Ro(r,r.geometry)}else if(bu(r.type))return new Ro(r,r)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const n=t.geometry(),r=t.canonicalID();if(n!=null&&r!=null){if(t.geometryType()==="Point")return function(i,o,s){const a=[];for(const h of i)for(const d of h)a.push(ar(d,o));const c=new lf(a[0][1],"meters");return s.type==="Point"||s.type==="MultiPoint"||s.type==="LineString"?K_(a,!1,s.type==="Point"?[s.coordinates]:s.coordinates,s.type==="LineString",c):s.type==="MultiLineString"?Rp(a,!1,s.coordinates,c):s.type==="Polygon"||s.type==="MultiPolygon"?ff(a,!1,s.type==="Polygon"?[s.coordinates]:s.coordinates,c):null}(n,r,this.geometries);if(t.geometryType()==="LineString")return function(i,o,s){const a=[];for(const h of i){const d=[];for(const m of h)d.push(ar(m,o));a.push(d)}const c=new lf(a[0][0][1],"meters");if(s.type==="Point"||s.type==="MultiPoint"||s.type==="LineString")return Rp(s.type==="Point"?[s.coordinates]:s.coordinates,s.type==="LineString",a,c);if(s.type==="MultiLineString"){let h=1/0;for(let d=0;d<s.coordinates.length;d++){const m=Rp(s.coordinates[d],!0,a,c,h);if(isNaN(m))return m;if((h=Math.min(h,m))===0)return h}return h}if(s.type==="Polygon"||s.type==="MultiPolygon"){let h=1/0;for(let d=0;d<a.length;d++){const m=ff(a[d],!0,s.type==="Polygon"?[s.coordinates]:s.coordinates,c,h);if(isNaN(m))return m;if((h=Math.min(h,m))===0)return h}return h}return null}(n,r,this.geometries);if(t.geometryType()==="Polygon")return function(i,o,s){const a=[];for(const h of function(d,m){const g=d.length;if(g<=1)return[d];const x=[];let v,w;for(let A=0;A<g;A++){const E=Ip(d[A]);E!==0&&(d[A].area=Math.abs(E),w===void 0&&(w=E<0),w===E<0?(v&&x.push(v),v=[d[A]]):v.push(d[A]))}return v&&x.push(v),x}(i)){const d=[];for(let m=0;m<h.length;++m)d.push(Lp(h[m],o));a.push(d)}const c=new lf(a[0][0][0][1],"meters");if(s.type==="Point"||s.type==="MultiPoint"||s.type==="LineString")return ff(s.type==="Point"?[s.coordinates]:s.coordinates,s.type==="LineString",a,c);if(s.type==="MultiLineString"){let h=1/0;for(let d=0;d<s.coordinates.length;d++){const m=ff(s.coordinates[d],!0,a,c,h);if(isNaN(m))return m;if((h=Math.min(h,m))===0)return h}return h}return s.type==="Polygon"||s.type==="MultiPolygon"?function(h,d,m){let g=1/0;for(const x of h)for(const v of d){const w=tw(x,v,m,g);if(isNaN(w))return w;if((g=Math.min(g,w))===0)return g}return g}(s.type==="Polygon"?[s.coordinates]:s.coordinates,a,c):null}(n,r,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var Au=Ro;function bl(e){if(e instanceof Po&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof Pa||e instanceof Au)return!1;let t=!0;return e.eachChild(n=>{t&&!bl(n)&&(t=!1)}),t}function Ra(e){if(e instanceof Po&&e.name==="feature-state")return!1;let t=!0;return e.eachChild(n=>{t&&!Ra(n)&&(t=!1)}),t}function df(e){if(e instanceof Po&&e.name==="config")return!1;let t=!0;return e.eachChild(n=>{t&&!df(n)&&(t=!1)}),t}function Al(e,t){if(e instanceof Po&&t.indexOf(e.name)>=0)return!1;let n=!0;return e.eachChild(r=>{n&&!Al(r,t)&&(n=!1)}),n}class Eu{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const r=t[1];return n.scope.has(r)?new Eu(r,n.scope.get(r)):n.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var kp=Eu;class El{constructor(t,n=[],r,i=new br,o=[],s){this.registry=t,this.path=n,this.key=n.map(a=>`[${a}]`).join(""),this.scope=i,this.errors=o,this.expectedType=r,this.options=s}parse(t,n,r,i,o={}){return n||r?this.concat(n,r,i)._parse(t,o):this._parse(t,o)}_parse(t,n){function r(i,o,s){return s==="assert"?new _s(o,[i]):s==="coerce"?new Js(o,[i]):i}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const i=typeof t[0]=="string"?this.registry[t[0]]:void 0;if(i){let o=i.parse(t,this);if(!o)return null;if(this.expectedType){const s=this.expectedType,a=o.type;if(s.kind!=="string"&&s.kind!=="number"&&s.kind!=="boolean"&&s.kind!=="object"&&s.kind!=="array"||a.kind!=="value")if(s.kind!=="color"&&s.kind!=="formatted"&&s.kind!=="resolvedImage"||a.kind!=="value"&&a.kind!=="string"){if(this.checkSubtype(s,a))return null}else o=r(o,s,n.typeAnnotation||"coerce");else o=r(o,s,n.typeAnnotation||"assert")}if(!(o instanceof vl)&&o.type.kind!=="resolvedImage"&&Tu(o)){const s=new Cp(this.options);try{o=new vl(o.type,o.evaluate(s))}catch(a){return this.error(a.message),null}}return o}return Js.parse(["to-array",t],this)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,r){const i=typeof t=="number"?this.path.concat(t):this.path,o=r?this.scope.concat(r):this.scope;return new El(this.registry,i,n||null,o,this.errors,this.options)}error(t,...n){const r=`${this.key}${n.map(i=>`[${i}]`).join("")}`;this.errors.push(new gs(r,t))}checkSubtype(t,n){const r=yl(t,n);return r&&this.error(r),r}}var ka=El;function Tu(e){if(e instanceof kp)return Tu(e.boundExpression);if(e instanceof Po&&e.name==="error"||e instanceof Po&&e.name==="config"||e instanceof of||e instanceof Pa||e instanceof Au)return!1;const t=e instanceof Js||e instanceof _s;let n=!0;return e.eachChild(r=>{n=t?n&&Tu(r):n&&r instanceof vl}),!!n&&bl(e)&&Al(e,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function pf(e,t){const n=e.length-1;let r,i,o=0,s=n,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),r=e[a],i=e[a+1],r<=t){if(a===n||t<i)return a;o=a+1}else{if(!(r>t))throw new ti("Input is not a number.");s=a-1}return 0}class Fp{constructor(t,n,r){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[i,o]of r)this.labels.push(i),this.outputs.push(o)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const r=n.parse(t[1],1,ie);if(!r)return null;const i=[];let o=null;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);for(let s=1;s<t.length;s+=2){const a=s===1?-1/0:t[s],c=t[s+1],h=s,d=s+1;if(typeof a!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',h);if(i.length&&i[i.length-1][0]>=a)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',h);const m=n.parse(c,d,o);if(!m)return null;o=o||m.type,i.push([a,m])}return new Fp(o,r,i)}evaluate(t){const n=this.labels,r=this.outputs;if(n.length===1)return r[0].evaluate(t);const i=this.input.evaluate(t);if(i<=n[0])return r[0].evaluate(t);const o=n.length;return i>=n[o-1]?r[o-1].evaluate(t):r[pf(n,i)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&t.push(this.labels[n]),t.push(this.outputs[n].serialize());return t}}var zp=Fp;function Ce(e,t,n){return e*(1-n)+t*n}function Gc(e,t,n){return e.map((r,i)=>Ce(r,t[i],n))}var Cu=Object.freeze({__proto__:null,array:Gc,color:function(e,t,n){return new Me(Ce(e.r,t.r,n),Ce(e.g,t.g,n),Ce(e.b,t.b,n),Ce(e.a,t.a,n))},number:Ce});const X_=.95047,Op=1.08883,Y_=4/29,Su=6/29,ei=3*Su*Su,Bi=Su*Su*Su,ew=Math.PI/180,nw=180/Math.PI;function mf(e){return e>Bi?Math.pow(e,1/3):e/ei+Y_}function Np(e){return e>Su?e*e*e:ei*(e-Y_)}function jc(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Tl(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function gf(e){const t=Tl(e.r),n=Tl(e.g),r=Tl(e.b),i=mf((.4124564*t+.3575761*n+.1804375*r)/X_),o=mf((.2126729*t+.7151522*n+.072175*r)/1);return{l:116*o-16,a:500*(i-o),b:200*(o-mf((.0193339*t+.119192*n+.9503041*r)/Op)),alpha:e.a}}function Cl(e){let t=(e.l+16)/116,n=isNaN(e.a)?t:t+e.a/500,r=isNaN(e.b)?t:t-e.b/200;return t=1*Np(t),n=X_*Np(n),r=Op*Np(r),new Me(jc(3.2404542*n-1.5371385*t-.4985314*r),jc(-.969266*n+1.8760108*t+.041556*r),jc(.0556434*n-.2040259*t+1.0572252*r),e.alpha)}function Hc(e,t,n){const r=t-e;return e+n*(r>180||r<-180?r-360*Math.round(r/360):r)}const Xs={forward:gf,reverse:Cl,interpolate:function(e,t,n){return{l:Ce(e.l,t.l,n),a:Ce(e.a,t.a,n),b:Ce(e.b,t.b,n),alpha:Ce(e.alpha,t.alpha,n)}}},Fa={forward:function(e){const{l:t,a:n,b:r}=gf(e),i=Math.atan2(r,n)*nw;return{h:i<0?i+360:i,c:Math.sqrt(n*n+r*r),l:t,alpha:e.a}},reverse:function(e){const t=e.h*ew,n=e.c;return Cl({l:e.l,a:Math.cos(t)*n,b:Math.sin(t)*n,alpha:e.alpha})},interpolate:function(e,t,n){return{h:Hc(e.h,t.h,n),c:Ce(e.c,t.c,n),l:Ce(e.l,t.l,n),alpha:Ce(e.alpha,t.alpha,n)}}};var Sl=Object.freeze({__proto__:null,hcl:Fa,lab:Xs});class _f{constructor(t,n,r,i,o){this.type=t,this.operator=n,this.interpolation=r,this.input=i,this.labels=[],this.outputs=[];for(const[s,a]of o)this.labels.push(s),this.outputs.push(a)}static interpolationFactor(t,n,r,i){let o=0;if(t.name==="exponential")o=Up(n,t.base,r,i);else if(t.name==="linear")o=Up(n,1,r,i);else if(t.name==="cubic-bezier"){const s=t.controlPoints;o=new oe(s[0],s[1],s[2],s[3]).solve(Up(n,1,r,i))}return o}static parse(t,n){let[r,i,o,...s]=t;if(!Array.isArray(i)||i.length===0)return n.error("Expected an interpolation type expression.",1);if(i[0]==="linear")i={name:"linear"};else if(i[0]==="exponential"){const h=i[1];if(typeof h!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:h}}else{if(i[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(i[0])}`,1,0);{const h=i.slice(1);if(h.length!==4||h.some(d=>typeof d!="number"||d<0||d>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:h}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(o=n.parse(o,2,ie),!o)return null;const a=[];let c=null;r==="interpolate-hcl"||r==="interpolate-lab"?c=Do:n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);for(let h=0;h<s.length;h+=2){const d=s[h],m=s[h+1],g=h+3,x=h+4;if(typeof d!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',g);if(a.length&&a[a.length-1][0]>=d)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',g);const v=n.parse(m,x,c);if(!v)return null;c=c||v.type,a.push([d,v])}return c.kind==="number"||c.kind==="color"||c.kind==="array"&&c.itemType.kind==="number"&&typeof c.N=="number"?new _f(c,r,i,o,a):n.error(`Type ${er(c)} is not interpolatable.`)}evaluate(t){const n=this.labels,r=this.outputs;if(n.length===1)return r[0].evaluate(t);const i=this.input.evaluate(t);if(i<=n[0])return r[0].evaluate(t);const o=n.length;if(i>=n[o-1])return r[o-1].evaluate(t);const s=pf(n,i),a=_f.interpolationFactor(this.interpolation,i,n[s],n[s+1]),c=r[s].evaluate(t),h=r[s+1].evaluate(t);return this.operator==="interpolate"?Cu[this.type.kind.toLowerCase()](c,h,a):this.operator==="interpolate-hcl"?Fa.reverse(Fa.interpolate(Fa.forward(c),Fa.forward(h),a)):Xs.reverse(Xs.interpolate(Xs.forward(c),Xs.forward(h),a))}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,t,this.input.serialize()];for(let r=0;r<this.labels.length;r++)n.push(this.labels[r],this.outputs[r].serialize());return n}}function Up(e,t,n,r){const i=r-n,o=e-n;return i===0?0:t===1?o/i:(Math.pow(t,o)-1)/(Math.pow(t,i)-1)}var xs=_f;class Vp{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expectected at least one argument.");let r=null;const i=n.expectedType;i&&i.kind!=="value"&&(r=i);const o=[];for(const a of t.slice(1)){const c=n.parse(a,1+o.length,r,void 0,{typeAnnotation:"omit"});if(!c)return null;r=r||c.type,o.push(c)}const s=i&&o.some(a=>yl(i,a.type));return new Vp(s?gn:r,o)}evaluate(t){let n,r=null,i=0;for(const o of this.args){if(i++,r=o.evaluate(t),r&&r instanceof ji&&!r.available&&(n||(n=r),r=null,i===this.args.length))return n;if(r!==null)break}return r}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(n=>{t.push(n.serialize())}),t}}var Q_=Vp;class Mu{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const r=[];for(let o=1;o<t.length-1;o+=2){const s=t[o];if(typeof s!="string")return n.error(`Expected string, but found ${typeof s} instead.`,o);if(/[^a-zA-Z0-9_]/.test(s))return n.error("Variable names must contain only alphanumeric characters or '_'.",o);const a=n.parse(t[o+1],o+1);if(!a)return null;r.push([s,a])}const i=n.parse(t[t.length-1],t.length-1,n.expectedType,r);return i?new Mu(r,i):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[n,r]of this.bindings)t.push(n,r.serialize());return t.push(this.result.serialize()),t}}var Iu=Mu;class yf{constructor(t,n,r){this.type=t,this.index=n,this.input=r}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const r=n.parse(t[1],1,ie),i=n.parse(t[2],2,Ii(n.expectedType||gn));return r&&i?new yf(i.type.itemType,r,i):null}evaluate(t){const n=this.index.evaluate(t),r=this.input.evaluate(t);if(n<0)throw new ti(`Array index out of bounds: ${n} < 0.`);if(n>=r.length)throw new ti(`Array index out of bounds: ${n} > ${r.length-1}.`);if(n!==Math.floor(n))throw new ti(`Array index must be an integer, but found ${n} instead.`);return r[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Z=yf;class za{constructor(t,n){this.type=vn,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const r=n.parse(t[1],1,gn),i=n.parse(t[2],2,gn);return r&&i?io(r.type,[vn,fn,ie,$n,gn])?new za(r,i):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${er(r.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(r==null)return!1;if(!gu(n,["boolean","string","number","null"]))throw new ti(`Expected first argument to be of type boolean, string, number or null, but found ${er(gr(n))} instead.`);if(!gu(r,["string","array"]))throw new ti(`Expected second argument to be of type array or string, but found ${er(gr(r))} instead.`);return r.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var xf=za;class Hi{constructor(t,n,r){this.type=ie,this.needle=t,this.haystack=n,this.fromIndex=r}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const r=n.parse(t[1],1,gn),i=n.parse(t[2],2,gn);if(!r||!i)return null;if(!io(r.type,[vn,fn,ie,$n,gn]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${er(r.type)} instead`);if(t.length===4){const o=n.parse(t[3],3,ie);return o?new Hi(r,i,o):null}return new Hi(r,i)}evaluate(t){const n=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(!gu(n,["boolean","string","number","null"]))throw new ti(`Expected first argument to be of type boolean, string, number or null, but found ${er(gr(n))} instead.`);if(!gu(r,["string","array"]))throw new ti(`Expected second argument to be of type array or string, but found ${er(gr(r))} instead.`);if(this.fromIndex){const i=this.fromIndex.evaluate(t);return r.indexOf(n,i)}return r.indexOf(n)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Vn=Hi;class Gp{constructor(t,n,r,i,o,s){this.inputType=t,this.type=n,this.input=r,this.cases=i,this.outputs=o,this.otherwise=s}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let r,i;n.expectedType&&n.expectedType.kind!=="value"&&(i=n.expectedType);const o={},s=[];for(let h=2;h<t.length-1;h+=2){let d=t[h];const m=t[h+1];Array.isArray(d)||(d=[d]);const g=n.concat(h);if(d.length===0)return g.error("Expected at least one branch label.");for(const v of d){if(typeof v!="number"&&typeof v!="string")return g.error("Branch labels must be numbers or strings.");if(typeof v=="number"&&Math.abs(v)>Number.MAX_SAFE_INTEGER)return g.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof v=="number"&&Math.floor(v)!==v)return g.error("Numeric branch labels must be integer values.");if(r){if(g.checkSubtype(r,gr(v)))return null}else r=gr(v);if(o[String(v)]!==void 0)return g.error("Branch labels must be unique.");o[String(v)]=s.length}const x=n.parse(m,h,i);if(!x)return null;i=i||x.type,s.push(x)}const a=n.parse(t[1],1,gn);if(!a)return null;const c=n.parse(t[t.length-1],t.length-1,i);return c?a.type.kind!=="value"&&n.concat(1).checkSubtype(r,a.type)?null:new Gp(r,i,a,o,s,c):null}evaluate(t){const n=this.input.evaluate(t);return(gr(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),r=[],i={};for(const s of n){const a=i[this.cases[s]];a===void 0?(i[this.cases[s]]=r.length,r.push([this.cases[s],[s]])):r[a][1].push(s)}const o=s=>this.inputType.kind==="number"?Number(s):s;for(const[s,a]of r)t.push(a.length===1?o(a[0]):a.map(o)),t.push(this.outputs[s].serialize());return t.push(this.otherwise.serialize()),t}}var rw=Gp;class jp{constructor(t,n,r){this.type=t,this.branches=n,this.otherwise=r}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let r;n.expectedType&&n.expectedType.kind!=="value"&&(r=n.expectedType);const i=[];for(let s=1;s<t.length-1;s+=2){const a=n.parse(t[s],s,vn);if(!a)return null;const c=n.parse(t[s+1],s+1,r);if(!c)return null;i.push([a,c]),r=r||c.type}const o=n.parse(t[t.length-1],t.length-1,r);return o?new jp(r,i,o):null}evaluate(t){for(const[n,r]of this.branches)if(n.evaluate(t))return r.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,r]of this.branches)t(n),t(r);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(n=>{t.push(n.serialize())}),t}}var Ml=jp;class vf{constructor(t,n,r,i){this.type=t,this.input=n,this.beginIndex=r,this.endIndex=i}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const r=n.parse(t[1],1,gn),i=n.parse(t[2],2,ie);if(!r||!i)return null;if(!io(r.type,[Ii(gn),fn,gn]))return n.error(`Expected first argument to be of type array or string, but found ${er(r.type)} instead`);if(t.length===4){const o=n.parse(t[3],3,ie);return o?new vf(r.type,r,i,o):null}return new vf(r.type,r,i)}evaluate(t){const n=this.input.evaluate(t),r=this.beginIndex.evaluate(t);if(!gu(n,["string","array"]))throw new ti(`Expected first argument to be of type array or string, but found ${er(gr(n))} instead.`);if(this.endIndex){const i=this.endIndex.evaluate(t);return n.slice(r,i)}return n.slice(r)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var iw=vf;function t0(e,t){return e==="=="||e==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function e0(e,t,n,r){return r.compare(t,n)===0}function Bu(e,t,n){const r=e!=="=="&&e!=="!=";return class L3{constructor(o,s,a){this.type=vn,this.lhs=o,this.rhs=s,this.collator=a,this.hasUntypedArgument=o.type.kind==="value"||s.type.kind==="value"}static parse(o,s){if(o.length!==3&&o.length!==4)return s.error("Expected two or three arguments.");const a=o[0];let c=s.parse(o[1],1,gn);if(!c)return null;if(!t0(a,c.type))return s.concat(1).error(`"${a}" comparisons are not supported for type '${er(c.type)}'.`);let h=s.parse(o[2],2,gn);if(!h)return null;if(!t0(a,h.type))return s.concat(2).error(`"${a}" comparisons are not supported for type '${er(h.type)}'.`);if(c.type.kind!==h.type.kind&&c.type.kind!=="value"&&h.type.kind!=="value")return s.error(`Cannot compare types '${er(c.type)}' and '${er(h.type)}'.`);r&&(c.type.kind==="value"&&h.type.kind!=="value"?c=new _s(h.type,[c]):c.type.kind!=="value"&&h.type.kind==="value"&&(h=new _s(c.type,[h])));let d=null;if(o.length===4){if(c.type.kind!=="string"&&h.type.kind!=="string"&&c.type.kind!=="value"&&h.type.kind!=="value")return s.error("Cannot use collator to compare non-string types.");if(d=s.parse(o[3],3,kc),!d)return null}return new L3(c,h,d)}evaluate(o){const s=this.lhs.evaluate(o),a=this.rhs.evaluate(o);if(r&&this.hasUntypedArgument){const c=gr(s),h=gr(a);if(c.kind!==h.kind||c.kind!=="string"&&c.kind!=="number")throw new ti(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${c.kind}, ${h.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const c=gr(s),h=gr(a);if(c.kind!=="string"||h.kind!=="string")return t(o,s,a)}return this.collator?n(o,s,a,this.collator.evaluate(o)):t(o,s,a)}eachChild(o){o(this.lhs),o(this.rhs),this.collator&&o(this.collator)}outputDefined(){return!0}serialize(){const o=[e];return this.eachChild(s=>{o.push(s.serialize())}),o}}}const Ys=Bu("==",function(e,t,n){return t===n},e0),ow=Bu("!=",function(e,t,n){return t!==n},function(e,t,n,r){return!e0(0,t,n,r)}),sw=Bu("<",function(e,t,n){return t<n},function(e,t,n,r){return r.compare(t,n)<0}),aw=Bu(">",function(e,t,n){return t>n},function(e,t,n,r){return r.compare(t,n)>0}),lw=Bu("<=",function(e,t,n){return t<=n},function(e,t,n,r){return r.compare(t,n)<=0}),uw=Bu(">=",function(e,t,n){return t>=n},function(e,t,n,r){return r.compare(t,n)>=0});class ts{constructor(t,n,r,i,o,s){this.type=fn,this.number=t,this.locale=n,this.currency=r,this.unit=i,this.minFractionDigits=o,this.maxFractionDigits=s}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const r=n.parse(t[1],1,ie);if(!r)return null;const i=t[2];if(typeof i!="object"||Array.isArray(i))return n.error("NumberFormat options argument must be an object.");let o=null;if(i.locale&&(o=n.parse(i.locale,1,fn),!o))return null;let s=null;if(i.currency&&(s=n.parse(i.currency,1,fn),!s))return null;let a=null;if(i.unit&&(a=n.parse(i.unit,1,fn),!a))return null;let c=null;if(i["min-fraction-digits"]&&(c=n.parse(i["min-fraction-digits"],1,ie),!c))return null;let h=null;return i["max-fraction-digits"]&&(h=n.parse(i["max-fraction-digits"],1,ie),!h)?null:new ts(r,o,s,a,c,h)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Hp{constructor(t){this.type=ie,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const r=n.parse(t[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${er(r.type)} instead.`):new Hp(r):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string"||Array.isArray(n))return n.length;throw new ti(`Expected value to be of type string or array, but found ${er(gr(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(n=>{t.push(n.serialize())}),t}}function Zp(e){return function(){e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const n0={"==":Ys,"!=":ow,">":aw,"<":sw,">=":uw,"<=":lw,array:_s,at:Z,boolean:_s,case:Ml,coalesce:Q_,collator:of,format:Ba,image:ys,in:xf,"index-of":Vn,interpolate:xs,"interpolate-hcl":xs,"interpolate-lab":xs,length:Hp,let:Iu,literal:vl,match:rw,number:_s,"number-format":ts,object:_s,slice:iw,step:zp,string:_s,"to-boolean":Js,"to-color":Js,"to-number":Js,"to-string":Js,var:kp,within:Pa,distance:Au};function r0(e,[t,n,r,i]){t=t.evaluate(e),n=n.evaluate(e),r=r.evaluate(e);const o=i?i.evaluate(e):1,s=nf(t,n,r,o);if(s)throw new ti(s);return new Me(t/255*o,n/255*o,r/255*o,o)}function i0(e,[t,n,r,i]){t=t.evaluate(e),n=n.evaluate(e),r=r.evaluate(e);const o=i?i.evaluate(e):1,s=function(h,d,m,g){return typeof h=="number"&&h>=0&&h<=360?typeof d=="number"&&d>=0&&d<=100&&typeof m=="number"&&m>=0&&m<=100?g===void 0||typeof g=="number"&&g>=0&&g<=1?null:`Invalid hsla value [${[h,d,m,g].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof g=="number"?[h,d,m,g]:[h,d,m]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof g=="number"?[h,d,m,g]:[h,d,m]).join(", ")}]: 'h' must be between 0 and 360.`}(t,n,r,o);if(s)throw new ti(s);const a=`hsla(${t}, ${n}%, ${r}%, ${o})`,c=Me.parse(a);if(!c)throw new ti(`Failed to parse HSLA color: ${a}`);return c}function Oa(e,t){return e in t}function Wp(e,t){const n=t[e];return n===void 0?null:n}function o0(e,t){switch(e){case"string":return String(t);case"number":return+t;case"boolean":return!!t;case"color":return Me.parse(t)}return t}function ko(e,t,n,r){return r!==void 0&&(e=r*Math.round(e/r)),t!==void 0&&e<t&&(e=t),n!==void 0&&e>n&&(e=n),e}function s0(e,t,n){n.length&&(t+=`${n}`);const r=e.getConfig(t);if(!r)return null;const{type:i,value:o,values:s,minValue:a,maxValue:c,stepValue:h}=r,d=r.default.evaluate(e);let m=o?o.evaluate(e):d;return i&&(m=o0(i,m)),o!==void 0&&m!==void 0&&s&&!s.includes(m)&&(m=d,i&&(m=o0(i,m))),m===void 0||a===void 0&&c===void 0&&h===void 0||(typeof m=="number"?m=ko(m,a,c,h):Array.isArray(m)&&(m=m.map(g=>typeof g=="number"?ko(g,a,c,h):g))),m}function Il(e){return{type:e}}Po.register(n0,{error:[{kind:"error"},[fn],(e,[t])=>{throw new ti(t.evaluate(e))}],typeof:[fn,[gn],(e,[t])=>er(gr(t.evaluate(e)))],"to-rgba":[Ii(ie,4),[Do],(e,[t])=>t.evaluate(e).toArray()],rgb:[Do,[ie,ie,ie],r0],rgba:[Do,[ie,ie,ie,ie],r0],hsl:[Do,[ie,ie,ie],i0],hsla:[Do,[ie,ie,ie,ie],i0],has:{type:vn,overloads:[[[fn],(e,[t])=>Oa(t.evaluate(e),e.properties())],[[fn,mu],(e,[t,n])=>Oa(t.evaluate(e),n.evaluate(e))]]},get:{type:gn,overloads:[[[fn],(e,[t])=>Wp(t.evaluate(e),e.properties())],[[fn,mu],(e,[t,n])=>Wp(t.evaluate(e),n.evaluate(e))]]},config:{type:gn,overloads:[[[fn],(e,[t])=>s0(e,t.evaluate(e),"")],[[fn,fn],(e,[t,n])=>s0(e,t.evaluate(e),n.evaluate(e))]]},"feature-state":[gn,[fn],(e,[t])=>Wp(t.evaluate(e),e.featureState||{})],properties:[mu,[],e=>e.properties()],"geometry-type":[fn,[],e=>e.geometryType()],id:[gn,[],e=>e.id()],zoom:[ie,[],e=>e.globals.zoom],pitch:[ie,[],e=>e.globals.pitch||0],"distance-from-center":[ie,[],e=>e.distanceFromCenter()],"measure-light":[ie,[fn],(e,[t])=>e.measureLight(t.evaluate(e))],"heatmap-density":[ie,[],e=>e.globals.heatmapDensity||0],"line-progress":[ie,[],e=>e.globals.lineProgress||0],"raster-value":[ie,[],e=>e.globals.rasterValue||0],"sky-radial-progress":[ie,[],e=>e.globals.skyRadialProgress||0],accumulated:[gn,[],e=>e.globals.accumulated===void 0?null:e.globals.accumulated],"+":[ie,Il(ie),(e,t)=>{let n=0;for(const r of t)n+=r.evaluate(e);return n}],"*":[ie,Il(ie),(e,t)=>{let n=1;for(const r of t)n*=r.evaluate(e);return n}],"-":{type:ie,overloads:[[[ie,ie],(e,[t,n])=>t.evaluate(e)-n.evaluate(e)],[[ie],(e,[t])=>-t.evaluate(e)]]},"/":[ie,[ie,ie],(e,[t,n])=>t.evaluate(e)/n.evaluate(e)],"%":[ie,[ie,ie],(e,[t,n])=>t.evaluate(e)%n.evaluate(e)],ln2:[ie,[],()=>Math.LN2],pi:[ie,[],()=>Math.PI],e:[ie,[],()=>Math.E],"^":[ie,[ie,ie],(e,[t,n])=>Math.pow(t.evaluate(e),n.evaluate(e))],sqrt:[ie,[ie],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[ie,[ie],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[ie,[ie],(e,[t])=>Math.log(t.evaluate(e))],log2:[ie,[ie],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[ie,[ie],(e,[t])=>Math.sin(t.evaluate(e))],cos:[ie,[ie],(e,[t])=>Math.cos(t.evaluate(e))],tan:[ie,[ie],(e,[t])=>Math.tan(t.evaluate(e))],asin:[ie,[ie],(e,[t])=>Math.asin(t.evaluate(e))],acos:[ie,[ie],(e,[t])=>Math.acos(t.evaluate(e))],atan:[ie,[ie],(e,[t])=>Math.atan(t.evaluate(e))],min:[ie,Il(ie),(e,t)=>Math.min(...t.map(n=>n.evaluate(e)))],max:[ie,Il(ie),(e,t)=>Math.max(...t.map(n=>n.evaluate(e)))],abs:[ie,[ie],(e,[t])=>Math.abs(t.evaluate(e))],round:[ie,[ie],(e,[t])=>{const n=t.evaluate(e);return n<0?-Math.round(-n):Math.round(n)}],floor:[ie,[ie],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[ie,[ie],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[vn,[fn,gn],(e,[t,n])=>e.properties()[t.value]===n.value],"filter-id-==":[vn,[gn],(e,[t])=>e.id()===t.value],"filter-type-==":[vn,[fn],(e,[t])=>e.geometryType()===t.value],"filter-<":[vn,[fn,gn],(e,[t,n])=>{const r=e.properties()[t.value],i=n.value;return typeof r==typeof i&&r<i}],"filter-id-<":[vn,[gn],(e,[t])=>{const n=e.id(),r=t.value;return typeof n==typeof r&&n<r}],"filter->":[vn,[fn,gn],(e,[t,n])=>{const r=e.properties()[t.value],i=n.value;return typeof r==typeof i&&r>i}],"filter-id->":[vn,[gn],(e,[t])=>{const n=e.id(),r=t.value;return typeof n==typeof r&&n>r}],"filter-<=":[vn,[fn,gn],(e,[t,n])=>{const r=e.properties()[t.value],i=n.value;return typeof r==typeof i&&r<=i}],"filter-id-<=":[vn,[gn],(e,[t])=>{const n=e.id(),r=t.value;return typeof n==typeof r&&n<=r}],"filter->=":[vn,[fn,gn],(e,[t,n])=>{const r=e.properties()[t.value],i=n.value;return typeof r==typeof i&&r>=i}],"filter-id->=":[vn,[gn],(e,[t])=>{const n=e.id(),r=t.value;return typeof n==typeof r&&n>=r}],"filter-has":[vn,[gn],(e,[t])=>t.value in e.properties()],"filter-has-id":[vn,[],e=>e.id()!==null&&e.id()!==void 0],"filter-type-in":[vn,[Ii(fn)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[vn,[Ii(gn)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[vn,[fn,Ii(gn)],(e,[t,n])=>n.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[vn,[fn,Ii(gn)],(e,[t,n])=>function(r,i,o,s){for(;o<=s;){const a=o+s>>1;if(i[a]===r)return!0;i[a]>r?s=a-1:o=a+1}return!1}(e.properties()[t.value],n.value,0,n.value.length-1)],all:{type:vn,overloads:[[[vn,vn],(e,[t,n])=>t.evaluate(e)&&n.evaluate(e)],[Il(vn),(e,t)=>{for(const n of t)if(!n.evaluate(e))return!1;return!0}]]},any:{type:vn,overloads:[[[vn,vn],(e,[t,n])=>t.evaluate(e)||n.evaluate(e)],[Il(vn),(e,t)=>{for(const n of t)if(n.evaluate(e))return!0;return!1}]]},"!":[vn,[vn],(e,[t])=>!t.evaluate(e)],"is-supported-script":[vn,[fn],(e,[t])=>{const n=e.globals&&e.globals.isSupportedScript;return!n||n(t.evaluate(e))}],upcase:[fn,[fn],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[fn,[fn],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[fn,Il(gn),(e,t)=>t.map(n=>xl(n.evaluate(e))).join("")],"resolved-locale":[fn,[kc],(e,[t])=>t.evaluate(e).resolvedLocale()],random:[ie,[ie,ie,gn],(e,t)=>{const[n,r,i]=t.map(s=>s.evaluate(e));if(n>r||n===r)return n;let o;if(typeof i=="string")o=function(s){let a=0;if(s.length===0)return a;for(let c=0;c<s.length;c++)a=(a<<5)-a+s.charCodeAt(c),a&=a;return a}(i);else{if(typeof i!="number")throw new ti(`Invalid seed input: ${i}`);o=i}return n+Zp(o)()*(r-n)}]});var Zc=n0;function a0(e){return{result:"success",value:e}}function Bl(e){return{result:"error",value:e}}function qp(e,t){return!!e&&!!e.parameters&&e.parameters.indexOf(t)>-1}function Na(e){return e["property-type"]==="data-driven"}function l0(e){return qp(e.expression,"measure-light")}function Jp(e){return qp(e.expression,"zoom")}function Wc(e){return!!e.expression&&e.expression.interpolated}function Ua(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function wf(e){return e}function u0(e,t){const n=t.type==="color",r=e.stops&&typeof e.stops[0][0]=="object",i=r||!(r||e.property!==void 0),o=e.type||(Wc(t)?"exponential":"interval");if(n&&((e=Qo({},e)).stops&&(e.stops=e.stops.map(h=>[h[0],Me.parse(h[1])])),e.default=Me.parse(e.default?e.default:t.default)),e.colorSpace&&e.colorSpace!=="rgb"&&!Sl[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let s,a,c;if(o==="exponential")s=bf;else if(o==="interval")s=Qs;else if(o==="categorical"){s=cw,a=Object.create(null);for(const h of e.stops)a[h[0]]=h[1];c=typeof e.stops[0][0]}else{if(o!=="identity")throw new Error(`Unknown function type "${o}"`);s=Dl}if(r){const h={},d=[];for(let x=0;x<e.stops.length;x++){const v=e.stops[x],w=v[0].zoom;h[w]===void 0&&(h[w]={zoom:w,type:e.type,property:e.property,default:e.default,stops:[]},d.push(w)),h[w].stops.push([v[0].value,v[1]])}const m=[];for(const x of d)m.push([h[x].zoom,u0(h[x],t)]);const g={name:"linear"};return{kind:"composite",interpolationType:g,interpolationFactor:xs.interpolationFactor.bind(void 0,g),zoomStops:m.map(x=>x[0]),evaluate:({zoom:x},v)=>bf({stops:m,base:e.base},t,x).evaluate(x,v)}}if(i){const h=o==="exponential"?{name:"exponential",base:e.base!==void 0?e.base:1}:null;return{kind:"camera",interpolationType:h,interpolationFactor:xs.interpolationFactor.bind(void 0,h),zoomStops:e.stops.map(d=>d[0]),evaluate:({zoom:d})=>s(e,t,d,a,c)}}return{kind:"source",evaluate(h,d){const m=d&&d.properties?d.properties[e.property]:void 0;return m===void 0?Du(e.default,t.default):s(e,t,m,a,c)}}}function Du(e,t,n){return e!==void 0?e:t!==void 0?t:n!==void 0?n:void 0}function cw(e,t,n,r,i){return Du(typeof n===i?r[n]:void 0,e.default,t.default)}function Qs(e,t,n){if(Mn(n)!=="number")return Du(e.default,t.default);const r=e.stops.length;if(r===1||n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[r-1][0])return e.stops[r-1][1];const i=pf(e.stops.map(o=>o[0]),n);return e.stops[i][1]}function bf(e,t,n){const r=e.base!==void 0?e.base:1;if(Mn(n)!=="number")return Du(e.default,t.default);const i=e.stops.length;if(i===1||n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[i-1][0])return e.stops[i-1][1];const o=pf(e.stops.map(d=>d[0]),n),s=function(d,m,g,x){const v=x-g,w=d-g;return v===0?0:m===1?w/v:(Math.pow(m,w)-1)/(Math.pow(m,v)-1)}(n,r,e.stops[o][0],e.stops[o+1][0]),a=e.stops[o][1],c=e.stops[o+1][1];let h=Cu[t.type]||wf;if(e.colorSpace&&e.colorSpace!=="rgb"){const d=Sl[e.colorSpace];h=(m,g)=>d.reverse(d.interpolate(d.forward(m),d.forward(g),s))}return typeof a.evaluate=="function"?{evaluate(...d){const m=a.evaluate.apply(void 0,d),g=c.evaluate.apply(void 0,d);if(m!==void 0&&g!==void 0)return h(m,g,s)}}:h(a,c,s)}function Dl(e,t,n){return t.type==="color"?n=Me.parse(n):t.type==="formatted"?n=Wr.fromString(n.toString()):t.type==="resolvedImage"?n=ji.fromString(n.toString()):Mn(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0),Du(n,e.default,t.default)}class so{constructor(t,n,r){this.expression=t,this._warningHistory={},this._evaluator=new Cp(r),this._defaultValue=n?function(i){return i.type==="color"&&(Ua(i.default)||Array.isArray(i.default))?new Me(0,0,0,0):i.type==="color"?Me.parse(i.default)||null:i.default===void 0?null:i.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(t,n,r,i,o,s,a,c){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=r,this._evaluator.canonical=i||null,this._evaluator.availableImages=o||null,this._evaluator.formattedSection=s,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=c||null,this.expression.evaluate(this._evaluator)}evaluate(t,n,r,i,o,s,a,c){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=r||null,this._evaluator.canonical=i||null,this._evaluator.availableImages=o||null,this._evaluator.formattedSection=s||null,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=c||null;try{const h=this.expression.evaluate(this._evaluator);if(h==null||typeof h=="number"&&h!=h)return this._defaultValue;if(this._enumValues&&!(h in this._enumValues))throw new ti(`Expected value to be one of ${Object.keys(this._enumValues).map(d=>JSON.stringify(d)).join(", ")}, but found ${JSON.stringify(h)} instead.`);return h}catch(h){return this._warningHistory[h.message]||(this._warningHistory[h.message]=!0,typeof console<"u"&&console.warn(h.message)),this._defaultValue}}}function Af(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in Zc}function ta(e,t,n){const r=new ka(Zc,[],t?function(o){const s={color:Do,string:fn,number:ie,enum:fn,boolean:vn,formatted:Fc,resolvedImage:Zr};return o.type==="array"?Ii(s[o.value]||gn,o.length):s[o.type]}(t):void 0,void 0,void 0,n),i=r.parse(e,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return i?a0(new so(i,t,n)):Bl(r.errors)}class Ef{constructor(t,n,r){this.kind=t,this._styleExpression=n,this.isLightConstant=r,this.isStateDependent=t!=="constant"&&!Ra(n.expression),this.isConfigDependent=!df(n.expression)}evaluateWithoutErrorHandling(t,n,r,i,o,s){return this._styleExpression.evaluateWithoutErrorHandling(t,n,r,i,o,s)}evaluate(t,n,r,i,o,s){return this._styleExpression.evaluate(t,n,r,i,o,s)}}class Fo{constructor(t,n,r,i,o){this.kind=t,this.zoomStops=r,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!Ra(n.expression),this.isLightConstant=o,this.isConfigDependent=!df(n.expression),this.interpolationType=i}evaluateWithoutErrorHandling(t,n,r,i,o,s){return this._styleExpression.evaluateWithoutErrorHandling(t,n,r,i,o,s)}evaluate(t,n,r,i,o,s){return this._styleExpression.evaluate(t,n,r,i,o,s)}interpolationFactor(t,n,r){return this.interpolationType?xs.interpolationFactor(this.interpolationType,t,n,r):0}}function vs(e,t,n){if((e=ta(e,t,n)).result==="error")return e;const r=e.value.expression,i=bl(r);if(!i&&!Na(t))return Bl([new gs("","data expressions not supported")]);const o=Al(r,["zoom","pitch","distance-from-center"]);if(!o&&!Jp(t))return Bl([new gs("","zoom expressions not supported")]);const s=Al(r,["measure-light"]);if(!s&&!l0(t))return Bl([new gs("","measure-light expression not supported")]);const a=t.expression&&t.expression.relaxZoomRestriction,c=Tf(r);return c||o||a?c instanceof gs?Bl([c]):c instanceof xs&&!Wc(t)?Bl([new gs("",'"interpolate" expressions cannot be used with this property')]):a0(c?new Fo(i?"camera":"composite",e.value,c.labels,c instanceof xs?c.interpolation:void 0,s):new Ef(i?"constant":"source",e.value,s)):Bl([new gs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class qc{constructor(t,n){this._parameters=t,this._specification=n,Qo(this,u0(this._parameters,this._specification))}static deserialize(t){return new qc(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Tf(e){let t=null;if(e instanceof Iu)t=Tf(e.result);else if(e instanceof Q_){for(const n of e.args)if(t=Tf(n),t)break}else(e instanceof zp||e instanceof xs)&&e.input instanceof Po&&e.input.name==="zoom"&&(t=e);return t instanceof gs||e.eachChild(n=>{const r=Tf(n);r instanceof gs?t=r:t&&r&&t!==r&&(t=new gs("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Zi(e){const t=e.key,n=e.value,r=e.valueSpec||{},i=e.objectElementValidators||{},o=e.style,s=e.styleSpec;let a=[];const c=Mn(n);if(c!=="object")return[new ae(t,n,`object expected, ${c} found`)];for(const h in n){const d=h.split(".")[0];let m;i[d]?m=i[d]:r[d]?m=ri:i["*"]?m=i["*"]:r["*"]&&(m=ri),m?a=a.concat(m({key:(t&&`${t}.`)+h,value:n[h],valueSpec:r[d]||r["*"],style:o,styleSpec:s,object:n,objectKey:h},n)):a.push(new _l(t,n[h],`unknown property "${h}"`))}for(const h in r)i[h]||r[h].required&&r[h].default===void 0&&n[h]===void 0&&a.push(new ae(t,n,`missing required property "${h}"`));return a}function c0(e){const t=e.value,n=e.valueSpec,r=e.style,i=e.styleSpec,o=e.key,s=e.arrayElementValidator||ri;if(Mn(t)!=="array")return[new ae(o,t,`array expected, ${Mn(t)} found`)];if(n.length&&t.length!==n.length)return[new ae(o,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new ae(o,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let a={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};i.$version<7&&(a.function=n.function),Mn(n.value)==="object"&&(a=n.value);let c=[];for(let h=0;h<t.length;h++)c=c.concat(s({array:t,arrayIndex:h,value:t[h],valueSpec:a,style:r,styleSpec:i,key:`${o}[${h}]`},!0));return c}function $p(e){const t=e.key,n=e.value,r=e.valueSpec;let i=Mn(n);if(i==="number"&&n!=n&&(i="NaN"),i!=="number")return[new ae(t,n,`number expected, ${i} found`)];if("minimum"in r){let o=r.minimum;if(Mn(r.minimum)==="array"&&(o=r.minimum[e.arrayIndex]),n<o)return[new ae(t,n,`${n} is less than the minimum value ${o}`)]}if("maximum"in r){let o=r.maximum;if(Mn(r.maximum)==="array"&&(o=r.maximum[e.arrayIndex]),n>o)return[new ae(t,n,`${n} is greater than the maximum value ${o}`)]}return[]}function di(e){const t=e.valueSpec,n=kr(e.value.type);let r,i,o,s={};const a=n!=="categorical"&&e.value.property===void 0,c=!a,h=Mn(e.value.stops)==="array"&&Mn(e.value.stops[0])==="array"&&Mn(e.value.stops[0][0])==="object",d=Zi({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(x){if(n==="identity")return[new ae(x.key,x.value,'identity function may not have a "stops" property')];let v=[];const w=x.value;return v=v.concat(c0({key:x.key,value:w,valueSpec:x.valueSpec,style:x.style,styleSpec:x.styleSpec,arrayElementValidator:m})),Mn(w)==="array"&&w.length===0&&v.push(new ae(x.key,w,"array must have at least one stop")),v},default:function(x){return ri({key:x.key,value:x.value,valueSpec:t,style:x.style,styleSpec:x.styleSpec})}}});return n==="identity"&&a&&d.push(new ae(e.key,e.value,'missing required property "property"')),n==="identity"||e.value.stops||d.push(new ae(e.key,e.value,'missing required property "stops"')),n==="exponential"&&e.valueSpec.expression&&!Wc(e.valueSpec)&&d.push(new ae(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(c&&!Na(e.valueSpec)?d.push(new ae(e.key,e.value,"property functions not supported")):a&&!Jp(e.valueSpec)&&d.push(new ae(e.key,e.value,"zoom functions not supported"))),n!=="categorical"&&!h||e.value.property!==void 0||d.push(new ae(e.key,e.value,'"property" property is required')),d;function m(x){let v=[];const w=x.value,A=x.key;if(Mn(w)!=="array")return[new ae(A,w,`array expected, ${Mn(w)} found`)];if(w.length!==2)return[new ae(A,w,`array length 2 expected, length ${w.length} found`)];if(h){if(Mn(w[0])!=="object")return[new ae(A,w,`object expected, ${Mn(w[0])} found`)];if(w[0].zoom===void 0)return[new ae(A,w,"object stop key must have zoom")];if(w[0].value===void 0)return[new ae(A,w,"object stop key must have value")];const E=kr(w[0].zoom);if(typeof E!="number")return[new ae(A,w[0].zoom,"stop zoom values must be numbers")];if(o&&o>E)return[new ae(A,w[0].zoom,"stop zoom values must appear in ascending order")];E!==o&&(o=E,i=void 0,s={}),v=v.concat(Zi({key:`${A}[0]`,value:w[0],valueSpec:{zoom:{}},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{zoom:$p,value:g}}))}else v=v.concat(g({key:`${A}[0]`,value:w[0],valueSpec:{},style:x.style,styleSpec:x.styleSpec},w));return Af(qs(w[1]))?v.concat([new ae(`${A}[1]`,w[1],"expressions are not allowed in function stops.")]):v.concat(ri({key:`${A}[1]`,value:w[1],valueSpec:t,style:x.style,styleSpec:x.styleSpec}))}function g(x,v){const w=Mn(x.value),A=kr(x.value),E=x.value!==null?x.value:v;if(r){if(w!==r)return[new ae(x.key,E,`${w} stop domain type must match previous stop domain type ${r}`)]}else r=w;if(w!=="number"&&w!=="string"&&w!=="boolean"&&typeof A!="number"&&typeof A!="string"&&typeof A!="boolean")return[new ae(x.key,E,"stop domain value must be a number, string, or boolean")];if(w!=="number"&&n!=="categorical"){let S=`number expected, ${w} found`;return Na(t)&&n===void 0&&(S+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ae(x.key,E,S)]}return n!=="categorical"||w!=="number"||typeof A=="number"&&isFinite(A)&&Math.floor(A)===A?n!=="categorical"&&w==="number"&&typeof A=="number"&&typeof i=="number"&&i!==void 0&&A<i?[new ae(x.key,E,"stop domain values must appear in ascending order")]:(i=A,n==="categorical"&&A in s?[new ae(x.key,E,"stop domain values must be unique")]:(s[A]=!0,[])):[new ae(x.key,E,`integer expected, found ${String(A)}`)]}}function ea(e){const t=(e.expressionContext==="property"?vs:ta)(qs(e.value),e.valueSpec);if(t.result==="error")return t.value.map(r=>new ae(`${e.key}${r.key}`,e.value,r.message));const n=t.value.expression||t.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!n.outputDefined())return[new ae(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!Ra(n))return[new ae(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter")return Kp(n,e);if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!Al(n,["zoom","feature-state"]))return[new ae(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!bl(n))return[new ae(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Kp(e,t){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const i of t.valueSpec.expression.parameters)n.delete(i);if(n.size===0)return[];const r=[];return e instanceof Po&&n.has(e.name)?[new ae(t.key,t.value,`["${e.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(e.eachChild(i=>{r.push(...Kp(i,t))}),r)}function yo(e){const t=e.key,n=e.value,r=e.valueSpec,i=[];return Array.isArray(r.values)?r.values.indexOf(kr(n))===-1&&i.push(new ae(t,n,`expected one of [${r.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(r.values).indexOf(kr(n))===-1&&i.push(new ae(t,n,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(n)} found`)),i}function Jc(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Jc(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function Pl(e,t="fill"){if(e==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Jc(e)||(e=Cf(e));const n=e;let r=!0;try{r=function(h){if(!ni(h))return h;let d=qs(h);return Xp(d),d=Va(d),d}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}const i=ut[`filter_${t}`],o=ta(r,i);let s=null;if(o.result==="error")throw new Error(o.value.map(h=>`${h.key}: ${h.message}`).join(", "));s=(h,d,m)=>o.value.evaluate(h,d,{},m);let a=null,c=null;if(r!==n){const h=ta(n,i);if(h.result==="error")throw new Error(h.value.map(d=>`${d.key}: ${d.message}`).join(", "));a=(d,m,g,x,v)=>h.value.evaluate(d,m,{},g,void 0,void 0,x,v),c=!bl(h.value.expression)}return{filter:s,dynamicFilter:a||void 0,needGeometry:h0(r),needFeature:!!c}}function Va(e){if(!Array.isArray(e))return e;const t=function(n){if(Yp.has(n[0])){for(let r=1;r<n.length;r++)if(ni(n[r]))return!0}return n}(e);return t===!0?t:t.map(n=>Va(n))}function Xp(e){let t=!1;const n=[];if(e[0]==="case"){for(let r=1;r<e.length-1;r+=2)t=t||ni(e[r]),n.push(e[r+1]);n.push(e[e.length-1])}else if(e[0]==="match"){t=t||ni(e[1]);for(let r=2;r<e.length-1;r+=2)n.push(e[r+1]);n.push(e[e.length-1])}else if(e[0]==="step"){t=t||ni(e[1]);for(let r=1;r<e.length-1;r+=2)n.push(e[r+1])}t&&(e.length=0,e.push("any",...n));for(let r=1;r<e.length;r++)Xp(e[r])}function ni(e){if(!Array.isArray(e))return!1;if((t=e[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let n=1;n<e.length;n++)if(ni(e[n]))return!0;return!1}const Yp=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function hw(e,t){return e<t?-1:e>t?1:0}function h0(e){if(!Array.isArray(e))return!1;if(e[0]==="within"||e[0]==="distance")return!0;for(let t=1;t<e.length;t++)if(h0(e[t]))return!0;return!1}function Cf(e){if(!e)return!0;const t=e[0];return e.length<=1?t!=="any":t==="=="?$c(e[1],e[2],"=="):t==="!="?Kc($c(e[1],e[2],"==")):t==="<"||t===">"||t==="<="||t===">="?$c(e[1],e[2],t):t==="any"?(n=e.slice(1),["any"].concat(n.map(Cf))):t==="all"?["all"].concat(e.slice(1).map(Cf)):t==="none"?["all"].concat(e.slice(1).map(Cf).map(Kc)):t==="in"?f0(e[1],e.slice(2)):t==="!in"?Kc(f0(e[1],e.slice(2))):t==="has"?Pu(e[1]):t!=="!has"||Kc(Pu(e[1]));var n}function $c(e,t,n){switch(e){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,e,t]}}function f0(e,t){if(t.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",e,["literal",t.sort(hw)]]:["filter-in-small",e,["literal",t]]}}function Pu(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Kc(e){return["!",e]}function Qp(e){return Jc(qs(e.value))?ea(Qo({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${e.layerType||"fill"}`]})):d0(e)}function d0(e){const t=e.value,n=e.key;if(Mn(t)!=="array")return[new ae(n,t,`array expected, ${Mn(t)} found`)];const r=e.styleSpec;let i,o=[];if(t.length<1)return[new ae(n,t,"filter array must have at least 1 element")];switch(o=o.concat(yo({key:`${n}[0]`,value:t[0],valueSpec:r.filter_operator,style:e.style,styleSpec:e.styleSpec})),kr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&kr(t[1])==="$type"&&o.push(new ae(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&o.push(new ae(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(i=Mn(t[1]),i!=="string"&&o.push(new ae(`${n}[1]`,t[1],`string expected, ${i} found`)));for(let s=2;s<t.length;s++)i=Mn(t[s]),kr(t[1])==="$type"?o=o.concat(yo({key:`${n}[${s}]`,value:t[s],valueSpec:r.geometry_type,style:e.style,styleSpec:e.styleSpec})):i!=="string"&&i!=="number"&&i!=="boolean"&&o.push(new ae(`${n}[${s}]`,t[s],`string, number, or boolean expected, ${i} found`));break;case"any":case"all":case"none":for(let s=1;s<t.length;s++)o=o.concat(d0({key:`${n}[${s}]`,value:t[s],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":i=Mn(t[1]),t.length!==2?o.push(new ae(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):i!=="string"&&o.push(new ae(`${n}[1]`,t[1],`string expected, ${i} found`))}return o}function Lu(e,t){const n=e.key,r=e.style,i=e.layer,o=e.styleSpec,s=e.value,a=e.objectKey,c=o[`${t}_${e.layerType}`];if(!c)return[];const h=a.match(/^(.*)-transition$/);if(t==="paint"&&h&&c[h[1]]&&c[h[1]].transition)return ri({key:n,value:s,valueSpec:o.transition,style:r,styleSpec:o});const d=e.valueSpec||c[a];if(!d)return[new _l(n,s,`unknown property "${a}"`)];let m;if(Mn(s)==="string"&&Na(d)&&!d.tokens&&(m=/^{([^}]+)}$/.exec(s))){const x=`\`{ "type": "identity", "property": ${m?JSON.stringify(m[1]):'"_"'} }\``;return[new ae(n,s,`"${a}" does not support interpolation syntax
Use an identity property function instead: ${x}.`)]}const g=[];if(e.layerType==="symbol")a!=="text-field"||!r||r.glyphs||r.imports||g.push(new ae(n,s,'use of "text-field" requires a style "glyphs" property')),a==="text-font"&&Ua(qs(s))&&kr(s.type)==="identity"&&g.push(new ae(n,s,'"text-font" does not support identity functions'));else if(e.layerType==="model"&&t==="paint"&&i&&i.layout&&i.layout.hasOwnProperty("model-id")&&Na(d)&&(l0(d)||Jp(d))){const x=vs(qs(s),d),v=x.value.expression||x.value._styleExpression.expression;v&&!Al(v,["measure-light"])&&(a==="model-emissive-strength"&&bl(v)&&Ra(v)||g.push(new ae(n,s,`${a} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return g.concat(ri({key:e.key,value:s,valueSpec:d,style:r,styleSpec:o,expressionContext:"property",propertyType:t,propertyKey:a}))}function p0(e){return Lu(e,"paint")}function m0(e){return Lu(e,"layout")}function Sf(e){let t=[];const n=e.value,r=e.key,i=e.style,o=e.styleSpec;n.type||n.ref||t.push(new ae(r,n,'either "type" or "ref" is required'));let s=kr(n.type);const a=kr(n.ref);if(n.id){const c=kr(n.id);for(let h=0;h<e.arrayIndex;h++){const d=i.layers[h];kr(d.id)===c&&t.push(new ae(r,n.id,`duplicate layer id "${n.id}", previously used at line ${d.id.__line__}`))}}if("ref"in n){let c;["type","source","source-layer","filter","layout"].forEach(h=>{h in n&&t.push(new ae(r,n[h],`"${h}" is prohibited for ref layers`))}),i.layers.forEach(h=>{kr(h.id)===a&&(c=h)}),c?c.ref?t.push(new ae(r,n.ref,"ref cannot reference another ref layer")):s=kr(c.type):typeof a=="string"&&t.push(new ae(r,n.ref,`ref layer "${a}" not found`))}else if(s!=="background"&&s!=="sky"&&s!=="slot")if(n.source){const c=i.sources&&i.sources[n.source],h=c&&kr(c.type);c?h==="vector"&&s==="raster"?t.push(new ae(r,n.source,`layer "${n.id}" requires a raster source`)):h==="raster"&&s!=="raster"?t.push(new ae(r,n.source,`layer "${n.id}" requires a vector source`)):h!=="vector"||n["source-layer"]?h==="raster-dem"&&s!=="hillshade"?t.push(new ae(r,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):s!=="line"||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||h==="geojson"&&c.lineMetrics||t.push(new ae(r,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ae(r,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new ae(r,n.source,`source "${n.source}" not found`))}else t.push(new ae(r,n,'missing required property "source"'));return t=t.concat(Zi({key:r,value:n,valueSpec:o.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ri({key:`${r}.type`,value:n.type,valueSpec:o.layer.type,style:e.style,styleSpec:e.styleSpec,object:n,objectKey:"type"}),filter:c=>Qp(Qo({layerType:s},c)),layout:c=>Zi({layer:n,key:c.key,value:c.value,valueSpec:{},style:c.style,styleSpec:c.styleSpec,objectElementValidators:{"*":h=>m0(Qo({layerType:s},h))}}),paint:c=>Zi({layer:n,key:c.key,value:c.value,valueSpec:{},style:c.style,styleSpec:c.styleSpec,objectElementValidators:{"*":h=>p0(Qo({layerType:s,layer:n},h))}})}})),t}function Ll(e){const t=e.value,n=e.key,r=Mn(t);return r!=="string"?[new ae(n,t,`string expected, ${r} found`)]:[]}const g0={promoteId:function({key:e,value:t}){if(Mn(t)==="string")return Ll({key:e,value:t});{const n=[];for(const r in t)n.push(...Ll({key:`${e}.${r}`,value:t[r]}));return n}}};function _0(e){const t=e.value,n=e.key,r=e.styleSpec,i=e.style;if(!t.type)return[new ae(n,t,'"type" is required')];const o=kr(t.type);let s=[];switch(["vector","raster","raster-dem"].includes(o)&&(t.url||t.tiles||s.push(new ae(n,t,'Either "url" or "tiles" is required.'))),o){case"vector":case"raster":case"raster-dem":return s=s.concat(Zi({key:n,value:t,valueSpec:r[`source_${o.replace("-","_")}`],style:e.style,styleSpec:r,objectElementValidators:g0})),s;case"geojson":if(s=Zi({key:n,value:t,valueSpec:r.source_geojson,style:i,styleSpec:r,objectElementValidators:g0}),t.cluster)for(const a in t.clusterProperties){const[c,h]=t.clusterProperties[a],d=typeof c=="string"?[c,["accumulated"],["get",a]]:c;s.push(...ea({key:`${n}.${a}.map`,value:h,expressionContext:"cluster-map"})),s.push(...ea({key:`${n}.${a}.reduce`,value:d,expressionContext:"cluster-reduce"}))}return s;case"video":return Zi({key:n,value:t,valueSpec:r.source_video,style:i,styleSpec:r});case"image":return Zi({key:n,value:t,valueSpec:r.source_image,style:i,styleSpec:r});case"canvas":return[new ae(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return yo({key:`${n}.type`,value:t.type,valueSpec:{values:fw(r)},style:i,styleSpec:r})}}function fw(e){return e.source.reduce((t,n)=>{const r=e[n];return r.type.type==="enum"&&(t=t.concat(Object.keys(r.type.values))),t},[])}function tm(e){const t=e.value;let n=[];if(!t)return n;const r=Mn(t);return r!=="string"?(n=n.concat([new ae(e.key,t,`string expected, "${r}" found`)]),n):(function(i){const o=i.indexOf("://")===-1;try{return new URL(i,o?"http://example.com":void 0),!0}catch{return!1}}(t)||(n=n.concat([new ae(e.key,t,`invalid url "${t}"`)])),n)}function Mf(e){const t=e.value,n=e.styleSpec,r=n.light,i=e.style;let o=[];const s=Mn(t);if(t===void 0)return o;if(s!=="object")return o=o.concat([new ae("light",t,`object expected, ${s} found`)]),o;for(const a in t){const c=a.match(/^(.*)-transition$/);o=o.concat(c&&r[c[1]]&&r[c[1]].transition?ri({key:a,value:t[a],valueSpec:n.transition,style:i,styleSpec:n}):r[a]?ri({key:a,value:t[a],valueSpec:r[a],style:i,styleSpec:n}):[new ae(a,t[a],`unknown property "${a}"`)])}return o}function y0(e){const t=e.value;let n=[];if(!t)return n;const r=Mn(t);if(r!=="object")return n=n.concat([new ae("light-3d",t,`object expected, ${r} found`)]),n;const i=e.styleSpec,o=i["light-3d"],s=e.key,a=e.style,c=e.style.lights;for(const m of["type","id"])if(!(m in t))return n=n.concat([new ae("light-3d",t,`missing property ${m} on light`)]),n;if(t.type&&c)for(let m=0;m<e.arrayIndex;m++){const g=kr(t.type),x=c[m];kr(x.type)===g&&n.push(new ae(s,t.id,`duplicate light type "${t.type}", previously defined at line ${x.id.__line__}`))}const h=`properties_light_${t.type}`;if(!(h in i))return n=n.concat([new ae("light-3d",t,`Invalid light type ${t.type}`)]),n;const d=i[h];for(const m in t)if(m==="properties"){const g=t[m],x=Mn(g);if(x!=="object")return n=n.concat([new ae("properties",g,`object expected, ${x} found`)]),n;for(const v in g)n=n.concat(d[v]?ri({key:v,value:g[v],valueSpec:d[v],style:a,styleSpec:i}):[new _l(e.key,g[v],`unknown property "${v}"`)])}else{const g=m.match(/^(.*)-transition$/);n=n.concat(g&&o[g[1]]&&o[g[1]].transition?ri({key:m,value:t[m],valueSpec:i.transition,style:a,styleSpec:i}):o[m]?ri({key:m,value:t[m],valueSpec:o[m],style:a,styleSpec:i}):[new _l(m,t[m],`unknown property "${m}"`)])}return n}function If(e){const t=e.value,n=e.key,r=e.style,i=e.styleSpec,o=i.terrain;let s=[];const a=Mn(t);if(t===void 0||a==="null")return s;if(a!=="object")return s=s.concat([new ae("terrain",t,`object expected, ${a} found`)]),s;for(const c in t){const h=c.match(/^(.*)-transition$/);s=s.concat(h&&o[h[1]]&&o[h[1]].transition?ri({key:c,value:t[c],valueSpec:i.transition,style:r,styleSpec:i}):o[c]?ri({key:c,value:t[c],valueSpec:o[c],style:r,styleSpec:i}):[new _l(c,t[c],`unknown property "${c}"`)])}if(t.source){const c=r.sources&&r.sources[t.source],h=c&&kr(c.type);c?h!=="raster-dem"&&s.push(new ae(n,t.source,`terrain cannot be used with a source of type ${String(h)}, it only be used with a "raster-dem" source type`)):s.push(new ae(n,t.source,`source "${t.source}" not found`))}else s.push(new ae(n,t,'terrain is missing required property "source"'));return s}function em(e){const t=e.value,n=e.style,r=e.styleSpec,i=r.fog;let o=[];const s=Mn(t);if(t===void 0)return o;if(s!=="object")return o=o.concat([new ae("fog",t,`object expected, ${s} found`)]),o;for(const a in t){const c=a.match(/^(.*)-transition$/);o=o.concat(c&&i[c[1]]&&i[c[1]].transition?ri({key:a,value:t[a],valueSpec:r.transition,style:n,styleSpec:r}):i[a]?ri({key:a,value:t[a],valueSpec:i[a],style:n,styleSpec:r}):[new _l(a,t[a],`unknown property "${a}"`)])}return o}const nm={"*":()=>[],array:c0,boolean:function(e){const t=e.value,n=e.key,r=Mn(t);return r!=="boolean"?[new ae(n,t,`boolean expected, ${r} found`)]:[]},number:$p,color:function(e){const t=e.key,n=e.value,r=Mn(n);return r!=="string"?[new ae(t,n,`color expected, ${r} found`)]:Qh(n)===null?[new ae(t,n,`color expected, "${n}" found`)]:[]},enum:yo,filter:Qp,function:di,layer:Sf,object:Zi,source:_0,model:tm,light:Mf,"light-3d":y0,terrain:If,fog:em,string:Ll,formatted:function(e){return Ll(e).length===0?[]:ea(e)},resolvedImage:function(e){return Ll(e).length===0?[]:ea(e)},projection:function(e){const t=e.value,n=e.styleSpec,r=n.projection,i=e.style;let o=[];const s=Mn(t);if(s==="object")for(const a in t)o=o.concat(ri({key:a,value:t[a],valueSpec:r[a],style:i,styleSpec:n}));else s!=="string"&&(o=o.concat([new ae("projection",t,`object or string expected, ${s} found`)]));return o},import:function(e){const{value:t,styleSpec:n}=e,{data:r,...i}=t;Object.defineProperty(i,"__line__",{value:t.__line__,enumerable:!1});let o=Zi(Qo({},e,{value:i,valueSpec:n.import}));return kr(i.id)===""&&o.push(new ae(`${e.key}.id`,i,"import id can't be an empty string")),r&&(o=o.concat(x0(r,n,{key:`${e.key}.data`}))),o}};function ri(e,t=!1){const n=e.value,r=e.valueSpec,i=e.styleSpec;if(r.expression&&Ua(kr(n)))return di(e);if(r.expression&&Af(qs(n)))return ea(e);if(r.type&&nm[r.type]){const o=nm[r.type](e);return t===!0&&o.length>0&&Mn(e.value)==="array"?ea(e):o}return Zi(Qo({},e,{valueSpec:r.type?i[r.type]:r}))}function Bf(e){const t=e.value,n=e.key,r=Ll(e);return r.length||(t.indexOf("{fontstack}")===-1&&r.push(new ae(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&r.push(new ae(n,t,'"glyphs" url must include a "{range}" token'))),r}function x0(e,t=ut,n={}){return ri({key:n.key||"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Bf,"*":()=>[]}})}function Rl(e,t=ut){return es(x0(e,t))}const v0=e=>es(_0(e)),dw=e=>es(Mf(e)),w0=e=>es(y0(e)),pw=e=>es(If(e)),rm=e=>es(em(e)),b0=e=>es(Sf(e)),Xc=e=>es(Qp(e)),mw=e=>es(p0(e)),im=e=>es(m0(e)),In=e=>es(tm(e));function es(e){return e.slice().sort((t,n)=>t.line&&n.line?t.line-n.line:0)}function Df(e,t){let n=!1;if(t&&t.length)for(const r of t)r instanceof _l?rt(r.message):(e.fire(new Ie(new Error(r.message))),n=!0);return n}var Yc=ws,na=3;function ws(e,t,n){var r=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var i=new Int32Array(this.arrayBuffer);e=i[0],this.d=(t=i[1])+2*(n=i[2]);for(var o=0;o<this.d*this.d;o++){var s=i[na+o],a=i[na+o+1];r.push(s===a?null:i.subarray(s,a))}var c=i[na+r.length+1];this.keys=i.subarray(i[na+r.length],c),this.bboxes=i.subarray(c),this.insert=this._insertReadonly}else{this.d=t+2*n;for(var h=0;h<this.d*this.d;h++)r.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=n,this.scale=t/e,this.uid=0;var d=n/t*e;this.min=-d,this.max=e+d}ws.prototype.insert=function(e,t,n,r,i){this._forEachCell(t,n,r,i,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)},ws.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ws.prototype._insertCell=function(e,t,n,r,i,o){this.cells[i].push(o)},ws.prototype.query=function(e,t,n,r,i){var o=this.min,s=this.max;if(e<=o&&t<=o&&s<=n&&s<=r&&!i)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(e,t,n,r,this._queryCell,a,{},i),a},ws.prototype._queryCell=function(e,t,n,r,i,o,s,a){var c=this.cells[i];if(c!==null)for(var h=this.keys,d=this.bboxes,m=0;m<c.length;m++){var g=c[m];if(s[g]===void 0){var x=4*g;(a?a(d[x+0],d[x+1],d[x+2],d[x+3]):e<=d[x+2]&&t<=d[x+3]&&n>=d[x+0]&&r>=d[x+1])?(s[g]=!0,o.push(h[g])):s[g]=!1}}},ws.prototype._forEachCell=function(e,t,n,r,i,o,s,a){for(var c=this._convertToCellCoord(e),h=this._convertToCellCoord(t),d=this._convertToCellCoord(n),m=this._convertToCellCoord(r),g=c;g<=d;g++)for(var x=h;x<=m;x++){var v=this.d*x+g;if((!a||a(this._convertFromCellCoord(g),this._convertFromCellCoord(x),this._convertFromCellCoord(g+1),this._convertFromCellCoord(x+1)))&&i.call(this,e,t,n,r,v,o,s,a))return}},ws.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},ws.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},ws.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=na+this.cells.length+1+1,n=0,r=0;r<this.cells.length;r++)n+=this.cells[r].length;var i=new Int32Array(t+n+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var o=t,s=0;s<e.length;s++){var a=e[s];i[na+s]=o,i.set(a,o),o+=a.length}return i[na+e.length]=o,i.set(this.keys,o),i[na+e.length+1]=o+=this.keys.length,i.set(this.bboxes,o),o+=this.bboxes.length,i.buffer};var Ru=It(Yc);const Wi={};function le(e,t,n={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Wi[t]={klass:e,omit:n.omit||[]}}le(Object,"Object"),Ru.serialize=function(e,t){const n=e.toArrayBuffer();return t&&t.add(n),{buffer:n}},Ru.deserialize=function(e){return new Ru(e.buffer)},Object.defineProperty(Ru,"name",{value:"Grid"}),le(Ru,"Grid"),le(Me,"Color"),le(Error,"Error"),le(Ct,"AJAXError"),le(ji,"ResolvedImage"),le(qc,"StylePropertyFunction"),le(so,"StyleExpression",{omit:["_evaluator"]}),le(Fo,"ZoomDependentExpression"),le(Ef,"ZoomConstantExpression"),le(Po,"CompoundExpression",{omit:["_evaluate"]});for(const e in Zc)Wi[Zc[e]._classRegistryKey]||le(Zc[e],`Expression${e}`);function Qc(e){return e&&typeof ArrayBuffer<"u"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function Pf(e){return k.ImageBitmap&&e instanceof k.ImageBitmap}function kl(e,t){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Qc(e)||Pf(e))return t&&t.add(e),e;if(ArrayBuffer.isView(e)){const n=e;return t&&t.add(n.buffer),n}if(e instanceof k.ImageData)return t&&t.add(e.data.buffer),e;if(Array.isArray(e)){const n=[];for(const r of e)n.push(kl(r,t));return n}if(e instanceof Map){const n={$name:"Map"};for(const[r,i]of e.entries())n[r]=kl(i);return n}if(typeof e=="object"){const n=e.constructor,r=n._classRegistryKey;if(!r)throw new Error(`can't serialize object of unregistered class ${r}`);const i=n.serialize?n.serialize(e,t):{};if(!n.serialize){for(const o in e)e.hasOwnProperty(o)&&(Wi[r].omit.indexOf(o)>=0||(i[o]=kl(e[o],t)));e instanceof Error&&(i.message=e.message)}if(i.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(i.$name=r),i}throw new Error("can't serialize object of type "+typeof e)}function Fl(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Qc(e)||Pf(e)||ArrayBuffer.isView(e)||e instanceof k.ImageData)return e;if(Array.isArray(e))return e.map(Fl);if(typeof e=="object"){const t=e.$name||"Object";if(t==="Map"){const i=new Map;for(const o of Object.keys(e))o!=="$name"&&i.set(o,Fl(e[o]));return i}const{klass:n}=Wi[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(e);const r=Object.create(n.prototype);for(const i of Object.keys(e))i!=="$name"&&(r[i]=Fl(e[i]));return r}throw new Error("can't deserialize object of type "+typeof e)}const ee={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519,"CJK Unified Ideographs Extension B":e=>e>=131072&&e<=173791};function bs(e){for(const t of e)if(ku(t.charCodeAt(0)))return!0;return!1}function om(e){for(const t of e)if(!A0(t.charCodeAt(0)))return!1;return!0}function A0(e){return!(ee.Arabic(e)||ee["Arabic Supplement"](e)||ee["Arabic Extended-A"](e)||ee["Arabic Presentation Forms-A"](e)||ee["Arabic Presentation Forms-B"](e))}function ku(e){return!(e!==746&&e!==747&&(e<4352||!(ee["Bopomofo Extended"](e)||ee.Bopomofo(e)||ee["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||ee["CJK Compatibility Ideographs"](e)||ee["CJK Compatibility"](e)||ee["CJK Radicals Supplement"](e)||ee["CJK Strokes"](e)||!(!ee["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||ee["CJK Unified Ideographs Extension A"](e)||ee["CJK Unified Ideographs"](e)||ee["Enclosed CJK Letters and Months"](e)||ee["Hangul Compatibility Jamo"](e)||ee["Hangul Jamo Extended-A"](e)||ee["Hangul Jamo Extended-B"](e)||ee["Hangul Jamo"](e)||ee["Hangul Syllables"](e)||ee.Hiragana(e)||ee["Ideographic Description Characters"](e)||ee.Kanbun(e)||ee["Kangxi Radicals"](e)||ee["Katakana Phonetic Extensions"](e)||ee.Katakana(e)&&e!==12540||!(!ee["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!ee["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||ee["Unified Canadian Aboriginal Syllabics"](e)||ee["Unified Canadian Aboriginal Syllabics Extended"](e)||ee["Vertical Forms"](e)||ee["Yijing Hexagram Symbols"](e)||ee["Yi Syllables"](e)||ee["Yi Radicals"](e))))}function sm(e){return!(ku(e)||function(t){return!!(ee["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||ee["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||ee["Letterlike Symbols"](t)||ee["Number Forms"](t)||ee["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||ee["Control Pictures"](t)&&t!==9251||ee["Optical Character Recognition"](t)||ee["Enclosed Alphanumerics"](t)||ee["Geometric Shapes"](t)||ee["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||ee["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||ee["CJK Symbols and Punctuation"](t)||ee.Katakana(t)||ee["Private Use Area"](t)||ee["CJK Compatibility Forms"](t)||ee["Small Form Variants"](t)||ee["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(e))}function Lf(e){return e>=1424&&e<=2303||ee["Arabic Presentation Forms-A"](e)||ee["Arabic Presentation Forms-B"](e)}function E0(e,t){return!(!t&&Lf(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||ee.Khmer(e))}function am(e){for(const t of e)if(Lf(t.charCodeAt(0)))return!0;return!1}const th="deferred",As="loading",lm="loaded";let Es=null,qi="unavailable",ra=null;const Rf=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(qi="error"),Es&&Es(e)};function um(){cm.fire(new Nt("pluginStateChange",{pluginStatus:qi,pluginURL:ra}))}const cm=new Sr,hm=function(){return qi},fm=function(){if(qi!==th||!ra)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");qi=As,um(),ra&&Kt({url:ra},e=>{e?Rf(e):(qi=lm,um())})},xo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>qi===lm||xo.applyArabicShaping!=null,isLoading:()=>qi===As,setState(e){qi=e.pluginStatus,ra=e.pluginURL},isParsed:()=>xo.applyArabicShaping!=null&&xo.processBidirectionalText!=null&&xo.processStyledBidirectionalText!=null,getPluginURL:()=>ra};class rr{constructor(t,n){this.zoom=t,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(n,r){for(const i of n)if(!E0(i.charCodeAt(0),r))return!1;return!0}(t,xo.isLoaded())}}class eh{constructor(t,n,r){this.property=t,this.value=n,this.expression=function(i,o,s){if(Ua(i))return new qc(i,o);if(Af(i)||Array.isArray(i)&&i.length>0){const a=vs(i,o,s);if(a.result==="error")throw new Error(a.value.map(c=>`${c.key}: ${c.message}`).join(", "));return a.value}{let a=i;return typeof i=="string"&&o.type==="color"&&(a=Me.parse(i)),{kind:"constant",isConfigDependent:!1,evaluate:()=>a}}}(n===void 0?t.specification.default:n,t.specification,r)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,n,r){return this.property.possiblyEvaluate(this,t,n,r)}}class kf{constructor(t,n){this.property=t,this.value=new eh(t,void 0,n)}transitioned(t,n){return new ns(this.property,this.value,n,re({},t.transition,this.transition),t.now)}untransitioned(){return new ns(this.property,this.value,null,{},0)}}class pi{constructor(t,n){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._options=n,this.isConfigDependent=!1}getValue(t){return q(this._values[t].value.value)}setValue(t,n){this._values.hasOwnProperty(t)||(this._values[t]=new kf(this._values[t].property,this._options)),this._values[t].value=new eh(this._values[t].property,n===null?void 0:q(n),this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].value.expression.isConfigDependent}setTransitionOrValue(t,n){n&&(this._options=n);const r=this._properties.properties;if(t)for(const i in t){const o=t[i];if(ps(i,"-transition")){const s=i.slice(0,-11);r[s]&&this.setTransition(s,o)}else r[i]&&this.setValue(i,o)}}getTransition(t){return q(this._values[t].transition)}setTransition(t,n){this._values.hasOwnProperty(t)||(this._values[t]=new kf(this._values[t].property)),this._values[t].transition=q(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const r=this.getValue(n);r!==void 0&&(t[n]=r);const i=this.getTransition(n);i!==void 0&&(t[`${n}-transition`]=i)}return t}transitioned(t,n){const r=new T0(this._properties);for(const i of Object.keys(this._values))r._values[i]=this._values[i].transitioned(t,n._values[i]);return r}untransitioned(){const t=new T0(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class ns{constructor(t,n,r,i,o){const s=i.delay||0,a=i.duration||0;o=o||0,this.property=t,this.value=n,this.begin=o+s,this.end=this.begin+a,t.specification.transition&&(i.delay||i.duration)&&(this.prior=r)}possiblyEvaluate(t,n,r){const i=t.now||0,o=this.value.possiblyEvaluate(t,n,r),s=this.prior;if(s){if(i>this.end)return this.prior=null,o;if(this.value.isDataDriven())return this.prior=null,o;if(i<this.begin)return s.possiblyEvaluate(t,n,r);{const a=(i-this.begin)/(this.end-this.begin);return this.property.interpolate(s.possiblyEvaluate(t,n,r),o,si(a))}}return o}}class T0{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,r){const i=new Ts(this._properties);for(const o of Object.keys(this._values))i._values[o]=this._values[o].possiblyEvaluate(t,n,r);return i}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class gw{constructor(t,n){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._options=n,this.isConfigDependent=!1}getValue(t){return q(this._values[t].value)}setValue(t,n){this._values[t]=new eh(this._values[t].property,n===null?void 0:q(n),this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].expression.isConfigDependent}serialize(){const t={};for(const n of Object.keys(this._values)){const r=this.getValue(n);r!==void 0&&(t[n]=r)}return t}possiblyEvaluate(t,n,r){const i=new Ts(this._properties);for(const o of Object.keys(this._values))i._values[o]=this._values[o].possiblyEvaluate(t,n,r);return i}}class ia{constructor(t,n,r){this.property=t,this.value=n,this.parameters=r}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,r,i){return this.property.evaluate(this.value,this.parameters,t,n,r,i)}}class Ts{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Rt{constructor(t){this.specification=t}possiblyEvaluate(t,n){return t.expression.evaluate(n)}interpolate(t,n,r){const i=Cu[this.specification.type];return i?i(t,n,r):t}}class ge{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,r,i){return new ia(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},r,i)}:t.expression,n)}interpolate(t,n,r){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new ia(this,{kind:"constant",value:void 0},t.parameters);const i=Cu[this.specification.type];return i?new ia(this,{kind:"constant",value:i(t.value.value,n.value.value,r)},t.parameters):t}evaluate(t,n,r,i,o,s){return t.kind==="constant"?t.value:t.evaluate(n,r,i,o,s)}}class nh{constructor(t){this.specification=t}possiblyEvaluate(t,n,r,i){return!!t.expression.evaluate(n,null,{},r,i)}interpolate(){return!1}}class lr{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new rr(0,{});for(const r in t){const i=t[r];i.specification.overridable&&this.overridableProperties.push(r);const o=this.defaultPropertyValues[r]=new eh(i,void 0),s=this.defaultTransitionablePropertyValues[r]=new kf(i);this.defaultTransitioningPropertyValues[r]=s.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=o.possiblyEvaluate(n)}}}le(ge,"DataDrivenProperty"),le(Rt,"DataConstantProperty"),le(nh,"ColorRampProperty");const oa="";function Fu(e){return e.indexOf(oa)>=0}function wi(e,t){return t?`${e}${oa}${t}`:e}function rh(e){const t=e.indexOf(oa);return t>=0?e.slice(0,t):e}const dm="-transition";class Di extends Sr{constructor(t,n,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&t.type!=="sky"&&t.type!=="slot"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),this.options=r,t.slot&&(this.slot=t.slot),n.layout&&(this._unevaluatedLayout=new gw(n.layout,r),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),n.paint)){this._transitionablePaint=new pi(n.paint,r);for(const i in t.paint)this.setPaintProperty(i,t.paint[i],{validate:!1});for(const i in t.layout)this.setLayoutProperty(i,t.layout[i],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ts(n.paint)}}setScope(t){this.scope=t,this.fqid=wi(this.id,t)}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,n,r={}){if(n!=null&&this._validate(im,`layers.${this.id}.layout.${t}`,t,n,r))return;if(this.type==="custom"&&t==="visibility")return void(this.visibility=n);const i=this._unevaluatedLayout;i._properties.properties[t]&&(i.setValue(t,n),this.isConfigDependent=this.isConfigDependent||i.isConfigDependent,t==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(t){return ps(t,dm)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,r={}){if(n!=null&&this._validate(mw,`layers.${this.id}.paint.${t}`,t,n,r))return!1;const i=this._transitionablePaint,o=i._properties.properties;if(ps(t,dm)){const g=t.slice(0,-11);return o[g]&&i.setTransition(g,n||void 0),!1}if(!o[t])return!1;const s=i._values[t],a=s.value.isDataDriven(),c=s.value;i.setValue(t,n),this.isConfigDependent=this.isConfigDependent||i.isConfigDependent,this._handleSpecialPaintPropertyUpdate(t);const h=i._values[t].value,d=h.isDataDriven(),m=ps(t,"pattern")||t==="line-dasharray";return d||a||m||this._handleOverridablePaintPropertyUpdate(t,c,h)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,n){return null}_handleOverridablePaintPropertyUpdate(t,n,r){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){return Ot({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(t,n)=>!(t===void 0||n==="layout"&&!Object.keys(t).length||n==="paint"&&!Object.keys(t).length))}_validate(t,n,r,i,o={}){return(!o||o.validate!==!1)&&Df(this,t.call(Rl,{key:n,layerType:this.type,objectKey:r,value:i,styleSpec:ut,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof ia&&Na(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Pl(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(){this._stats&&(this._stats.numRenderedVerticesInShadowPass=0,this._stats.numRenderedVerticesInTransparentPass=0)}}class C0{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,n){this._updatedSourceCaches[t]=n,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const n=t.scope;this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._updatedLayers[n].add(t.id),this.setDirty()}removeLayer(t){const n=t.scope;this._removedLayers[n]=this._removedLayers[n]||{},this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._removedLayers[n][t.id]=t,this._updatedLayers[n].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const n in this._updatedLayers)t[n]=t[n]||{},t[n].updatedIds=Array.from(this._updatedLayers[n].values());for(const n in this._removedLayers)t[n]=t[n]||{},t[n].removedIds=Object.keys(this._removedLayers[n]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(t),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const Ff={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class zu{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class qn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.add(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function wn(e,t=1){let n=0,r=0;return{members:e.map(i=>{const o=Ff[i.type].BYTES_PER_ELEMENT,s=n=pm(n,Math.max(t,o)),a=i.components||1;return r=Math.max(r,o),n+=o*a,{name:i.name,type:i.type,components:a,offset:s}}),size:pm(n,Math.max(r,t)),alignment:t}}function pm(e,t){return Math.ceil(e/t)*t}class bi extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const r=this.length;return this.resize(r+1),this.emplace(r,t,n)}emplace(t,n,r){const i=2*t;return this.int16[i+0]=n,this.int16[i+1]=r,t}}bi.prototype.bytesPerElement=4,le(bi,"StructArrayLayout2i4");class ih extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,r){const i=this.length;return this.resize(i+1),this.emplace(i,t,n,r)}emplace(t,n,r,i){const o=3*t;return this.int16[o+0]=n,this.int16[o+1]=r,this.int16[o+2]=i,t}}ih.prototype.bytesPerElement=6,le(ih,"StructArrayLayout3i6");class sa extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,r,i){const o=this.length;return this.resize(o+1),this.emplace(o,t,n,r,i)}emplace(t,n,r,i,o){const s=4*t;return this.int16[s+0]=n,this.int16[s+1]=r,this.int16[s+2]=i,this.int16[s+3]=o,t}}sa.prototype.bytesPerElement=8,le(sa,"StructArrayLayout4i8");class mm extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,r,i,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,n,r,i,o)}emplace(t,n,r,i,o,s){const a=5*t;return this.int16[a+0]=n,this.int16[a+1]=r,this.int16[a+2]=i,this.int16[a+3]=o,this.int16[a+4]=s,t}}mm.prototype.bytesPerElement=10,le(mm,"StructArrayLayout5i10");class zf extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,r,i,o,s,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,r,i,o,s,a)}emplace(t,n,r,i,o,s,a,c){const h=6*t,d=12*t,m=3*t;return this.int16[h+0]=n,this.int16[h+1]=r,this.uint8[d+4]=i,this.uint8[d+5]=o,this.uint8[d+6]=s,this.uint8[d+7]=a,this.float32[m+2]=c,t}}zf.prototype.bytesPerElement=12,le(zf,"StructArrayLayout2i4ub1f12");class Ai extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,r,i){const o=this.length;return this.resize(o+1),this.emplace(o,t,n,r,i)}emplace(t,n,r,i,o){const s=4*t;return this.float32[s+0]=n,this.float32[s+1]=r,this.float32[s+2]=i,this.float32[s+3]=o,t}}Ai.prototype.bytesPerElement=16,le(Ai,"StructArrayLayout4f16");class aa extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,r,i,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,n,r,i,o)}emplace(t,n,r,i,o,s){const a=6*t,c=3*t;return this.uint16[a+0]=n,this.uint16[a+1]=r,this.uint16[a+2]=i,this.uint16[a+3]=o,this.float32[c+2]=s,t}}aa.prototype.bytesPerElement=12,le(aa,"StructArrayLayout4ui1f12");class oh extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,r,i){const o=this.length;return this.resize(o+1),this.emplace(o,t,n,r,i)}emplace(t,n,r,i,o){const s=4*t;return this.uint16[s+0]=n,this.uint16[s+1]=r,this.uint16[s+2]=i,this.uint16[s+3]=o,t}}oh.prototype.bytesPerElement=8,le(oh,"StructArrayLayout4ui8");class Of extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,r,i,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,n,r,i,o,s)}emplace(t,n,r,i,o,s,a){const c=6*t;return this.int16[c+0]=n,this.int16[c+1]=r,this.int16[c+2]=i,this.int16[c+3]=o,this.int16[c+4]=s,this.int16[c+5]=a,t}}Of.prototype.bytesPerElement=12,le(Of,"StructArrayLayout6i12");class Nf extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,r,i,o,s,a,c,h,d,m,g){const x=this.length;return this.resize(x+1),this.emplace(x,t,n,r,i,o,s,a,c,h,d,m,g)}emplace(t,n,r,i,o,s,a,c,h,d,m,g,x){const v=12*t;return this.int16[v+0]=n,this.int16[v+1]=r,this.int16[v+2]=i,this.int16[v+3]=o,this.uint16[v+4]=s,this.uint16[v+5]=a,this.uint16[v+6]=c,this.uint16[v+7]=h,this.int16[v+8]=d,this.int16[v+9]=m,this.int16[v+10]=g,this.int16[v+11]=x,t}}Nf.prototype.bytesPerElement=24,le(Nf,"StructArrayLayout4i4ui4i24");class gm extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,r,i,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,n,r,i,o,s)}emplace(t,n,r,i,o,s,a){const c=10*t,h=5*t;return this.int16[c+0]=n,this.int16[c+1]=r,this.int16[c+2]=i,this.float32[h+2]=o,this.float32[h+3]=s,this.float32[h+4]=a,t}}gm.prototype.bytesPerElement=20,le(gm,"StructArrayLayout3i3f20");class _m extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}_m.prototype.bytesPerElement=4,le(_m,"StructArrayLayout1ul4");class Pi extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const r=this.length;return this.resize(r+1),this.emplace(r,t,n)}emplace(t,n,r){const i=2*t;return this.uint16[i+0]=n,this.uint16[i+1]=r,t}}Pi.prototype.bytesPerElement=4,le(Pi,"StructArrayLayout2ui4");class sh extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,r,i,o,s,a,c,h,d,m,g,x){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,r,i,o,s,a,c,h,d,m,g,x)}emplace(t,n,r,i,o,s,a,c,h,d,m,g,x,v){const w=20*t,A=10*t;return this.int16[w+0]=n,this.int16[w+1]=r,this.int16[w+2]=i,this.int16[w+3]=o,this.int16[w+4]=s,this.float32[A+3]=a,this.float32[A+4]=c,this.float32[A+5]=h,this.float32[A+6]=d,this.int16[w+14]=m,this.uint32[A+8]=g,this.uint16[w+18]=x,this.uint16[w+19]=v,t}}sh.prototype.bytesPerElement=40,le(sh,"StructArrayLayout5i4f1i1ul2ui40");class Ou extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,r,i,o,s,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,r,i,o,s,a)}emplace(t,n,r,i,o,s,a,c){const h=8*t;return this.int16[h+0]=n,this.int16[h+1]=r,this.int16[h+2]=i,this.int16[h+4]=o,this.int16[h+5]=s,this.int16[h+6]=a,this.int16[h+7]=c,t}}Ou.prototype.bytesPerElement=16,le(Ou,"StructArrayLayout3i2i2i16");class ah extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,r,i,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,n,r,i,o)}emplace(t,n,r,i,o,s){const a=4*t,c=8*t;return this.float32[a+0]=n,this.float32[a+1]=r,this.float32[a+2]=i,this.int16[c+6]=o,this.int16[c+7]=s,t}}ah.prototype.bytesPerElement=16,le(ah,"StructArrayLayout2f1f2i16");class Nu extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,r,i){const o=this.length;return this.resize(o+1),this.emplace(o,t,n,r,i)}emplace(t,n,r,i,o){const s=12*t,a=3*t;return this.uint8[s+0]=n,this.uint8[s+1]=r,this.float32[a+1]=i,this.float32[a+2]=o,t}}Nu.prototype.bytesPerElement=12,le(Nu,"StructArrayLayout2ub2f12");class ur extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,r){const i=this.length;return this.resize(i+1),this.emplace(i,t,n,r)}emplace(t,n,r,i){const o=3*t;return this.uint16[o+0]=n,this.uint16[o+1]=r,this.uint16[o+2]=i,t}}ur.prototype.bytesPerElement=6,le(ur,"StructArrayLayout3ui6");class Xe extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,n,r,i,o,s,a,c,h,d,m,g,x,v,w,A,E,S,I,B,M){const D=this.length;return this.resize(D+1),this.emplace(D,t,n,r,i,o,s,a,c,h,d,m,g,x,v,w,A,E,S,I,B,M)}emplace(t,n,r,i,o,s,a,c,h,d,m,g,x,v,w,A,E,S,I,B,M,D){const R=30*t,z=15*t,N=60*t;return this.int16[R+0]=n,this.int16[R+1]=r,this.int16[R+2]=i,this.float32[z+2]=o,this.float32[z+3]=s,this.uint16[R+8]=a,this.uint16[R+9]=c,this.uint32[z+5]=h,this.uint32[z+6]=d,this.uint32[z+7]=m,this.uint16[R+16]=g,this.uint16[R+17]=x,this.uint16[R+18]=v,this.float32[z+10]=w,this.float32[z+11]=A,this.uint8[N+48]=E,this.uint8[N+49]=S,this.uint8[N+50]=I,this.uint32[z+13]=B,this.int16[R+28]=M,this.uint8[N+58]=D,t}}Xe.prototype.bytesPerElement=60,le(Xe,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Uu extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,n,r,i,o,s,a,c,h,d,m,g,x,v,w,A,E,S,I,B,M,D,R,z,N,V,j,H,$,G,Q,et){const st=this.length;return this.resize(st+1),this.emplace(st,t,n,r,i,o,s,a,c,h,d,m,g,x,v,w,A,E,S,I,B,M,D,R,z,N,V,j,H,$,G,Q,et)}emplace(t,n,r,i,o,s,a,c,h,d,m,g,x,v,w,A,E,S,I,B,M,D,R,z,N,V,j,H,$,G,Q,et,st){const Y=20*t,tt=40*t,ct=80*t;return this.float32[Y+0]=n,this.float32[Y+1]=r,this.int16[tt+4]=i,this.int16[tt+5]=o,this.int16[tt+6]=s,this.int16[tt+7]=a,this.int16[tt+8]=c,this.int16[tt+9]=h,this.int16[tt+10]=d,this.int16[tt+11]=m,this.int16[tt+12]=g,this.uint16[tt+13]=x,this.uint16[tt+14]=v,this.uint16[tt+15]=w,this.uint16[tt+16]=A,this.uint16[tt+17]=E,this.uint16[tt+18]=S,this.uint16[tt+19]=I,this.uint16[tt+20]=B,this.uint16[tt+21]=M,this.uint16[tt+22]=D,this.uint16[tt+23]=R,this.uint16[tt+24]=z,this.uint16[tt+25]=N,this.uint16[tt+26]=V,this.uint16[tt+27]=j,this.uint32[Y+14]=H,this.float32[Y+15]=$,this.float32[Y+16]=G,this.float32[Y+17]=Q,this.float32[Y+18]=et,this.uint8[ct+76]=st,t}}Uu.prototype.bytesPerElement=80,le(Uu,"StructArrayLayout2f9i15ui1ul4f1ub80");class zl extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}zl.prototype.bytesPerElement=4,le(zl,"StructArrayLayout1f4");class vo extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,r,i,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,n,r,i,o)}emplace(t,n,r,i,o,s){const a=5*t;return this.float32[a+0]=n,this.float32[a+1]=r,this.float32[a+2]=i,this.float32[a+3]=o,this.float32[a+4]=s,t}}vo.prototype.bytesPerElement=20,le(vo,"StructArrayLayout5f20");class ym extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,r,i,o,s,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,r,i,o,s,a)}emplace(t,n,r,i,o,s,a,c){const h=7*t;return this.float32[h+0]=n,this.float32[h+1]=r,this.float32[h+2]=i,this.float32[h+3]=o,this.float32[h+4]=s,this.float32[h+5]=a,this.float32[h+6]=c,t}}ym.prototype.bytesPerElement=28,le(ym,"StructArrayLayout7f28");class lh extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,r,i){const o=this.length;return this.resize(o+1),this.emplace(o,t,n,r,i)}emplace(t,n,r,i,o){const s=6*t;return this.uint32[3*t+0]=n,this.uint16[s+2]=r,this.uint16[s+3]=i,this.uint16[s+4]=o,t}}lh.prototype.bytesPerElement=12,le(lh,"StructArrayLayout1ul3ui12");class Vu extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}Vu.prototype.bytesPerElement=2,le(Vu,"StructArrayLayout1ui2");class Ur extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,r){const i=this.length;return this.resize(i+1),this.emplace(i,t,n,r)}emplace(t,n,r,i){const o=3*t;return this.float32[o+0]=n,this.float32[o+1]=r,this.float32[o+2]=i,t}}Ur.prototype.bytesPerElement=12,le(Ur,"StructArrayLayout3f12");class uh extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const r=this.length;return this.resize(r+1),this.emplace(r,t,n)}emplace(t,n,r){const i=2*t;return this.float32[i+0]=n,this.float32[i+1]=r,t}}uh.prototype.bytesPerElement=8,le(uh,"StructArrayLayout2f8");class xm extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,r,i,o,s,a,c,h,d,m,g,x,v,w,A){const E=this.length;return this.resize(E+1),this.emplace(E,t,n,r,i,o,s,a,c,h,d,m,g,x,v,w,A)}emplace(t,n,r,i,o,s,a,c,h,d,m,g,x,v,w,A,E){const S=16*t;return this.float32[S+0]=n,this.float32[S+1]=r,this.float32[S+2]=i,this.float32[S+3]=o,this.float32[S+4]=s,this.float32[S+5]=a,this.float32[S+6]=c,this.float32[S+7]=h,this.float32[S+8]=d,this.float32[S+9]=m,this.float32[S+10]=g,this.float32[S+11]=x,this.float32[S+12]=v,this.float32[S+13]=w,this.float32[S+14]=A,this.float32[S+15]=E,t}}xm.prototype.bytesPerElement=64,le(xm,"StructArrayLayout16f64");class ch extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,r,i,o,s,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,r,i,o,s,a)}emplace(t,n,r,i,o,s,a,c){const h=10*t,d=5*t;return this.uint16[h+0]=n,this.uint16[h+1]=r,this.uint16[h+2]=i,this.uint16[h+3]=o,this.float32[d+2]=s,this.float32[d+3]=a,this.float32[d+4]=c,t}}ch.prototype.bytesPerElement=20,le(ch,"StructArrayLayout4ui3f20");class vm extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint8[1*t+0]=n,t}}vm.prototype.bytesPerElement=1,le(vm,"StructArrayLayout1ub1");class wm extends zu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}wm.prototype.size=40;class bm extends sh{get(t){return new wm(this,t)}}le(bm,"CollisionBoxArray");class S0 extends zu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}S0.prototype.size=60;class M0 extends Xe{get(t){return new S0(this,t)}}le(M0,"PlacedSymbolArray");class Cs extends zu{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Cs.prototype.size=80;class Li extends Uu{get(t){return new Cs(this,t)}}le(Li,"SymbolInstanceArray");class Uf extends zl{getoffsetX(t){return this.float32[1*t+0]}}le(Uf,"GlyphOffsetArray");class I0 extends bi{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}le(I0,"SymbolLineVertexArray");class Vf extends zu{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Vf.prototype.size=12;class B0 extends lh{get(t){return new Vf(this,t)}}le(B0,"FeatureIndexArray");class D0 extends Pi{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}le(D0,"FillExtrusionCentroidArray");const hh=wn([{name:"a_pos",components:2,type:"Int16"}],4),P0=wn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Cn{constructor(t=[]){this.segments=t}_prepareSegment(t,n,r,i){let o=this.segments[this.segments.length-1];return t>Cn.MAX_VERTEX_ARRAY_LENGTH&&rt(`Max vertices per segment is ${Cn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!o||o.vertexLength+t>Cn.MAX_VERTEX_ARRAY_LENGTH||o.sortKey!==i)&&(o={vertexOffset:n,primitiveOffset:r,vertexLength:0,primitiveLength:0},i!==void 0&&(o.sortKey=i),this.segments.push(o)),o}prepareSegment(t,n,r,i){return this._prepareSegment(t,n.length,r.length,i)}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,r,i){return new Cn([{vertexOffset:t,primitiveOffset:n,vertexLength:r,primitiveLength:i,vaos:{},sortKey:0}])}}function L0(e,t){return 256*(e=$t(Math.floor(e),0,255))+$t(Math.floor(t),0,255)}Cn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,le(Cn,"SegmentVector");const _w=wn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),yw=wn([{name:"a_dash",components:4,type:"Uint16"}]);var Gf={exports:{}},Am={exports:{}};(function(e){e.exports=function(t,n){var r,i,o,s,a,c,h,d;for(i=t.length-(r=3&t.length),o=n,a=3432918353,c=461845907,d=0;d<i;)h=255&t.charCodeAt(d)|(255&t.charCodeAt(++d))<<8|(255&t.charCodeAt(++d))<<16|(255&t.charCodeAt(++d))<<24,++d,o=27492+(65535&(s=5*(65535&(o=(o^=h=(65535&(h=(h=(65535&h)*a+(((h>>>16)*a&65535)<<16)&4294967295)<<15|h>>>17))*c+(((h>>>16)*c&65535)<<16)&4294967295)<<13|o>>>19))+((5*(o>>>16)&65535)<<16)&4294967295))+((58964+(s>>>16)&65535)<<16);switch(h=0,r){case 3:h^=(255&t.charCodeAt(d+2))<<16;case 2:h^=(255&t.charCodeAt(d+1))<<8;case 1:o^=h=(65535&(h=(h=(65535&(h^=255&t.charCodeAt(d)))*a+(((h>>>16)*a&65535)<<16)&4294967295)<<15|h>>>17))*c+(((h>>>16)*c&65535)<<16)&4294967295}return o^=t.length,o=2246822507*(65535&(o^=o>>>16))+((2246822507*(o>>>16)&65535)<<16)&4294967295,o=3266489909*(65535&(o^=o>>>13))+((3266489909*(o>>>16)&65535)<<16)&4294967295,(o^=o>>>16)>>>0}})(Am);var R0=Am.exports,k0={exports:{}};(function(e){e.exports=function(t,n){for(var r,i=t.length,o=n^i,s=0;i>=4;)r=1540483477*(65535&(r=255&t.charCodeAt(s)|(255&t.charCodeAt(++s))<<8|(255&t.charCodeAt(++s))<<16|(255&t.charCodeAt(++s))<<24))+((1540483477*(r>>>16)&65535)<<16),o=1540483477*(65535&o)+((1540483477*(o>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),i-=4,++s;switch(i){case 3:o^=(255&t.charCodeAt(s+2))<<16;case 2:o^=(255&t.charCodeAt(s+1))<<8;case 1:o=1540483477*(65535&(o^=255&t.charCodeAt(s)))+((1540483477*(o>>>16)&65535)<<16)}return o=1540483477*(65535&(o^=o>>>13))+((1540483477*(o>>>16)&65535)<<16),(o^=o>>>15)>>>0}})(k0);var jf=R0,F0=k0.exports;Gf.exports=jf,Gf.exports.murmur3=jf,Gf.exports.murmur2=F0;var Ol=It(Gf.exports);class Nl{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,n,r,i){this.ids.push(Em(t)),this.positions.push(n,r,i)}eachPosition(t,n){const r=Em(t);let i=0,o=this.ids.length-1;for(;i<o;){const s=i+o>>1;this.ids[s]>=r?o=s:i=s+1}for(;this.ids[i]===r;)n(this.positions[3*i],this.positions[3*i+1],this.positions[3*i+2]),i++}static serialize(t,n){const r=new Float64Array(t.ids),i=new Uint32Array(t.positions);return Hf(r,i,0,r.length-1),n&&(n.add(r.buffer),n.add(i.buffer)),{ids:r,positions:i}}static deserialize(t){const n=new Nl;let r;n.ids=t.ids,n.positions=t.positions;for(const i of n.ids)i!==r&&n.uniqueIds.push(i),r=i;return n.indexed=!0,n}}function Em(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Ol(String(e))}function Hf(e,t,n,r){for(;n<r;){const i=e[n+r>>1];let o=n-1,s=r+1;for(;;){do o++;while(e[o]<i);do s--;while(e[s]>i);if(o>=s)break;Ul(e,o,s),Ul(t,3*o,3*s),Ul(t,3*o+1,3*s+1),Ul(t,3*o+2,3*s+2)}s-n<r-s?(Hf(e,t,n,s),n=s+1):(Hf(e,t,s+1,r),r=s)}}function Ul(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}le(Nl,"FeaturePositionMap");class Ss{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,n),this.initialized=!0),!!this.location}}class Oe extends Ss{constructor(t){super(t),this.current=0}set(t,n,r){this.fetchUniformLocation(t,n)&&this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}}class Bt extends Ss{constructor(t){super(t),this.current=0}set(t,n,r){this.fetchUniformLocation(t,n)&&this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class $e extends Ss{constructor(t){super(t),this.current=[0,0]}set(t,n,r){this.fetchUniformLocation(t,n)&&(r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1])))}}class Ve extends Ss{constructor(t){super(t),this.current=[0,0,0]}set(t,n,r){this.fetchUniformLocation(t,n)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2])))}}class ao extends Ss{constructor(t){super(t),this.current=[0,0,0,0]}set(t,n,r){this.fetchUniformLocation(t,n)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3])))}}class Gu extends Ss{constructor(t){super(t),this.current=Me.transparent}set(t,n,r){this.fetchUniformLocation(t,n)&&(r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a)))}}const xw=new Float32Array(16);class Ne extends Ss{constructor(t){super(t),this.current=xw}set(t,n,r){if(this.fetchUniformLocation(t,n)){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let i=1;i<16;i++)if(r[i]!==this.current[i]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}}}const vw=new Float32Array(9);class Tm extends Ss{constructor(t){super(t),this.current=vw}set(t,n,r){if(this.fetchUniformLocation(t,n)){for(let i=0;i<9;i++)if(r[i]!==this.current[i]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}}const ww=new Float32Array(4);class Cm extends Ss{constructor(t){super(t),this.current=ww}set(t,n,r){if(this.fetchUniformLocation(t,n)){for(let i=0;i<4;i++)if(r[i]!==this.current[i]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}}}function Sm(e){return[L0(255*e.r,255*e.g),L0(255*e.b,255*e.a)]}class fh{constructor(t,n,r){this.value=t,this.uniformNames=n.map(i=>`u_${i}`),this.type=r}setUniform(t,n,r,i,o){n.set(t,o,i.constantOr(this.value))}getBinding(t,n){return this.type==="color"?new Gu(t):new Bt(t)}}class ju{constructor(t,n){this.uniformNames=n.map(r=>`u_${r}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,n,r,i,o){const s=o==="u_pattern"||o==="u_dash"?this.pattern:o==="u_pixel_ratio"?this.pixelRatio:null;s&&n.set(t,o,s)}getBinding(t,n){return n==="u_pattern"||n==="u_dash"?new ao(t):new Bt(t)}}class Ms{constructor(t,n,r,i){this.expression=t,this.type=r,this.maxValue=0,this.paintVertexAttributes=n.map(o=>({name:`a_${o}`,type:"Float32",components:r==="color"?2:1,offset:0})),this.paintVertexArray=new i}populatePaintArray(t,n,r,i,o,s,a){const c=this.paintVertexArray.length,h=this.expression.evaluate(new rr(0,{brightness:s}),n,{},o,i,a);this.paintVertexArray.resize(t),this._setPaintValue(c,t,h)}updatePaintArray(t,n,r,i,o,s,a){const c=this.expression.evaluate({zoom:0,brightness:a},r,i,void 0,o);this._setPaintValue(t,n,c)}_setPaintValue(t,n,r){if(this.type==="color"){const i=Sm(r);for(let o=t;o<n;o++)this.paintVertexArray.emplace(o,i[0],i[1])}else{for(let i=t;i<n;i++)this.paintVertexArray.emplace(i,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class zo{constructor(t,n,r,i,o,s){this.expression=t,this.uniformNames=n.map(a=>`u_${a}_t`),this.type=r,this.useIntegerZoom=i,this.zoom=o,this.maxValue=0,this.paintVertexAttributes=n.map(a=>({name:`a_${a}`,type:"Float32",components:r==="color"?4:2,offset:0})),this.paintVertexArray=new s}populatePaintArray(t,n,r,i,o,s,a){const c=this.expression.evaluate(new rr(this.zoom,{brightness:s}),n,{},o,i,a),h=this.expression.evaluate(new rr(this.zoom+1,{brightness:s}),n,{},o,i,a),d=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(d,t,c,h)}updatePaintArray(t,n,r,i,o,s,a){const c=this.expression.evaluate({zoom:this.zoom,brightness:a},r,i,void 0,o),h=this.expression.evaluate({zoom:this.zoom+1,brightness:a},r,i,void 0,o);this._setPaintValue(t,n,c,h)}_setPaintValue(t,n,r,i){if(this.type==="color"){const o=Sm(r),s=Sm(i);for(let a=t;a<n;a++)this.paintVertexArray.emplace(a,o[0],o[1],s[0],s[1])}else{for(let o=t;o<n;o++)this.paintVertexArray.emplace(o,r,i);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(i))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n,r,i,o){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,a=$t(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);n.set(t,o,a)}getBinding(t,n){return new Bt(t)}}class la{constructor(t,n,r,i,o){this.expression=t,this.layerId=o,this.paintVertexAttributes=(r==="array"?yw:_w).members;for(let s=0;s<n.length;++s);this.paintVertexArray=new i}populatePaintArray(t,n,r){const i=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(i,t,n.patterns&&n.patterns[this.layerId],r)}updatePaintArray(t,n,r,i,o,s,a){this._setPaintValues(t,n,r.patterns&&r.patterns[this.layerId],s)}_setPaintValues(t,n,r,i){if(!i||!r)return;const o=i[r];if(!o)return;const{tl:s,br:a,pixelRatio:c}=o;for(let h=t;h<n;h++)this.paintVertexArray.emplace(h,s[0],s[1],a[0],a[1],c)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Vl{constructor(t,n,r=()=>!0){this.binders={},this._buffers=[];const i=[];for(const o in t.paint._values){const s=t.paint.get(o);if(!r(o)||!(s instanceof ia&&Na(s.property.specification)))continue;const a=z0(o,t.type),c=s.value,h=s.property.specification.type,d=!!s.property.useIntegerZoom,m=o==="line-dasharray"||o.endsWith("pattern"),g=o==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant";if(c.kind!=="constant"||g)if(c.kind==="source"||g||m){const x=O0(o,h,"source");this.binders[o]=m?new la(c,a,h,x,t.id):new Ms(c,a,h,x),i.push(`/a_${o}`)}else{const x=O0(o,h,"composite");this.binders[o]=new zo(c,a,h,d,n,x),i.push(`/z_${o}`)}else this.binders[o]=m?new ju(c.value,a):new fh(c.value,a,h),i.push(`/u_${o}`)}this.cacheKey=i.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof Ms||n instanceof zo?n.maxValue:0}populatePaintArrays(t,n,r,i,o,s,a){for(const c in this.binders){const h=this.binders[c];(h instanceof Ms||h instanceof zo||h instanceof la)&&h.populatePaintArray(t,n,r,i,o,s,a)}}setConstantPatternPositions(t){for(const n in this.binders){const r=this.binders[n];r instanceof ju&&r.setConstantPatternPositions(t)}}updatePaintArrays(t,n,r,i,o,s,a,c){let h=!1;const d=Object.keys(t),m=d.length!==0,g=m?d:n.uniqueIds;for(const x in this.binders){const v=this.binders[x];if((v instanceof Ms||v instanceof zo||v instanceof la)&&(v.expression.isStateDependent===!0||v.expression.isLightConstant===!1)){const w=o.paint.get(x);v.expression=w.value;for(const A of g){const E=t[A.toString()];n.eachPosition(A,(S,I,B)=>{const M=i.feature(S);v.updatePaintArray(I,B,M,E,s,a,c)})}if(!m)for(const A of r.uniqueIds){const E=t[A.toString()];r.eachPosition(A,(S,I,B)=>{const M=i.feature(S);v.updatePaintArray(I,B,M,E,s,a,c)})}h=!0}}return h}defines(){const t=[];for(const n in this.binders){const r=this.binders[n];(r instanceof fh||r instanceof ju)&&t.push(...r.uniformNames.map(i=>`#define HAS_UNIFORM_${i}`))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const r=this.binders[n];if(r instanceof Ms||r instanceof zo||r instanceof la)for(let i=0;i<r.paintVertexAttributes.length;i++)t.push(r.paintVertexAttributes[i].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const r=this.binders[n];if(r instanceof fh||r instanceof ju||r instanceof zo)for(const i of r.uniformNames)t.push(i)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const n=[];for(const r in this.binders){const i=this.binders[r];if(i instanceof fh||i instanceof ju||i instanceof zo)for(const o of i.uniformNames)n.push({name:o,property:r,binding:i.getBinding(t,o)})}return n}setUniforms(t,n,r,i,o){for(const{name:s,property:a,binding:c}of r)this.binders[a].setUniform(t,c,o,i.get(a),s)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const n=this.binders[t];(n instanceof Ms||n instanceof zo||n instanceof la)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(t){for(const n in this.binders){const r=this.binders[n];(r instanceof Ms||r instanceof zo||r instanceof la)&&r.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof Ms||n instanceof zo||n instanceof la)&&n.destroy()}}}class Ga{constructor(t,n,r=()=>!0){this.programConfigurations={};for(const i of t)this.programConfigurations[i.id]=new Vl(i,n,r);this.needsUpload=!1,this._featureMap=new Nl,this._featureMapWithoutIds=new Nl,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,n,r,i,o,s,a,c){for(const h in this.programConfigurations)this.programConfigurations[h].populatePaintArrays(t,n,i,o,s,a,c);n.id!==void 0?this._featureMap.add(n.id,r,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,r,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,r,i,o,s){for(const a of r)this.needsUpload=this.programConfigurations[a.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,n,a,i,o,s||0)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const bw={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function z0(e,t){return bw[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}const Aw={"line-pattern":{source:aa,composite:aa},"fill-pattern":{source:aa,composite:aa},"fill-extrusion-pattern":{source:aa,composite:aa},"line-dasharray":{source:oh,composite:oh}},Ew={color:{source:uh,composite:Ai},number:{source:zl,composite:uh}};function O0(e,t,n){const r=Aw[e];return r&&r[n]||Ew[t][n]}le(fh,"ConstantBinder"),le(ju,"PatternConstantBinder"),le(Ms,"SourceExpressionBinder"),le(la,"PatternCompositeBinder"),le(zo,"CompositeExpressionBinder"),le(Vl,"ProgramConfiguration",{omit:["_buffers"]}),le(Ga,"ProgramConfigurationSet");class lo{constructor(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof Be?new Be(t.lng,t.lat):Be.convert(t),this}setSouthWest(t){return this._sw=t instanceof Be?new Be(t.lng,t.lat):Be.convert(t),this}extend(t){const n=this._sw,r=this._ne;let i,o;if(t instanceof Be)i=t,o=t;else{if(!(t instanceof lo))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(lo.convert(t)):this.extend(Be.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(Be.convert(t)):this;if(i=t._sw,o=t._ne,!i||!o)return this}return n||r?(n.lng=Math.min(i.lng,n.lng),n.lat=Math.min(i.lat,n.lat),r.lng=Math.max(o.lng,r.lng),r.lat=Math.max(o.lat,r.lat)):(this._sw=new Be(i.lng,i.lat),this._ne=new Be(o.lng,o.lat)),this}getCenter(){return new Be((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Be(this.getWest(),this.getNorth())}getSouthEast(){return new Be(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:n,lat:r}=Be.convert(t);let i=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&i}static convert(t){return!t||t instanceof lo?t:new lo(t)}}var qr={},Jr={};Object.defineProperty(Jr,"__esModule",{value:!0}),Jr.setMatrixArrayType=function(e){Jr.ARRAY_TYPE=N0=e},Jr.toRadian=function(e){return e*Cw},Jr.equals=function(e,t){return Math.abs(e-t)<=wo*Math.max(1,Math.abs(e),Math.abs(t))},Jr.RANDOM=Jr.ARRAY_TYPE=Jr.EPSILON=void 0;var wo=1e-6;Jr.EPSILON=wo;var N0=typeof Float32Array<"u"?Float32Array:Array;Jr.ARRAY_TYPE=N0;var Tw=Math.random;Jr.RANDOM=Tw;var Cw=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var Kn={};function Mm(e){return Mm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mm(e)}Object.defineProperty(Kn,"__esModule",{value:!0}),Kn.create=function(){var e=new ja.ARRAY_TYPE(4);return ja.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},Kn.clone=function(e){var t=new ja.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Kn.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Kn.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},Kn.fromValues=function(e,t,n,r){var i=new ja.ARRAY_TYPE(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i},Kn.set=function(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e},Kn.transpose=function(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},Kn.invert=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=n*o-i*r;return s?(e[0]=o*(s=1/s),e[1]=-r*s,e[2]=-i*s,e[3]=n*s,e):null},Kn.adjoint=function(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e},Kn.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},Kn.multiply=V0,Kn.rotate=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=Math.sin(n),c=Math.cos(n);return e[0]=r*c+o*a,e[1]=i*c+s*a,e[2]=r*-a+o*c,e[3]=i*-a+s*c,e},Kn.scale=function(e,t,n){var r=t[1],i=t[2],o=t[3],s=n[0],a=n[1];return e[0]=t[0]*s,e[1]=r*s,e[2]=i*a,e[3]=o*a,e},Kn.fromRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=-n,e[3]=r,e},Kn.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},Kn.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},Kn.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},Kn.LDU=function(e,t,n,r){return e[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-e[2]*n[1],[e,t,n]},Kn.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},Kn.subtract=Zf,Kn.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},Kn.equals=function(e,t){var n=e[0],r=e[1],i=e[2],o=e[3],s=t[0],a=t[1],c=t[2],h=t[3];return Math.abs(n-s)<=ja.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-a)<=ja.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-c)<=ja.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(o-h)<=ja.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))},Kn.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},Kn.multiplyScalarAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e},Kn.sub=Kn.mul=void 0;var ja=function(e,t){if(e&&e.__esModule)return e;if(e===null||Mm(e)!=="object"&&typeof e!="function")return{default:e};var n=U0(void 0);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(o!=="default"&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}(Jr);function U0(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,n=new WeakMap;return(U0=function(r){return r?n:t})(e)}function V0(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=n[0],c=n[1],h=n[2],d=n[3];return e[0]=r*a+o*c,e[1]=i*a+s*c,e[2]=r*h+o*d,e[3]=i*h+s*d,e}function Zf(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}Kn.mul=V0,Kn.sub=Zf;var cr={};function Im(e){return Im=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Im(e)}Object.defineProperty(cr,"__esModule",{value:!0}),cr.create=function(){var e=new Is.ARRAY_TYPE(6);return Is.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},cr.clone=function(e){var t=new Is.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},cr.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},cr.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},cr.fromValues=function(e,t,n,r,i,o){var s=new Is.ARRAY_TYPE(6);return s[0]=e,s[1]=t,s[2]=n,s[3]=r,s[4]=i,s[5]=o,s},cr.set=function(e,t,n,r,i,o,s){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=o,e[5]=s,e},cr.invert=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],c=n*o-r*i;return c?(e[0]=o*(c=1/c),e[1]=-r*c,e[2]=-i*c,e[3]=n*c,e[4]=(i*a-o*s)*c,e[5]=(r*s-n*a)*c,e):null},cr.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},cr.multiply=j0,cr.rotate=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],c=t[5],h=Math.sin(n),d=Math.cos(n);return e[0]=r*d+o*h,e[1]=i*d+s*h,e[2]=r*-h+o*d,e[3]=i*-h+s*d,e[4]=a,e[5]=c,e},cr.scale=function(e,t,n){var r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],c=n[0],h=n[1];return e[0]=t[0]*c,e[1]=r*c,e[2]=i*h,e[3]=o*h,e[4]=s,e[5]=a,e},cr.translate=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],c=t[5],h=n[0],d=n[1];return e[0]=r,e[1]=i,e[2]=o,e[3]=s,e[4]=r*h+o*d+a,e[5]=i*h+s*d+c,e},cr.fromRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=-n,e[3]=r,e[4]=0,e[5]=0,e},cr.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},cr.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},cr.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},cr.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},cr.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e},cr.subtract=H0,cr.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e},cr.multiplyScalarAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e},cr.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},cr.equals=function(e,t){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],c=t[0],h=t[1],d=t[2],m=t[3],g=t[4],x=t[5];return Math.abs(n-c)<=Is.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(r-h)<=Is.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(i-d)<=Is.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(o-m)<=Is.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(s-g)<=Is.EPSILON*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(a-x)<=Is.EPSILON*Math.max(1,Math.abs(a),Math.abs(x))},cr.sub=cr.mul=void 0;var Is=function(e,t){if(e&&e.__esModule)return e;if(e===null||Im(e)!=="object"&&typeof e!="function")return{default:e};var n=G0(void 0);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(o!=="default"&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}(Jr);function G0(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,n=new WeakMap;return(G0=function(r){return r?n:t})(e)}function j0(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],c=t[5],h=n[0],d=n[1],m=n[2],g=n[3],x=n[4],v=n[5];return e[0]=r*h+o*d,e[1]=i*h+s*d,e[2]=r*m+o*g,e[3]=i*m+s*g,e[4]=r*x+o*v+a,e[5]=i*x+s*v+c,e}function H0(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e}cr.mul=j0,cr.sub=H0;var zn={};function Bm(e){return Bm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bm(e)}Object.defineProperty(zn,"__esModule",{value:!0}),zn.create=function(){var e=new bo.ARRAY_TYPE(9);return bo.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},zn.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},zn.clone=function(e){var t=new bo.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},zn.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},zn.fromValues=function(e,t,n,r,i,o,s,a,c){var h=new bo.ARRAY_TYPE(9);return h[0]=e,h[1]=t,h[2]=n,h[3]=r,h[4]=i,h[5]=o,h[6]=s,h[7]=a,h[8]=c,h},zn.set=function(e,t,n,r,i,o,s,a,c,h){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=o,e[5]=s,e[6]=a,e[7]=c,e[8]=h,e},zn.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},zn.transpose=function(e,t){if(e===t){var n=t[1],r=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},zn.invert=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],c=t[6],h=t[7],d=t[8],m=d*s-a*h,g=-d*o+a*c,x=h*o-s*c,v=n*m+r*g+i*x;return v?(e[0]=m*(v=1/v),e[1]=(-d*r+i*h)*v,e[2]=(a*r-i*s)*v,e[3]=g*v,e[4]=(d*n-i*c)*v,e[5]=(-a*n+i*o)*v,e[6]=x*v,e[7]=(-h*n+r*c)*v,e[8]=(s*n-r*o)*v,e):null},zn.adjoint=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],c=t[6],h=t[7],d=t[8];return e[0]=s*d-a*h,e[1]=i*h-r*d,e[2]=r*a-i*s,e[3]=a*c-o*d,e[4]=n*d-i*c,e[5]=i*o-n*a,e[6]=o*h-s*c,e[7]=r*c-n*h,e[8]=n*s-r*o,e},zn.determinant=function(e){var t=e[3],n=e[4],r=e[5],i=e[6],o=e[7],s=e[8];return e[0]*(s*n-r*o)+e[1]*(-s*t+r*i)+e[2]*(o*t-n*i)},zn.multiply=W0,zn.translate=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],c=t[5],h=t[6],d=t[7],m=t[8],g=n[0],x=n[1];return e[0]=r,e[1]=i,e[2]=o,e[3]=s,e[4]=a,e[5]=c,e[6]=g*r+x*s+h,e[7]=g*i+x*a+d,e[8]=g*o+x*c+m,e},zn.rotate=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],c=t[5],h=t[6],d=t[7],m=t[8],g=Math.sin(n),x=Math.cos(n);return e[0]=x*r+g*s,e[1]=x*i+g*a,e[2]=x*o+g*c,e[3]=x*s-g*r,e[4]=x*a-g*i,e[5]=x*c-g*o,e[6]=h,e[7]=d,e[8]=m,e},zn.scale=function(e,t,n){var r=n[0],i=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},zn.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},zn.fromRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=-n,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},zn.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},zn.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},zn.fromQuat=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=n+n,a=r+r,c=i+i,h=n*s,d=r*s,m=r*a,g=i*s,x=i*a,v=i*c,w=o*s,A=o*a,E=o*c;return e[0]=1-m-v,e[3]=d-E,e[6]=g+A,e[1]=d+E,e[4]=1-h-v,e[7]=x-w,e[2]=g-A,e[5]=x+w,e[8]=1-h-m,e},zn.normalFromMat4=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],c=t[6],h=t[7],d=t[8],m=t[9],g=t[10],x=t[11],v=t[12],w=t[13],A=t[14],E=t[15],S=n*a-r*s,I=n*c-i*s,B=n*h-o*s,M=r*c-i*a,D=r*h-o*a,R=i*h-o*c,z=d*w-m*v,N=d*A-g*v,V=d*E-x*v,j=m*A-g*w,H=m*E-x*w,$=g*E-x*A,G=S*$-I*H+B*j+M*V-D*N+R*z;return G?(e[0]=(a*$-c*H+h*j)*(G=1/G),e[1]=(c*V-s*$-h*N)*G,e[2]=(s*H-a*V+h*z)*G,e[3]=(i*H-r*$-o*j)*G,e[4]=(n*$-i*V+o*N)*G,e[5]=(r*V-n*H-o*z)*G,e[6]=(w*R-A*D+E*M)*G,e[7]=(A*B-v*R-E*I)*G,e[8]=(v*D-w*B+E*S)*G,e):null},zn.projection=function(e,t,n){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},zn.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},zn.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},zn.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e},zn.subtract=q0,zn.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e},zn.multiplyScalarAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e},zn.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},zn.equals=function(e,t){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],c=e[6],h=e[7],d=e[8],m=t[0],g=t[1],x=t[2],v=t[3],w=t[4],A=t[5],E=t[6],S=t[7],I=t[8];return Math.abs(n-m)<=bo.EPSILON*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(r-g)<=bo.EPSILON*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(i-x)<=bo.EPSILON*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-v)<=bo.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(s-w)<=bo.EPSILON*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(a-A)<=bo.EPSILON*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(c-E)<=bo.EPSILON*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(h-S)<=bo.EPSILON*Math.max(1,Math.abs(h),Math.abs(S))&&Math.abs(d-I)<=bo.EPSILON*Math.max(1,Math.abs(d),Math.abs(I))},zn.sub=zn.mul=void 0;var bo=function(e,t){if(e&&e.__esModule)return e;if(e===null||Bm(e)!=="object"&&typeof e!="function")return{default:e};var n=Z0(void 0);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(o!=="default"&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}(Jr);function Z0(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,n=new WeakMap;return(Z0=function(r){return r?n:t})(e)}function W0(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],c=t[5],h=t[6],d=t[7],m=t[8],g=n[0],x=n[1],v=n[2],w=n[3],A=n[4],E=n[5],S=n[6],I=n[7],B=n[8];return e[0]=g*r+x*s+v*h,e[1]=g*i+x*a+v*d,e[2]=g*o+x*c+v*m,e[3]=w*r+A*s+E*h,e[4]=w*i+A*a+E*d,e[5]=w*o+A*c+E*m,e[6]=S*r+I*s+B*h,e[7]=S*i+I*a+B*d,e[8]=S*o+I*c+B*m,e}function q0(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}zn.mul=W0,zn.sub=q0;var je={};function Dm(e){return Dm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dm(e)}Object.defineProperty(je,"__esModule",{value:!0}),je.create=function(){var e=new yr.ARRAY_TYPE(16);return yr.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},je.clone=function(e){var t=new yr.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},je.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},je.fromValues=function(e,t,n,r,i,o,s,a,c,h,d,m,g,x,v,w){var A=new yr.ARRAY_TYPE(16);return A[0]=e,A[1]=t,A[2]=n,A[3]=r,A[4]=i,A[5]=o,A[6]=s,A[7]=a,A[8]=c,A[9]=h,A[10]=d,A[11]=m,A[12]=g,A[13]=x,A[14]=v,A[15]=w,A},je.set=function(e,t,n,r,i,o,s,a,c,h,d,m,g,x,v,w,A){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=o,e[5]=s,e[6]=a,e[7]=c,e[8]=h,e[9]=d,e[10]=m,e[11]=g,e[12]=x,e[13]=v,e[14]=w,e[15]=A,e},je.identity=$0,je.transpose=function(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],o=t[6],s=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=o,e[11]=t[14],e[12]=i,e[13]=s,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},je.invert=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],c=t[6],h=t[7],d=t[8],m=t[9],g=t[10],x=t[11],v=t[12],w=t[13],A=t[14],E=t[15],S=n*a-r*s,I=n*c-i*s,B=n*h-o*s,M=r*c-i*a,D=r*h-o*a,R=i*h-o*c,z=d*w-m*v,N=d*A-g*v,V=d*E-x*v,j=m*A-g*w,H=m*E-x*w,$=g*E-x*A,G=S*$-I*H+B*j+M*V-D*N+R*z;return G?(e[0]=(a*$-c*H+h*j)*(G=1/G),e[1]=(i*H-r*$-o*j)*G,e[2]=(w*R-A*D+E*M)*G,e[3]=(g*D-m*R-x*M)*G,e[4]=(c*V-s*$-h*N)*G,e[5]=(n*$-i*V+o*N)*G,e[6]=(A*B-v*R-E*I)*G,e[7]=(d*R-g*B+x*I)*G,e[8]=(s*H-a*V+h*z)*G,e[9]=(r*V-n*H-o*z)*G,e[10]=(v*D-w*B+E*S)*G,e[11]=(m*B-d*D-x*S)*G,e[12]=(a*N-s*j-c*z)*G,e[13]=(n*j-r*N+i*z)*G,e[14]=(w*I-v*M-A*S)*G,e[15]=(d*M-m*I+g*S)*G,e):null},je.adjoint=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],c=t[6],h=t[7],d=t[8],m=t[9],g=t[10],x=t[11],v=t[12],w=t[13],A=t[14],E=t[15];return e[0]=a*(g*E-x*A)-m*(c*E-h*A)+w*(c*x-h*g),e[1]=-(r*(g*E-x*A)-m*(i*E-o*A)+w*(i*x-o*g)),e[2]=r*(c*E-h*A)-a*(i*E-o*A)+w*(i*h-o*c),e[3]=-(r*(c*x-h*g)-a*(i*x-o*g)+m*(i*h-o*c)),e[4]=-(s*(g*E-x*A)-d*(c*E-h*A)+v*(c*x-h*g)),e[5]=n*(g*E-x*A)-d*(i*E-o*A)+v*(i*x-o*g),e[6]=-(n*(c*E-h*A)-s*(i*E-o*A)+v*(i*h-o*c)),e[7]=n*(c*x-h*g)-s*(i*x-o*g)+d*(i*h-o*c),e[8]=s*(m*E-x*w)-d*(a*E-h*w)+v*(a*x-h*m),e[9]=-(n*(m*E-x*w)-d*(r*E-o*w)+v*(r*x-o*m)),e[10]=n*(a*E-h*w)-s*(r*E-o*w)+v*(r*h-o*a),e[11]=-(n*(a*x-h*m)-s*(r*x-o*m)+d*(r*h-o*a)),e[12]=-(s*(m*A-g*w)-d*(a*A-c*w)+v*(a*g-c*m)),e[13]=n*(m*A-g*w)-d*(r*A-i*w)+v*(r*g-i*m),e[14]=-(n*(a*A-c*w)-s*(r*A-i*w)+v*(r*c-i*a)),e[15]=n*(a*g-c*m)-s*(r*g-i*m)+d*(r*c-i*a),e},je.determinant=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=e[6],c=e[7],h=e[8],d=e[9],m=e[10],g=e[11],x=e[12],v=e[13],w=e[14],A=e[15];return(t*s-n*o)*(m*A-g*w)-(t*a-r*o)*(d*A-g*v)+(t*c-i*o)*(d*w-m*v)+(n*a-r*s)*(h*A-g*x)-(n*c-i*s)*(h*w-m*x)+(r*c-i*a)*(h*v-d*x)},je.multiply=K0,je.translate=function(e,t,n){var r,i,o,s,a,c,h,d,m,g,x,v,w=n[0],A=n[1],E=n[2];return t===e?(e[12]=t[0]*w+t[4]*A+t[8]*E+t[12],e[13]=t[1]*w+t[5]*A+t[9]*E+t[13],e[14]=t[2]*w+t[6]*A+t[10]*E+t[14],e[15]=t[3]*w+t[7]*A+t[11]*E+t[15]):(i=t[1],o=t[2],s=t[3],a=t[4],c=t[5],h=t[6],d=t[7],m=t[8],g=t[9],x=t[10],v=t[11],e[0]=r=t[0],e[1]=i,e[2]=o,e[3]=s,e[4]=a,e[5]=c,e[6]=h,e[7]=d,e[8]=m,e[9]=g,e[10]=x,e[11]=v,e[12]=r*w+a*A+m*E+t[12],e[13]=i*w+c*A+g*E+t[13],e[14]=o*w+h*A+x*E+t[14],e[15]=s*w+d*A+v*E+t[15]),e},je.scale=function(e,t,n){var r=n[0],i=n[1],o=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},je.rotate=function(e,t,n,r){var i,o,s,a,c,h,d,m,g,x,v,w,A,E,S,I,B,M,D,R,z,N,V,j,H=r[0],$=r[1],G=r[2],Q=Math.hypot(H,$,G);return Q<yr.EPSILON?null:(H*=Q=1/Q,$*=Q,G*=Q,i=Math.sin(n),o=Math.cos(n),c=t[1],h=t[2],d=t[3],g=t[5],x=t[6],v=t[7],A=t[9],E=t[10],S=t[11],D=H*$*(s=1-o)-G*i,R=$*$*s+o,z=G*$*s+H*i,N=H*G*s+$*i,V=$*G*s-H*i,j=G*G*s+o,e[0]=(a=t[0])*(I=H*H*s+o)+(m=t[4])*(B=$*H*s+G*i)+(w=t[8])*(M=G*H*s-$*i),e[1]=c*I+g*B+A*M,e[2]=h*I+x*B+E*M,e[3]=d*I+v*B+S*M,e[4]=a*D+m*R+w*z,e[5]=c*D+g*R+A*z,e[6]=h*D+x*R+E*z,e[7]=d*D+v*R+S*z,e[8]=a*N+m*V+w*j,e[9]=c*N+g*V+A*j,e[10]=h*N+x*V+E*j,e[11]=d*N+v*V+S*j,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},je.rotateX=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[4],s=t[5],a=t[6],c=t[7],h=t[8],d=t[9],m=t[10],g=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+h*r,e[5]=s*i+d*r,e[6]=a*i+m*r,e[7]=c*i+g*r,e[8]=h*i-o*r,e[9]=d*i-s*r,e[10]=m*i-a*r,e[11]=g*i-c*r,e},je.rotateY=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],s=t[1],a=t[2],c=t[3],h=t[8],d=t[9],m=t[10],g=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-h*r,e[1]=s*i-d*r,e[2]=a*i-m*r,e[3]=c*i-g*r,e[8]=o*r+h*i,e[9]=s*r+d*i,e[10]=a*r+m*i,e[11]=c*r+g*i,e},je.rotateZ=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],s=t[1],a=t[2],c=t[3],h=t[4],d=t[5],m=t[6],g=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+h*r,e[1]=s*i+d*r,e[2]=a*i+m*r,e[3]=c*i+g*r,e[4]=h*i-o*r,e[5]=d*i-s*r,e[6]=m*i-a*r,e[7]=g*i-c*r,e},je.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},je.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},je.fromRotation=function(e,t,n){var r,i,o,s=n[0],a=n[1],c=n[2],h=Math.hypot(s,a,c);return h<yr.EPSILON?null:(s*=h=1/h,a*=h,c*=h,r=Math.sin(t),i=Math.cos(t),e[0]=s*s*(o=1-i)+i,e[1]=a*s*o+c*r,e[2]=c*s*o-a*r,e[3]=0,e[4]=s*a*o-c*r,e[5]=a*a*o+i,e[6]=c*a*o+s*r,e[7]=0,e[8]=s*c*o+a*r,e[9]=a*c*o-s*r,e[10]=c*c*o+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},je.fromXRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},je.fromYRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},je.fromZRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},je.fromRotationTranslation=X0,je.fromQuat2=function(e,t){var n=new yr.ARRAY_TYPE(3),r=-t[0],i=-t[1],o=-t[2],s=t[3],a=t[4],c=t[5],h=t[6],d=t[7],m=r*r+i*i+o*o+s*s;return m>0?(n[0]=2*(a*s+d*r+c*o-h*i)/m,n[1]=2*(c*s+d*i+h*r-a*o)/m,n[2]=2*(h*s+d*o+a*i-c*r)/m):(n[0]=2*(a*s+d*r+c*o-h*i),n[1]=2*(c*s+d*i+h*r-a*o),n[2]=2*(h*s+d*o+a*i-c*r)),X0(e,t,n),e},je.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},je.getScaling=Y0,je.getRotation=function(e,t){var n=new yr.ARRAY_TYPE(3);Y0(n,t);var r=1/n[0],i=1/n[1],o=1/n[2],s=t[0]*r,a=t[1]*i,c=t[2]*o,h=t[4]*r,d=t[5]*i,m=t[6]*o,g=t[8]*r,x=t[9]*i,v=t[10]*o,w=s+d+v,A=0;return w>0?(A=2*Math.sqrt(w+1),e[3]=.25*A,e[0]=(m-x)/A,e[1]=(g-c)/A,e[2]=(a-h)/A):s>d&&s>v?(A=2*Math.sqrt(1+s-d-v),e[3]=(m-x)/A,e[0]=.25*A,e[1]=(a+h)/A,e[2]=(g+c)/A):d>v?(A=2*Math.sqrt(1+d-s-v),e[3]=(g-c)/A,e[0]=(a+h)/A,e[1]=.25*A,e[2]=(m+x)/A):(A=2*Math.sqrt(1+v-s-d),e[3]=(a-h)/A,e[0]=(g+c)/A,e[1]=(m+x)/A,e[2]=.25*A),e},je.fromRotationTranslationScale=function(e,t,n,r){var i=t[0],o=t[1],s=t[2],a=t[3],c=i+i,h=o+o,d=s+s,m=i*c,g=i*h,x=i*d,v=o*h,w=o*d,A=s*d,E=a*c,S=a*h,I=a*d,B=r[0],M=r[1],D=r[2];return e[0]=(1-(v+A))*B,e[1]=(g+I)*B,e[2]=(x-S)*B,e[3]=0,e[4]=(g-I)*M,e[5]=(1-(m+A))*M,e[6]=(w+E)*M,e[7]=0,e[8]=(x+S)*D,e[9]=(w-E)*D,e[10]=(1-(m+v))*D,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},je.fromRotationTranslationScaleOrigin=function(e,t,n,r,i){var o=t[0],s=t[1],a=t[2],c=t[3],h=o+o,d=s+s,m=a+a,g=o*h,x=o*d,v=o*m,w=s*d,A=s*m,E=a*m,S=c*h,I=c*d,B=c*m,M=r[0],D=r[1],R=r[2],z=i[0],N=i[1],V=i[2],j=(1-(w+E))*M,H=(x+B)*M,$=(v-I)*M,G=(x-B)*D,Q=(1-(g+E))*D,et=(A+S)*D,st=(v+I)*R,Y=(A-S)*R,tt=(1-(g+w))*R;return e[0]=j,e[1]=H,e[2]=$,e[3]=0,e[4]=G,e[5]=Q,e[6]=et,e[7]=0,e[8]=st,e[9]=Y,e[10]=tt,e[11]=0,e[12]=n[0]+z-(j*z+G*N+st*V),e[13]=n[1]+N-(H*z+Q*N+Y*V),e[14]=n[2]+V-($*z+et*N+tt*V),e[15]=1,e},je.fromQuat=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=n+n,a=r+r,c=i+i,h=n*s,d=r*s,m=r*a,g=i*s,x=i*a,v=i*c,w=o*s,A=o*a,E=o*c;return e[0]=1-m-v,e[1]=d+E,e[2]=g-A,e[3]=0,e[4]=d-E,e[5]=1-h-v,e[6]=x+w,e[7]=0,e[8]=g+A,e[9]=x-w,e[10]=1-h-m,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},je.frustum=function(e,t,n,r,i,o,s){var a=1/(n-t),c=1/(i-r),h=1/(o-s);return e[0]=2*o*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*c,e[6]=0,e[7]=0,e[8]=(n+t)*a,e[9]=(i+r)*c,e[10]=(s+o)*h,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*o*2*h,e[15]=0,e},je.perspectiveNO=Wf,je.perspectiveZO=function(e,t,n,r,i){var o,s=1/Math.tan(t/2);return e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0?(e[10]=i*(o=1/(r-i)),e[14]=i*r*o):(e[10]=-1,e[14]=-r),e},je.perspectiveFromFieldOfView=function(e,t,n,r){var i=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),c=2/(s+a),h=2/(i+o);return e[0]=c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=h,e[6]=0,e[7]=0,e[8]=-(s-a)*c*.5,e[9]=(i-o)*h*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e},je.orthoNO=Pm,je.orthoZO=function(e,t,n,r,i,o,s){var a=1/(t-n),c=1/(r-i),h=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=h,e[11]=0,e[12]=(t+n)*a,e[13]=(i+r)*c,e[14]=o*h,e[15]=1,e},je.lookAt=function(e,t,n,r){var i,o,s,a,c,h,d,m,g,x,v=t[0],w=t[1],A=t[2],E=r[0],S=r[1],I=r[2],B=n[0],M=n[1],D=n[2];return Math.abs(v-B)<yr.EPSILON&&Math.abs(w-M)<yr.EPSILON&&Math.abs(A-D)<yr.EPSILON?$0(e):(d=v-B,m=w-M,g=A-D,i=S*(g*=x=1/Math.hypot(d,m,g))-I*(m*=x),o=I*(d*=x)-E*g,s=E*m-S*d,(x=Math.hypot(i,o,s))?(i*=x=1/x,o*=x,s*=x):(i=0,o=0,s=0),a=m*s-g*o,c=g*i-d*s,h=d*o-m*i,(x=Math.hypot(a,c,h))?(a*=x=1/x,c*=x,h*=x):(a=0,c=0,h=0),e[0]=i,e[1]=a,e[2]=d,e[3]=0,e[4]=o,e[5]=c,e[6]=m,e[7]=0,e[8]=s,e[9]=h,e[10]=g,e[11]=0,e[12]=-(i*v+o*w+s*A),e[13]=-(a*v+c*w+h*A),e[14]=-(d*v+m*w+g*A),e[15]=1,e)},je.targetTo=function(e,t,n,r){var i=t[0],o=t[1],s=t[2],a=r[0],c=r[1],h=r[2],d=i-n[0],m=o-n[1],g=s-n[2],x=d*d+m*m+g*g;x>0&&(d*=x=1/Math.sqrt(x),m*=x,g*=x);var v=c*g-h*m,w=h*d-a*g,A=a*m-c*d;return(x=v*v+w*w+A*A)>0&&(v*=x=1/Math.sqrt(x),w*=x,A*=x),e[0]=v,e[1]=w,e[2]=A,e[3]=0,e[4]=m*A-g*w,e[5]=g*v-d*A,e[6]=d*w-m*v,e[7]=0,e[8]=d,e[9]=m,e[10]=g,e[11]=0,e[12]=i,e[13]=o,e[14]=s,e[15]=1,e},je.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},je.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},je.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e},je.subtract=Q0,je.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e},je.multiplyScalarAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e},je.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},je.equals=function(e,t){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],c=e[6],h=e[7],d=e[8],m=e[9],g=e[10],x=e[11],v=e[12],w=e[13],A=e[14],E=e[15],S=t[0],I=t[1],B=t[2],M=t[3],D=t[4],R=t[5],z=t[6],N=t[7],V=t[8],j=t[9],H=t[10],$=t[11],G=t[12],Q=t[13],et=t[14],st=t[15];return Math.abs(n-S)<=yr.EPSILON*Math.max(1,Math.abs(n),Math.abs(S))&&Math.abs(r-I)<=yr.EPSILON*Math.max(1,Math.abs(r),Math.abs(I))&&Math.abs(i-B)<=yr.EPSILON*Math.max(1,Math.abs(i),Math.abs(B))&&Math.abs(o-M)<=yr.EPSILON*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(s-D)<=yr.EPSILON*Math.max(1,Math.abs(s),Math.abs(D))&&Math.abs(a-R)<=yr.EPSILON*Math.max(1,Math.abs(a),Math.abs(R))&&Math.abs(c-z)<=yr.EPSILON*Math.max(1,Math.abs(c),Math.abs(z))&&Math.abs(h-N)<=yr.EPSILON*Math.max(1,Math.abs(h),Math.abs(N))&&Math.abs(d-V)<=yr.EPSILON*Math.max(1,Math.abs(d),Math.abs(V))&&Math.abs(m-j)<=yr.EPSILON*Math.max(1,Math.abs(m),Math.abs(j))&&Math.abs(g-H)<=yr.EPSILON*Math.max(1,Math.abs(g),Math.abs(H))&&Math.abs(x-$)<=yr.EPSILON*Math.max(1,Math.abs(x),Math.abs($))&&Math.abs(v-G)<=yr.EPSILON*Math.max(1,Math.abs(v),Math.abs(G))&&Math.abs(w-Q)<=yr.EPSILON*Math.max(1,Math.abs(w),Math.abs(Q))&&Math.abs(A-et)<=yr.EPSILON*Math.max(1,Math.abs(A),Math.abs(et))&&Math.abs(E-st)<=yr.EPSILON*Math.max(1,Math.abs(E),Math.abs(st))},je.sub=je.mul=je.ortho=je.perspective=void 0;var yr=function(e,t){if(e&&e.__esModule)return e;if(e===null||Dm(e)!=="object"&&typeof e!="function")return{default:e};var n=J0(void 0);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(o!=="default"&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}(Jr);function J0(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,n=new WeakMap;return(J0=function(r){return r?n:t})(e)}function $0(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function K0(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],c=t[5],h=t[6],d=t[7],m=t[8],g=t[9],x=t[10],v=t[11],w=t[12],A=t[13],E=t[14],S=t[15],I=n[0],B=n[1],M=n[2],D=n[3];return e[0]=I*r+B*a+M*m+D*w,e[1]=I*i+B*c+M*g+D*A,e[2]=I*o+B*h+M*x+D*E,e[3]=I*s+B*d+M*v+D*S,e[4]=(I=n[4])*r+(B=n[5])*a+(M=n[6])*m+(D=n[7])*w,e[5]=I*i+B*c+M*g+D*A,e[6]=I*o+B*h+M*x+D*E,e[7]=I*s+B*d+M*v+D*S,e[8]=(I=n[8])*r+(B=n[9])*a+(M=n[10])*m+(D=n[11])*w,e[9]=I*i+B*c+M*g+D*A,e[10]=I*o+B*h+M*x+D*E,e[11]=I*s+B*d+M*v+D*S,e[12]=(I=n[12])*r+(B=n[13])*a+(M=n[14])*m+(D=n[15])*w,e[13]=I*i+B*c+M*g+D*A,e[14]=I*o+B*h+M*x+D*E,e[15]=I*s+B*d+M*v+D*S,e}function X0(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=r+r,c=i+i,h=o+o,d=r*a,m=r*c,g=r*h,x=i*c,v=i*h,w=o*h,A=s*a,E=s*c,S=s*h;return e[0]=1-(x+w),e[1]=m+S,e[2]=g-E,e[3]=0,e[4]=m-S,e[5]=1-(d+w),e[6]=v+A,e[7]=0,e[8]=g+E,e[9]=v-A,e[10]=1-(d+x),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function Y0(e,t){var n=t[4],r=t[5],i=t[6],o=t[8],s=t[9],a=t[10];return e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(n,r,i),e[2]=Math.hypot(o,s,a),e}function Wf(e,t,n,r,i){var o,s=1/Math.tan(t/2);return e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0?(e[10]=(i+r)*(o=1/(r-i)),e[14]=2*i*r*o):(e[10]=-1,e[14]=-2*r),e}function Pm(e,t,n,r,i,o,s){var a=1/(t-n),c=1/(r-i),h=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*h,e[11]=0,e[12]=(t+n)*a,e[13]=(i+r)*c,e[14]=(s+o)*h,e[15]=1,e}function Q0(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}je.perspective=Wf,je.ortho=Pm,je.mul=K0,je.sub=Q0;var Ue={},Ge={};function Lm(e){return Lm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lm(e)}Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.create=ey,Ge.clone=function(e){var t=new ua.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Ge.length=ny,Ge.fromValues=function(e,t,n){var r=new ua.ARRAY_TYPE(3);return r[0]=e,r[1]=t,r[2]=n,r},Ge.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Ge.set=function(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e},Ge.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},Ge.subtract=Rm,Ge.multiply=ry,Ge.divide=dh,Ge.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},Ge.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},Ge.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},Ge.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},Ge.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},Ge.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},Ge.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e},Ge.distance=iy,Ge.squaredDistance=oy,Ge.squaredLength=sy,Ge.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},Ge.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},Ge.normalize=function(e,t){var n=t[0],r=t[1],i=t[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e},Ge.dot=ay,Ge.cross=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=n[0],a=n[1],c=n[2];return e[0]=i*c-o*a,e[1]=o*s-r*c,e[2]=r*a-i*s,e},Ge.lerp=function(e,t,n,r){var i=t[0],o=t[1],s=t[2];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e[2]=s+r*(n[2]-s),e},Ge.hermite=function(e,t,n,r,i,o){var s=o*o,a=s*(2*o-3)+1,c=s*(o-2)+o,h=s*(o-1),d=s*(3-2*o);return e[0]=t[0]*a+n[0]*c+r[0]*h+i[0]*d,e[1]=t[1]*a+n[1]*c+r[1]*h+i[1]*d,e[2]=t[2]*a+n[2]*c+r[2]*h+i[2]*d,e},Ge.bezier=function(e,t,n,r,i,o){var s=1-o,a=s*s,c=o*o,h=a*s,d=3*o*a,m=3*c*s,g=c*o;return e[0]=t[0]*h+n[0]*d+r[0]*m+i[0]*g,e[1]=t[1]*h+n[1]*d+r[1]*m+i[1]*g,e[2]=t[2]*h+n[2]*d+r[2]*m+i[2]*g,e},Ge.random=function(e,t){t=t||1;var n=2*ua.RANDOM()*Math.PI,r=2*ua.RANDOM()-1,i=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*i,e[1]=Math.sin(n)*i,e[2]=r*t,e},Ge.transformMat4=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=n[3]*r+n[7]*i+n[11]*o+n[15];return e[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/(s=s||1),e[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/s,e[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/s,e},Ge.transformMat3=function(e,t,n){var r=t[0],i=t[1],o=t[2];return e[0]=r*n[0]+i*n[3]+o*n[6],e[1]=r*n[1]+i*n[4]+o*n[7],e[2]=r*n[2]+i*n[5]+o*n[8],e},Ge.transformQuat=function(e,t,n){var r=n[0],i=n[1],o=n[2],s=t[0],a=t[1],c=t[2],h=i*c-o*a,d=o*s-r*c,m=r*a-i*s,g=i*m-o*d,x=o*h-r*m,v=r*d-i*h,w=2*n[3];return d*=w,m*=w,x*=2,v*=2,e[0]=s+(h*=w)+(g*=2),e[1]=a+d+x,e[2]=c+m+v,e},Ge.rotateX=function(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},Ge.rotateY=function(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},Ge.rotateZ=function(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},Ge.angle=function(e,t){var n=e[0],r=e[1],i=e[2],o=t[0],s=t[1],a=t[2],c=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(o*o+s*s+a*a),h=c&&ay(e,t)/c;return Math.acos(Math.min(Math.max(h,-1),1))},Ge.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e},Ge.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},Ge.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},Ge.equals=function(e,t){var n=e[0],r=e[1],i=e[2],o=t[0],s=t[1],a=t[2];return Math.abs(n-o)<=ua.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-s)<=ua.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-a)<=ua.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))},Ge.forEach=Ge.sqrLen=Ge.len=Ge.sqrDist=Ge.dist=Ge.div=Ge.mul=Ge.sub=void 0;var ua=function(e,t){if(e&&e.__esModule)return e;if(e===null||Lm(e)!=="object"&&typeof e!="function")return{default:e};var n=ty(void 0);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(o!=="default"&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}(Jr);function ty(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,n=new WeakMap;return(ty=function(r){return r?n:t})(e)}function ey(){var e=new ua.ARRAY_TYPE(3);return ua.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function ny(e){return Math.hypot(e[0],e[1],e[2])}function Rm(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function ry(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function dh(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function iy(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])}function oy(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}function sy(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function ay(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}Ge.sub=Rm,Ge.mul=ry,Ge.div=dh,Ge.dist=iy,Ge.sqrDist=oy,Ge.len=ny,Ge.sqrLen=sy;var ca,Sw=(ca=ey(),function(e,t,n,r,i,o){var s,a;for(t||(t=3),n||(n=0),a=r?Math.min(r*t+n,e.length):e.length,s=n;s<a;s+=t)ca[0]=e[s],ca[1]=e[s+1],ca[2]=e[s+2],i(ca,ca,o),e[s]=ca[0],e[s+1]=ca[1],e[s+2]=ca[2];return e});Ge.forEach=Sw;var tn={};function km(e){return km=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},km(e)}Object.defineProperty(tn,"__esModule",{value:!0}),tn.create=uy,tn.clone=function(e){var t=new Oo.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},tn.fromValues=function(e,t,n,r){var i=new Oo.ARRAY_TYPE(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i},tn.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},tn.set=function(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e},tn.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},tn.subtract=cy,tn.multiply=hy,tn.divide=fy,tn.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},tn.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},tn.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e},tn.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e},tn.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},tn.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},tn.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e},tn.distance=dy,tn.squaredDistance=py,tn.length=Fm,tn.squaredLength=zm,tn.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},tn.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},tn.normalize=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=n*n+r*r+i*i+o*o;return s>0&&(s=1/Math.sqrt(s)),e[0]=n*s,e[1]=r*s,e[2]=i*s,e[3]=o*s,e},tn.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},tn.cross=function(e,t,n,r){var i=n[0]*r[1]-n[1]*r[0],o=n[0]*r[2]-n[2]*r[0],s=n[0]*r[3]-n[3]*r[0],a=n[1]*r[2]-n[2]*r[1],c=n[1]*r[3]-n[3]*r[1],h=n[2]*r[3]-n[3]*r[2],d=t[0],m=t[1],g=t[2],x=t[3];return e[0]=m*h-g*c+x*a,e[1]=-d*h+g*s-x*o,e[2]=d*c-m*s+x*i,e[3]=-d*a+m*o-g*i,e},tn.lerp=function(e,t,n,r){var i=t[0],o=t[1],s=t[2],a=t[3];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e[2]=s+r*(n[2]-s),e[3]=a+r*(n[3]-a),e},tn.random=function(e,t){var n,r,i,o,s,a;t=t||1;do s=(n=2*Oo.RANDOM()-1)*n+(r=2*Oo.RANDOM()-1)*r;while(s>=1);do a=(i=2*Oo.RANDOM()-1)*i+(o=2*Oo.RANDOM()-1)*o;while(a>=1);var c=Math.sqrt((1-s)/a);return e[0]=t*n,e[1]=t*r,e[2]=t*i*c,e[3]=t*o*c,e},tn.transformMat4=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*s,e[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*s,e[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*s,e[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*s,e},tn.transformQuat=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=n[0],a=n[1],c=n[2],h=n[3],d=h*r+a*o-c*i,m=h*i+c*r-s*o,g=h*o+s*i-a*r,x=-s*r-a*i-c*o;return e[0]=d*h+x*-s+m*-c-g*-a,e[1]=m*h+x*-a+g*-s-d*-c,e[2]=g*h+x*-c+d*-a-m*-s,e[3]=t[3],e},tn.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},tn.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},tn.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},tn.equals=function(e,t){var n=e[0],r=e[1],i=e[2],o=e[3],s=t[0],a=t[1],c=t[2],h=t[3];return Math.abs(n-s)<=Oo.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-a)<=Oo.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-c)<=Oo.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(o-h)<=Oo.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))},tn.forEach=tn.sqrLen=tn.len=tn.sqrDist=tn.dist=tn.div=tn.mul=tn.sub=void 0;var Oo=function(e,t){if(e&&e.__esModule)return e;if(e===null||km(e)!=="object"&&typeof e!="function")return{default:e};var n=ly(void 0);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(o!=="default"&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}(Jr);function ly(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,n=new WeakMap;return(ly=function(r){return r?n:t})(e)}function uy(){var e=new Oo.ARRAY_TYPE(4);return Oo.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function cy(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function hy(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function fy(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e}function dy(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3])}function py(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return n*n+r*r+i*i+o*o}function Fm(e){return Math.hypot(e[0],e[1],e[2],e[3])}function zm(e){var t=e[0],n=e[1],r=e[2],i=e[3];return t*t+n*n+r*r+i*i}tn.sub=cy,tn.mul=hy,tn.div=fy,tn.dist=dy,tn.sqrDist=py,tn.len=Fm,tn.sqrLen=zm;var Mw=function(){var e=uy();return function(t,n,r,i,o,s){var a,c;for(n||(n=4),r||(r=0),c=i?Math.min(i*n+r,t.length):t.length,a=r;a<c;a+=n)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],o(e,e,s),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}}();function Om(e){return Om=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Om(e)}tn.forEach=Mw,Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.create=Nm,Ue.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},Ue.setAxisAngle=gy,Ue.getAxisAngle=function(e,t){var n=2*Math.acos(t[3]),r=Math.sin(n/2);return r>Gl.EPSILON?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),n},Ue.getAngle=function(e,t){var n=ph(e,t);return Math.acos(2*n*n-1)},Ue.multiply=_y,Ue.rotateX=function(e,t,n){n*=.5;var r=t[0],i=t[1],o=t[2],s=t[3],a=Math.sin(n),c=Math.cos(n);return e[0]=r*c+s*a,e[1]=i*c+o*a,e[2]=o*c-i*a,e[3]=s*c-r*a,e},Ue.rotateY=function(e,t,n){n*=.5;var r=t[0],i=t[1],o=t[2],s=t[3],a=Math.sin(n),c=Math.cos(n);return e[0]=r*c-o*a,e[1]=i*c+s*a,e[2]=o*c+r*a,e[3]=s*c-i*a,e},Ue.rotateZ=function(e,t,n){n*=.5;var r=t[0],i=t[1],o=t[2],s=t[3],a=Math.sin(n),c=Math.cos(n);return e[0]=r*c+i*a,e[1]=i*c-r*a,e[2]=o*c+s*a,e[3]=s*c-o*a,e},Ue.calculateW=function(e,t){var n=t[0],r=t[1],i=t[2];return e[0]=n,e[1]=r,e[2]=i,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),e},Ue.exp=yy,Ue.ln=xy,Ue.pow=function(e,t,n){return xy(e,t),wy(e,e,n),yy(e,e),e},Ue.slerp=Jf,Ue.random=function(e){var t=Gl.RANDOM(),n=Gl.RANDOM(),r=Gl.RANDOM(),i=Math.sqrt(1-t),o=Math.sqrt(t);return e[0]=i*Math.sin(2*Math.PI*n),e[1]=i*Math.cos(2*Math.PI*n),e[2]=o*Math.sin(2*Math.PI*r),e[3]=o*Math.cos(2*Math.PI*r),e},Ue.invert=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=n*n+r*r+i*i+o*o,a=s?1/s:0;return e[0]=-n*a,e[1]=-r*a,e[2]=-i*a,e[3]=o*a,e},Ue.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},Ue.fromMat3=vy,Ue.fromEuler=function(e,t,n,r){var i=.5*Math.PI/180;t*=i,n*=i,r*=i;var o=Math.sin(t),s=Math.cos(t),a=Math.sin(n),c=Math.cos(n),h=Math.sin(r),d=Math.cos(r);return e[0]=o*c*d-s*a*h,e[1]=s*a*d+o*c*h,e[2]=s*c*h-o*a*d,e[3]=s*c*d+o*a*h,e},Ue.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},Ue.setAxes=Ue.sqlerp=Ue.rotationTo=Ue.equals=Ue.exactEquals=Ue.normalize=Ue.sqrLen=Ue.squaredLength=Ue.len=Ue.length=Ue.lerp=Ue.dot=Ue.scale=Ue.mul=Ue.add=Ue.set=Ue.copy=Ue.fromValues=Ue.clone=void 0;var Gl=qf(Jr),Iw=qf(zn),No=qf(Ge),Ao=qf(tn);function my(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,n=new WeakMap;return(my=function(r){return r?n:t})(e)}function qf(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||Om(e)!=="object"&&typeof e!="function")return{default:e};var n=my(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(o!=="default"&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}function Nm(){var e=new Gl.ARRAY_TYPE(4);return Gl.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function gy(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function _y(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=n[0],c=n[1],h=n[2],d=n[3];return e[0]=r*d+s*a+i*h-o*c,e[1]=i*d+s*c+o*a-r*h,e[2]=o*d+s*h+r*c-i*a,e[3]=s*d-r*a-i*c-o*h,e}function yy(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=Math.sqrt(n*n+r*r+i*i),a=Math.exp(o),c=s>0?a*Math.sin(s)/s:0;return e[0]=n*c,e[1]=r*c,e[2]=i*c,e[3]=a*Math.cos(s),e}function xy(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=Math.sqrt(n*n+r*r+i*i),a=s>0?Math.atan2(s,o)/s:0;return e[0]=n*a,e[1]=r*a,e[2]=i*a,e[3]=.5*Math.log(n*n+r*r+i*i+o*o),e}function Jf(e,t,n,r){var i,o,s,a,c,h=t[0],d=t[1],m=t[2],g=t[3],x=n[0],v=n[1],w=n[2],A=n[3];return(o=h*x+d*v+m*w+g*A)<0&&(o=-o,x=-x,v=-v,w=-w,A=-A),1-o>Gl.EPSILON?(i=Math.acos(o),s=Math.sin(i),a=Math.sin((1-r)*i)/s,c=Math.sin(r*i)/s):(a=1-r,c=r),e[0]=a*h+c*x,e[1]=a*d+c*v,e[2]=a*m+c*w,e[3]=a*g+c*A,e}function vy(e,t){var n,r=t[0]+t[4]+t[8];if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,e[0]=(t[5]-t[7])*(n=.5/n),e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);var o=(i+1)%3,s=(i+2)%3;n=Math.sqrt(t[3*i+i]-t[3*o+o]-t[3*s+s]+1),e[i]=.5*n,e[3]=(t[3*o+s]-t[3*s+o])*(n=.5/n),e[o]=(t[3*o+i]+t[3*i+o])*n,e[s]=(t[3*s+i]+t[3*i+s])*n}return e}Ue.clone=Ao.clone,Ue.fromValues=Ao.fromValues,Ue.copy=Ao.copy,Ue.set=Ao.set,Ue.add=Ao.add,Ue.mul=_y;var wy=Ao.scale;Ue.scale=wy;var ph=Ao.dot;Ue.dot=ph,Ue.lerp=Ao.lerp;var by=Ao.length;Ue.length=by,Ue.len=by;var Um=Ao.squaredLength;Ue.squaredLength=Um,Ue.sqrLen=Um;var $f=Ao.normalize;Ue.normalize=$f,Ue.exactEquals=Ao.exactEquals,Ue.equals=Ao.equals;var Eo,Vm,Gm,Ay=(Eo=No.create(),Vm=No.fromValues(1,0,0),Gm=No.fromValues(0,1,0),function(e,t,n){var r=No.dot(t,n);return r<-.999999?(No.cross(Eo,Vm,t),No.len(Eo)<1e-6&&No.cross(Eo,Gm,t),No.normalize(Eo,Eo),gy(e,Eo,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(No.cross(Eo,t,n),e[0]=Eo[0],e[1]=Eo[1],e[2]=Eo[2],e[3]=1+r,$f(e,e))});Ue.rotationTo=Ay;var Kf,jm,Bw=(Kf=Nm(),jm=Nm(),function(e,t,n,r,i,o){return Jf(Kf,t,i,o),Jf(jm,n,r,o),Jf(e,Kf,jm,2*o*(1-o)),e});Ue.sqlerp=Bw;var rs,Xf=(rs=Iw.create(),function(e,t,n,r){return rs[0]=n[0],rs[3]=n[1],rs[6]=n[2],rs[1]=r[0],rs[4]=r[1],rs[7]=r[2],rs[2]=-t[0],rs[5]=-t[1],rs[8]=-t[2],$f(e,vy(e,rs))});Ue.setAxes=Xf;var en={};function Hm(e){return Hm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hm(e)}Object.defineProperty(en,"__esModule",{value:!0}),en.create=function(){var e=new Ji.ARRAY_TYPE(8);return Ji.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},en.clone=function(e){var t=new Ji.ARRAY_TYPE(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},en.fromValues=function(e,t,n,r,i,o,s,a){var c=new Ji.ARRAY_TYPE(8);return c[0]=e,c[1]=t,c[2]=n,c[3]=r,c[4]=i,c[5]=o,c[6]=s,c[7]=a,c},en.fromRotationTranslationValues=function(e,t,n,r,i,o,s){var a=new Ji.ARRAY_TYPE(8);a[0]=e,a[1]=t,a[2]=n,a[3]=r;var c=.5*i,h=.5*o,d=.5*s;return a[4]=c*r+h*n-d*t,a[5]=h*r+d*e-c*n,a[6]=d*r+c*t-h*e,a[7]=-c*e-h*t-d*n,a},en.fromRotationTranslation=Ty,en.fromTranslation=function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},en.fromRotation=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},en.fromMat4=function(e,t){var n=is.create();Zm.getRotation(n,t);var r=new Ji.ARRAY_TYPE(3);return Zm.getTranslation(r,t),Ty(e,n,r),e},en.copy=Cy,en.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},en.set=function(e,t,n,r,i,o,s,a,c){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=o,e[5]=s,e[6]=a,e[7]=c,e},en.getDual=function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},en.setDual=function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},en.getTranslation=function(e,t){var n=t[4],r=t[5],i=t[6],o=t[7],s=-t[0],a=-t[1],c=-t[2],h=t[3];return e[0]=2*(n*h+o*s+r*c-i*a),e[1]=2*(r*h+o*a+i*s-n*c),e[2]=2*(i*h+o*c+n*a-r*s),e},en.translate=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=.5*n[0],c=.5*n[1],h=.5*n[2],d=t[4],m=t[5],g=t[6],x=t[7];return e[0]=r,e[1]=i,e[2]=o,e[3]=s,e[4]=s*a+i*h-o*c+d,e[5]=s*c+o*a-r*h+m,e[6]=s*h+r*c-i*a+g,e[7]=-r*a-i*c-o*h+x,e},en.rotateX=function(e,t,n){var r=-t[0],i=-t[1],o=-t[2],s=t[3],a=t[4],c=t[5],h=t[6],d=t[7],m=a*s+d*r+c*o-h*i,g=c*s+d*i+h*r-a*o,x=h*s+d*o+a*i-c*r,v=d*s-a*r-c*i-h*o;return is.rotateX(e,t,n),e[4]=m*(s=e[3])+v*(r=e[0])+g*(o=e[2])-x*(i=e[1]),e[5]=g*s+v*i+x*r-m*o,e[6]=x*s+v*o+m*i-g*r,e[7]=v*s-m*r-g*i-x*o,e},en.rotateY=function(e,t,n){var r=-t[0],i=-t[1],o=-t[2],s=t[3],a=t[4],c=t[5],h=t[6],d=t[7],m=a*s+d*r+c*o-h*i,g=c*s+d*i+h*r-a*o,x=h*s+d*o+a*i-c*r,v=d*s-a*r-c*i-h*o;return is.rotateY(e,t,n),e[4]=m*(s=e[3])+v*(r=e[0])+g*(o=e[2])-x*(i=e[1]),e[5]=g*s+v*i+x*r-m*o,e[6]=x*s+v*o+m*i-g*r,e[7]=v*s-m*r-g*i-x*o,e},en.rotateZ=function(e,t,n){var r=-t[0],i=-t[1],o=-t[2],s=t[3],a=t[4],c=t[5],h=t[6],d=t[7],m=a*s+d*r+c*o-h*i,g=c*s+d*i+h*r-a*o,x=h*s+d*o+a*i-c*r,v=d*s-a*r-c*i-h*o;return is.rotateZ(e,t,n),e[4]=m*(s=e[3])+v*(r=e[0])+g*(o=e[2])-x*(i=e[1]),e[5]=g*s+v*i+x*r-m*o,e[6]=x*s+v*o+m*i-g*r,e[7]=v*s-m*r-g*i-x*o,e},en.rotateByQuatAppend=function(e,t,n){var r=n[0],i=n[1],o=n[2],s=n[3],a=t[0],c=t[1],h=t[2],d=t[3];return e[0]=a*s+d*r+c*o-h*i,e[1]=c*s+d*i+h*r-a*o,e[2]=h*s+d*o+a*i-c*r,e[3]=d*s-a*r-c*i-h*o,e[4]=(a=t[4])*s+(d=t[7])*r+(c=t[5])*o-(h=t[6])*i,e[5]=c*s+d*i+h*r-a*o,e[6]=h*s+d*o+a*i-c*r,e[7]=d*s-a*r-c*i-h*o,e},en.rotateByQuatPrepend=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=n[0],c=n[1],h=n[2],d=n[3];return e[0]=r*d+s*a+i*h-o*c,e[1]=i*d+s*c+o*a-r*h,e[2]=o*d+s*h+r*c-i*a,e[3]=s*d-r*a-i*c-o*h,e[4]=r*(d=n[7])+s*(a=n[4])+i*(h=n[6])-o*(c=n[5]),e[5]=i*d+s*c+o*a-r*h,e[6]=o*d+s*h+r*c-i*a,e[7]=s*d-r*a-i*c-o*h,e},en.rotateAroundAxis=function(e,t,n,r){if(Math.abs(r)<Ji.EPSILON)return Cy(e,t);var i=Math.hypot(n[0],n[1],n[2]);r*=.5;var o=Math.sin(r),s=o*n[0]/i,a=o*n[1]/i,c=o*n[2]/i,h=Math.cos(r),d=t[0],m=t[1],g=t[2],x=t[3];e[0]=d*h+x*s+m*c-g*a,e[1]=m*h+x*a+g*s-d*c,e[2]=g*h+x*c+d*a-m*s,e[3]=x*h-d*s-m*a-g*c;var v=t[4],w=t[5],A=t[6],E=t[7];return e[4]=v*h+E*s+w*c-A*a,e[5]=w*h+E*a+A*s-v*c,e[6]=A*h+E*c+v*a-w*s,e[7]=E*h-v*s-w*a-A*c,e},en.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e},en.multiply=Sy,en.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e},en.lerp=function(e,t,n,r){var i=1-r;return My(t,n)<0&&(r=-r),e[0]=t[0]*i+n[0]*r,e[1]=t[1]*i+n[1]*r,e[2]=t[2]*i+n[2]*r,e[3]=t[3]*i+n[3]*r,e[4]=t[4]*i+n[4]*r,e[5]=t[5]*i+n[5]*r,e[6]=t[6]*i+n[6]*r,e[7]=t[7]*i+n[7]*r,e},en.invert=function(e,t){var n=Yf(t);return e[0]=-t[0]/n,e[1]=-t[1]/n,e[2]=-t[2]/n,e[3]=t[3]/n,e[4]=-t[4]/n,e[5]=-t[5]/n,e[6]=-t[6]/n,e[7]=t[7]/n,e},en.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},en.normalize=function(e,t){var n=Yf(t);if(n>0){n=Math.sqrt(n);var r=t[0]/n,i=t[1]/n,o=t[2]/n,s=t[3]/n,a=t[4],c=t[5],h=t[6],d=t[7],m=r*a+i*c+o*h+s*d;e[0]=r,e[1]=i,e[2]=o,e[3]=s,e[4]=(a-r*m)/n,e[5]=(c-i*m)/n,e[6]=(h-o*m)/n,e[7]=(d-s*m)/n}return e},en.str=function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},en.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},en.equals=function(e,t){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],c=e[6],h=e[7],d=t[0],m=t[1],g=t[2],x=t[3],v=t[4],w=t[5],A=t[6],E=t[7];return Math.abs(n-d)<=Ji.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(r-m)<=Ji.EPSILON*Math.max(1,Math.abs(r),Math.abs(m))&&Math.abs(i-g)<=Ji.EPSILON*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(o-x)<=Ji.EPSILON*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(s-v)<=Ji.EPSILON*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(a-w)<=Ji.EPSILON*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(c-A)<=Ji.EPSILON*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(h-E)<=Ji.EPSILON*Math.max(1,Math.abs(h),Math.abs(E))},en.sqrLen=en.squaredLength=en.len=en.length=en.dot=en.mul=en.setReal=en.getReal=void 0;var Ji=Wm(Jr),is=Wm(Ue),Zm=Wm(je);function Ey(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,n=new WeakMap;return(Ey=function(r){return r?n:t})(e)}function Wm(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||Hm(e)!=="object"&&typeof e!="function")return{default:e};var n=Ey(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(o!=="default"&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}function Ty(e,t,n){var r=.5*n[0],i=.5*n[1],o=.5*n[2],s=t[0],a=t[1],c=t[2],h=t[3];return e[0]=s,e[1]=a,e[2]=c,e[3]=h,e[4]=r*h+i*c-o*a,e[5]=i*h+o*s-r*c,e[6]=o*h+r*a-i*s,e[7]=-r*s-i*a-o*c,e}function Cy(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function Sy(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=n[4],c=n[5],h=n[6],d=n[7],m=t[4],g=t[5],x=t[6],v=t[7],w=n[0],A=n[1],E=n[2],S=n[3];return e[0]=r*S+s*w+i*E-o*A,e[1]=i*S+s*A+o*w-r*E,e[2]=o*S+s*E+r*A-i*w,e[3]=s*S-r*w-i*A-o*E,e[4]=r*d+s*a+i*h-o*c+m*S+v*w+g*E-x*A,e[5]=i*d+s*c+o*a-r*h+g*S+v*A+x*w-m*E,e[6]=o*d+s*h+r*c-i*a+x*S+v*E+m*A-g*w,e[7]=s*d-r*a-i*c-o*h+v*S-m*w-g*A-x*E,e}en.getReal=is.copy,en.setReal=is.copy,en.mul=Sy;var My=is.dot;en.dot=My;var Iy=is.length;en.length=Iy,en.len=Iy;var Yf=is.squaredLength;en.squaredLength=Yf,en.sqrLen=Yf;var qe={};function qm(e){return qm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qm(e)}Object.defineProperty(qe,"__esModule",{value:!0}),qe.create=Uo,qe.clone=function(e){var t=new jl.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},qe.fromValues=function(e,t){var n=new jl.ARRAY_TYPE(2);return n[0]=e,n[1]=t,n},qe.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},qe.set=function(e,t,n){return e[0]=t,e[1]=n,e},qe.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e},qe.subtract=Dy,qe.multiply=Py,qe.divide=Ha,qe.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},qe.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},qe.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e},qe.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e},qe.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},qe.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e},qe.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e},qe.distance=_n,qe.squaredDistance=Ly,qe.length=$i,qe.squaredLength=Vr,qe.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},qe.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},qe.normalize=function(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e},qe.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},qe.cross=function(e,t,n){var r=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=r,e},qe.lerp=function(e,t,n,r){var i=t[0],o=t[1];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e},qe.random=function(e,t){t=t||1;var n=2*jl.RANDOM()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e},qe.transformMat2=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i,e[1]=n[1]*r+n[3]*i,e},qe.transformMat2d=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i+n[4],e[1]=n[1]*r+n[3]*i+n[5],e},qe.transformMat3=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[3]*i+n[6],e[1]=n[1]*r+n[4]*i+n[7],e},qe.transformMat4=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e},qe.rotate=function(e,t,n,r){var i=t[0]-n[0],o=t[1]-n[1],s=Math.sin(r),a=Math.cos(r);return e[0]=i*a-o*s+n[0],e[1]=i*s+o*a+n[1],e},qe.angle=function(e,t){var n=e[0],r=e[1],i=t[0],o=t[1],s=Math.sqrt(n*n+r*r)*Math.sqrt(i*i+o*o);return Math.acos(Math.min(Math.max(s&&(n*i+r*o)/s,-1),1))},qe.zero=function(e){return e[0]=0,e[1]=0,e},qe.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},qe.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},qe.equals=function(e,t){var n=e[0],r=e[1],i=t[0],o=t[1];return Math.abs(n-i)<=jl.EPSILON*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-o)<=jl.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))},qe.forEach=qe.sqrLen=qe.sqrDist=qe.dist=qe.div=qe.mul=qe.sub=qe.len=void 0;var jl=function(e,t){if(e&&e.__esModule)return e;if(e===null||qm(e)!=="object"&&typeof e!="function")return{default:e};var n=By(void 0);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(o!=="default"&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}(Jr);function By(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,n=new WeakMap;return(By=function(r){return r?n:t})(e)}function Uo(){var e=new jl.ARRAY_TYPE(2);return jl.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function Dy(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function Py(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function Ha(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}function _n(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1])}function Ly(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}function $i(e){return Math.hypot(e[0],e[1])}function Vr(e){var t=e[0],n=e[1];return t*t+n*n}qe.len=$i,qe.sub=Dy,qe.mul=Py,qe.div=Ha,qe.dist=_n,qe.sqrDist=Ly,qe.sqrLen=Vr;var Dw=function(){var e=Uo();return function(t,n,r,i,o,s){var a,c;for(n||(n=2),r||(r=0),c=i?Math.min(i*n+r,t.length):t.length,a=r;a<c;a+=n)e[0]=t[a],e[1]=t[a+1],o(e,e,s),t[a]=e[0],t[a+1]=e[1];return t}}();function Bs(e){return Bs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bs(e)}qe.forEach=Dw,Object.defineProperty(qr,"__esModule",{value:!0});var Bn=qr.vec4=J=qr.vec3=qr.vec2=qr.quat2=En=qr.quat=lt=qr.mat4=Ki=qr.mat3=qr.mat2d=Hu=qr.mat2=qr.glMatrix=void 0,Pw=Ds(Jr);qr.glMatrix=Pw;var Lw=Ds(Kn),Hu=qr.mat2=Lw,Rw=Ds(cr);qr.mat2d=Rw;var Jm=Ds(zn),Ki=qr.mat3=Jm,ha=Ds(je),lt=qr.mat4=ha,Qf=Ds(Ue),En=qr.quat=Qf,Gr=Ds(en);qr.quat2=Gr;var Ry=Ds(qe);qr.vec2=Ry;var kw=Ds(Ge),J=qr.vec3=kw,Fw=Ds(tn);function ky(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,n=new WeakMap;return(ky=function(r){return r?n:t})(e)}function Ds(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||Bs(e)!=="object"&&typeof e!="function")return{default:e};var n=ky(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(o!=="default"&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}Bn=qr.vec4=Fw;const zw=wn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:mh}=zw,Zu=wn([{name:"a_pos_3",components:3,type:"Int16"}]);var Ps=wn([{name:"a_pos",type:"Int16",components:2}]),Fy={};(function(e,t){(function(n){function r(o,s,a){var c=i(256*o,256*(s=Math.pow(2,a)-s-1),a),h=i(256*(o+1),256*(s+1),a);return c[0]+","+c[1]+","+h[0]+","+h[1]}function i(o,s,a){var c=2*Math.PI*6378137/256/Math.pow(2,a);return[o*c-2*Math.PI*6378137/2,s*c-2*Math.PI*6378137/2]}n.getURL=function(o,s,a,c,h,d){return d=d||{},o+"?"+["bbox="+r(a,c,h),"format="+(d.format||"image/png"),"service="+(d.service||"WMS"),"version="+(d.version||"1.1.1"),"request="+(d.request||"GetMap"),"srs="+(d.srs||"EPSG:3857"),"width="+(d.width||256),"height="+(d.height||256),"layers="+s].join("&")},n.getTileBBox=r,n.getMercCoords=i,Object.defineProperty(n,"__esModule",{value:!0})})(t)})(0,Fy);var zy=Fy;class Xi{constructor(t,n,r){this.z=t,this.x=n,this.y=r,this.key=gh(0,t,t,n,r)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n){const r=zy.getTileBBox(this.x,this.y,this.z),i=function(o,s,a){let c,h="";for(let d=o;d>0;d--)c=1<<d-1,h+=(s&c?1:0)+(a&c?2:0);return h}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",i).replace("{bbox-epsg-3857}",r)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Yi{constructor(t,n){this.wrap=t,this.canonical=n,this.key=gh(t,n.z,n.z,n.x,n.y)}}class sn{constructor(t,n,r,i,o){this.overscaledZ=t,this.wrap=n,this.canonical=new Xi(r,+i,+o),this.key=n===0&&t===r?this.canonical.key:gh(n,t,r,i,o)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const n=this.canonical.z-t;return t>this.canonical.z?new sn(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new sn(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n=!0){if(this.overscaledZ===t&&n)return this.key;if(t>this.canonical.z)return gh(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y);{const r=this.canonical.z-t;return gh(this.wrap*+n,t,t,this.canonical.x>>r,this.canonical.y>>r)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const n=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new sn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,r=2*this.canonical.x,i=2*this.canonical.y;return[new sn(n,this.wrap,n,r,i),new sn(n,this.wrap,n,r+1,i),new sn(n,this.wrap,n,r,i+1),new sn(n,this.wrap,n,r+1,i+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new sn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new sn(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Yi(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function gh(e,t,n,r,i){const o=1<<Math.min(n,22);let s=o*(i%o)+r%o;return e&&n<22&&(s+=o*o*((e<0?-2*e-1:2*e)%(1<<2*(22-n)))),16*(32*s+n)+(t-n)}const Oy=[e=>{let t=e.canonical.x-1,n=e.wrap;return t<0&&(t=(1<<e.canonical.z)-1,n--),new sn(e.overscaledZ,n,e.canonical.z,t,e.canonical.y)},e=>{let t=e.canonical.x+1,n=e.wrap;return t===1<<e.canonical.z&&(t=0,n++),new sn(e.overscaledZ,n,e.canonical.z,t,e.canonical.y)},e=>new sn(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(e.canonical.y===0?1<<e.canonical.z:e.canonical.y)-1),e=>new sn(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)];le(Xi,"CanonicalTileID"),le(sn,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});class td{constructor(t,n){this.pos=t,this.dir=n}intersectsPlane(t,n,r){const i=J.dot(n,this.dir);if(Math.abs(i)<1e-6)return!1;const o=((t[0]-this.pos[0])*n[0]+(t[1]-this.pos[1])*n[1]+(t[2]-this.pos[2])*n[2])/i;return r[0]=this.pos[0]+this.dir[0]*o,r[1]=this.pos[1]+this.dir[1]*o,r[2]=this.pos[2]+this.dir[2]*o,!0}closestPointOnSphere(t,n,r){if(J.equals(this.pos,t)||n===0)return r[0]=r[1]=r[2]=0,!1;const[i,o,s]=this.dir,a=this.pos[0]-t[0],c=this.pos[1]-t[1],h=this.pos[2]-t[2],d=i*i+o*o+s*s,m=2*(a*i+c*o+h*s),g=m*m-4*d*(a*a+c*c+h*h-n*n);if(g<0){const x=Math.max(-m/2,0),v=a+i*x,w=c+o*x,A=h+s*x,E=Math.hypot(v,w,A);return r[0]=v*n/E,r[1]=w*n/E,r[2]=A*n/E,!1}{const x=(-m-Math.sqrt(g))/(2*d);if(x<0){const v=Math.hypot(a,c,h);return r[0]=a*n/v,r[1]=c*n/v,r[2]=h*n/v,!1}return r[0]=a+i*x,r[1]=c+o*x,r[2]=h+s*x,!0}}}class $m{constructor(t,n,r,i,o){this.TL=t,this.TR=n,this.BR=r,this.BL=i,this.horizon=o}static fromInvProjectionMatrix(t,n,r){const i=[-1,1,1],o=[1,1,1],s=[1,-1,1],a=[-1,-1,1],c=J.transformMat4(i,i,t),h=J.transformMat4(o,o,t),d=J.transformMat4(s,s,t),m=J.transformMat4(a,a,t);return new $m(c,h,d,m,n/r)}}function _h(e,t,n){let r=1/0,i=-1/0;const o=[];for(const s of e){J.sub(o,s,t);const a=J.dot(o,n);r=Math.min(r,a),i=Math.max(i,a)}return[r,i]}function Km(e,t){let n=!0;for(let r=0;r<e.planes.length;r++){const i=e.planes[r];let o=0;for(let s=0;s<t.length;s++)o+=J.dot(i,t[s])+i[3]>=0;if(o===0)return 0;o!==t.length&&(n=!1)}return n?2:1}function Ls(e,t){for(const n of e.projections){const r=_h(t,e.points[0],n.axis);if(n.projection[1]<r[0]||n.projection[0]>r[1])return 0}return 1}function bn(e,t){let n=0;const r=[0,0,0,0];for(let i=0;i<e.length;i++)r[0]=e[i][0],r[1]=e[i][1],r[2]=e[i][2],r[3]=1,Bn.dot(r,t)>=0&&n++;return n}class Rs{constructor(t,n){this.points=t||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=yn.fromPoints(this.points),this.projections=[],this.frustumEdges=[J.sub([],this.points[2],this.points[3]),J.sub([],this.points[0],this.points[3]),J.sub([],this.points[4],this.points[0]),J.sub([],this.points[5],this.points[1]),J.sub([],this.points[6],this.points[2]),J.sub([],this.points[7],this.points[3])];for(const r of this.frustumEdges){const i=[0,-r[2],r[1]],o=[r[2],0,-r[0]];this.projections.push({axis:i,projection:_h(this.points,this.points[0],i)}),this.projections.push({axis:o,projection:_h(this.points,this.points[0],o)})}}static fromInvProjectionMatrix(t,n,r,i){const o=Math.pow(2,r),s=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(h=>{const d=Bn.transformMat4([],h,t),m=1/d[3]/n*o;return Bn.mul(d,d,[m,m,i?1/d[3]:m,m])}),a=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(h=>{const d=J.sub([],s[h[0]],s[h[1]]),m=J.sub([],s[h[2]],s[h[1]]),g=J.normalize([],J.cross([],d,m)),x=-J.dot(g,s[h[1]]);return g.concat(x)}),c=[];for(let h=0;h<s.length;h++)c.push([s[h][0],s[h][1],s[h][2]]);return new Rs(c,a)}intersectsPrecise(t,n,r){for(let i=0;i<n.length;i++)if(!bn(t,n[i]))return 0;for(let i=0;i<this.planes.length;i++)if(!bn(t,this.planes[i]))return 0;for(const i of r)for(const o of this.frustumEdges){const s=J.cross([],i,o),a=J.length(s);if(a===0)continue;J.scale(s,s,1/a);const c=_h(this.points,this.points[0],s),h=_h(t,this.points[0],s);if(c[0]>h[1]||h[0]>c[1])return 0}return 1}}class yn{static fromPoints(t){const n=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0];for(const i of t)J.min(n,n,i),J.max(r,r,i);return new yn(n,r)}static fromTileIdAndHeight(t,n,r){const i=1<<t.canonical.z,o=t.canonical.x,s=t.canonical.y;return new yn([o/i,s/i,n],[(o+1)/i,(s+1)/i,r])}static applyTransform(t,n){const r=t.getCorners();for(let i=0;i<r.length;++i)J.transformMat4(r[i],r[i],n);return yn.fromPoints(r)}static projectAabbCorners(t,n){const r=t.getCorners();for(let i=0;i<r.length;++i)J.transformMat4(r[i],r[i],n);return r}constructor(t,n){this.min=t,this.max=n,this.center=J.scale([],J.add([],this.min,this.max),.5)}quadrant(t){const n=[t%2==0,t<2],r=J.clone(this.min),i=J.clone(this.max);for(let o=0;o<n.length;o++)r[o]=n[o]?this.min[o]:this.center[o],i[o]=n[o]?this.center[o]:this.max[o];return i[2]=this.max[2],new yn(r,i)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,n=this.max;return[[t[0],t[1],t[2]],[n[0],t[1],t[2]],[n[0],n[1],t[2]],[t[0],n[1],t[2]],[t[0],t[1],n[2]],[n[0],t[1],n[2]],[n[0],n[1],n[2]],[t[0],n[1],n[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?Km(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?Km(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,n){return n||this.intersects(t)?Ls(t,this.getCorners()):0}intersectsPreciseFlat(t,n){return n||this.intersectsFlat(t)?Ls(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let n=0;n<3;++n)if(this.min[n]>t.max[n]||t.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],t.min[n]),this.max[n]=Math.max(this.max[n],t.max[n])}encapsulatePoint(t){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],t[n]),this.max[n]=Math.max(this.max[n],t[n])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}le(yn,"Aabb");const Wu=5,Za=6,dn=gt/Math.PI/2,Ow=16383,Hl=64,qu=[Hl,32,16],Vo=-dn,Go=dn,Nw=[new yn([Vo,Vo,Vo],[Go,Go,Go]),new yn([Vo,Vo,Vo],[0,0,Go]),new yn([0,Vo,Vo],[Go,0,Go]),new yn([Vo,0,Vo],[0,Go,Go]),new yn([0,0,Vo],[Go,Go,Go])];function ed(e){return e*dn/$u}function Ny(e,t,n,r=!0){const i=J.scale([],e._camera.position,e.worldSize),o=[t,n,1,1];Bn.transformMat4(o,o,e.pixelMatrixInverse),Bn.scale(o,o,1/o[3]);const s=J.sub([],o,i),a=J.normalize([],s),c=e.globeMatrix,h=[c[12],c[13],c[14]],d=J.sub([],h,i),m=J.length(d),g=J.normalize([],d),x=e.worldSize/(2*Math.PI),v=J.dot(g,a),w=Math.asin(x/m);if(w<Math.acos(v)){if(!r)return null;const j=[],H=[];J.scale(j,a,m/v),J.normalize(H,J.sub(H,j,d)),J.normalize(a,J.add(a,d,J.scale(a,H,Math.tan(w)*m)))}const A=[];new td(i,a).closestPointOnSphere(h,x,A);const E=J.normalize([],Qn(c,0)),S=J.normalize([],Qn(c,1)),I=J.normalize([],Qn(c,2)),B=J.dot(E,A),M=J.dot(S,A),D=J.dot(I,A),R=dr(Math.asin(-M/x));let z=dr(Math.atan2(B,D));z=e.center.lng+function(j,H){const $=(H-j+180)%360-180;return $<-180?$+360:$}(e.center.lng,z);const N=Ir(z),V=$t(Fr(R),0,1);return new an(N,V)}class Uw{constructor(t,n,r){this.a=J.sub([],t,r),this.b=J.sub([],n,r),this.center=r;const i=J.normalize([],this.a),o=J.normalize([],this.b);this.angle=Math.acos(J.dot(i,o))}}function Xm(e,t){if(e.angle===0)return null;let n;return n=e.a[t]===0?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),n<0||n>1?null:function(r,i,o,s){const a=Math.sin(o);return r*(Math.sin((1-s)*o)/a)+i*(Math.sin(s*o)/a)}(e.a[t],e.b[t],e.angle,$t(n,0,1))+e.center[t]}function To(e){if(e.z<=1)return Nw[e.z+2*e.y+e.x];const t=yh(nd(e));return yn.fromPoints(t)}function fa(e,t,n){return J.scale(e,e,1-n),J.scaleAndAdd(e,e,t,n)}function Uy(e,t){const n=$r(t.zoom);if(n===0)return To(e);const r=nd(e),i=yh(r),o=Ir(r.getWest())*t.worldSize,s=Ir(r.getEast())*t.worldSize,a=Fr(r.getNorth())*t.worldSize,c=Fr(r.getSouth())*t.worldSize,h=[o,a,0],d=[s,a,0],m=[o,c,0],g=[s,c,0],x=lt.invert([],t.globeMatrix);return J.transformMat4(h,h,x),J.transformMat4(d,d,x),J.transformMat4(m,m,x),J.transformMat4(g,g,x),i[0]=fa(i[0],m,n),i[1]=fa(i[1],g,n),i[2]=fa(i[2],d,n),i[3]=fa(i[3],h,n),yn.fromPoints(i)}function Vy(e,t,n){for(const r of e)J.transformMat4(r,r,t),J.scale(r,r,n)}function Ym(e,t,n,r){const i=t/e.worldSize,o=e.globeMatrix;if(n.z<=1){const N=To(n).getCorners();return Vy(N,o,i),yn.fromPoints(N)}const s=nd(n,r),a=yh(s);Vy(a,o,i);const c=Number.MAX_VALUE,h=[-c,-c,-c],d=[c,c,c];if(s.contains(e.center)){for(const j of a)J.min(d,d,j),J.max(h,h,j);h[2]=0;const N=e.point,V=[N.x*i,N.y*i,0];return J.min(d,d,V),J.max(h,h,V),new yn(d,h)}const m=[o[12]*i,o[13]*i,o[14]*i],g=s.getCenter(),x=$t(e.center.lat,-xr,xr),v=$t(g.lat,-xr,xr),w=Ir(e.center.lng),A=Fr(x);let E=w-Ir(g.lng);const S=A-Fr(v);E>.5?E-=1:E<-.5&&(E+=1);let I=0;if(Math.abs(E)>Math.abs(S))I=E>=0?1:3;else{I=S>=0?0:2;const N=[o[4]*i,o[5]*i,o[6]*i],V=-Math.sin(Ae(S>=0?s.getSouth():s.getNorth()))*dn;J.scaleAndAdd(m,m,N,V)}const B=a[I],M=a[(I+1)%4],D=new Uw(B,M,m),R=[Xm(D,0)||B[0],Xm(D,1)||B[1],Xm(D,2)||B[2]],z=$r(e.zoom);if(z>0){const N=function({x:j,y:H,z:$},G,Q,et,st){const Y=1/(1<<$);let tt=j*Y,ct=tt+Y,pt=H*Y,dt=pt+Y,wt=0;const bt=(tt+ct)/2-et;return bt>.5?wt=-1:bt<-.5&&(wt=1),tt=((tt+wt)*G-(et*=G))*Q+et,ct=((ct+wt)*G-et)*Q+et,pt=(pt*G-(st*=G))*Q+st,dt=(dt*G-st)*Q+st,[[tt,dt,0],[ct,dt,0],[ct,pt,0],[tt,pt,0]]}(n,t,e._pixelsPerMercatorPixel,w,A);for(let j=0;j<a.length;j++)fa(a[j],N[j],z);const V=J.add([],N[I],N[(I+1)%4]);J.scale(V,V,.5),fa(R,V,z)}for(const N of a)J.min(d,d,N),J.max(h,h,N);return d[2]=Math.min(B[2],M[2]),J.min(d,d,R),J.max(h,h,R),new yn(d,h)}function nd({x:e,y:t,z:n},r=!1){const i=1/(1<<n),o=new Be(uo(e*i),t===(1<<n)-1&&r?-90:Br((t+1)*i)),s=new Be(uo((e+1)*i),t===0&&r?90:Br(t*i));return new lo(o,s)}function yh(e){const t=Ae(e.getNorth()),n=Ae(e.getSouth()),r=Math.cos(t),i=Math.cos(n),o=Math.sin(t),s=Math.sin(n),a=e.getWest(),c=e.getEast();return[Ju(i,s,a),Ju(i,s,c),Ju(r,o,c),Ju(r,o,a)]}function Ju(e,t,n,r=dn){return n=Ae(n),[e*Math.sin(n)*r,-t*r,e*Math.cos(n)*r]}function Ei(e,t,n){return Ju(Math.cos(Ae(e)),Math.sin(Ae(e)),t,n)}function xh(e,t,n,r){const i=1<<n.z,o=(e/gt+n.x)/i;return Ei(Br((t/gt+n.y)/i),uo(o),r)}function rd({min:e,max:t}){return Ow/Math.max(t[0]-e[0],t[1]-e[1],t[2]-e[2])}const Gy=new Float64Array(16);function Ar(e){const t=rd(e),n=lt.fromScaling(Gy,[t,t,t]);return lt.translate(n,n,J.negate([],e.min))}function Ri(e){const t=lt.fromTranslation(Gy,e.min),n=1/rd(e);return lt.scale(t,t,[n,n,n])}function Qm(e){const t=gt/(2*Math.PI);return e/(2*Math.PI)/t}function jy(e,t){return gt/(512*Math.pow(2,e))*rd(To(t))}function Hy(e,t,n,r,i){const o=Qm(n),s=[e,t,-n/(2*Math.PI)],a=lt.identity(new Float64Array(16));return lt.translate(a,a,s),lt.scale(a,a,[o,o,o]),lt.rotateX(a,a,Ae(-i)),lt.rotateY(a,a,Ae(-r)),a}function tg(e){const t=e.pixelsPerMeter,n=t/Rn(1,e.center.lat),r=lt.identity(new Float64Array(16));return lt.translate(r,r,[e.point.x,e.point.y,0]),lt.scale(r,r,[n,n,t]),Float32Array.from(r)}function $r(e){return Ui(Wu,Za,e)}function Zy(e,t,n){const r=lt.identity(new Float64Array(16)),i=(t/(1<<e)-.5)*Math.PI*2;return lt.rotateY(r,n.globeMatrix,i),Float32Array.from(r)}function Wy(e,t,n){const r=$r(n.zoom),i=e.style.map._antialias,o=t.options.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return r===0&&!i&&!o}function eg(e,t,n,r){const i=t.getNorth(),o=t.getSouth(),s=t.getWest(),a=t.getEast(),c=1<<e.z,h=a-s,d=i-o,m=h/Hl,g=-d/qu[n],x=[0,m,0,g,0,0,i,s,0];if(e.z>0){const v=180/r;Ki.multiply(x,x,[v/h+1,0,0,0,v/d+1,0,-.5*v/m,.5*v/g,1])}return x[2]=c,x[5]=e.x,x[8]=e.y,x}function Vw(e){const t=xr-5;e=$t(e,-t,t)/t*90;const n=Math.pow(Math.abs(Math.sin(Ae(e))),3);return Math.round(n*(qu.length-1))}function qy(e){const t=[0,0,0],n=lt.identity(new Float64Array(16));return lt.multiply(n,e.pixelMatrix,e.globeMatrix),J.transformMat4(t,t,n),new nt(t[0],t[1])}function Jy(e,t){const n=Ei(t.lat,t.lng),r=function(o){const s=Ei(o._center.lat,o._center.lng),a=J.fromValues(0,1,0);let c=J.cross([],a,s);const h=lt.fromRotation([],-o.angle,s);c=J.transformMat4(c,c,h),lt.fromRotation(h,-o._pitch,c);const d=J.normalize([],s);return J.scale(d,d,ed(o.cameraToCenterDistance/o.pixelsPerMeter)),J.transformMat4(d,d,h),J.add([],s,d)}(e),i=J.subtract([],r,n);return J.angle(i,n)}function vh(e,t){return Jy(e,t)>Math.PI/2*1.01}const ng=Ae(85),Gw=Math.cos(ng),jw=Math.sin(ng);class Hw{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,n){const r=new bi,i=new ur,o=[],s=t+1+2,a=n[0]+1,c=n[0]+1+(1+n.length),h=(d,m,g)=>{let x=d===s-1?d-2:d===0?d:d-1;return x+=g?24575:0,[x,m]};for(let d=0;d<s;++d)r.emplaceBack(...h(d,0,!0));for(let d=0;d<a;++d)for(let m=0;m<s;++m)r.emplaceBack(...h(m,d,(m===0||m===s-1)&&!0));for(let d=0;d<n.length;++d){const m=n[d];for(let g=0;g<s;++g)r.emplaceBack(...h(g,m,!0))}for(let d=0;d<n.length;++d){const m=i.length,g=n[d]+1+2,x=new ur;for(let A=0;A<g-1;A++){const E=A===g-2,S=E?s*(c-n.length+d-A):s;for(let I=0;I<s-1;I++){const B=A*s+I;A===0||E||I===0||I===s-2?(x.emplaceBack(B+1,B,B+S),x.emplaceBack(B+S,B+S+1,B+1)):(i.emplaceBack(B+1,B,B+S),i.emplaceBack(B+S,B+S+1,B+1))}}const v=Cn.simpleSegment(0,m,r.length,i.length-m);for(let A=0;A<x.uint16.length;A+=3)i.emplaceBack(x.uint16[A],x.uint16[A+1],x.uint16[A+2]);const w=Cn.simpleSegment(0,m,r.length,i.length-m);o.push({withoutSkirts:v,withSkirts:w})}return{vertices:r,indices:i,segments:o}}_createGrid(t){const n=this._fillGridMeshWithLods(Hl,qu);this._gridSegments=n.segments,this._gridBuffer=t.createVertexBuffer(n.vertices,Ps.members),this._gridIndexBuffer=t.createIndexBuffer(n.indices,!0)}_createPoles(t){const n=new ur;for(let a=0;a<=Hl;a++)n.emplaceBack(0,a+1,a+2);this._poleIndexBuffer=t.createIndexBuffer(n,!0);const r=new vo,i=new vo,o=new vo,s=new vo;this._poleSegments=[];for(let a=0,c=0;a<Wu;a++){const h=360/(1<<a);r.emplaceBack(0,-dn,0,.5,0),i.emplaceBack(0,-dn,0,.5,1),o.emplaceBack(0,-dn,0,.5,.5),s.emplaceBack(0,-dn,0,.5,.5);for(let d=0;d<=Hl;d++){let m=d/Hl,g=0;const x=Ce(0,h,m),[v,w,A]=Ju(Gw,jw,x,dn);r.emplaceBack(v,w,A,m,g),i.emplaceBack(v,w,A,m,1-g);const E=Ae(x);m=.5+.5*Math.sin(E),g=.5+.5*Math.cos(E),o.emplaceBack(v,w,A,m,g),s.emplaceBack(v,w,A,m,1-g)}this._poleSegments.push(Cn.simpleSegment(c,0,66,64)),c+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(r,mh,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(i,mh,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(o,mh,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(s,mh,!1)}getGridBuffers(t,n){return[this._gridBuffer,this._gridIndexBuffer,n?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,n){return[n?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,n?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}}const $u=63710088e-1,Wa=2*Math.PI*$u;class qa{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new qa(ci(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,r=this.lat*n,i=t.lat*n,o=Math.sin(r)*Math.sin(i)+Math.cos(r)*Math.cos(i)*Math.cos((t.lng-this.lng)*n);return $u*Math.acos(Math.min(o,1))}toBounds(t=0){const n=360*t/40075017,r=n/Math.cos(Math.PI/180*this.lat);return new lo(new qa(this.lng-r,this.lat-n),new qa(this.lng+r,this.lat+n))}toEcef(t){const n=ed(t);return Ei(this.lat,this.lng,dn+n)}static convert(t){if(t instanceof qa)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new qa(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new qa(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Be=qa;const Zw=0,Ww=25.5;function id(e){return Wa*Math.cos(e*Math.PI/180)}function Ir(e){return(180+e)/360}function Fr(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Rn(e,t){return e/id(t)}function uo(e){return 360*e-180}function Br(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function $y(e,t){return e*id(Br(t))}const xr=85.051129;function Ky(e){return Math.cos(Ae($t(e,-xr,xr)))}function Ja(e,t){const n=$t(t,Zw,Ww),r=Math.pow(2,n);return Ky(e)*Wa/(512*r)}function rg(e){return 1/Math.cos(e*Math.PI/180)}function wh(e,t=0){const n=Math.exp(Math.PI*(1-(e.y+t/gt)/(1<<e.z)*2));return 80150034*n/(n*n+1)/gt/(1<<e.z)}class an{constructor(t,n,r=0){this.x=+t,this.y=+n,this.z=+r}static fromLngLat(t,n=0){const r=Be.convert(t);return new an(Ir(r.lng),Fr(r.lat),Rn(n,r.lat))}toLngLat(){return new Be(uo(this.x),Br(this.y))}toAltitude(){return $y(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Wa*rg(Br(this.y))}}function ig(e,t,n,r,i,o,s,a,c){const h=(t+r)/2,d=(n+i)/2,m=new nt(h,d);a(m),function(g,x,v,w,A,E){const S=v-A,I=w-E;return Math.abs((w-x)*S-(v-g)*I)/Math.hypot(S,I)}(m.x,m.y,o.x,o.y,s.x,s.y)>=c?(ig(e,t,n,h,d,o,m,a,c),ig(e,h,d,r,i,m,s,a,c)):e.push(s)}function Xy(e,t,n){let r=e[0],i=r.x,o=r.y;t(r);const s=[r];for(let a=1;a<e.length;a++){const c=e[a],{x:h,y:d}=c;t(c),ig(s,i,o,h,d,r,c,t,n),i=h,o=d,r=c}return s}function og(e,t,n,r){if(r(t,n)){const i=t.add(n)._mult(.5);og(e,t,i,r),og(e,i,n,r)}else e.push(n)}function qw(e,t){let n=e[0];const r=[n];for(let i=1;i<e.length;i++){const o=e[i];og(r,n,o,t),n=o}return r}const sg=Math.pow(2,14)-1,Yy=-sg-1;function Jw(e,t){const n=Math.round(e.x*t),r=Math.round(e.y*t);return e.x=$t(n,Yy,sg),e.y=$t(r,Yy,sg),(n<e.x||n>e.x+1||r<e.y||r>e.y+1)&&rt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function ks(e,t,n){const r=e.loadGeometry(),i=e.extent,o=gt/i;if(t&&n&&n.projection.isReprojectedInTileSpace){const s=1<<t.z,{scale:a,x:c,y:h,projection:d}=n,m=g=>{const x=uo((t.x+g.x/i)/s),v=Br((t.y+g.y/i)/s),w=d.project(x,v);g.x=(w.x*a-c)*i,g.y=(w.y*a-h)*i};for(let g=0;g<r.length;g++)if(e.type!==1)r[g]=Xy(r[g],m,1);else{const x=[];for(const v of r[g])v.x<0||v.x>=i||v.y<0||v.y>=i||(m(v),x.push(v));r[g]=x}}for(const s of r)for(const a of s)Jw(a,o);return r}function $a(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?ks(e):[]}}function od(e,t,n,r,i){e.emplaceBack(2*t+(r+1)/2,2*n+(i+1)/2)}function sd(e,t,n){e.emplaceBack(t.x,t.y,t.z,n[0]*16384,n[1]*16384,n[2]*16384)}class ag{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new bi,this.indexArray=new ur,this.segments=new Cn,this.programConfigurations=new Ga(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,r,i){const o=this.layers[0],s=[];let a=null;o.type==="circle"&&(a=o.layout.get("circle-sort-key"));for(const{feature:h,id:d,index:m,sourceLayerIndex:g}of t){const x=this.layers[0]._featureFilter.needGeometry,v=$a(h,x);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom),v,r))continue;const w=a?a.evaluate(v,{},r):void 0,A={id:d,properties:h.properties,type:h.type,sourceLayerIndex:g,index:m,geometry:x?v.geometry:ks(h,r,i),patterns:{},sortKey:w};s.push(A)}a&&s.sort((h,d)=>h.sortKey-d.sortKey);let c=null;i.projection.name==="globe"&&(this.globeExtVertexArray=new Of,c=i.projection);for(const h of s){const{geometry:d,index:m,sourceLayerIndex:g}=h,x=t[m].feature;this.addFeature(h,d,m,n.availableImages,r,c,n.brightness),n.featureIndex.insert(x,d,m,g,this.index)}}update(t,n,r,i,o){const s=Object.keys(t).length!==0;s&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,n,s?this.stateDependentLayers:this.layers,r,i,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,hh.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,P0.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,n,r,i,o,s,a){for(const c of n)for(const h of c){const d=h.x,m=h.y;if(d<0||d>=gt||m<0||m>=gt)continue;if(s){const v=s.projectTilePoint(d,m,o),w=s.upVector(o,d,m),A=this.globeExtVertexArray;sd(A,v,w),sd(A,v,w),sd(A,v,w),sd(A,v,w)}const g=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),x=g.vertexLength;od(this.layoutVertexArray,d,m,-1,-1),od(this.layoutVertexArray,d,m,1,-1),od(this.layoutVertexArray,d,m,1,1),od(this.layoutVertexArray,d,m,-1,1),this.indexArray.emplaceBack(x,x+1,x+2),this.indexArray.emplaceBack(x,x+2,x+3),g.vertexLength+=4,g.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,{},i,o,a)}}function Qy(e,t){for(let n=0;n<e.length;n++)if(Fs(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(Fs(e,t[n]))return!0;return!!ad(e,t)}function $w(e,t,n){return!!Fs(e,t)||!!ug(t,e,n)}function t1(e,t){if(e.length===1)return r1(t,e[0]);for(let n=0;n<t.length;n++){const r=t[n];for(let i=0;i<r.length;i++)if(Fs(e,r[i]))return!0}for(let n=0;n<e.length;n++)if(r1(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(ad(e,t[n]))return!0;return!1}function lg(e,t,n){if(e.length>1){if(ad(e,t))return!0;for(let r=0;r<t.length;r++)if(ug(t[r],e,n))return!0}for(let r=0;r<e.length;r++)if(ug(e[r],t,n))return!0;return!1}function ad(e,t){if(e.length===0||t.length===0)return!1;for(let n=0;n<e.length-1;n++){const r=e[n],i=e[n+1];for(let o=0;o<t.length-1;o++)if(e1(r,i,t[o],t[o+1]))return!0}return!1}function e1(e,t,n,r){return St(e,n,r)!==St(t,n,r)&&St(e,t,n)!==St(e,t,r)}function ug(e,t,n){const r=n*n;if(t.length===1)return e.distSqr(t[0])<r;for(let i=1;i<t.length;i++)if(n1(e,t[i-1],t[i])<r)return!0;return!1}function n1(e,t,n){const r=t.distSqr(n);if(r===0)return e.distSqr(t);const i=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/r;return e.distSqr(i<0?t:i>1?n:n.sub(t)._mult(i)._add(t))}function r1(e,t){let n,r,i,o=!1;for(let s=0;s<e.length;s++){n=e[s];for(let a=0,c=n.length-1;a<n.length;c=a++)r=n[a],i=n[c],r.y>t.y!=i.y>t.y&&t.x<(i.x-r.x)*(t.y-r.y)/(i.y-r.y)+r.x&&(o=!o)}return o}function Fs(e,t){let n=!1;for(let r=0,i=e.length-1;r<e.length;i=r++){const o=e[r],s=e[i];o.y>t.y!=s.y>t.y&&t.x<(s.x-o.x)*(t.y-o.y)/(s.y-o.y)+o.x&&(n=!n)}return n}function i1(e,t,n,r,i){for(const s of e)if(t<=s.x&&n<=s.y&&r>=s.x&&i>=s.y)return!0;const o=[new nt(t,n),new nt(t,i),new nt(r,i),new nt(r,n)];if(e.length>2){for(const s of o)if(Fs(e,s))return!0}for(let s=0;s<e.length-1;s++)if(Kw(e[s],e[s+1],o))return!0;return!1}function Kw(e,t,n){const r=n[0],i=n[2];if(e.x<r.x&&t.x<r.x||e.x>i.x&&t.x>i.x||e.y<r.y&&t.y<r.y||e.y>i.y&&t.y>i.y)return!1;const o=St(e,t,n[0]);return o!==St(e,t,n[1])||o!==St(e,t,n[2])||o!==St(e,t,n[3])}function Ku(e,t,n,r,i,o){let s=t.y-e.y,a=e.x-t.x;if(o=o||0){const c=s*s+a*a;if(c===0)return!0;const h=Math.sqrt(c);s/=h,a/=h}return!((n.x-e.x)*s+(n.y-e.y)*a-o<0||(r.x-e.x)*s+(r.y-e.y)*a-o<0||(i.x-e.x)*s+(i.y-e.y)*a-o<0)}function ki(e,t,n,r,i,o,s){return!(Ku(e,t,r,i,o,s)||Ku(t,n,r,i,o,s)||Ku(n,e,r,i,o,s)||Ku(r,i,e,t,n,s)||Ku(i,o,e,t,n,s)||Ku(o,r,e,t,n,s))}function Ka(e,t,n){const r=t.paint.get(e).value;return r.kind==="constant"?r.value:n.programConfigurations.get(t.id).getMaxValue(e)}function ld(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function o1(e,t,n,r,i){if(!t[0]&&!t[1])return e;const o=nt.convert(t)._mult(i);n==="viewport"&&o._rotate(-r);const s=[];for(let a=0;a<e.length;a++)s.push(e[a].sub(o));return s}function s1(e,t,n,r){const i=nt.convert(e)._mult(r);return t==="viewport"&&i._rotate(-n),i}le(ag,"CircleBucket",{omit:["layers"]});const Xw=new lr({"circle-sort-key":new ge(ut.layout_circle["circle-sort-key"]),visibility:new Rt(ut.layout_circle.visibility)});var cg={paint:new lr({"circle-radius":new ge(ut.paint_circle["circle-radius"]),"circle-color":new ge(ut.paint_circle["circle-color"]),"circle-blur":new ge(ut.paint_circle["circle-blur"]),"circle-opacity":new ge(ut.paint_circle["circle-opacity"]),"circle-translate":new Rt(ut.paint_circle["circle-translate"]),"circle-translate-anchor":new Rt(ut.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Rt(ut.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Rt(ut.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ge(ut.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ge(ut.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ge(ut.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Rt(ut.paint_circle["circle-emissive-strength"])}),layout:Xw};const Yw=lt.create(),hg=(e,t,n,r,i,o)=>{const s=e.transform,a=s.projection.name==="globe";let c;if(o.paint.get("circle-pitch-alignment")==="map")if(a){const d=jy(s.zoom,t.canonical)*s._pixelsPerMercatorPixel;c=Float32Array.from([d,0,0,d])}else c=s.calculatePixelsToTileUnitsMatrix(n);else c=new Float32Array([s.pixelsToGLUnits[0],0,0,s.pixelsToGLUnits[1]]);const h={u_camera_to_center_distance:e.transform.getCameraToCenterDistance(s.projection),u_matrix:e.translatePosMatrix(t.projMatrix,n,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ze.devicePixelRatio,u_extrude_scale:c,u_inv_rot_matrix:Yw,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:o.paint.get("circle-emissive-strength")};if(a){h.u_inv_rot_matrix=r,h.u_merc_center=i,h.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],h.u_zoom_transition=$r(s.zoom);const d=i[0]*gt,m=i[1]*gt;h.u_up_dir=s.projection.upVector(new Xi(0,0,0),d,m)}return h},a1=e=>{const t=[];return e.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),e.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t};function l1(e,t,n,r,i,o,s,a,c){if(o&&e.queryGeometry.isAboveHorizon)return!1;o&&(c*=e.pixelToTileUnitsFactor);const h=e.tileID.canonical,d=n.projection.upVectorScale(h,n.center.lat,n.worldSize).metersToTile;for(const m of t)for(const g of m){const x=g.add(a),v=i&&n.elevation?n.elevation.exaggeration()*i.getElevationAt(x.x,x.y,!0):0,w=n.projection.projectTilePoint(x.x,x.y,h);if(v>0){const I=n.projection.upVector(h,x.x,x.y);w.x+=I[0]*d*v,w.y+=I[1]*d*v,w.z+=I[2]*d*v}const A=o?x:Qw(w.x,w.y,w.z,r),E=o?e.tilespaceRays.map(I=>tb(I,v)):e.queryGeometry.screenGeometry,S=Bn.transformMat4([],[w.x,w.y,w.z,1],r);if(!s&&o?c*=S[3]/n.cameraToCenterDistance:s&&!o&&(c*=n.cameraToCenterDistance/S[3]),o){const I=Br((g.y/gt+h.y)/(1<<h.z));c/=n.projection.pixelsPerMeter(I,1)/Rn(1,I)}if($w(E,A,c))return!0}return!1}function Qw(e,t,n,r){const i=Bn.transformMat4([],[e,t,n,1],r);return new nt(i[0]/i[3],i[1]/i[3])}const u1=J.fromValues(0,0,0),c1=J.fromValues(0,0,1);function tb(e,t){const n=J.create();return u1[2]=t,e.intersectsPlane(u1,c1,n),new nt(n[0],n[1])}class h1 extends ag{}function f1(e,{width:t,height:n},r,i){if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==t*n*r)throw new RangeError("mismatched image size")}else i=new Uint8Array(t*n*r);return e.width=t,e.height=n,e.data=i,e}function ud(e,t,n){const{width:r,height:i}=t;r===e.width&&i===e.height||(bh(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,r),height:Math.min(e.height,i)},n),e.width=r,e.height=i,e.data=t.data)}function bh(e,t,n,r,i,o){if(i.width===0||i.height===0)return t;if(i.width>e.width||i.height>e.height||n.x>e.width-i.width||n.y>e.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>t.width||i.height>t.height||r.x>t.width-i.width||r.y>t.height-i.height)throw new RangeError("out of range destination coordinates for image copy");const s=e.data,a=t.data;for(let c=0;c<i.height;c++){const h=((n.y+c)*e.width+n.x)*o,d=((r.y+c)*t.width+r.x)*o;for(let m=0;m<i.width*o;m++)a[d+m]=s[h+m]}return t}le(h1,"HeatmapBucket",{omit:["layers"]});class da{constructor(t,n){f1(this,t,1,n)}resize(t){ud(this,new da(t),1)}clone(){return new da({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,r,i,o){bh(t,n,r,i,o,1)}}class Er{constructor(t,n){f1(this,t,4,n)}resize(t){ud(this,new Er(t),4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Er({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,r,i,o){bh(t,n,r,i,o,4)}}class d1{constructor(t,n){this.width=t.width,this.height=t.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}le(da,"AlphaImage"),le(Er,"RGBAImage");const eb=new lr({visibility:new Rt(ut.layout_heatmap.visibility)});var nb={paint:new lr({"heatmap-radius":new ge(ut.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ge(ut.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Rt(ut.paint_heatmap["heatmap-intensity"]),"heatmap-color":new nh(ut.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Rt(ut.paint_heatmap["heatmap-opacity"])}),layout:eb};function cd(e){const t={},n=e.resolution||256,r=e.clips?e.clips.length:1,i=e.image||new Er({width:n,height:r}),o=(s,a,c)=>{t[e.evaluationKey]=c;const h=e.expression.evaluate(t);h&&(i.data[s+a+0]=Math.floor(255*h.r/h.a),i.data[s+a+1]=Math.floor(255*h.g/h.a),i.data[s+a+2]=Math.floor(255*h.b/h.a),i.data[s+a+3]=Math.floor(255*h.a))};if(e.clips)for(let s=0,a=0;s<r;++s,a+=4*n)for(let c=0,h=0;c<n;c++,h+=4){const d=c/(n-1),{start:m,end:g}=e.clips[s];o(a,h,m*(1-d)+g*d)}else for(let s=0,a=0;s<n;s++,a+=4)o(0,a,s/(n-1));return i}const rb=new lr({visibility:new Rt(ut.layout_hillshade.visibility)});var ib={paint:new lr({"hillshade-illumination-direction":new Rt(ut.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Rt(ut.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Rt(ut.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Rt(ut.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Rt(ut.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Rt(ut.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Rt(ut.paint_hillshade["hillshade-emissive-strength"])}),layout:rb};const ob=wn([{name:"a_pos",components:2,type:"Int16"}],4),{members:sb}=ob;var fg={exports:{}};function hd(e,t,n){n=n||2;var r,i,o,s,a,c,h,d=t&&t.length,m=d?t[0]*n:e.length,g=p1(e,0,m,n,!0),x=[];if(!g||g.next===g.prev)return x;if(d&&(g=function(w,A,E,S){var I,B,M,D=[];for(I=0,B=A.length;I<B;I++)(M=p1(w,A[I]*S,I<B-1?A[I+1]*S:w.length,S,!1))===M.next&&(M.steiner=!0),D.push(T(M));for(D.sort(hb),I=0;I<D.length;I++)E=fb(D[I],E);return E}(e,t,g,n)),e.length>80*n){r=o=e[0],i=s=e[1];for(var v=n;v<m;v+=n)(a=e[v])<r&&(r=a),(c=e[v+1])<i&&(i=c),a>o&&(o=a),c>s&&(s=c);h=(h=Math.max(o-r,s-i))!==0?32767/h:0}return Ah(g,x,n,r,i,h,0),x}function p1(e,t,n,r,i){var o,s;if(i===An(e,t,n,r)>0)for(o=t;o<n;o+=r)s=ye(o,e[o],e[o+1],s);else for(o=n-r;o>=t;o-=r)s=ye(o,e[o],e[o+1],s);return s&&it(s,s.next)&&(ke(s),s=s.next),s}function Zl(e,t){if(!e)return e;t||(t=e);var n,r=e;do if(n=!1,r.steiner||!it(r,r.next)&&W(r.prev,r,r.next)!==0)r=r.next;else{if(ke(r),(r=t=r.prev)===r.next)break;n=!0}while(n||r!==t);return t}function Ah(e,t,n,r,i,o,s){if(e){!s&&o&&function(d,m,g,x){var v=d;do v.z===0&&(v.z=_(v.x,v.y,m,g,x)),v.prevZ=v.prev,v.nextZ=v.next,v=v.next;while(v!==d);v.prevZ.nextZ=null,v.prevZ=null,function(w){var A,E,S,I,B,M,D,R,z=1;do{for(E=w,w=null,B=null,M=0;E;){for(M++,S=E,D=0,A=0;A<z&&(D++,S=S.nextZ);A++);for(R=z;D>0||R>0&&S;)D!==0&&(R===0||!S||E.z<=S.z)?(I=E,E=E.nextZ,D--):(I=S,S=S.nextZ,R--),B?B.nextZ=I:w=I,I.prevZ=B,B=I;E=S}B.nextZ=null,z*=2}while(M>1)}(v)}(e,r,i,o);for(var a,c,h=e;e.prev!==e.next;)if(a=e.prev,c=e.next,o?lb(e,r,i,o):ab(e))t.push(a.i/n|0),t.push(e.i/n|0),t.push(c.i/n|0),ke(e),e=c.next,h=c.next;else if((e=c)===h){s?s===1?Ah(e=ub(Zl(e),t,n),t,n,r,i,o,2):s===2&&cb(e,t,n,r,i,o):Ah(Zl(e),t,n,r,i,o,1);break}}}function ab(e){var t=e.prev,n=e,r=e.next;if(W(t,n,r)>=0)return!1;for(var i=t.x,o=n.x,s=r.x,a=t.y,c=n.y,h=r.y,d=i<o?i<s?i:s:o<s?o:s,m=a<c?a<h?a:h:c<h?c:h,g=i>o?i>s?i:s:o>s?o:s,x=a>c?a>h?a:h:c>h?c:h,v=r.next;v!==t;){if(v.x>=d&&v.x<=g&&v.y>=m&&v.y<=x&&L(i,a,o,c,s,h,v.x,v.y)&&W(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function lb(e,t,n,r){var i=e.prev,o=e,s=e.next;if(W(i,o,s)>=0)return!1;for(var a=i.x,c=o.x,h=s.x,d=i.y,m=o.y,g=s.y,x=a<c?a<h?a:h:c<h?c:h,v=d<m?d<g?d:g:m<g?m:g,w=a>c?a>h?a:h:c>h?c:h,A=d>m?d>g?d:g:m>g?m:g,E=_(x,v,t,n,r),S=_(w,A,t,n,r),I=e.prevZ,B=e.nextZ;I&&I.z>=E&&B&&B.z<=S;){if(I.x>=x&&I.x<=w&&I.y>=v&&I.y<=A&&I!==i&&I!==s&&L(a,d,c,m,h,g,I.x,I.y)&&W(I.prev,I,I.next)>=0||(I=I.prevZ,B.x>=x&&B.x<=w&&B.y>=v&&B.y<=A&&B!==i&&B!==s&&L(a,d,c,m,h,g,B.x,B.y)&&W(B.prev,B,B.next)>=0))return!1;B=B.nextZ}for(;I&&I.z>=E;){if(I.x>=x&&I.x<=w&&I.y>=v&&I.y<=A&&I!==i&&I!==s&&L(a,d,c,m,h,g,I.x,I.y)&&W(I.prev,I,I.next)>=0)return!1;I=I.prevZ}for(;B&&B.z<=S;){if(B.x>=x&&B.x<=w&&B.y>=v&&B.y<=A&&B!==i&&B!==s&&L(a,d,c,m,h,g,B.x,B.y)&&W(B.prev,B,B.next)>=0)return!1;B=B.nextZ}return!0}function ub(e,t,n){var r=e;do{var i=r.prev,o=r.next.next;!it(i,o)&&ht(i,r,r.next,o)&&Gt(i,o)&&Gt(o,i)&&(t.push(i.i/n|0),t.push(r.i/n|0),t.push(o.i/n|0),ke(r),ke(r.next),r=e=o),r=r.next}while(r!==e);return Zl(r)}function cb(e,t,n,r,i,o){var s=e;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&U(s,a)){var c=Yt(s,a);return s=Zl(s,s.next),c=Zl(c,c.next),Ah(s,t,n,r,i,o,0),void Ah(c,t,n,r,i,o,0)}a=a.next}s=s.next}while(s!==e)}function hb(e,t){return e.x-t.x}function fb(e,t){var n=function(i,o){var s,a=o,c=i.x,h=i.y,d=-1/0;do{if(h<=a.y&&h>=a.next.y&&a.next.y!==a.y){var m=a.x+(h-a.y)*(a.next.x-a.x)/(a.next.y-a.y);if(m<=c&&m>d&&(d=m,s=a.x<a.next.x?a:a.next,m===c))return s}a=a.next}while(a!==o);if(!s)return null;var g,x=s,v=s.x,w=s.y,A=1/0;a=s;do c>=a.x&&a.x>=v&&c!==a.x&&L(h<w?c:d,h,v,w,h<w?d:c,h,a.x,a.y)&&(g=Math.abs(h-a.y)/(c-a.x),Gt(a,i)&&(g<A||g===A&&(a.x>s.x||a.x===s.x&&p(s,a)))&&(s=a,A=g)),a=a.next;while(a!==x);return s}(e,t);if(!n)return t;var r=Yt(n,e);return Zl(r,r.next),Zl(n,n.next)}function p(e,t){return W(e.prev,e,t.prev)<0&&W(t.next,e,e.next)<0}function _(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function T(e){var t=e,n=e;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==e);return n}function L(e,t,n,r,i,o,s,a){return(i-s)*(t-a)>=(e-s)*(o-a)&&(e-s)*(r-a)>=(n-s)*(t-a)&&(n-s)*(o-a)>=(i-s)*(r-a)}function U(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(n,r){var i=n;do{if(i.i!==n.i&&i.next.i!==n.i&&i.i!==r.i&&i.next.i!==r.i&&ht(i,i.next,n,r))return!0;i=i.next}while(i!==n);return!1}(e,t)&&(Gt(e,t)&&Gt(t,e)&&function(n,r){var i=n,o=!1,s=(n.x+r.x)/2,a=(n.y+r.y)/2;do i.y>a!=i.next.y>a&&i.next.y!==i.y&&s<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(o=!o),i=i.next;while(i!==n);return o}(e,t)&&(W(e.prev,e,t.prev)||W(e,t.prev,t))||it(e,t)&&W(e.prev,e,e.next)>0&&W(t.prev,t,t.next)>0)}function W(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function it(e,t){return e.x===t.x&&e.y===t.y}function ht(e,t,n,r){var i=Vt(W(e,t,n)),o=Vt(W(e,t,r)),s=Vt(W(n,r,e)),a=Vt(W(n,r,t));return i!==o&&s!==a||!(i!==0||!vt(e,n,t))||!(o!==0||!vt(e,r,t))||!(s!==0||!vt(n,e,r))||!(a!==0||!vt(n,t,r))}function vt(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Vt(e){return e>0?1:e<0?-1:0}function Gt(e,t){return W(e.prev,e,e.next)<0?W(e,t,e.next)>=0&&W(e,e.prev,t)>=0:W(e,t,e.prev)<0||W(e,e.next,t)<0}function Yt(e,t){var n=new nn(e.i,e.x,e.y),r=new nn(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function ye(e,t,n,r){var i=new nn(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function ke(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function nn(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function An(e,t,n,r){for(var i=0,o=t,s=n-r;o<n;o+=r)i+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return i}fg.exports=hd,fg.exports.default=hd,hd.deviation=function(e,t,n,r){var i=t&&t.length,o=Math.abs(An(e,0,i?t[0]*n:e.length,n));if(i)for(var s=0,a=t.length;s<a;s++)o-=Math.abs(An(e,t[s]*n,s<a-1?t[s+1]*n:e.length,n));var c=0;for(s=0;s<r.length;s+=3){var h=r[s]*n,d=r[s+1]*n,m=r[s+2]*n;c+=Math.abs((e[h]-e[m])*(e[d+1]-e[h+1])-(e[h]-e[d])*(e[m+1]-e[h+1]))}return o===0&&c===0?0:Math.abs((c-o)/o)},hd.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var s=0;s<t;s++)n.vertices.push(e[i][o][s]);i>0&&n.holes.push(r+=e[i-1].length)}return n};var Ye=It(fg.exports);function Dn(e,t){const n=e.length;if(n<=1)return[e];const r=[];let i,o;for(let s=0;s<n;s++){const a=Dt(e[s]);a!==0&&(e[s].area=Math.abs(a),o===void 0&&(o=a<0),o===a<0?(i&&r.push(i),i=[e[s]]):i.push(e[s]))}if(i&&r.push(i),t>1)for(let s=0;s<r.length;s++)r[s].length<=t||(go(r[s],t,1,r[s].length-1,jn),r[s]=r[s].slice(0,t));return r}function jn(e,t){return t.area-e.area}function Qi(e,t,n){const r=n.patternDependencies;let i=!1;for(const o of t){const s=o.paint.get(`${e}-pattern`);s.isConstant()||(i=!0);const a=s.constantOr(null);a&&(i=!0,r[a]=!0)}return i}function Ti(e,t,n,r,i){const o=i.patternDependencies;for(const s of t){const a=s.paint.get(`${e}-pattern`).value;if(a.kind!=="constant"){let c=a.evaluate({zoom:r},n,{},i.availableImages);c=c&&c.name?c.name:c,o[c]=!0,n.patterns[s.id]=c}}return n}class Fi{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new bi,this.indexArray=new ur,this.indexArray2=new Pi,this.programConfigurations=new Ga(t.layers,t.zoom),this.segments=new Cn,this.segments2=new Cn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=t.projection}populate(t,n,r,i){this.hasPattern=Qi("fill",this.layers,n);const o=this.layers[0].layout.get("fill-sort-key"),s=[];for(const{feature:a,id:c,index:h,sourceLayerIndex:d}of t){const m=this.layers[0]._featureFilter.needGeometry,g=$a(a,m);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom),g,r))continue;const x=o?o.evaluate(g,{},r,n.availableImages):void 0,v={id:c,properties:a.properties,type:a.type,sourceLayerIndex:d,index:h,geometry:m?g.geometry:ks(a,r,i),patterns:{},sortKey:x};s.push(v)}o&&s.sort((a,c)=>a.sortKey-c.sortKey);for(const a of s){const{geometry:c,index:h,sourceLayerIndex:d}=a;if(this.hasPattern){const m=Ti("fill",this.layers,a,this.zoom,n);this.patternFeatures.push(m)}else this.addFeature(a,c,h,r,{},n.availableImages,n.brightness);n.featureIndex.insert(t[h].feature,c,h,d,this.index)}}update(t,n,r,i,o){const s=Object.keys(t).length!==0;s&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,n,s?this.stateDependentLayers:this.layers,r,i,o)}addFeatures(t,n,r,i,o,s){for(const a of this.patternFeatures)this.addFeature(a,a.geometry,a.index,n,r,i,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,sb),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,r,i,o,s=[],a){for(const c of Dn(n,500)){let h=0;for(const w of c)h+=w.length;const d=this.segments.prepareSegment(h,this.layoutVertexArray,this.indexArray),m=d.vertexLength,g=[],x=[];for(const w of c){if(w.length===0)continue;w!==c[0]&&x.push(g.length/2);const A=this.segments2.prepareSegment(w.length,this.layoutVertexArray,this.indexArray2),E=A.vertexLength;this.layoutVertexArray.emplaceBack(w[0].x,w[0].y),this.indexArray2.emplaceBack(E+w.length-1,E),g.push(w[0].x),g.push(w[0].y);for(let S=1;S<w.length;S++)this.layoutVertexArray.emplaceBack(w[S].x,w[S].y),this.indexArray2.emplaceBack(E+S-1,E+S),g.push(w[S].x),g.push(w[S].y);A.vertexLength+=w.length,A.primitiveLength+=w.length}const v=Ye(g,x);for(let w=0;w<v.length;w+=3)this.indexArray.emplaceBack(m+v[w],m+v[w+1],m+v[w+2]);d.vertexLength+=h,d.primitiveLength+=v.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,o,s,i,a)}}le(Fi,"FillBucket",{omit:["layers","patternFeatures"]});const Kr=new lr({"fill-sort-key":new ge(ut.layout_fill["fill-sort-key"]),visibility:new Rt(ut.layout_fill.visibility)});var os={paint:new lr({"fill-antialias":new Rt(ut.paint_fill["fill-antialias"]),"fill-opacity":new ge(ut.paint_fill["fill-opacity"]),"fill-color":new ge(ut.paint_fill["fill-color"]),"fill-outline-color":new ge(ut.paint_fill["fill-outline-color"]),"fill-translate":new Rt(ut.paint_fill["fill-translate"]),"fill-translate-anchor":new Rt(ut.paint_fill["fill-translate-anchor"]),"fill-pattern":new ge(ut.paint_fill["fill-pattern"]),"fill-emissive-strength":new Rt(ut.paint_fill["fill-emissive-strength"])}),layout:Kr};const pa=wn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),m1=wn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),U3=wn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),V3=wn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),G3=wn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:j3}=pa;var g1={},H3=me,qT=fd;function fd(e,t,n,r,i){this.properties={},this.extent=n,this.type=0,this._pbf=e,this._geometry=-1,this._keys=r,this._values=i,e.readFields(Z3,this,t)}function Z3(e,t,n){e==1?t.id=n.readVarint():e==2?function(r,i){for(var o=r.readVarint()+r.pos;r.pos<o;){var s=i._keys[r.readVarint()],a=i._values[r.readVarint()];i.properties[s]=a}}(n,t):e==3?t.type=n.readVarint():e==4&&(t._geometry=n.pos)}function W3(e){for(var t,n,r=0,i=0,o=e.length,s=o-1;i<o;s=i++)r+=((n=e[s]).x-(t=e[i]).x)*(t.y+n.y);return r}fd.types=["Unknown","Point","LineString","Polygon"],fd.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,n=e.readVarint()+e.pos,r=1,i=0,o=0,s=0,a=[];e.pos<n;){if(i<=0){var c=e.readVarint();r=7&c,i=c>>3}if(i--,r===1||r===2)o+=e.readSVarint(),s+=e.readSVarint(),r===1&&(t&&a.push(t),t=[]),t.push(new H3(o,s));else{if(r!==7)throw new Error("unknown command "+r);t&&t.push(t[0].clone())}}return t&&a.push(t),a},fd.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,n=1,r=0,i=0,o=0,s=1/0,a=-1/0,c=1/0,h=-1/0;e.pos<t;){if(r<=0){var d=e.readVarint();n=7&d,r=d>>3}if(r--,n===1||n===2)(i+=e.readSVarint())<s&&(s=i),i>a&&(a=i),(o+=e.readSVarint())<c&&(c=o),o>h&&(h=o);else if(n!==7)throw new Error("unknown command "+n)}return[s,c,a,h]},fd.prototype.toGeoJSON=function(e,t,n){var r,i,o=this.extent*Math.pow(2,n),s=this.extent*e,a=this.extent*t,c=this.loadGeometry(),h=fd.types[this.type];function d(x){for(var v=0;v<x.length;v++){var w=x[v];x[v]=[360*(w.x+s)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(w.y+a)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var m=[];for(r=0;r<c.length;r++)m[r]=c[r][0];d(c=m);break;case 2:for(r=0;r<c.length;r++)d(c[r]);break;case 3:for(c=function(x){var v=x.length;if(v<=1)return[x];for(var w,A,E=[],S=0;S<v;S++){var I=W3(x[S]);I!==0&&(A===void 0&&(A=I<0),A===I<0?(w&&E.push(w),w=[x[S]]):w.push(x[S]))}return w&&E.push(w),E}(c),r=0;r<c.length;r++)for(i=0;i<c[r].length;i++)d(c[r][i])}c.length===1?c=c[0]:h="Multi"+h;var g={type:"Feature",geometry:{type:h,coordinates:c},properties:this.properties};return"id"in this&&(g.id=this.id),g};var q3=qT,JT=$T;function $T(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(J3,this,t),this.length=this._features.length}function J3(e,t,n){e===15?t.version=n.readVarint():e===1?t.name=n.readString():e===5?t.extent=n.readVarint():e===2?t._features.push(n.pos):e===3?t._keys.push(n.readString()):e===4&&t._values.push(function(r){for(var i=null,o=r.readVarint()+r.pos;r.pos<o;){var s=r.readVarint()>>3;i=s===1?r.readString():s===2?r.readFloat():s===3?r.readDouble():s===4?r.readVarint64():s===5?r.readVarint():s===6?r.readSVarint():s===7?r.readBoolean():null}return i}(n))}$T.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new q3(this._pbf,t,this.extent,this._keys,this._values)};var $3=JT;function K3(e,t,n){if(e===3){var r=new $3(n,n.readVarint()+n.pos);r.length&&(t[r.name]=r)}}var db=g1.VectorTile=function(e,t){this.layers=e.readFields(K3,{},t)},_1=g1.VectorTileFeature=qT;function y1(e,t,n,r){const i=[],o=r===0?(s,a,c,h,d,m)=>{s.push(new nt(m,c+(m-a)/(h-a)*(d-c)))}:(s,a,c,h,d,m)=>{s.push(new nt(a+(m-c)/(d-c)*(h-a),m))};for(const s of e){const a=[];for(const c of s){if(c.length<=2)continue;const h=[];for(let g=0;g<c.length-1;g++){const x=c[g].x,v=c[g].y,w=c[g+1].x,A=c[g+1].y,E=r===0?x:v,S=r===0?w:A;E<t?S>t&&o(h,x,v,w,A,t):E>n?S<n&&o(h,x,v,w,A,n):h.push(c[g]),S<t&&E>=t&&o(h,x,v,w,A,t),S>n&&E<=n&&o(h,x,v,w,A,n)}let d=c[c.length-1];const m=r===0?d.x:d.y;m>=t&&m<=n&&h.push(d),h.length&&(d=h[h.length-1],h[0].x===d.x&&h[0].y===d.y||h.push(h[0]),a.push(h))}a.length&&i.push(a)}return i}g1.VectorTileLayer=JT;class KT{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const r=t[n];this._stringToNumber[r]=n,this._numberToString[n]=r}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}var X3={read:function(e,t,n,r,i){var o,s,a=8*i-r-1,c=(1<<a)-1,h=c>>1,d=-7,m=n?i-1:0,g=n?-1:1,x=e[t+m];for(m+=g,o=x&(1<<-d)-1,x>>=-d,d+=a;d>0;o=256*o+e[t+m],m+=g,d-=8);for(s=o&(1<<-d)-1,o>>=-d,d+=r;d>0;s=256*s+e[t+m],m+=g,d-=8);if(o===0)o=1-h;else{if(o===c)return s?NaN:1/0*(x?-1:1);s+=Math.pow(2,r),o-=h}return(x?-1:1)*s*Math.pow(2,o-r)},write:function(e,t,n,r,i,o){var s,a,c,h=8*o-i-1,d=(1<<h)-1,m=d>>1,g=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,x=r?0:o-1,v=r?1:-1,w=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=d):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+m>=1?g/c:g*Math.pow(2,1-m))*c>=2&&(s++,c/=2),s+m>=d?(a=0,s=d):s+m>=1?(a=(t*c-1)*Math.pow(2,i),s+=m):(a=t*Math.pow(2,m-1)*Math.pow(2,i),s=0));i>=8;e[n+x]=255&a,x+=v,a/=256,i-=8);for(s=s<<i|a,h+=i;h>0;e[n+x]=255&s,x+=v,s/=256,h-=8);e[n+x-v]|=128*w}},XT=hr,x1=X3;function hr(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}hr.Varint=0,hr.Fixed64=1,hr.Bytes=2,hr.Fixed32=5;var pb=4294967296,YT=1/pb,QT=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Wl(e){return e.type===hr.Bytes?e.readVarint()+e.pos:e.pos+1}function dd(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function tC(e,t,n){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=e;i--)n.buf[i+r]=n.buf[i]}function Y3(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function Q3(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function tP(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function eP(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function nP(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function rP(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function iP(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function oP(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function sP(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function v1(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function pd(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function eC(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}hr.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,o=this.pos;this.type=7&r,e(i,t,this),this.pos===o&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=v1(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=eC(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=v1(this.buf,this.pos)+v1(this.buf,this.pos+4)*pb;return this.pos+=8,e},readSFixed64:function(){var e=v1(this.buf,this.pos)+eC(this.buf,this.pos+4)*pb;return this.pos+=8,e},readFloat:function(){var e=x1.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=x1.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,r=this.buf;return t=127&(n=r[this.pos++]),n<128?t:(t|=(127&(n=r[this.pos++]))<<7,n<128?t:(t|=(127&(n=r[this.pos++]))<<14,n<128?t:(t|=(127&(n=r[this.pos++]))<<21,n<128?t:function(i,o,s){var a,c,h=s.buf;if(a=(112&(c=h[s.pos++]))>>4,c<128||(a|=(127&(c=h[s.pos++]))<<3,c<128)||(a|=(127&(c=h[s.pos++]))<<10,c<128)||(a|=(127&(c=h[s.pos++]))<<17,c<128)||(a|=(127&(c=h[s.pos++]))<<24,c<128)||(a|=(1&(c=h[s.pos++]))<<31,c<128))return dd(i,a,o);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&QT?function(n,r,i){return QT.decode(n.subarray(r,i))}(this.buf,t,e):function(n,r,i){for(var o="",s=r;s<i;){var a,c,h,d=n[s],m=null,g=d>239?4:d>223?3:d>191?2:1;if(s+g>i)break;g===1?d<128&&(m=d):g===2?(192&(a=n[s+1]))==128&&(m=(31&d)<<6|63&a)<=127&&(m=null):g===3?(c=n[s+2],(192&(a=n[s+1]))==128&&(192&c)==128&&((m=(15&d)<<12|(63&a)<<6|63&c)<=2047||m>=55296&&m<=57343)&&(m=null)):g===4&&(c=n[s+2],h=n[s+3],(192&(a=n[s+1]))==128&&(192&c)==128&&(192&h)==128&&((m=(15&d)<<18|(63&a)<<12|(63&c)<<6|63&h)<=65535||m>=1114112)&&(m=null)),m===null?(m=65533,g=1):m>65535&&(m-=65536,o+=String.fromCharCode(m>>>10&1023|55296),m=56320|1023&m),o+=String.fromCharCode(m),s+=g}return o}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==hr.Bytes)return e.push(this.readVarint(t));var n=Wl(this);for(e=e||[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==hr.Bytes)return e.push(this.readSVarint());var t=Wl(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==hr.Bytes)return e.push(this.readBoolean());var t=Wl(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==hr.Bytes)return e.push(this.readFloat());var t=Wl(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==hr.Bytes)return e.push(this.readDouble());var t=Wl(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==hr.Bytes)return e.push(this.readFixed32());var t=Wl(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==hr.Bytes)return e.push(this.readSFixed32());var t=Wl(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==hr.Bytes)return e.push(this.readFixed64());var t=Wl(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==hr.Bytes)return e.push(this.readSFixed64());var t=Wl(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===hr.Varint)for(;this.buf[this.pos++]>127;);else if(t===hr.Bytes)this.pos=this.readVarint()+this.pos;else if(t===hr.Fixed32)this.pos+=4;else{if(t!==hr.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),pd(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),pd(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),pd(this.buf,-1&e,this.pos),pd(this.buf,Math.floor(e*YT),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),pd(this.buf,-1&e,this.pos),pd(this.buf,Math.floor(e*YT),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,n){var r,i;if(t>=0?(r=t%4294967296|0,i=t/4294967296|0):(i=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:(r=0,i=i+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(o,s,a){a.buf[a.pos++]=127&o|128,o>>>=7,a.buf[a.pos++]=127&o|128,o>>>=7,a.buf[a.pos++]=127&o|128,o>>>=7,a.buf[a.pos++]=127&o|128,a.buf[a.pos]=127&(o>>>=7)}(r,0,n),function(o,s){var a=(7&o)<<4;s.buf[s.pos++]|=a|((o>>>=3)?128:0),o&&(s.buf[s.pos++]=127&o|((o>>>=7)?128:0),o&&(s.buf[s.pos++]=127&o|((o>>>=7)?128:0),o&&(s.buf[s.pos++]=127&o|((o>>>=7)?128:0),o&&(s.buf[s.pos++]=127&o|((o>>>=7)?128:0),o&&(s.buf[s.pos++]=127&o)))))}(i,n)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(r,i,o){for(var s,a,c=0;c<i.length;c++){if((s=i.charCodeAt(c))>55295&&s<57344){if(!a){s>56319||c+1===i.length?(r[o++]=239,r[o++]=191,r[o++]=189):a=s;continue}if(s<56320){r[o++]=239,r[o++]=191,r[o++]=189,a=s;continue}s=a-55296<<10|s-56320|65536,a=null}else a&&(r[o++]=239,r[o++]=191,r[o++]=189,a=null);s<128?r[o++]=s:(s<2048?r[o++]=s>>6|192:(s<65536?r[o++]=s>>12|224:(r[o++]=s>>18|240,r[o++]=s>>12&63|128),r[o++]=s>>6&63|128),r[o++]=63&s|128)}return o}(this.buf,e,this.pos);var n=this.pos-t;n>=128&&tC(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),x1.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),x1.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var r=this.pos-n;r>=128&&tC(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,n){this.writeTag(e,hr.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,Y3,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Q3,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,nP,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,tP,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,eP,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,rP,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,iP,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,oP,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,sP,t)},writeBytesField:function(e,t){this.writeTag(e,hr.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,hr.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,hr.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,hr.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,hr.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,hr.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,hr.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,hr.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,hr.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,hr.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,!!t)}};var w1=It(XT);const aP=["tile","layer","source","sourceLayer","state"];class nC{constructor(t,n,r,i,o){this.type="Feature",this._vectorTileFeature=t,this._z=n,this._x=r,this._y=i,this.properties=t.properties,this.id=o}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(t.id=this.id);for(const n of aP)this[n]!==void 0&&(t[n]=this[n]);return t}}class lP{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,r){const i=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][i]=this.stateChanges[t][i]||{},re(this.stateChanges[t][i],r),this.deletedStates[t]===null){this.deletedStates[t]={};for(const o in this.state[t])o!==i&&(this.deletedStates[t][o]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][i]===null){this.deletedStates[t][i]={};for(const o in this.state[t][i])r[o]||(this.deletedStates[t][i][o]=null)}else for(const o in r)this.deletedStates[t]&&this.deletedStates[t][i]&&this.deletedStates[t][i][o]===null&&delete this.deletedStates[t][i][o]}removeFeatureState(t,n,r){if(this.deletedStates[t]===null)return;const i=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},r&&n!==void 0)this.deletedStates[t][i]!==null&&(this.deletedStates[t][i]=this.deletedStates[t][i]||{},this.deletedStates[t][i][r]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][i])for(r in this.deletedStates[t][i]={},this.stateChanges[t][i])this.deletedStates[t][i][r]=null;else this.deletedStates[t][i]=null;else this.deletedStates[t]=null}getState(t,n){const r=String(n),i=re({},(this.state[t]||{})[r],(this.stateChanges[t]||{})[r]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const o=this.deletedStates[t][n];if(o===null)return{};for(const s in o)delete i[s]}return i}initializeTileState(t,n){t.setFeatureState(this.state,n)}coalesceChanges(t,n){const r={};for(const i in this.stateChanges){this.state[i]=this.state[i]||{};const o={};for(const s in this.stateChanges[i])this.state[i][s]||(this.state[i][s]={}),re(this.state[i][s],this.stateChanges[i][s]),o[s]=this.state[i][s];r[i]=o}for(const i in this.deletedStates){this.state[i]=this.state[i]||{};const o={};if(this.deletedStates[i]===null)for(const s in this.state[i])o[s]={},this.state[i][s]={};else for(const s in this.deletedStates[i]){if(this.deletedStates[i][s]===null)this.state[i][s]={};else if(this.state[i][s])for(const a of Object.keys(this.deletedStates[i][s]))delete this.state[i][s][a];o[s]=this.state[i][s]}r[i]=r[i]||{},re(r[i],o)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(const i in t)t[i].setFeatureState(r,n)}}class rC{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,n){const r=this.toIdx(t,n);return{min:this.minimums[r],max:this.maximums[r]}}isLeaf(t,n){return this.leaves[this.toIdx(t,n)]}toIdx(t,n){return n*this.size+t}}function iC(e,t,n,r){let i=0,o=Number.MAX_VALUE;for(let s=0;s<3;s++)if(Math.abs(r[s])<1e-15){if(n[s]<e[s]||n[s]>t[s])return null}else{const a=1/r[s];let c=(e[s]-n[s])*a,h=(t[s]-n[s])*a;if(c>h){const d=c;c=h,h=d}if(c>i&&(i=c),h<o&&(o=h),i>o)return null}return i}function oC(e,t,n,r,i,o,s,a,c,h,d){const m=r-e,g=i-t,x=o-n,v=s-e,w=a-t,A=c-n,E=d[1]*A-d[2]*w,S=d[2]*v-d[0]*A,I=d[0]*w-d[1]*v,B=m*E+g*S+x*I;if(Math.abs(B)<1e-15)return null;const M=1/B,D=h[0]-e,R=h[1]-t,z=h[2]-n,N=(D*E+R*S+z*I)*M;if(N<0||N>1)return null;const V=R*x-z*g,j=z*m-D*x,H=D*g-R*m,$=(d[0]*V+d[1]*j+d[2]*H)*M;return $<0||N+$>1?null:(v*V+w*j+A*H)*M}function sC(e,t,n){return(e-t)/(n-t)}function aC(e,t,n,r,i,o,s,a,c){const h=1<<n,d=o-r,m=s-i,g=(e+1)/h*d+r,x=(t+0)/h*m+i,v=(t+1)/h*m+i;a[0]=(e+0)/h*d+r,a[1]=x,c[0]=g,c[1]=v}class lC{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(o){const s=Math.ceil(Math.log2(o.dim/8)),a=[];let c=Math.ceil(Math.pow(2,s));const h=1/c,d=(x,v,w,A,E)=>{const S=A?1:0,I=(x+1)*w-S,B=v*w,M=(v+1)*w-S;E[0]=x*w,E[1]=B,E[2]=I,E[3]=M};let m=new rC(c);const g=[];for(let x=0;x<c*c;x++){d(x%c,Math.floor(x/c),h,!1,g);const v=Xu(g[0],g[1],o),w=Xu(g[2],g[1],o),A=Xu(g[2],g[3],o),E=Xu(g[0],g[3],o);m.minimums.push(Math.min(v,w,A,E)),m.maximums.push(Math.max(v,w,A,E)),m.leaves.push(1)}for(a.push(m),c/=2;c>=1;c/=2){const x=a[a.length-1];m=new rC(c);for(let v=0;v<c*c;v++){d(v%c,Math.floor(v/c),2,!0,g);const w=x.getElevation(g[0],g[1]),A=x.getElevation(g[2],g[1]),E=x.getElevation(g[2],g[3]),S=x.getElevation(g[0],g[3]),I=x.isLeaf(g[0],g[1]),B=x.isLeaf(g[2],g[1]),M=x.isLeaf(g[2],g[3]),D=x.isLeaf(g[0],g[3]),R=Math.min(w.min,A.min,E.min,S.min),z=Math.max(w.max,A.max,E.max,S.max),N=I&&B&&M&&D;m.maximums.push(z),m.minimums.push(R),m.leaves.push(z-R<=5&&N?1:0)}a.push(m)}return a}(this.dem),r=n.length-1,i=n[r];this._addNode(i.minimums[0],i.maximums[0],i.leaves[0]),this._construct(n,0,0,r,0)}raycastRoot(t,n,r,i,o,s,a=1){return iC([t,n,-100],[r,i,this.maximums[0]*a],o,s)}raycast(t,n,r,i,o,s,a=1){if(!this.nodeCount)return null;const c=this.raycastRoot(t,n,r,i,o,s,a);if(c==null)return null;const h=[],d=[],m=[],g=[],x=[{idx:0,t:c,nodex:0,nodey:0,depth:0}];for(;x.length>0;){const{idx:v,t:w,nodex:A,nodey:E,depth:S}=x.pop();if(this.leaves[v]){aC(A,E,S,t,n,r,i,m,g);const B=1<<S,M=(A+0)/B,D=(A+1)/B,R=(E+0)/B,z=(E+1)/B,N=Xu(M,R,this.dem)*a,V=Xu(D,R,this.dem)*a,j=Xu(D,z,this.dem)*a,H=Xu(M,z,this.dem)*a,$=oC(m[0],m[1],N,g[0],m[1],V,g[0],g[1],j,o,s),G=oC(g[0],g[1],j,m[0],g[1],H,m[0],m[1],N,o,s),Q=Math.min($!==null?$:Number.MAX_VALUE,G!==null?G:Number.MAX_VALUE);if(Q!==Number.MAX_VALUE)return Q;{const et=J.scaleAndAdd([],o,s,w);if(uC(N,V,H,j,sC(et[0],m[0],g[0]),sC(et[1],m[1],g[1]))>=et[2])return w}continue}let I=0;for(let B=0;B<this._siblingOffset.length;B++){aC((A<<1)+this._siblingOffset[B][0],(E<<1)+this._siblingOffset[B][1],S+1,t,n,r,i,m,g),m[2]=-100,g[2]=this.maximums[this.childOffsets[v]+B]*a;const M=iC(m,g,o,s);if(M!=null){const D=M;h[B]=D;let R=!1;for(let z=0;z<I&&!R;z++)D>=h[d[z]]&&(d.splice(z,0,B),R=!0);R||(d[I]=B),I++}}for(let B=0;B<I;B++){const M=d[B];x.push({idx:this.childOffsets[v]+M,t:h[M],nodex:(A<<1)+this._siblingOffset[M][0],nodey:(E<<1)+this._siblingOffset[M][1],depth:S+1})}}return null}_addNode(t,n,r){return this.minimums.push(t),this.maximums.push(n),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(t,n,r,i,o){if(t[i].isLeaf(n,r)===1)return;this.childOffsets[o]||(this.childOffsets[o]=this.nodeCount);const s=i-1,a=t[s];let c=0,h=0;for(let d=0;d<this._siblingOffset.length;d++){const m=2*n+this._siblingOffset[d][0],g=2*r+this._siblingOffset[d][1],x=a.getElevation(m,g),v=a.isLeaf(m,g),w=this._addNode(x.min,x.max,v);v&&(c|=1<<d),h||(h=w)}for(let d=0;d<this._siblingOffset.length;d++)c&1<<d||this._construct(t,2*n+this._siblingOffset[d][0],2*r+this._siblingOffset[d][1],s,h+d)}}function uC(e,t,n,r,i,o){return Ce(Ce(e,n,o),Ce(t,r,o),i)}function Xu(e,t,n){const r=n.dim,i=$t(e*r-.5,0,r-1),o=$t(t*r-.5,0,r-1),s=Math.floor(i),a=Math.floor(o),c=Math.min(s+1,r-1),h=Math.min(a+1,r-1);return uC(n.get(s,a),n.get(c,a),n.get(s,h),n.get(c,h),i-s,o-a)}const uP={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function cP(e,t,n){return(256*e*256+256*t+n)/10-1e4}function hP(e,t,n){return 256*e+t+n/256-32768}class b1{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,n,r,i=!1){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return rt(`"${r}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const o=this.dim=n.height-2,s=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=i,this._modifiedForSources={},!i){for(let c=0;c<o;c++)s[this._idx(-1,c)]=s[this._idx(0,c)],s[this._idx(o,c)]=s[this._idx(o-1,c)],s[this._idx(c,-1)]=s[this._idx(c,0)],s[this._idx(c,o)]=s[this._idx(c,o-1)];s[this._idx(-1,-1)]=s[this._idx(0,0)],s[this._idx(o,-1)]=s[this._idx(o-1,0)],s[this._idx(-1,o)]=s[this._idx(0,o-1)],s[this._idx(o,o)]=s[this._idx(o-1,o-1)]}const a=r==="terrarium"?hP:cP;for(let c=0;c<s.length;++c){const h=4*c;this.floatView[c]=a(this.pixels[h],this.pixels[h+1],this.pixels[h+2])}this._timestamp=ze.now()}_buildQuadTree(){this._tree=new lC(this)}get(t,n,r=!1){r&&(t=$t(t,-1,this.dim),n=$t(n,-1,this.dim));const i=this._idx(t,n);return this.floatView[i]}set(t,n,r){const i=this._idx(t,n),o=this.floatView[i];return this.floatView[i]=r,r-o}static getUnpackVector(t){return uP[t]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}static pack(t,n){const r=[0,0,0,0],i=b1.getUnpackVector(n);let o=Math.floor((t+i[3])/i[2]);return r[2]=o%256,o=Math.floor(o/256),r[1]=o%256,o=Math.floor(o/256),r[0]=o,r}getPixels(){return new d1({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,n,r){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let i=n*this.dim,o=n*this.dim+this.dim,s=r*this.dim,a=r*this.dim+this.dim;switch(n){case-1:i=o-1;break;case 1:o=i+1}switch(r){case-1:s=a-1;break;case 1:a=s+1}const c=-n*this.dim,h=-r*this.dim;for(let d=s;d<a;d++)for(let m=i;m<o;m++){const g=4*this._idx(m,d),x=4*this._idx(m+c,d+h);this.pixels[g+0]=t.pixels[x+0],this.pixels[g+1]=t.pixels[x+1],this.pixels[g+2]=t.pixels[x+2],this.pixels[g+3]=t.pixels[x+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}le(b1,"DEMData"),le(lC,"DemMinMaxQuadTree",{omit:["dem"]});class fP{isDataAvailableAtPoint(t){const n=this._source();if(this.isUsingMockSource()||!n||t.y<0||t.y>1)return!1;const r=n.getSource().maxzoom,i=1<<r,o=Math.floor(t.x),s=Math.floor((t.x-o)*i),a=Math.floor(t.y*i),c=this.findDEMTileFor(new sn(r,o,r,s,a));return!(!c||!c.dem)}getAtPointOrZero(t,n=0){return this.getAtPoint(t,n)||0}getAtPoint(t,n,r=!0){if(this.isUsingMockSource())return null;n==null&&(n=null);const i=this._source();if(!i||t.y<0||t.y>1)return n;const o=i.getSource().maxzoom,s=1<<o,a=Math.floor(t.x),c=t.x-a,h=new sn(o,a,o,Math.floor(c*s),Math.floor(t.y*s)),d=this.findDEMTileFor(h);if(!d||!d.dem)return n;const m=d.dem,g=1<<d.tileID.canonical.z,x=(c*g-d.tileID.canonical.x)*m.dim,v=(t.y*g-d.tileID.canonical.y)*m.dim,w=Math.floor(x),A=Math.floor(v);return(r?this.exaggeration():1)*Ce(Ce(m.get(w,A),m.get(w,A+1),v-A),Ce(m.get(w+1,A),m.get(w+1,A+1),v-A),x-w)}getAtTileOffset(t,n,r){const i=1<<t.canonical.z;return this.getAtPointOrZero(new an(t.wrap+(t.canonical.x+n/gt)/i,(t.canonical.y+r/gt)/i))}getAtTileOffsetFunc(t,n,r,i){return o=>{const s=this.getAtTileOffset(t,o.x,o.y),a=i.upVector(t.canonical,o.x,o.y),c=i.upVectorScale(t.canonical,n,r).metersToTile;return J.scale(a,a,s*c),a}}getForTilePoints(t,n,r,i){if(this.isUsingMockSource())return!1;const o=md.create(this,t,i);return!!o&&(n.forEach(s=>{s[2]=this.exaggeration()*o.getElevationAt(s[0],s[1],r)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const n=this.findDEMTileFor(t);if(!n||!n.dem)return null;const r=n.dem.tree,i=n.tileID,o=1<<t.canonical.z-i.canonical.z;let s=t.canonical.x/o-i.canonical.x,a=t.canonical.y/o-i.canonical.y,c=0;for(let h=0;h<t.canonical.z-i.canonical.z&&!r.leaves[c];h++){s*=2,a*=2;const d=2*Math.floor(a)+Math.floor(s);c=r.childOffsets[c]+d,s%=1,a%=1}return{min:this.exaggeration()*r.minimums[c],max:this.exaggeration()*r.maximums[c]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,n,r){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const t=this.visibleDemTiles;if(t.length===0)return null;let n=!1,r=Number.MAX_VALUE,i=Number.MIN_VALUE;for(const o of t){const s=this.getMinMaxForTile(o.tileID);s&&(r=Math.min(r,s.min),i=Math.max(i,s.max),n=!0)}return n?{min:r,max:i}:null}}class md{constructor(t,n,r){this._demTile=t,this._dem=this._demTile.dem,this._scale=n,this._offset=r}static create(t,n,r){const i=r||t.findDEMTileFor(n);if(!i||!i.dem)return;const o=i.dem,s=i.tileID,a=1<<n.canonical.z-s.canonical.z;return new md(i,o.dim/gt/a,[(n.canonical.x/a-s.canonical.x)*o.dim,(n.canonical.y/a-s.canonical.y)*o.dim])}tileCoordToPixel(t,n){const r=n*this._scale+this._offset[1],i=Math.floor(t*this._scale+this._offset[0]),o=Math.floor(r);return new nt(i,o)}getElevationAt(t,n,r,i){const o=t*this._scale+this._offset[0],s=n*this._scale+this._offset[1],a=Math.floor(o),c=Math.floor(s),h=this._dem;return i=!!i,r?Ce(Ce(h.get(a,c,i),h.get(a,c+1,i),s-c),Ce(h.get(a+1,c,i),h.get(a+1,c+1,i),s-c),o-a):h.get(a,c,i)}getElevationAtPixel(t,n,r){return this._dem.get(t,n,!!r)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*Rn(1,t)*this._dem.stride}}class mb{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Ru(gt,16,0),this.featureIndexArray=new B0,this.promoteId=n}insert(t,n,r,i,o,s=0){const a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,i,o,s);const c=this.grid;for(let h=0;h<n.length;h++){const d=n[h],m=[1/0,1/0,-1/0,-1/0];for(let g=0;g<d.length;g++){const x=d[g];m[0]=Math.min(m[0],x.x),m[1]=Math.min(m[1],x.y),m[2]=Math.max(m[2],x.x),m[3]=Math.max(m[3],x.y)}m[0]<gt&&m[1]<gt&&m[2]>=0&&m[3]>=0&&c.insert(a,m[0],m[1],m[2],m[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new db(new w1(this.rawTileData)).layers,this.sourceLayerCoder=new KT(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,n,r,i){this.loadVTLayers();const o=t.params||{},s=Pl(o.filter),a=t.tileResult,c=t.transform,h=a.bufferedTilespaceBounds,d=this.grid.query(h.min.x,h.min.y,h.max.x,h.max.y,(v,w,A,E)=>i1(a.bufferedTilespaceGeometry,v,w,A,E));d.sort(dP);let m=null;c.elevation&&d.length>0&&(m=md.create(c.elevation,this.tileID));const g={};let x;for(let v=0;v<d.length;v++){const w=d[v];if(w===x)continue;x=w;const A=this.featureIndexArray.get(w);let E=null;this.loadMatchingFeature(g,A,s,o.layers,o.availableImages,n,r,i,(S,I,B,M=0)=>(E||(E=ks(S,this.tileID.canonical,t.tileTransform)),I.queryIntersectsFeature(a,S,B,E,this.z,t.transform,t.pixelPosMatrix,m,M)))}return g}loadMatchingFeature(t,n,r,i,o,s,a,c,h){const{featureIndex:d,bucketIndex:m,sourceLayerIndex:g,layoutVertexArrayOffset:x}=n,v=this.bucketLayerIDs[m];if(i&&!function(S,I){for(let B=0;B<S.length;B++)if(I.indexOf(S[B])>=0)return!0;return!1}(i,v))return;const w=this.sourceLayerCoder.decode(g),A=this.vtLayers[w].feature(d);if(r.needGeometry){const S=$a(A,!0);if(!r.filter(new rr(this.tileID.overscaledZ),S,this.tileID.canonical))return}else if(!r.filter(new rr(this.tileID.overscaledZ),A))return;const E=this.getId(A,w);for(let S=0;S<v.length;S++){const I=v[S];if(i&&i.indexOf(I)<0)continue;const B=s[I];if(!B)continue;let M={};E!==void 0&&c&&(M=c.getState(B.sourceLayer||"_geojsonTileLayer",E));const D=re({},a[I]);D.paint=cC(D.paint,B.paint,A,M,o),D.layout=cC(D.layout,B.layout,A,M,o);const R=!h||h(A,B,M,x);if(!R)continue;const z=new nC(A,this.z,this.x,this.y,E);z.layer=D;let N=t[I];N===void 0&&(N=t[I]=[]),N.push({featureIndex:d,feature:z,intersectionZ:R})}}lookupSymbolFeatures(t,n,r,i,o,s,a,c){const h={};this.loadVTLayers();const d=Pl(o);for(const m of t)this.loadMatchingFeature(h,{bucketIndex:r,sourceLayerIndex:i,featureIndex:m,layoutVertexArrayOffset:0},d,s,a,c,n);return h}loadFeature(t){const{featureIndex:n,sourceLayerIndex:r}=t;this.loadVTLayers();const i=this.sourceLayerCoder.decode(r),o=this.vtFeatures[i];if(o[n])return o[n];const s=this.vtLayers[i].feature(n);return o[n]=s,s}hasLayer(t){for(const n of this.bucketLayerIDs)for(const r of n)if(t===r)return!0;return!1}getId(t,n){let r=t.id;if(this.promoteId){const i=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];i!=null&&(r=t.properties[i]),typeof r=="boolean"&&(r=Number(r))}return r}}function cC(e,t,n,r,i){return au(e,(o,s)=>{const a=t instanceof Ts?t.get(s):null;return a&&a.evaluate?a.evaluate(n,r,i):a})}function dP(e,t){return t-e}le(mb,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const pP=wn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),mP=wn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),gP=wn([{name:"a_projected_pos",components:4,type:"Float32"}],4);wn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const _P=wn([{name:"a_z_offset",components:1,type:"Float32"}],4),yP=wn([{name:"a_texb",components:2,type:"Uint16"}]),xP=wn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),vP=wn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);wn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const hC=wn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),wP=wn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);wn([{name:"triangle",components:3,type:"Uint16"}]),wn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),wn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),wn([{type:"Float32",name:"offsetX"}]),wn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var li=24;const ma=128;function gb(e,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new rr(e+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:r,interpolationType:i}=n;let o=0;for(;o<r.length&&r[o]<=e;)o++;o=Math.max(0,o-1);let s=o;for(;s<r.length&&r[s]<e+1;)s++;s=Math.min(r.length-1,s);const a=r[o],c=r[s];return n.kind==="composite"?{kind:"composite",minZoom:a,maxZoom:c,interpolationType:i}:{kind:"camera",minZoom:a,maxZoom:c,minSize:n.evaluate(new rr(a)),maxSize:n.evaluate(new rr(c)),interpolationType:i}}}function dg(e,{uSize:t,uSizeT:n},{lowerSize:r,upperSize:i}){return e.kind==="source"?r/ma:e.kind==="composite"?Ce(r/ma,i/ma,n):t}function Xa(e,t){let n=0,r=0;if(e.kind==="constant")r=e.layoutSize;else if(e.kind!=="source"){const{interpolationType:i,minZoom:o,maxZoom:s}=e,a=i?$t(xs.interpolationFactor(i,t,o,s),0,1):0;e.kind==="camera"?r=Ce(e.minSize,e.maxSize,a):n=a}return{uSizeT:n,uSize:r}}var bP=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:ma,evaluateSizeForFeature:dg,evaluateSizeForZoom:Xa,getSizeData:gb});function AP(e,t,n){return e.sections.forEach(r=>{r.text=function(i,o,s){const a=o.layout.get("text-transform").evaluate(s,{});return a==="uppercase"?i=i.toLocaleUpperCase():a==="lowercase"&&(i=i.toLocaleLowerCase()),xo.applyArabicShaping&&(i=xo.applyArabicShaping(i)),i}(r.text,t,n)}),e}const pg={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function EP(e){return e===""||e===""||e===""||e===""||e===""||e===""||e===""||e===""||e===""||e===""||e===""||e===""||e===""||e===""||e===""||e===""||e===""}function TP(e){return e===""||e===""||e===""||e===""||e===""||e===""||e===""||e===""||e===""||e===""}const _b=3;function CP(e,t,n){t.glyphs=[],e===1&&n.readMessage(SP,t)}function SP(e,t,n){if(e===3){const{id:r,bitmap:i,width:o,height:s,left:a,top:c,advance:h}=n.readMessage(MP,{});t.glyphs.push({id:r,bitmap:new da({width:o+2*_b,height:s+2*_b},i),metrics:{width:o,height:s,left:a,top:c,advance:h}})}else e===4?t.ascender=n.readSVarint():e===5&&(t.descender=n.readSVarint())}function MP(e,t,n){e===1?t.id=n.readVarint():e===2?t.bitmap=n.readBytes():e===3?t.width=n.readVarint():e===4?t.height=n.readVarint():e===5?t.left=n.readSVarint():e===6?t.top=n.readSVarint():e===7&&(t.advance=n.readVarint())}const fC=_b,fr={horizontal:1,vertical:2,horizontalOnly:3},dC=-17;class mg{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,n){const r=new mg;return r.scale=t||1,r.fontStack=n,r}static forImage(t){const n=new mg;return n.imageName=t,n}}class gd{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const r=new gd;for(let i=0;i<t.sections.length;i++){const o=t.sections[i];o.image?r.addImageSection(o):r.addTextSection(o,n)}return r}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(n,r){let i="";for(let o=0;o<n.length;o++){const s=n.charCodeAt(o+1)||null,a=n.charCodeAt(o-1)||null;i+=!r&&(s&&sm(s)&&!pg[n[o+1]]||a&&sm(a)&&!pg[n[o-1]])||!pg[n[o]]?n[o]:pg[n[o]]}return i}(this.text,t)}trim(){let t=0;for(let r=0;r<this.text.length&&A1[this.text.charCodeAt(r)];r++)t++;let n=this.text.length;for(let r=this.text.length-1;r>=0&&r>=t&&A1[this.text.charCodeAt(r)];r--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const r=new gd;return r.text=this.text.substring(t,n),r.sectionIndex=this.sectionIndex.slice(t,n),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,n)=>Math.max(t,this.sections[n].scale),0)}addTextSection(t,n){this.text+=t.text,this.sections.push(mg.forText(t.scale,t.fontStack||n));const r=this.sections.length-1;for(let i=0;i<t.text.length;++i)this.sectionIndex.push(r)}addImageSection(t){const n=t.image?t.image.namePrimary:"";if(n.length===0)return void rt("Can't add FormattedSection with an empty image.");const r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCodePoint(r),this.sections.push(mg.forImage(n)),this.sectionIndex.push(this.sections.length-1)):rt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function yb(e,t,n,r,i,o,s,a,c,h,d,m,g,x,v){const w=gd.fromFeature(e,i);m===fr.vertical&&w.verticalizePunctuation(g);let A=[];const E=function(D,R,z,N,V,j){if(!D)return[];const H=[],$=function(st,Y,tt,ct,pt,dt){let wt=0;for(let bt=0;bt<st.length();bt++){const Et=st.getSection(bt);wt+=pC(st.getCodePoint(bt),Et,ct,pt,Y,dt)}return wt/Math.max(1,Math.ceil(wt/tt))}(D,R,z,N,V,j),G=D.text.indexOf("")>=0;let Q=0;for(let st=0;st<D.length();st++){const Y=D.getSection(st),tt=D.getCodePoint(st);if(A1[tt]||(Q+=pC(tt,Y,N,V,R,j)),st<D.length()-1){const ct=!((et=tt)<11904||!(ee["Bopomofo Extended"](et)||ee.Bopomofo(et)||ee["CJK Compatibility Forms"](et)||ee["CJK Compatibility Ideographs"](et)||ee["CJK Compatibility"](et)||ee["CJK Radicals Supplement"](et)||ee["CJK Strokes"](et)||ee["CJK Symbols and Punctuation"](et)||ee["CJK Unified Ideographs Extension A"](et)||ee["CJK Unified Ideographs"](et)||ee["Enclosed CJK Letters and Months"](et)||ee["Halfwidth and Fullwidth Forms"](et)||ee.Hiragana(et)||ee["Ideographic Description Characters"](et)||ee["Kangxi Radicals"](et)||ee["Katakana Phonetic Extensions"](et)||ee.Katakana(et)||ee["Vertical Forms"](et)||ee["Yi Radicals"](et)||ee["Yi Syllables"](et)));(IP[tt]||ct||Y.imageName)&&H.push(gC(st+1,Q,$,H,BP(tt,D.getCodePoint(st+1),ct&&G),!1))}}var et;return _C(gC(D.length(),Q,$,H,0,!0))}(w,h,o,t,r,x),{processBidirectionalText:S,processStyledBidirectionalText:I}=xo;if(S&&w.sections.length===1){const D=S(w.toString(),E);for(const R of D){const z=new gd;z.text=R,z.sections=w.sections;for(let N=0;N<R.length;N++)z.sectionIndex.push(0);A.push(z)}}else if(I){const D=I(w.text,w.sectionIndex,E);for(const R of D){const z=new gd;z.text=R[0],z.sectionIndex=R[1],z.sections=w.sections,A.push(z)}}else A=function(D,R){const z=[],N=D.text;let V=0;for(const j of R)z.push(D.substring(V,j)),V=j;return V<N.length&&z.push(D.substring(V,N.length)),z}(w,E);const B=[],M={positionedLines:B,text:w.toString(),top:d[1],bottom:d[1],left:d[0],right:d[0],writingMode:m,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(D,R,z,N,V,j,H,$,G,Q,et,st){let Y=0,tt=0,ct=0;const pt=$==="right"?1:$==="left"?0:.5;let dt=!1;for(const qt of V){const Jt=qt.getSections();for(const ne of Jt){if(ne.imageName)continue;const se=R[ne.fontStack];if(se&&(dt=se.ascender!==void 0&&se.descender!==void 0,!dt))break}if(!dt)break}let wt=0;for(const qt of V){qt.trim();const Jt=qt.getMaxScale(),ne=(Jt-1)*li,se={positionedGlyphs:[],lineOffset:0};D.positionedLines[wt]=se;const Pe=se.positionedGlyphs;let pe=0;if(!qt.length()){tt+=j,++wt;continue}let pn=0,rn=0;for(let Se=0;Se<qt.length();Se++){const _e=qt.getSection(Se),ln=qt.getSectionIndex(Se),cn=qt.getCodePoint(Se);let Je=_e.scale,Gn=null,Tr=null,On=null,Xn=li,Dr=0;const Cr=!(G===fr.horizontal||!et&&!ku(cn)||et&&(A1[cn]||(bt=cn,ee.Arabic(bt)||ee["Arabic Supplement"](bt)||ee["Arabic Extended-A"](bt)||ee["Arabic Presentation Forms-A"](bt)||ee["Arabic Presentation Forms-B"](bt))));if(_e.imageName){const or=N[_e.imageName];if(!or)continue;On=_e.imageName,D.iconsInText=D.iconsInText||!0,Tr=or.paddedRect;const kn=or.displaySize;Je=Je*li/st,Gn={width:kn[0],height:kn[1],left:0,top:-fC,advance:Cr?kn[1]:kn[0],localGlyph:!1},Dr=dt?-Gn.height*Je:dC+Jt*li-kn[1]*Je,Xn=Gn.advance;const mi=(Cr?kn[0]:kn[1])*Je-li*Jt;mi>0&&mi>pe&&(pe=mi)}else{const or=z[_e.fontStack];if(!or)continue;or[cn]&&(Tr=or[cn]);const kn=R[_e.fontStack];if(!kn)continue;const mi=kn.glyphs[cn];if(!mi)continue;if(Gn=mi.metrics,Xn=cn!==8203?li:0,dt){const rl=kn.ascender!==void 0?Math.abs(kn.ascender):0,Jl=kn.descender!==void 0?Math.abs(kn.descender):0,$l=(rl+Jl)*Je;pn<$l&&(pn=$l,rn=(rl-Jl)/2*Je),Dr=-rl*Je}else Dr=dC+(Jt-Je)*li}Cr?(D.verticalizable=!0,Pe.push({glyph:cn,imageName:On,x:Y,y:tt+Dr,vertical:Cr,scale:Je,localGlyph:Gn.localGlyph,fontStack:_e.fontStack,sectionIndex:ln,metrics:Gn,rect:Tr}),Y+=Xn*Je+Q):(Pe.push({glyph:cn,imageName:On,x:Y,y:tt+Dr,vertical:Cr,scale:Je,localGlyph:Gn.localGlyph,fontStack:_e.fontStack,sectionIndex:ln,metrics:Gn,rect:Tr}),Y+=Gn.advance*Je+Q)}Pe.length!==0&&(ct=Math.max(Y-Q,ct),dt?yC(Pe,pt,pe,rn,j*Jt/2):yC(Pe,pt,pe,0,j/2)),Y=0;const Le=j*Jt+pe;se.lineOffset=Math.max(pe,ne),tt+=Le,++wt}var bt;const Et=tt,{horizontalAlign:_t,verticalAlign:Mt}=E1(H);(function(qt,Jt,ne,se,Pe,pe){const pn=(Jt-ne)*Pe,rn=-pe*se;for(const Le of qt)for(const Se of Le.positionedGlyphs)Se.x+=pn,Se.y+=rn})(D.positionedLines,pt,_t,Mt,ct,Et),D.top+=-Mt*Et,D.bottom=D.top+Et,D.left+=-_t*ct,D.right=D.left+ct,D.hasBaseline=dt}(M,t,n,r,A,s,a,c,m,h,g,v),!function(D){for(const R of D)if(R.positionedGlyphs.length!==0)return!1;return!0}(B)&&M}const A1={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},IP={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function pC(e,t,n,r,i,o){if(t.imageName){const s=r[t.imageName];return s?s.displaySize[0]*t.scale*li/o+i:0}{const s=n[t.fontStack],a=s&&s.glyphs[e];return a?a.metrics.advance*t.scale+i:0}}function mC(e,t,n,r){const i=Math.pow(e-t,2);return r?e<t?i/2:2*i:i+Math.abs(n)*n}function BP(e,t,n){let r=0;return e===10&&(r-=1e4),n&&(r+=150),e!==40&&e!==65288||(r+=50),t!==41&&t!==65289||(r+=50),r}function gC(e,t,n,r,i,o){let s=null,a=mC(t,n,i,o);for(const c of r){const h=mC(t-c.x,n,i,o)+c.badness;h<=a&&(s=c,a=h)}return{index:e,x:t,priorBreak:s,badness:a}}function _C(e){return e?_C(e.priorBreak).concat(e.index):[]}function E1(e){let t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function yC(e,t,n,r,i){if(!(t||n||r||i))return;const o=e.length-1,s=e[o],a=(s.x+s.metrics.advance*s.scale)*t;for(let c=0;c<=o;c++)e[c].x-=a,e[c].y+=n+r+i}function DP(e,t,n,r){const{horizontalAlign:i,verticalAlign:o}=E1(r),s=n[0]-e.displaySize[0]*i,a=n[1]-e.displaySize[1]*o;return{imagePrimary:e,imageSecondary:t,top:a,bottom:a+e.displaySize[1],left:s,right:s+e.displaySize[0]}}function xC(e,t,n,r,i,o){const s=e.imagePrimary;let a;if(s.content){const A=s.content,E=s.pixelRatio||1;a=[A[0]/E,A[1]/E,s.displaySize[0]-A[2]/E,s.displaySize[1]-A[3]/E]}const c=t.left*o,h=t.right*o;let d,m,g,x;n==="width"||n==="both"?(x=i[0]+c-r[3],m=i[0]+h+r[1]):(x=i[0]+(c+h-s.displaySize[0])/2,m=x+s.displaySize[0]);const v=t.top*o,w=t.bottom*o;return n==="height"||n==="both"?(d=i[1]+v-r[0],g=i[1]+w+r[2]):(d=i[1]+(v+w-s.displaySize[1])/2,g=d+s.displaySize[1]),{imagePrimary:s,imageSecondary:void 0,top:d,right:m,bottom:g,left:x,collisionPadding:a}}class ql extends nt{constructor(t,n,r,i,o){super(t,n),this.angle=i,this.z=r,o!==void 0&&(this.segment=o)}clone(){return new ql(this.x,this.y,this.z,this.angle,this.segment)}}function vC(e,t,n,r,i){if(t.segment===void 0)return!0;let o=t,s=t.segment+1,a=0;for(;a>-n/2;){if(s--,s<0)return!1;a-=e[s].dist(o),o=e[s]}a+=e[s].dist(e[s+1]),s++;const c=[];let h=0;for(;a<n/2;){const d=e[s],m=e[s+1];if(!m)return!1;let g=e[s-1].angleTo(d)-d.angleTo(m);for(g=Math.abs((g+3*Math.PI)%(2*Math.PI)-Math.PI),c.push({distance:a,angleDelta:g}),h+=g;a-c[0].distance>r;)h-=c.shift().angleDelta;if(h>i)return!1;s++,a+=d.dist(m)}return!0}function wC(e){let t=0;for(let n=0;n<e.length-1;n++)t+=e[n].dist(e[n+1]);return t}function bC(e,t,n){return e?.6*t*n:0}function AC(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function PP(e,t,n,r,i,o){const s=bC(n,i,o),a=AC(n,r)*o;let c=0;const h=wC(e)/2;for(let d=0;d<e.length-1;d++){const m=e[d],g=e[d+1],x=m.dist(g);if(c+x>h){const v=(h-c)/x,w=Ce(m.x,g.x,v),A=Ce(m.y,g.y,v),E=new ql(w,A,0,g.angleTo(m),d);return!s||vC(e,E,a,s,t)?E:void 0}c+=x}}function LP(e,t,n,r,i,o,s,a,c){const h=bC(r,o,s),d=AC(r,i),m=d*s,g=e[0].x===0||e[0].x===c||e[0].y===0||e[0].y===c;return t-m<t/4&&(t=m+t/4),EC(e,g?t/2*a%t:(d/2+2*o)*s*a%t,t,h,n,m,g,!1,c)}function EC(e,t,n,r,i,o,s,a,c){const h=o/2,d=wC(e);let m=0,g=t-n,x=[];for(let v=0;v<e.length-1;v++){const w=e[v],A=e[v+1],E=w.dist(A),S=A.angleTo(w);for(;g+n<m+E;){g+=n;const I=(g-m)/E,B=Ce(w.x,A.x,I),M=Ce(w.y,A.y,I);if(B>=0&&B<c&&M>=0&&M<c&&g-h>=0&&g+h<=d){const D=new ql(B,M,0,S,v);r&&!vC(e,D,o,r,i)||x.push(D)}}m+=E}return a||x.length||s||(x=EC(e,m/2,n,r,i,o,s,!0,c)),x}function TC(e,t,n,r,i){const o=[];for(let s=0;s<e.length;s++){const a=e[s];let c;for(let h=0;h<a.length-1;h++){let d=a[h],m=a[h+1];d.x<t&&m.x<t||(d.x<t?d=new nt(t,d.y+(t-d.x)/(m.x-d.x)*(m.y-d.y))._round():m.x<t&&(m=new nt(t,d.y+(t-d.x)/(m.x-d.x)*(m.y-d.y))._round()),d.y<n&&m.y<n||(d.y<n?d=new nt(d.x+(n-d.y)/(m.y-d.y)*(m.x-d.x),n)._round():m.y<n&&(m=new nt(d.x+(n-d.y)/(m.y-d.y)*(m.x-d.x),n)._round()),d.x>=r&&m.x>=r||(d.x>=r?d=new nt(r,d.y+(r-d.x)/(m.x-d.x)*(m.y-d.y))._round():m.x>=r&&(m=new nt(r,d.y+(r-d.x)/(m.x-d.x)*(m.y-d.y))._round()),d.y>=i&&m.y>=i||(d.y>=i?d=new nt(d.x+(i-d.y)/(m.y-d.y)*(m.x-d.x),i)._round():m.y>=i&&(m=new nt(d.x+(i-d.y)/(m.y-d.y)*(m.x-d.x),i)._round()),c&&d.equals(c[c.length-1])||(c=[d],o.push(c)),c.push(m)))))}}return o}function xb(e){let t=0,n=0;for(const s of e)t+=s.w*s.h,n=Math.max(n,s.w);e.sort((s,a)=>a.h-s.h);const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let i=0,o=0;for(const s of e)for(let a=r.length-1;a>=0;a--){const c=r[a];if(!(s.w>c.w||s.h>c.h)){if(s.x=c.x,s.y=c.y,o=Math.max(o,s.y+s.h),i=Math.max(i,s.x+s.w),s.w===c.w&&s.h===c.h){const h=r.pop();a<r.length&&(r[a]=h)}else s.h===c.h?(c.x+=s.w,c.w-=s.w):s.w===c.w?(c.y+=s.h,c.h-=s.h):(r.push({x:c.x+s.w,y:c.y,w:c.w-s.w,h:s.h}),c.y+=s.h,c.h-=s.h);break}}return{w:i,h:o,fill:t/(i*o)||0}}le(ql,"Anchor");const jo=1;class vb{constructor(t,{pixelRatio:n,version:r,stretchX:i,stretchY:o,content:s}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=i,this.stretchY=o,this.content=s,this.version=r}get tl(){return[this.paddedRect.x+jo,this.paddedRect.y+jo]}get br(){return[this.paddedRect.x+this.paddedRect.w-jo,this.paddedRect.y+this.paddedRect.h-jo]}get displaySize(){return[(this.paddedRect.w-2*jo)/this.pixelRatio,(this.paddedRect.h-2*jo)/this.pixelRatio]}}class CC{constructor(t,n){const r={},i={};this.haveRenderCallbacks=[];const o=[];this.addImages(t,r,o),this.addImages(n,i,o);const{w:s,h:a}=xb(o),c=new Er({width:s||1,height:a||1});for(const h in t){const d=t[h],m=r[h].paddedRect;Er.copy(d.data,c,{x:0,y:0},{x:m.x+jo,y:m.y+jo},d.data)}for(const h in n){const d=n[h],m=i[h].paddedRect,g=m.x+jo,x=m.y+jo,v=d.data.width,w=d.data.height;Er.copy(d.data,c,{x:0,y:0},{x:g,y:x},d.data),Er.copy(d.data,c,{x:0,y:w-1},{x:g,y:x-1},{width:v,height:1}),Er.copy(d.data,c,{x:0,y:0},{x:g,y:x+w},{width:v,height:1}),Er.copy(d.data,c,{x:v-1,y:0},{x:g-1,y:x},{width:1,height:w}),Er.copy(d.data,c,{x:0,y:0},{x:g+v,y:x},{width:1,height:w})}this.image=c,this.iconPositions=r,this.patternPositions=i}addImages(t,n,r){for(const i in t){const o=t[i],s={x:0,y:0,w:o.data.width+2*jo,h:o.data.height+2*jo};r.push(s),n[i]=new vb(s,o),o.hasRenderCallback&&this.haveRenderCallbacks.push(i)}}patchUpdatedImages(t,n,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(i=>t.hasImage(i,r)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,r);for(const i in t.getUpdatedImages(r))this.patchUpdatedImage(this.iconPositions[i],t.getImage(i,r),n),this.patchUpdatedImage(this.patternPositions[i],t.getImage(i,r),n)}patchUpdatedImage(t,n,r){if(!t||!n||t.version===n.version)return;t.version=n.version;const[i,o]=t.tl;r.update(n.data,void 0,{x:i,y:o})}}le(vb,"ImagePosition"),le(CC,"ImageAtlas");const gg=1e20;function SC(e,t,n,r,i,o,s,a,c){for(let h=t;h<t+r;h++)MC(e,n*o+h,o,i,s,a,c);for(let h=n;h<n+i;h++)MC(e,h*o+t,1,r,s,a,c)}function MC(e,t,n,r,i,o,s){o[0]=0,s[0]=-gg,s[1]=gg,i[0]=e[t];for(let a=1,c=0,h=0;a<r;a++){i[a]=e[t+a*n];const d=a*a;do{const m=o[c];h=(i[a]-i[m]+d-m*m)/(a-m)/2}while(h<=s[c]&&--c>-1);c++,o[c]=a,s[c]=h,s[c+1]=gg}for(let a=0,c=0;a<r;a++){for(;s[c+1]<a;)c++;const h=o[c],d=a-h;e[t+a*n]=i[h]+d*d}}const ga=2;class _d{constructor(t,n,r){this.requestManager=t,this.localGlyphMode=n,this.localFontFamily=r,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t,n){this.urls[n]=t}getGlyphs(t,n,r){const i=[],o=this.urls[n]||X.GLYPHS_URL;for(const s in t)for(const a of t[s])i.push({stack:s,id:a});Mi(i,({stack:s,id:a},c)=>{let h=this.entries[s];h||(h=this.entries[s]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let d=h.glyphs[a];if(d!==void 0)return void c(null,{stack:s,id:a,glyph:d});if(d=this._tinySDF(h,s,a),d)return h.glyphs[a]=d,void c(null,{stack:s,id:a,glyph:d});const m=Math.floor(a/256);if(256*m>65535)return void c(new Error("glyphs > 65535 not supported"));if(h.ranges[m])return void c(null,{stack:s,id:a,glyph:d});let g=h.requests[m];g||(g=h.requests[m]=[],_d.loadGlyphRange(s,m,o,this.requestManager,(x,v)=>{if(v){h.ascender=v.ascender,h.descender=v.descender;for(const w in v.glyphs)this._doesCharSupportLocalGlyph(+w)||(h.glyphs[+w]=v.glyphs[+w]);h.ranges[m]=!0}for(const w of g)w(x,v);delete h.requests[m]})),g.push((x,v)=>{x?c(x):v&&c(null,{stack:s,id:a,glyph:v.glyphs[a]||null})})},(s,a)=>{if(s)r(s);else if(a){const c={};for(const{stack:h,id:d,glyph:m}of a)c[h]===void 0&&(c[h]={}),c[h].glyphs===void 0&&(c[h].glyphs={}),c[h].glyphs[d]=m&&{id:m.id,bitmap:m.bitmap.clone(),metrics:m.metrics},c[h].ascender=this.entries[h].ascender,c[h].descender=this.entries[h].descender;r(null,c)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==0&&(this.localGlyphMode===2?!!this.localFontFamily:!!this.localFontFamily&&(ee["CJK Unified Ideographs"](t)||ee["Hangul Syllables"](t)||ee.Hiragana(t)||ee.Katakana(t)||ee["CJK Symbols and Punctuation"](t)||ee["CJK Unified Ideographs Extension A"](t)||ee["CJK Unified Ideographs Extension B"](t)))}_tinySDF(t,n,r){const i=this.localFontFamily;if(!i||!this._doesCharSupportLocalGlyph(r))return;let o=t.tinySDF;if(!o){let w="400";/bold/i.test(n)?w="900":/medium/i.test(n)?w="500":/light/i.test(n)&&(w="200"),o=t.tinySDF=new _d.TinySDF({fontFamily:i,fontWeight:w,fontSize:24*ga,buffer:3*ga,radius:8*ga}),o.fontWeight=w}if(this.localGlyphs[o.fontWeight][r])return this.localGlyphs[o.fontWeight][r];const s=String.fromCodePoint(r),{data:a,width:c,height:h,glyphWidth:d,glyphHeight:m,glyphLeft:g,glyphTop:x,glyphAdvance:v}=o.draw(s);return this.localGlyphs[o.fontWeight][r]={id:r,bitmap:new da({width:c,height:h},a),metrics:{width:d/ga,height:m/ga,left:g/ga,top:x/ga-27,advance:v/ga,localGlyph:!0}}}}_d.loadGlyphRange=function(e,t,n,r,i){const o=256*t,s=o+255,a=r.transformRequest(r.normalizeGlyphsURL(n).replace("{fontstack}",e).replace("{range}",`${o}-${s}`),At.Glyphs);Kt(a,(c,h)=>{if(c)i(c);else if(h){const d={},m=function(g){return new w1(g).readFields(CP,{})}(h);for(const g of m.glyphs)d[g.id]=g;i(null,{glyphs:d,ascender:m.ascender,descender:m.descender})}})},_d.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:n=8,cutoff:r=.25,fontFamily:i="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}={}){this.buffer=t,this.cutoff=r,this.radius=n;const a=this.size=e+4*t,c=this._createCanvas(a),h=this.ctx=c.getContext("2d",{willReadFrequently:!0});h.font=`${s} ${o} ${e}px ${i}`,h.textBaseline="alphabetic",h.textAlign="left",h.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:r,actualBoundingBoxLeft:i,actualBoundingBoxRight:o}=this.ctx.measureText(e),s=Math.ceil(n),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-i))),c=Math.min(this.size-this.buffer,s+Math.ceil(r)),h=a+2*this.buffer,d=c+2*this.buffer,m=Math.max(h*d,0),g=new Uint8ClampedArray(m),x={data:g,width:h,height:d,glyphWidth:a,glyphHeight:c,glyphTop:s,glyphLeft:0,glyphAdvance:t};if(a===0||c===0)return x;const{ctx:v,buffer:w,gridInner:A,gridOuter:E}=this;v.clearRect(w,w,a,c),v.fillText(e,w,w+s);const S=v.getImageData(w,w,a,c);E.fill(gg,0,m),A.fill(0,0,m);for(let I=0;I<c;I++)for(let B=0;B<a;B++){const M=S.data[4*(I*a+B)+3]/255;if(M===0)continue;const D=(I+w)*h+B+w;if(M===1)E[D]=0,A[D]=gg;else{const R=.5-M;E[D]=R>0?R*R:0,A[D]=R<0?R*R:0}}SC(E,0,0,h,d,h,this.f,this.v,this.z),SC(A,w,w,a,c,h,this.f,this.v,this.z);for(let I=0;I<m;I++){const B=Math.sqrt(E[I])-Math.sqrt(A[I]);g[I]=Math.round(255-255*(B/this.radius+this.cutoff))}return x}};const Yu=jo;function IC(e,t,n,r){const i=[],o=e.imagePrimary,s=o.pixelRatio,a=o.paddedRect.w-2*Yu,c=o.paddedRect.h-2*Yu,h=e.right-e.left,d=e.bottom-e.top,m=o.stretchX||[[0,a]],g=o.stretchY||[[0,c]],x=(j,H)=>j+H[1]-H[0],v=m.reduce(x,0),w=g.reduce(x,0),A=a-v,E=c-w;let S=0,I=v,B=0,M=w,D=0,R=A,z=0,N=E;if(o.content&&r){const j=o.content;S=T1(m,0,j[0]),B=T1(g,0,j[1]),I=T1(m,j[0],j[2]),M=T1(g,j[1],j[3]),D=j[0]-S,z=j[1]-B,R=j[2]-j[0]-I,N=j[3]-j[1]-M}const V=(j,H,$,G)=>{const Q=C1(j.stretch-S,I,h,e.left),et=S1(j.fixed-D,R,j.stretch,v),st=C1(H.stretch-B,M,d,e.top),Y=S1(H.fixed-z,N,H.stretch,w),tt=C1($.stretch-S,I,h,e.left),ct=S1($.fixed-D,R,$.stretch,v),pt=C1(G.stretch-B,M,d,e.top),dt=S1(G.fixed-z,N,G.stretch,w),wt=new nt(Q,st),bt=new nt(tt,st),Et=new nt(tt,pt),_t=new nt(Q,pt),Mt=new nt(et/s,Y/s),qt=new nt(ct/s,dt/s),Jt=t*Math.PI/180;if(Jt){const rn=Math.sin(Jt),Le=Math.cos(Jt),Se=[Le,-rn,rn,Le];wt._matMult(Se),bt._matMult(Se),_t._matMult(Se),Et._matMult(Se)}const ne=j.stretch+j.fixed,se=$.stretch+$.fixed,Pe=H.stretch+H.fixed,pe=G.stretch+G.fixed,pn=e.imageSecondary;return{tl:wt,tr:bt,bl:_t,br:Et,texPrimary:{x:o.paddedRect.x+Yu+ne,y:o.paddedRect.y+Yu+Pe,w:se-ne,h:pe-Pe},texSecondary:pn?{x:pn.paddedRect.x+Yu+ne,y:pn.paddedRect.y+Yu+Pe,w:se-ne,h:pe-Pe}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Mt,pixelOffsetBR:qt,minFontScaleX:R/s/h,minFontScaleY:N/s/d,isSDF:n}};if(r&&(o.stretchX||o.stretchY)){const j=BC(m,A,v),H=BC(g,E,w);for(let $=0;$<j.length-1;$++){const G=j[$],Q=j[$+1];for(let et=0;et<H.length-1;et++)i.push(V(G,H[et],Q,H[et+1]))}}else i.push(V({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:a+1},{fixed:0,stretch:c+1}));return i}function T1(e,t,n){let r=0;for(const i of e)r+=Math.max(t,Math.min(n,i[1]))-Math.max(t,Math.min(n,i[0]));return r}function BC(e,t,n){const r=[{fixed:-Yu,stretch:0}];for(const[i,o]of e){const s=r[r.length-1];r.push({fixed:i-s.stretch,stretch:s.stretch}),r.push({fixed:i-s.stretch,stretch:s.stretch+(o-i)})}return r.push({fixed:t+Yu,stretch:n}),r}function C1(e,t,n,r){return e/t*n+r}function S1(e,t,n,r){return e-t*n/r}function RP(e,t,n,r){const i=t+e.positionedLines[r].lineOffset;return r===0?n+i/2:n+(i+(t+e.positionedLines[r-1].lineOffset))/2}function kP(e,t=1,n=!1){let r=1/0,i=1/0,o=-1/0,s=-1/0;const a=e[0];for(let x=0;x<a.length;x++){const v=a[x];(!x||v.x<r)&&(r=v.x),(!x||v.y<i)&&(i=v.y),(!x||v.x>o)&&(o=v.x),(!x||v.y>s)&&(s=v.y)}const c=Math.min(o-r,s-i);let h=c/2;const d=new Dp([],FP);if(c===0)return new nt(r,i);for(let x=r;x<o;x+=c)for(let v=i;v<s;v+=c)d.push(new yd(x+h,v+h,h,e));let m=function(x){let v=0,w=0,A=0;const E=x[0];for(let S=0,I=E.length,B=I-1;S<I;B=S++){const M=E[S],D=E[B],R=M.x*D.y-D.x*M.y;w+=(M.x+D.x)*R,A+=(M.y+D.y)*R,v+=3*R}return new yd(w/v,A/v,0,x)}(e),g=d.length;for(;d.length;){const x=d.pop();(x.d>m.d||!m.d)&&(m=x,n&&console.log("found best %d after %d probes",Math.round(1e4*x.d)/1e4,g)),x.max-m.d<=t||(h=x.h/2,d.push(new yd(x.p.x-h,x.p.y-h,h,e)),d.push(new yd(x.p.x+h,x.p.y-h,h,e)),d.push(new yd(x.p.x-h,x.p.y+h,h,e)),d.push(new yd(x.p.x+h,x.p.y+h,h,e)),g+=4)}return n&&(console.log(`num probes: ${g}`),console.log(`best distance: ${m.d}`)),m.p}function FP(e,t){return t.max-e.max}class yd{constructor(t,n,r,i){this.p=new nt(t,n),this.h=r,this.d=function(o,s){let a=!1,c=1/0;for(let h=0;h<s.length;h++){const d=s[h];for(let m=0,g=d.length,x=g-1;m<g;x=m++){const v=d[m],w=d[x];v.y>o.y!=w.y>o.y&&o.x<(w.x-v.x)*(o.y-v.y)/(w.y-v.y)+v.x&&(a=!a),c=Math.min(c,n1(o,v,w))}}return(a?1:-1)*Math.sqrt(c)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}}const xd=7,wb=Number.POSITIVE_INFINITY,zP=Math.sqrt(2);function bb(e,[t,n]){let r=0,i=0;if(n===wb){t<0&&(t=0);const o=t/zP;switch(e){case"top-right":case"top-left":i=o-xd;break;case"bottom-right":case"bottom-left":i=-o+xd;break;case"bottom":i=-t+xd;break;case"top":i=t-xd}switch(e){case"top-right":case"bottom-right":r=-o;break;case"top-left":case"bottom-left":r=o;break;case"left":r=t;break;case"right":r=-t}}else{switch(t=Math.abs(t),n=Math.abs(n),e){case"top-right":case"top-left":case"top":i=n-xd;break;case"bottom-right":case"bottom-left":case"bottom":i=-n+xd}switch(e){case"top-right":case"bottom-right":case"right":r=-t;break;case"top-left":case"bottom-left":case"left":r=t}}return[r,i]}function OP(e,t,n,r,i,o,s,a,c,h,d){e.createArrays(),e.tilePixelRatio=gt/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const m=e.layers[0].layout,g=e.layers[0]._unevaluatedLayout._values,x={};if(e.textSizeData.kind==="composite"){const{minZoom:E,maxZoom:S}=e.textSizeData;x.compositeTextSizes=[g["text-size"].possiblyEvaluate(new rr(E),a),g["text-size"].possiblyEvaluate(new rr(S),a)]}if(e.iconSizeData.kind==="composite"){const{minZoom:E,maxZoom:S}=e.iconSizeData;x.compositeIconSizes=[g["icon-size"].possiblyEvaluate(new rr(E),a),g["icon-size"].possiblyEvaluate(new rr(S),a)]}x.layoutTextSize=g["text-size"].possiblyEvaluate(new rr(c+1),a),x.layoutIconSize=g["icon-size"].possiblyEvaluate(new rr(c+1),a),x.textMaxSize=g["text-size"].possiblyEvaluate(new rr(18),a);const v=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point",w=m.get("text-size");let A=!1;for(const E of e.features)if(E.icon&&E.icon.nameSecondary){A=!0;break}for(const E of e.features){const S=m.get("text-font").evaluate(E,{},a).join(","),I=w.evaluate(E,{},a),B=x.layoutTextSize.evaluate(E,{},a),M=(x.layoutIconSize.evaluate(E,{},a),{horizontal:{},vertical:void 0}),D=E.text;let R,z=[0,0];if(D){const j=D.toString(),H=m.get("text-letter-spacing").evaluate(E,{},a)*li,$=m.get("text-line-height").evaluate(E,{},a)*li,G=om(j)?H:0,Q=m.get("text-anchor").evaluate(E,{},a),et=m.get("text-variable-anchor");if(!et){const pt=m.get("text-radial-offset").evaluate(E,{},a);z=pt?bb(Q,[pt*li,wb]):m.get("text-offset").evaluate(E,{},a).map(dt=>dt*li)}let st=v?"center":m.get("text-justify").evaluate(E,{},a);const Y=m.get("symbol-placement")==="point",tt=Y?m.get("text-max-width").evaluate(E,{},a)*li:1/0,ct=pt=>{e.allowVerticalPlacement&&bs(j)&&(M.vertical=yb(D,t,n,i,S,tt,$,Q,pt,G,z,fr.vertical,!0,B,I))};if(!v&&et){const pt=st==="auto"?et.map(wt=>Ab(wt)):[st];let dt=!1;for(let wt=0;wt<pt.length;wt++){const bt=pt[wt];if(!M.horizontal[bt])if(dt)M.horizontal[bt]=M.horizontal[0];else{const Et=yb(D,t,n,i,S,tt,$,"center",bt,G,z,fr.horizontal,!1,B,I);Et&&(M.horizontal[bt]=Et,dt=Et.positionedLines.length===1)}}ct("left")}else{if(st==="auto"&&(st=Ab(Q)),Y||m.get("text-writing-mode").indexOf("horizontal")>=0||!bs(j)){const pt=yb(D,t,n,i,S,tt,$,Q,st,G,z,fr.horizontal,!1,B,I);pt&&(M.horizontal[st]=pt)}ct(Y?"left":st)}}let N=!1;if(E.icon&&E.icon.namePrimary){const j=r[E.icon.namePrimary];j&&(R=DP(i[E.icon.namePrimary],E.icon.nameSecondary?i[E.icon.nameSecondary]:void 0,m.get("icon-offset").evaluate(E,{},a),m.get("icon-anchor").evaluate(E,{},a)),N=j.sdf,e.sdfIcons===void 0?e.sdfIcons=j.sdf:e.sdfIcons!==j.sdf&&rt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(j.pixelRatio!==e.pixelRatio||m.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}const V=PC(M.horizontal)||M.vertical;e.iconsInText||(e.iconsInText=!!V&&V.iconsInText),(V||R)&&NP(e,E,M,R,r,x,B,0,z,N,s,a,h,d,A)}o&&e.generateCollisionDebugBuffers(c,e.collisionBoxArray)}function Ab(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function NP(e,t,n,r,i,o,s,a,c,h,d,m,g,x,v){let w=o.textMaxSize.evaluate(t,{},m);w===void 0&&(w=s);const A=e.layers[0].layout,E=A.get("icon-offset").evaluate(t,{},m),S=PC(n.horizontal)||n.vertical,I=g.name==="globe",B=li,M=s/B,D=e.tilePixelRatio*w/B,R=(Q=e.overscaling,e.zoom>18&&Q>2&&(Q>>=1),Math.max(gt/(512*Q),1)*A.get("symbol-spacing")),z=A.get("text-padding")*e.tilePixelRatio,N=A.get("icon-padding")*e.tilePixelRatio,V=Ae(A.get("text-max-angle")),j=A.get("text-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",H=A.get("icon-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",$=A.get("symbol-placement"),G=R/2;var Q;const et=A.get("icon-text-fit").evaluate(t,{},m),st=A.get("icon-text-fit-padding").evaluate(t,{},m),Y=et!=="none";let tt;e.hasAnyIconTextFit===!1&&Y&&(e.hasAnyIconTextFit=!0),r&&Y&&(e.allowVerticalPlacement&&n.vertical&&(tt=xC(r,n.vertical,et,st,E,M)),S&&(r=xC(r,S,et,st,E,M)));const ct=(pt,dt,wt)=>{if(dt.x<0||dt.x>=gt||dt.y<0||dt.y>=gt)return;let bt=null;if(I){const{x:Et,y:_t,z:Mt}=g.projectTilePoint(dt.x,dt.y,wt);bt={anchor:new ql(Et,_t,Mt,0,void 0),up:g.upVector(wt,dt.x,dt.y)}}(function(Et,_t,Mt,qt,Jt,ne,se,Pe,pe,pn,rn,Le,Se,_e,ln,cn,Je,Gn,Tr,On,Xn,Dr,Cr,or,kn,mi,rl){const Jl=Et.addToLineVertexArray(_t,qt);let $l,Og,Ng,bx,OI,NI,UI,VI=0,GI=0,jI=0,HI=0,AA=-1,EA=-1;const il={};let ZI=Ol("");const Ph=Mt?Mt.anchor:_t,TA=pe.layout.get("icon-text-fit").evaluate(Xn,{},kn)!=="none";let CA=0,SA=0;if(pe._unevaluatedLayout.getValue("text-radial-offset")===void 0?[CA,SA]=pe.layout.get("text-offset").evaluate(Xn,{},kn).map(Zo=>Zo*li):(CA=pe.layout.get("text-radial-offset").evaluate(Xn,{},kn)*li,SA=wb),Et.allowVerticalPlacement&&Jt.vertical){const Zo=Jt.vertical;if(ln)NI=Eb(Zo),Pe&&(UI=Eb(Pe));else{const Wo=pe.layout.get("text-rotate").evaluate(Xn,{},kn)+90;Ng=M1(pn,Ph,_t,rn,Le,Se,Zo,_e,Wo,cn),Pe&&(bx=M1(pn,Ph,_t,rn,Le,Se,Pe,Gn,Wo))}}if(ne){const Zo=pe.layout.get("icon-rotate").evaluate(Xn,{},kn),Wo=IC(ne,Zo,Cr,TA),Bd=Pe?IC(Pe,Zo,Cr,TA):void 0;Og=M1(pn,Ph,_t,rn,Le,Se,ne,Gn,Zo),VI=4*Wo.length;const WI=Et.iconSizeData;let Lh=null;WI.kind==="source"?(Lh=[ma*pe.layout.get("icon-size").evaluate(Xn,{},kn)],Lh[0]>Qu&&rt(`${Et.layerIds[0]}: Value for "icon-size" is >= ${_g}. Reduce your "icon-size".`)):WI.kind==="composite"&&(Lh=[ma*Dr.compositeIconSizes[0].evaluate(Xn,{},kn),ma*Dr.compositeIconSizes[1].evaluate(Xn,{},kn)],(Lh[0]>Qu||Lh[1]>Qu)&&rt(`${Et.layerIds[0]}: Value for "icon-size" is >= ${_g}. Reduce your "icon-size".`)),Et.addSymbols(Et.icon,Wo,Lh,On,Tr,Xn,!1,Mt,_t,Jl.lineStartIndex,Jl.lineLength,-1,or,kn,mi,rl),AA=Et.icon.placedSymbolArray.length-1,Bd&&(GI=4*Bd.length,Et.addSymbols(Et.icon,Bd,Lh,On,Tr,Xn,fr.vertical,Mt,_t,Jl.lineStartIndex,Jl.lineLength,-1,or,kn,mi,rl),EA=Et.icon.placedSymbolArray.length-1)}for(const Zo in Jt.horizontal){const Wo=Jt.horizontal[Zo];$l||(ZI=Ol(Wo.text),ln?OI=Eb(Wo):$l=M1(pn,Ph,_t,rn,Le,Se,Wo,_e,pe.layout.get("text-rotate").evaluate(Xn,{},kn),cn));const Bd=Wo.positionedLines.length===1;if(jI+=DC(Et,Mt,_t,Wo,se,pe,ln,Xn,cn,Jl,Jt.vertical?fr.horizontal:fr.horizontalOnly,Bd?Object.keys(Jt.horizontal):[Zo],il,AA,Dr,or,kn,mi),Bd)break}Jt.vertical&&(HI+=DC(Et,Mt,_t,Jt.vertical,se,pe,ln,Xn,cn,Jl,fr.vertical,["vertical"],il,EA,Dr,or,kn,mi));let ac=-1;const MA=(Zo,Wo)=>Zo?Math.max(Zo,Wo):Wo;ac=MA(OI,ac),ac=MA(NI,ac),ac=MA(UI,ac);const Az=ac>-1?1:0;Et.glyphOffsetArray.length>=bg.MAX_GLYPHS&&rt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Xn.sortKey!==void 0&&Et.addToSortKeyRanges(Et.symbolInstances.length,Xn.sortKey),Et.symbolInstances.emplaceBack(_t.x,_t.y,Ph.x,Ph.y,Ph.z,il.right>=0?il.right:-1,il.center>=0?il.center:-1,il.left>=0?il.left:-1,il.vertical>=0?il.vertical:-1,AA,EA,ZI,$l!==void 0?$l:Et.collisionBoxArray.length,$l!==void 0?$l+1:Et.collisionBoxArray.length,Ng!==void 0?Ng:Et.collisionBoxArray.length,Ng!==void 0?Ng+1:Et.collisionBoxArray.length,Og!==void 0?Og:Et.collisionBoxArray.length,Og!==void 0?Og+1:Et.collisionBoxArray.length,bx||Et.collisionBoxArray.length,bx?bx+1:Et.collisionBoxArray.length,rn,jI,HI,VI,GI,Az,0,CA,SA,ac,0,TA?1:0)})(e,dt,bt,pt,n,r,i,tt,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,z,j,c,0,N,H,E,t,o,h,d,m,x,v)};if($==="line")for(const pt of TC(t.geometry,0,0,gt,gt)){const dt=LP(pt,R,V,n.vertical||S,r,B,D,e.overscaling,gt);for(const wt of dt)S&&UP(e,S.text,G,wt)||ct(pt,wt,m)}else if($==="line-center"){for(const pt of t.geometry)if(pt.length>1){const dt=PP(pt,V,n.vertical||S,r,B,D);dt&&ct(pt,dt,m)}}else if(t.type==="Polygon")for(const pt of Dn(t.geometry,0)){const dt=kP(pt,16);ct(pt[0],new ql(dt.x,dt.y,0,0,void 0),m)}else if(t.type==="LineString")for(const pt of t.geometry)ct(pt,new ql(pt[0].x,pt[0].y,0,0,void 0),m);else if(t.type==="Point")for(const pt of t.geometry)for(const dt of pt)ct([dt],new ql(dt.x,dt.y,0,0,void 0),m)}const _g=255,Qu=_g*ma;function DC(e,t,n,r,i,o,s,a,c,h,d,m,g,x,v,w,A,E){const S=function(M,D,R,z,N,V,j,H){const $=[];if(D.positionedLines.length===0)return $;const G=z.layout.get("text-rotate").evaluate(V,{})*Math.PI/180,Q=function(ct){const pt=ct[0],dt=ct[1],wt=pt*dt;return wt>0?[pt,-dt]:wt<0?[-pt,dt]:pt===0?[dt,pt]:[dt,-pt]}(R);let et=Math.abs(D.top-D.bottom);for(const ct of D.positionedLines)et-=ct.lineOffset;const st=D.positionedLines.length,Y=et/st;let tt=D.top-R[1];for(let ct=0;ct<st;++ct){const pt=D.positionedLines[ct];tt=RP(D,Y,tt,ct);for(const dt of pt.positionedGlyphs){if(!dt.rect)continue;const wt=dt.rect||{};let bt=fC+1,Et=!0,_t=1,Mt=0;if(dt.imageName){const On=j[dt.imageName];if(!On)continue;if(On.sdf){rt("SDF images are not supported in formatted text and will be ignored.");continue}Et=!1,_t=On.pixelRatio,bt=jo/_t}const qt=(N||H)&&dt.vertical,Jt=dt.metrics.advance*dt.scale/2,ne=dt.metrics,se=dt.rect;if(se===null)continue;H&&D.verticalizable&&(Mt=dt.imageName?Jt-dt.metrics.width*dt.scale/2:0);const Pe=N?[dt.x+Jt,dt.y]:[0,0];let pe=[0,0],pn=[0,0],rn=!1;N||(qt?(pn=[dt.x+Jt+Q[0],dt.y+Q[1]-Mt],rn=!0):pe=[dt.x+Jt+R[0],dt.y+R[1]-Mt]);const Le=se.w*dt.scale/(_t*(dt.localGlyph?ga:1)),Se=se.h*dt.scale/(_t*(dt.localGlyph?ga:1));let _e,ln,cn,Je;if(qt){const On=dt.y-tt,Xn=new nt(-Jt,Jt-On),Dr=-Math.PI/2,Cr=new nt(...pn);_e=new nt(-Jt+pe[0],pe[1]),_e._rotateAround(Dr,Xn)._add(Cr),_e.x+=-On+Jt,_e.y-=(ne.left-bt)*dt.scale;const or=dt.imageName?ne.advance*dt.scale:li*dt.scale,kn=String.fromCodePoint(dt.glyph);EP(kn)?_e.x+=(1-bt)*dt.scale:TP(kn)?_e.x+=or-ne.height*dt.scale+(-bt-1)*dt.scale:_e.x+=dt.imageName||ne.width+2*bt===se.w&&ne.height+2*bt===se.h?(or-Se)/2:(or-(ne.height+2*bt)*dt.scale)/2,ln=new nt(_e.x,_e.y-Le),cn=new nt(_e.x+Se,_e.y),Je=new nt(_e.x+Se,_e.y-Le)}else{const On=(ne.left-bt)*dt.scale-Jt+pe[0],Xn=(-ne.top-bt)*dt.scale+pe[1],Dr=On+Le,Cr=Xn+Se;_e=new nt(On,Xn),ln=new nt(Dr,Xn),cn=new nt(On,Cr),Je=new nt(Dr,Cr)}if(G){let On;On=N?new nt(0,0):rn?new nt(Q[0],Q[1]):new nt(R[0],R[1]),_e._rotateAround(G,On),ln._rotateAround(G,On),cn._rotateAround(G,On),Je._rotateAround(G,On)}const Gn=new nt(0,0),Tr=new nt(0,0);$.push({tl:_e,tr:ln,bl:cn,br:Je,texPrimary:wt,texSecondary:void 0,writingMode:D.writingMode,glyphOffset:Pe,sectionIndex:dt.sectionIndex,isSDF:Et,pixelOffsetTL:Gn,pixelOffsetBR:Tr,minFontScaleX:0,minFontScaleY:0})}}return $}(0,r,c,o,s,a,i,e.allowVerticalPlacement),I=e.textSizeData;let B=null;I.kind==="source"?(B=[ma*o.layout.get("text-size").evaluate(a,{},A)],B[0]>Qu&&rt(`${e.layerIds[0]}: Value for "text-size" is >= ${_g}. Reduce your "text-size".`)):I.kind==="composite"&&(B=[ma*v.compositeTextSizes[0].evaluate(a,{},A),ma*v.compositeTextSizes[1].evaluate(a,{},A)],(B[0]>Qu||B[1]>Qu)&&rt(`${e.layerIds[0]}: Value for "text-size" is >= ${_g}. Reduce your "text-size".`)),e.addSymbols(e.text,S,B,c,s,a,d,t,n,h.lineStartIndex,h.lineLength,x,w,A,E,!1);for(const M of m)g[M]=e.text.placedSymbolArray.length-1;return 4*S.length}function PC(e){for(const t in e)return e[t];return null}function M1(e,t,n,r,i,o,s,a,c,h){let d=s.top,m=s.bottom,g=s.left,x=s.right;const v=s.collisionPadding;if(v&&(g-=v[0],d-=v[1],x+=v[2],m+=v[3]),c){const w=new nt(g,d),A=new nt(x,d),E=new nt(g,m),S=new nt(x,m),I=Ae(c);let B=new nt(0,0);h&&(B=new nt(h[0],h[1])),w._rotateAround(I,B),A._rotateAround(I,B),E._rotateAround(I,B),S._rotateAround(I,B),g=Math.min(w.x,A.x,E.x,S.x),x=Math.max(w.x,A.x,E.x,S.x),d=Math.min(w.y,A.y,E.y,S.y),m=Math.max(w.y,A.y,E.y,S.y)}return e.emplaceBack(t.x,t.y,t.z,n.x,n.y,g,d,x,m,a,r,i,o),e.length-1}function Eb(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function UP(e,t,n,r){const i=e.compareText;if(t in i){const o=i[t];for(let s=o.length-1;s>=0;s--)if(r.dist(o[s])<n)return!0}else i[t]=[];return i[t].push(r),!1}function LC(e,t){const n=e.fovAboveCenter,r=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,i=(e._camera.position[2]*e.worldSize-r)/Math.cos(e._pitch),o=Math.sin(n)*i/Math.sin(Math.max(Math.PI/2-e._pitch-n,.01)),s=Math.sin(e._pitch)*o+i;return Math.min(1.01*s,i*(1/e._horizonShift))}function Eh(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const n=Math.pow(2,-e.z),r=e.x*n,i=(e.x+1)*n,o=e.y*n,s=(e.y+1)*n,a=uo(r),c=uo(i),h=Br(o),d=Br(s),m=t.project(a,h),g=t.project(c,h),x=t.project(c,d),v=t.project(a,d);let w=Math.min(m.x,g.x,x.x,v.x),A=Math.min(m.y,g.y,x.y,v.y),E=Math.max(m.x,g.x,x.x,v.x),S=Math.max(m.y,g.y,x.y,v.y);const I=n/16;function B(D,R,z,N,V,j){const H=(z+V)/2,$=(N+j)/2,G=t.project(uo(H),Br($)),Q=Math.max(0,w-G.x,A-G.y,G.x-E,G.y-S);w=Math.min(w,G.x),E=Math.max(E,G.x),A=Math.min(A,G.y),S=Math.max(S,G.y),Q>I&&(B(D,G,z,N,H,$),B(G,R,H,$,V,j))}B(m,g,r,o,i,o),B(g,x,i,o,i,s),B(x,v,i,s,r,s),B(v,m,r,s,r,o),w-=I,A-=I,E+=I,S+=I;const M=1/Math.max(E-w,S-A);return{scale:M,x:w*M,y:A*M,x2:E*M,y2:S*M,projection:t}}function RC(e,t,n,r,i,o,s,a,c){if(c.name==="globe")return Ym(e,t,new Xi(n,r,i),!1);const h=Eh({z:n,x:r,y:i},c);return new yn([(o+h.x/h.scale)*t,t*(h.y/h.scale),s],[(o+h.x2/h.scale)*t,t*(h.y2/h.scale),a])}function kC(e,{x:t,y:n},r=0){return new nt(((t-r)*e.scale-e.x)*gt,(n*e.scale-e.y)*gt)}function FC(e,t,n=0){return J.fromValues(((t.x-n)*e.scale-e.x)*gt,(t.y*e.scale-e.y)*gt,$y(t.z,t.y))}const VP=lt.identity(new Float32Array(16));class tc{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,n){return{x:0,y:0,z:0}}unproject(t,n){return new Be(0,0)}projectTilePoint(t,n,r){return{x:t,y:n,z:0}}locationPoint(t,n,r=!0){return t._coordinatePoint(t.locationCoordinate(n),r)}pixelsPerMeter(t,n){return Rn(1,t)*n}pixelSpaceConversion(t,n,r){return 1}farthestPixelDistance(t){return LC(t,t.pixelsPerMeter)}pointCoordinate(t,n,r,i){const o=t.horizonLineFromTop(!1),s=new nt(n,Math.max(o,r));return t.rayIntersectionCoordinate(t.pointRayIntersection(s,i))}pointCoordinate3D(t,n,r){const i=new nt(n,r);if(t.elevation)return t.elevation.pointCoordinate(i);{const o=this.pointCoordinate(t,i.x,i.y,0);return[o.x,o.y,o.z]}}isPointAboveHorizon(t,n){if(t.elevation)return!this.pointCoordinate3D(t,n.x,n.y);const r=t.horizonLineFromTop();return n.y<r}createInversionMatrix(t,n){return VP}createTileMatrix(t,n,r){let i,o,s;const a=r.canonical,c=lt.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const h=Eh(a,this);i=1,o=h.x+r.wrap*h.scale,s=h.y,lt.scale(c,c,[i/h.scale,i/h.scale,t.pixelsPerMeter/n])}else i=n/t.zoomScale(a.z),o=(a.x+Math.pow(2,a.z)*r.wrap)*i,s=a.y*i;return lt.translate(c,c,[o,s,0]),lt.scale(c,c,[i/gt,i/gt,1]),c}upVector(t,n,r){return[0,0,1]}upVectorScale(t,n,r){return{metersToTile:1}}}class GP extends tc{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[n,r]=this.parallels=t.parallels||[29.5,45.5],i=Math.sin(Ae(n));this.n=(i+Math.sin(Ae(r)))/2,this.c=1+i*(2*this.n-i),this.r0=Math.sqrt(this.c)/this.n}project(t,n){const{n:r,c:i,r0:o}=this,s=Ae(t-this.center[0]),a=Ae(n),c=Math.sqrt(i-2*r*Math.sin(a))/r;return{x:c*Math.sin(s*r),y:c*Math.cos(s*r)-o,z:0}}unproject(t,n){const{n:r,c:i,r0:o}=this,s=o+n;let a=Math.atan2(t,Math.abs(s))*Math.sign(s);s*r<0&&(a-=Math.PI*Math.sign(t)*Math.sign(s));const c=Ae(this.center[0])*r;a=ci(a,-Math.PI-c,Math.PI-c);const h=$t(dr(a/r)+this.center[0],-180,180),d=Math.asin($t((i-(t*t+s*s)*r*r)/(2*r),-1,1)),m=$t(dr(d),-xr,xr);return new Be(h,m)}}const yg=1.340264,xg=-.081106,vg=893e-6,wg=.003796,I1=Math.sqrt(3)/2;class jP extends tc{project(t,n){n=n/180*Math.PI,t=t/180*Math.PI;const r=Math.asin(I1*Math.sin(n)),i=r*r,o=i*i*i;return{x:.5*(t*Math.cos(r)/(I1*(yg+3*xg*i+o*(7*vg+9*wg*i)))/Math.PI+.5),y:1-.5*(r*(yg+xg*i+o*(vg+wg*i))/Math.PI+1),z:0}}unproject(t,n){t=(2*t-.5)*Math.PI;let r=n=(2*(1-n)-1)*Math.PI,i=r*r,o=i*i*i;for(let d,m,g,x=0;x<12&&(m=r*(yg+xg*i+o*(vg+wg*i))-n,g=yg+3*xg*i+o*(7*vg+9*wg*i),d=m/g,r=$t(r-d,-Math.PI/3,Math.PI/3),i=r*r,o=i*i*i,!(Math.abs(d)<1e-12));++x);const s=I1*t*(yg+3*xg*i+o*(7*vg+9*wg*i))/Math.cos(r),a=Math.asin(Math.sin(r)/I1),c=$t(180*s/Math.PI,-180,180),h=$t(180*a/Math.PI,-xr,xr);return new Be(c,h)}}class HP extends tc{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,n){return{x:.5+t/360,y:.5-n/360,z:0}}unproject(t,n){const r=360*(t-.5),i=$t(360*(.5-n),-xr,xr);return new Be(r,i)}}const vd=Math.PI/2;function B1(e){return Math.tan((vd+e)/2)}class ZP extends tc{constructor(t){super(t),this.center=t.center||[0,30];const[n,r]=this.parallels=t.parallels||[30,30];let i=Ae(n),o=Ae(r);this.southernCenter=i+o<0,this.southernCenter&&(i=-i,o=-o);const s=Math.cos(i),a=B1(i);this.n=i===o?Math.sin(i):Math.log(s/Math.cos(o))/Math.log(B1(o)/a),this.f=s*Math.pow(B1(i),this.n)/this.n}project(t,n){n=Ae(n),this.southernCenter&&(n=-n),t=Ae(t-this.center[0]);const r=1e-6,{n:i,f:o}=this;o>0?n<-vd+r&&(n=-vd+r):n>vd-r&&(n=vd-r);const s=o/Math.pow(B1(n),i);let a=s*Math.sin(i*t),c=o-s*Math.cos(i*t);return a=.5*(a/Math.PI+.5),c=.5*(c/Math.PI+.5),{x:a,y:this.southernCenter?c:1-c,z:0}}unproject(t,n){t=(2*t-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:r,f:i}=this,o=i-n,s=Math.sign(o),a=Math.sign(r)*Math.sqrt(t*t+o*o);let c=Math.atan2(t,Math.abs(o))*s;o*r<0&&(c-=Math.PI*Math.sign(t)*s);const h=$t(dr(c/r)+this.center[0],-180,180),d=$t(dr(2*Math.atan(Math.pow(i/a,1/r))-vd),-xr,xr);return new Be(h,this.southernCenter?-d:d)}}class zC extends tc{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,n){return{x:Ir(t),y:Fr(n),z:0}}unproject(t,n){const r=uo(t),i=Br(n);return new Be(r,i)}}const OC=Ae(xr);class WP extends tc{project(t,n){const r=(n=Ae(n))*n,i=r*r;return{x:.5*((t=Ae(t))*(.8707-.131979*r+i*(i*(.003971*r-.001529*i)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+r*(.015085+i*(.028874*r-.044475-.005916*i)))/Math.PI+1),z:0}}unproject(t,n){t=(2*t-.5)*Math.PI;let r=n=(2*(1-n)-1)*Math.PI,i=25,o=0,s=r*r;do{s=r*r;const h=s*s;o=(r*(1.007226+s*(.015085+h*(.028874*s-.044475-.005916*h)))-n)/(1.007226+s*(.045255+h*(.259866*s-.311325-.005916*11*h))),r=$t(r-o,-OC,OC)}while(Math.abs(o)>1e-6&&--i>0);s=r*r;const a=$t(dr(t/(.8707+s*(s*(s*s*s*(.003971-.001529*s)-.013791)-.131979))),-180,180),c=dr(r);return new Be(a,c)}}const NC=Ae(xr);class qP extends tc{project(t,n){n=Ae(n),t=Ae(t);const r=Math.cos(n),i=2/Math.PI,o=Math.acos(r*Math.cos(t/2)),s=Math.sin(o)/o,a=.5*(t*i+2*r*Math.sin(t/2)/s)||0,c=.5*(n+Math.sin(n)/s)||0;return{x:.5*(a/Math.PI+.5),y:1-.5*(c/Math.PI+1),z:0}}unproject(t,n){let r=t=(2*t-.5)*Math.PI,i=n=(2*(1-n)-1)*Math.PI,o=25;const s=1e-6;let a=0,c=0;do{const h=Math.cos(i),d=Math.sin(i),m=2*d*h,g=d*d,x=h*h,v=Math.cos(r/2),w=Math.sin(r/2),A=2*v*w,E=w*w,S=1-x*v*v,I=S?1/S:0,B=S?Math.acos(h*v)*Math.sqrt(1/S):0,M=.5*(2*B*h*w+2*r/Math.PI)-t,D=.5*(B*d+i)-n,R=.5*I*(x*E+B*h*v*g)+1/Math.PI,z=I*(A*m/4-B*d*w),N=.125*I*(m*w-B*d*x*A),V=.5*I*(g*v+B*E*h)+.5,j=z*N-V*R;a=(D*z-M*V)/j,c=(M*N-D*R)/j,r=$t(r-a,-Math.PI,Math.PI),i=$t(i-c,-NC,NC)}while((Math.abs(a)>s||Math.abs(c)>s)&&--o>0);return new Be(dr(r),dr(i))}}class UC extends tc{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ae(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,n){const{scale:r,cosPhi:i}=this;return{x:Ae(t)*i*r+.5,y:-Math.sin(Ae(n))/i*r+.5,z:0}}unproject(t,n){const{scale:r,cosPhi:i}=this,o=-(n-.5)/r,s=$t(dr((t-.5)/r)/i,-180,180),a=Math.asin($t(o*i,-1,1)),c=$t(dr(a),-xr,xr);return new Be(s,c)}}class JP extends zC{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,n,r){const i=xh(t,n,r),o=Ar(To(r));return J.transformMat4(i,i,o),{x:i[0],y:i[1],z:i[2]}}locationPoint(t,n){const r=Ei(n.lat,n.lng),i=J.normalize([],r),o=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(n),t._centerAltitude):t._centerAltitude,s=Rn(1,0)*gt*o;J.scaleAndAdd(r,r,i,s);const a=lt.identity(new Float64Array(16));return lt.multiply(a,t.pixelMatrix,t.globeMatrix),J.transformMat4(r,r,a),new nt(r[0],r[1])}pixelsPerMeter(t,n){return Rn(1,0)*n}pixelSpaceConversion(t,n,r){const i=Rn(1,t)*n,o=Ce(Rn(1,45)*n,i,r);return this.pixelsPerMeter(t,n)/o}createTileMatrix(t,n,r){const i=Ri(To(r.canonical));return lt.multiply(new Float64Array(16),t.globeMatrix,i)}createInversionMatrix(t,n){const{center:r}=t,i=Ar(To(n));return lt.rotateY(i,i,Ae(r.lng)),lt.rotateX(i,i,Ae(r.lat)),lt.scale(i,i,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(i)}pointCoordinate(t,n,r,i){return Ny(t,n,r,!0)||new an(0,0)}pointCoordinate3D(t,n,r){const i=this.pointCoordinate(t,n,r,0);return[i.x,i.y,i.z]}isPointAboveHorizon(t,n){return!Ny(t,n.x,n.y,!1)}farthestPixelDistance(t){const n=function(i,o){const s=i.cameraToCenterDistance,a=i._centerAltitude*o,c=i._camera,h=i._camera.forward(),d=J.add([],J.scale([],h,-s),[0,0,a]),m=i.worldSize/(2*Math.PI),g=[0,0,-m],x=i.width/i.height,v=Math.tan(i.fovAboveCenter),w=J.scale([],c.up(),v),A=J.scale([],c.right(),v*x),E=J.normalize([],J.add([],J.add([],h,w),A)),S=[];let I;if(new td(d,E).closestPointOnSphere(g,m,S)){const B=J.add([],S,g),M=J.sub([],B,d);I=Math.cos(i.fovAboveCenter)*J.length(M)}else{const B=J.sub([],d,g),M=J.sub([],g,d);J.normalize(M,M);const D=J.length(B)-m;I=Math.sqrt(D*(D+2*m));const R=Math.acos(I/(m+D))-Math.acos(J.dot(h,M));I*=Math.cos(R)}return 1.01*I}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),r=$r(t.zoom);if(r>0){const i=LC(t,Rn(1,t.center.lat)*t.worldSize),o=t.worldSize/(2*Math.PI),s=Math.max(t.width,t.height)/t.worldSize*Math.PI;return Ce(n,i+o*(1-Math.cos(s)),Math.pow(r,10))}return n}upVector(t,n,r){return xh(n,r,t,1)}upVectorScale(t){return{metersToTile:ed(rd(To(t)))}}}function D1(e){const t=e.parallels,n=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new zC(e);case"equirectangular":return new HP(e);case"naturalEarth":return new WP(e);case"equalEarth":return new jP(e);case"winkelTripel":return new qP(e);case"albers":return n?new UC(e):new GP(e);case"lambertConformalConic":return n?new UC(e):new ZP(e);case"globe":return new JP(e)}throw new Error(`Invalid projection name: ${e.name}`)}const $P=new lr({"symbol-placement":new Rt(ut.layout_symbol["symbol-placement"]),"symbol-spacing":new Rt(ut.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Rt(ut.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ge(ut.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Rt(ut.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Rt(ut.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Rt(ut.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Rt(ut.layout_symbol["icon-ignore-placement"]),"icon-optional":new Rt(ut.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Rt(ut.layout_symbol["icon-rotation-alignment"]),"icon-size":new ge(ut.layout_symbol["icon-size"]),"icon-text-fit":new ge(ut.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ge(ut.layout_symbol["icon-text-fit-padding"]),"icon-image":new ge(ut.layout_symbol["icon-image"]),"icon-rotate":new ge(ut.layout_symbol["icon-rotate"]),"icon-padding":new Rt(ut.layout_symbol["icon-padding"]),"icon-keep-upright":new Rt(ut.layout_symbol["icon-keep-upright"]),"icon-offset":new ge(ut.layout_symbol["icon-offset"]),"icon-anchor":new ge(ut.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Rt(ut.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Rt(ut.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Rt(ut.layout_symbol["text-rotation-alignment"]),"text-field":new ge(ut.layout_symbol["text-field"]),"text-font":new ge(ut.layout_symbol["text-font"]),"text-size":new ge(ut.layout_symbol["text-size"]),"text-max-width":new ge(ut.layout_symbol["text-max-width"]),"text-line-height":new ge(ut.layout_symbol["text-line-height"]),"text-letter-spacing":new ge(ut.layout_symbol["text-letter-spacing"]),"text-justify":new ge(ut.layout_symbol["text-justify"]),"text-radial-offset":new ge(ut.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Rt(ut.layout_symbol["text-variable-anchor"]),"text-anchor":new ge(ut.layout_symbol["text-anchor"]),"text-max-angle":new Rt(ut.layout_symbol["text-max-angle"]),"text-writing-mode":new Rt(ut.layout_symbol["text-writing-mode"]),"text-rotate":new ge(ut.layout_symbol["text-rotate"]),"text-padding":new Rt(ut.layout_symbol["text-padding"]),"text-keep-upright":new Rt(ut.layout_symbol["text-keep-upright"]),"text-transform":new ge(ut.layout_symbol["text-transform"]),"text-offset":new ge(ut.layout_symbol["text-offset"]),"text-allow-overlap":new Rt(ut.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Rt(ut.layout_symbol["text-ignore-placement"]),"text-optional":new Rt(ut.layout_symbol["text-optional"]),visibility:new Rt(ut.layout_symbol.visibility)});var Tb={paint:new lr({"icon-opacity":new ge(ut.paint_symbol["icon-opacity"]),"icon-emissive-strength":new ge(ut.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new ge(ut.paint_symbol["text-emissive-strength"]),"icon-color":new ge(ut.paint_symbol["icon-color"]),"icon-halo-color":new ge(ut.paint_symbol["icon-halo-color"]),"icon-halo-width":new ge(ut.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ge(ut.paint_symbol["icon-halo-blur"]),"icon-translate":new Rt(ut.paint_symbol["icon-translate"]),"icon-translate-anchor":new Rt(ut.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ge(ut.paint_symbol["icon-image-cross-fade"]),"text-opacity":new ge(ut.paint_symbol["text-opacity"]),"text-color":new ge(ut.paint_symbol["text-color"],{runtimeType:Do,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new ge(ut.paint_symbol["text-halo-color"]),"text-halo-width":new ge(ut.paint_symbol["text-halo-width"]),"text-halo-blur":new ge(ut.paint_symbol["text-halo-blur"]),"text-translate":new Rt(ut.paint_symbol["text-translate"]),"text-translate-anchor":new Rt(ut.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Rt(ut.paint_symbol["icon-color-saturation"])}),layout:$P};class VC{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:$n,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}le(VC,"FormatSectionOverride",{omit:["defaultValue"]});class P1 extends Di{constructor(t,n){super(t,Tb,n)}recalculate(t,n){super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const r=this.layout.get("text-writing-mode");if(r){const i=[];for(const o of r)i.indexOf(o)<0&&i.push(o);this.layout._values["text-writing-mode"]=i}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,n,r,i){const o=this.layout.get(t).evaluate(n,{},r,i),s=this._unevaluatedLayout._values[t];return s.isDataDriven()||Af(s.value)||!o?o:function(a,c){return c.replace(/{([^{}]+)}/g,(h,d)=>d in a?String(a[d]):"")}(n.properties,o)}createBucket(t){return new bg(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of Tb.paint.overridableProperties){if(!P1.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),r=new VC(n),i=new so(r,n.property.specification);let o=null;o=n.value.kind==="constant"||n.value.kind==="source"?new Ef("source",i):new Fo("composite",i,n.value.zoomStops,n.value._interpolationType),this.paint._values[t]=new ia(n.property,o,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,r){return!(!this.layout||n.isDataDriven()||r.isDataDriven())&&P1.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const r=t.get("text-field"),i=Tb.paint.properties[n];let o=!1;const s=a=>{for(const c of a)if(i.overrides&&i.overrides.hasOverride(c))return void(o=!0)};if(r.value.kind==="constant"&&r.value.value instanceof Wr)s(r.value.value.sections);else if(r.value.kind==="source"){const a=h=>{o||(h instanceof vl&&gr(h.value)===Fc?s(h.value.sections):h instanceof Ba?s(h.sections):h.eachChild(a))},c=r.value;c._styleExpression&&a(c._styleExpression.expression)}return o}getProgramIds(){const t=this.paint.get("icon-opacity").constantOr(1)!==0,n=this.paint.get("text-opacity").constantOr(1)!==0,r=[];return t&&r.push("symbolIcon"),n&&r.push("symbolSDF"),r}getDefaultProgramParams(t,n){return{config:new Vl(this,n),overrideFog:!1}}}const KP=_1.types,XP=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function L1(e,t,n,r,i,o,s,a,c,h,d,m,g){const x=a?Math.min(Qu,Math.round(a[0])):0,v=a?Math.min(Qu,Math.round(a[1])):0;e.emplaceBack(t,n,Math.round(32*r),Math.round(32*i),o,s,(x<<1)+(c?1:0),v,16*h,16*d,256*m,256*g)}function R1(e,t,n){e.emplaceBack(t,n)}function k1(e,t,n,r,i,o,s){e.emplaceBack(t,n,r,i,o,s)}function F1(e,t,n,r,i){const o=5*t+2;e.float32[o+0]=n,e.float32[o+1]=r,e.float32[o+2]=i}function wd(e,t,n,r,i){e.emplaceBack(t,n,r,i),e.emplaceBack(t,n,r,i),e.emplaceBack(t,n,r,i),e.emplaceBack(t,n,r,i)}function YP(e){for(const t of e.sections)if(am(t.text))return!0;return!1}class Cb{constructor(t){this.layoutVertexArray=new Nf,this.indexArray=new ur,this.programConfigurations=t,this.segments=new Cn,this.dynamicLayoutVertexArray=new Ai,this.opacityVertexArray=new _m,this.placedSymbolArray=new M0,this.iconTransitioningVertexArray=new Pi,this.globeExtVertexArray=new gm,this.zOffsetVertexArray=new zl}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(t,n,r,i,o){this.isEmpty()||(r&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,pP.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,gP.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,XP,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,yP.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,mP.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||o)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,_P.members,!0)),this.opacityVertexBuffer.itemSize=1),(r||i)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}le(Cb,"SymbolBuffers");class Sb{constructor(t,n,r){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new r,this.segments=new Cn,this.collisionVertexArray=new Nu,this.collisionVertexArrayExt=new Ai}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,xP.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,vP.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}le(Sb,"CollisionBuffers");class z1{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=lt.identity([]),this.placementViewportMatrix=lt.identity([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=gb(this.zoom,n["text-size"]),this.iconSizeData=gb(this.zoom,n["icon-size"]);const r=this.layers[0].layout,i=r.get("symbol-sort-key"),o=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=o!=="viewport-y"&&i.constantOr(1)!==void 0,this.sortFeaturesByY=(o==="viewport-y"||o==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map(s=>fr[s]),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=r.get("symbol-z-elevate")}createArrays(){this.text=new Cb(new Ga(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Cb(new Ga(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Uf,this.lineVertexArray=new I0,this.symbolInstances=new Li}calculateGlyphDependencies(t,n,r,i,o){for(let s=0;s<t.length;s++){const a=t.codePointAt(s);if(a===void 0)break;if(n[a]=!0,i&&o&&a<=65535){const c=pg[t.charAt(s)];c&&(n[c.charCodeAt(0)]=!0)}}}populate(t,n,r,i){const o=this.layers[0],s=o.layout,a=this.projection.name==="globe",c=s.get("text-font"),h=s.get("text-field"),d=s.get("icon-image"),m=(h.value.kind!=="constant"||h.value.value instanceof Wr&&!h.value.value.isEmpty()||h.value.value.toString().length>0)&&(c.value.kind!=="constant"||c.value.value.length>0),g=d.value.kind!=="constant"||!!d.value.value||Object.keys(d.parameters).length>0,x=s.get("symbol-sort-key");if(this.features=[],!m&&!g)return;const v=n.iconDependencies,w=n.glyphDependencies,A=n.availableImages,E=new rr(this.zoom);for(const{feature:S,id:I,index:B,sourceLayerIndex:M}of t){const D=o._featureFilter.needGeometry,R=$a(S,D);if(!o._featureFilter.filter(E,R,r))continue;if(D||(R.geometry=ks(S,r,i)),a&&S.type!==1&&r.z<=5){const j=R.geometry,H=.98078528056,$=(G,Q)=>{const et=xh(G.x,G.y,r,1),st=xh(Q.x,Q.y,r,1);return J.dot(et,st)<H};for(let G=0;G<j.length;G++)j[G]=qw(j[G],$)}let z,N;if(m){const j=o.getValueAndResolveTokens("text-field",R,r,A),H=Wr.factory(j);YP(H)&&(this.hasRTLText=!0),(!this.hasRTLText||hm()==="unavailable"||this.hasRTLText&&xo.isParsed())&&(z=AP(H,o,R))}if(g){const j=o.getValueAndResolveTokens("icon-image",R,r,A);N=j instanceof ji?j:ji.fromString(j)}if(!z&&!N)continue;const V=this.sortFeaturesByKey?x.evaluate(R,{},r):void 0;if(this.features.push({id:I,text:z,icon:N,index:B,sourceLayerIndex:M,geometry:R.geometry,properties:S.properties,type:KP[S.type],sortKey:V}),N&&(v[N.namePrimary]=!0,N.nameSecondary&&(v[N.nameSecondary]=!0)),z){const j=c.evaluate(R,{},r).join(","),H=s.get("text-rotation-alignment")==="map"&&s.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(fr.vertical)>=0;for(const $ of z.sections)if($.image)v[$.image.namePrimary]=!0;else{const G=bs(z.toString()),Q=$.fontStack||j,et=w[Q]=w[Q]||{};this.calculateGlyphDependencies($.text,et,H,this.allowVerticalPlacement,G)}}}s.get("symbol-placement")==="line"&&(this.features=function(S){const I={},B={},M=[];let D=0;function R(j){M.push(S[j]),D++}function z(j,H,$){const G=B[j];return delete B[j],B[H]=G,M[G].geometry[0].pop(),M[G].geometry[0]=M[G].geometry[0].concat($[0]),G}function N(j,H,$){const G=I[H];return delete I[H],I[j]=G,M[G].geometry[0].shift(),M[G].geometry[0]=$[0].concat(M[G].geometry[0]),G}function V(j,H,$){const G=$?H[0][H[0].length-1]:H[0][0];return`${j}:${G.x}:${G.y}`}for(let j=0;j<S.length;j++){const H=S[j],$=H.geometry,G=H.text?H.text.toString():null;if(!G){R(j);continue}const Q=V(G,$),et=V(G,$,!0);if(Q in B&&et in I&&B[Q]!==I[et]){const st=N(Q,et,$),Y=z(Q,et,M[st].geometry);delete I[Q],delete B[et],B[V(G,M[Y].geometry,!0)]=Y,M[st].geometry=null}else Q in B?z(Q,et,$):et in I?N(Q,et,$):(R(j),I[Q]=D-1,B[et]=D-1)}return M.filter(j=>j.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((S,I)=>S.sortKey-I.sortKey)}update(t,n,r,i,o){const s=Object.keys(t).length!==0;if(s&&!this.stateDependentLayers.length)return;const a=s?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(t,n,a,r,i,o),this.icon.programConfigurations.updatePaintArrays(t,n,a,r,i,o)}updateZOffset(){const t=(o,s,a)=>{r+=s,r>o.length&&o.resize(r);for(let c=-s;c<0;c++)o.emplace(c+r,a)},n=(o,s,a)=>{i+=s,i>o.length&&o.resize(i);for(let c=-s;c<0;c++)o.emplace(c+i,a)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let r=0,i=0;for(let o=0;o<this.symbolInstances.length;o++){const s=this.symbolInstances.get(o),{numHorizontalGlyphVertices:a,numVerticalGlyphVertices:c,numIconVertices:h}=s,d=s.zOffset,m=h>0;if((a>0||c>0)&&(t(this.text.zOffsetVertexArray,a,d),t(this.text.zOffsetVertexArray,c,d)),m){const{placedIconSymbolIndex:g,verticalPlacedIconSymbolIndex:x}=s;g>=0&&n(this.icon.zOffsetVertexArray,h,d),x>=0&&n(this.icon.zOffsetVertexArray,s.numVerticalIconVertices,d)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=D1(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const r=this.lineVertexArray.length;if(t.segment!==void 0)for(const{x:i,y:o}of n)this.lineVertexArray.emplaceBack(i,o);return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(t,n,r,i,o,s,a,c,h,d,m,g,x,v,w,A){const E=t.indexArray,S=t.layoutVertexArray,I=t.globeExtVertexArray,B=t.segments.prepareSegment(4*n.length,S,E,this.canOverlap?s.sortKey:void 0),M=this.glyphOffsetArray.length,D=B.vertexLength,R=this.allowVerticalPlacement&&a===fr.vertical?Math.PI/2:0,z=s.text&&s.text.sections;for(let V=0;V<n.length;V++){const{tl:j,tr:H,bl:$,br:G,texPrimary:Q,texSecondary:et,pixelOffsetTL:st,pixelOffsetBR:Y,minFontScaleX:tt,minFontScaleY:ct,glyphOffset:pt,isSDF:dt,sectionIndex:wt}=n[V],bt=B.vertexLength,Et=pt[1];if(L1(S,h.x,h.y,j.x,Et+j.y,Q.x,Q.y,r,dt,st.x,st.y,tt,ct),L1(S,h.x,h.y,H.x,Et+H.y,Q.x+Q.w,Q.y,r,dt,Y.x,st.y,tt,ct),L1(S,h.x,h.y,$.x,Et+$.y,Q.x,Q.y+Q.h,r,dt,st.x,Y.y,tt,ct),L1(S,h.x,h.y,G.x,Et+G.y,Q.x+Q.w,Q.y+Q.h,r,dt,Y.x,Y.y,tt,ct),c){const{x:_t,y:Mt,z:qt}=c.anchor,[Jt,ne,se]=c.up;k1(I,_t,Mt,qt,Jt,ne,se),k1(I,_t,Mt,qt,Jt,ne,se),k1(I,_t,Mt,qt,Jt,ne,se),k1(I,_t,Mt,qt,Jt,ne,se),wd(t.dynamicLayoutVertexArray,_t,Mt,qt,R)}else wd(t.dynamicLayoutVertexArray,h.x,h.y,h.z,R);if(A){const _t=et||Q;R1(t.iconTransitioningVertexArray,_t.x,_t.y),R1(t.iconTransitioningVertexArray,_t.x+_t.w,_t.y),R1(t.iconTransitioningVertexArray,_t.x,_t.y+_t.h),R1(t.iconTransitioningVertexArray,_t.x+_t.w,_t.y+_t.h)}E.emplaceBack(bt,bt+1,bt+2),E.emplaceBack(bt+1,bt+2,bt+3),B.vertexLength+=4,B.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(pt[0]),V!==n.length-1&&wt===n[V+1].sectionIndex||t.programConfigurations.populatePaintArrays(S.length,s,s.index,{},x,v,w,z&&z[wt])}const N=c?c.anchor:h;t.placedSymbolArray.emplaceBack(N.x,N.y,N.z,h.x,h.y,M,this.glyphOffsetArray.length-M,D,d,m,h.segment,r?r[0]:0,r?r[1]:0,i[0],i[1],a,0,!1,0,g,0)}_commitLayoutVertex(t,n,r,i,o,s,a){t.emplaceBack(n,r,i,o,s,Math.round(a.x),Math.round(a.y))}_addCollisionDebugVertices(t,n,r,i,o,s,a){const c=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),h=c.vertexLength,d=a.tileAnchorX,m=a.tileAnchorY;for(let x=0;x<4;x++)r.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(r.collisionVertexArrayExt,n,t.padding,a.zOffset),this._commitLayoutVertex(r.layoutVertexArray,i,o,s,d,m,new nt(t.x1,t.y1)),this._commitLayoutVertex(r.layoutVertexArray,i,o,s,d,m,new nt(t.x2,t.y1)),this._commitLayoutVertex(r.layoutVertexArray,i,o,s,d,m,new nt(t.x2,t.y2)),this._commitLayoutVertex(r.layoutVertexArray,i,o,s,d,m,new nt(t.x1,t.y2)),c.vertexLength+=4;const g=r.indexArray;g.emplaceBack(h,h+1),g.emplaceBack(h+1,h+2),g.emplaceBack(h+2,h+3),g.emplaceBack(h+3,h),c.primitiveLength+=4}_addTextDebugCollisionBoxes(t,n,r,i,o,s){for(let a=i;a<o;a++){const c=r.get(a),h=this.getSymbolInstanceTextSize(t,s,n,a);this._addCollisionDebugVertices(c,h,this.textCollisionBox,c.projectedAnchorX,c.projectedAnchorY,c.projectedAnchorZ,s)}}_addIconDebugCollisionBoxes(t,n,r,i,o,s){for(let a=i;a<o;a++){const c=r.get(a),h=this.getSymbolInstanceIconSize(t,n,s.placedIconSymbolIndex);this._addCollisionDebugVertices(c,h,this.iconCollisionBox,c.projectedAnchorX,c.projectedAnchorY,c.projectedAnchorZ,s)}}generateCollisionDebugBuffers(t,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Sb(Ou,hC.members,Pi),this.iconCollisionBox=new Sb(Ou,hC.members,Pi);const r=Xa(this.iconSizeData,t),i=Xa(this.textSizeData,t);for(let o=0;o<this.symbolInstances.length;o++){const s=this.symbolInstances.get(o);this._addTextDebugCollisionBoxes(i,t,n,s.textBoxStartIndex,s.textBoxEndIndex,s),this._addTextDebugCollisionBoxes(i,t,n,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s),this._addIconDebugCollisionBoxes(r,t,n,s.iconBoxStartIndex,s.iconBoxEndIndex,s),this._addIconDebugCollisionBoxes(r,t,n,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s)}}getSymbolInstanceTextSize(t,n,r,i){const o=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:i),s=dg(this.textSizeData,t,o)/li;return this.tilePixelRatio*s}getSymbolInstanceIconSize(t,n,r){const i=this.icon.placedSymbolArray.get(r),o=dg(this.iconSizeData,t,i);return this.tilePixelRatio*o}_commitDebugCollisionVertexUpdate(t,n,r,i){t.emplaceBack(n,-r,-r,i),t.emplaceBack(n,r,-r,i),t.emplaceBack(n,r,r,i),t.emplaceBack(n,-r,r,i)}_updateTextDebugCollisionBoxes(t,n,r,i,o,s){for(let a=i;a<o;a++){const c=r.get(a),h=this.getSymbolInstanceTextSize(t,s,n,a);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,h,c.padding,s.zOffset)}}_updateIconDebugCollisionBoxes(t,n,r,i,o,s){for(let a=i;a<o;a++){const c=r.get(a),h=this.getSymbolInstanceIconSize(t,n,s.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,h,c.padding,s.zOffset)}}updateCollisionDebugBuffers(t,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const r=Xa(this.iconSizeData,t),i=Xa(this.textSizeData,t);for(let o=0;o<this.symbolInstances.length;o++){const s=this.symbolInstances.get(o);this._updateTextDebugCollisionBoxes(i,t,n,s.textBoxStartIndex,s.textBoxEndIndex,s),this._updateTextDebugCollisionBoxes(i,t,n,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s),this._updateIconDebugCollisionBoxes(r,t,n,s.iconBoxStartIndex,s.iconBoxEndIndex,s),this._updateIconDebugCollisionBoxes(r,t,n,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,n,r,i,o,s,a,c,h){const d={};if(n<r){const{x1:m,y1:g,x2:x,y2:v,padding:w,projectedAnchorX:A,projectedAnchorY:E,projectedAnchorZ:S,tileAnchorX:I,tileAnchorY:B,featureIndex:M}=t.get(n);d.textBox={x1:m,y1:g,x2:x,y2:v,padding:w,projectedAnchorX:A,projectedAnchorY:E,projectedAnchorZ:S,tileAnchorX:I,tileAnchorY:B},d.textFeatureIndex=M}if(i<o){const{x1:m,y1:g,x2:x,y2:v,padding:w,projectedAnchorX:A,projectedAnchorY:E,projectedAnchorZ:S,tileAnchorX:I,tileAnchorY:B,featureIndex:M}=t.get(i);d.verticalTextBox={x1:m,y1:g,x2:x,y2:v,padding:w,projectedAnchorX:A,projectedAnchorY:E,projectedAnchorZ:S,tileAnchorX:I,tileAnchorY:B},d.verticalTextFeatureIndex=M}if(s<a){const{x1:m,y1:g,x2:x,y2:v,padding:w,projectedAnchorX:A,projectedAnchorY:E,projectedAnchorZ:S,tileAnchorX:I,tileAnchorY:B,featureIndex:M}=t.get(s);d.iconBox={x1:m,y1:g,x2:x,y2:v,padding:w,projectedAnchorX:A,projectedAnchorY:E,projectedAnchorZ:S,tileAnchorX:I,tileAnchorY:B},d.iconFeatureIndex=M}if(c<h){const{x1:m,y1:g,x2:x,y2:v,padding:w,projectedAnchorX:A,projectedAnchorY:E,projectedAnchorZ:S,tileAnchorX:I,tileAnchorY:B,featureIndex:M}=t.get(c);d.verticalIconBox={x1:m,y1:g,x2:x,y2:v,padding:w,projectedAnchorX:A,projectedAnchorY:E,projectedAnchorZ:S,tileAnchorX:I,tileAnchorY:B},d.verticalIconFeatureIndex=M}return d}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const r=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,n){const r=t.placedSymbolArray.get(n),i=r.vertexStartIndex+4*r.numGlyphs;for(let o=r.vertexStartIndex;o<i;o+=4)t.indexArray.emplaceBack(o,o+1,o+2),t.indexArray.emplaceBack(o+1,o+2,o+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),r=Math.cos(t),i=[],o=[],s=[];for(let a=0;a<this.symbolInstances.length;++a){s.push(a);const c=this.symbolInstances.get(a);i.push(0|Math.round(n*c.tileAnchorX+r*c.tileAnchorY)),o.push(c.featureIndex)}return s.sort((a,c)=>i[a]-i[c]||o[c]-o[a]),s}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((t,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(t).zOffset)}addToSortKeyRanges(t,n){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===n?r.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const r=this.symbolInstances.get(n);this.featureSortOrder.push(r.featureIndex);const{rightJustifiedTextSymbolIndex:i,centerJustifiedTextSymbolIndex:o,leftJustifiedTextSymbolIndex:s,verticalPlacedTextSymbolIndex:a,placedIconSymbolIndex:c,verticalPlacedIconSymbolIndex:h}=r;i>=0&&this.addIndicesForPlacedSymbol(this.text,i),o>=0&&o!==i&&this.addIndicesForPlacedSymbol(this.text,o),s>=0&&s!==o&&s!==i&&this.addIndicesForPlacedSymbol(this.text,s),a>=0&&this.addIndicesForPlacedSymbol(this.text,a),c>=0&&this.addIndicesForPlacedSymbol(this.icon,c),h>=0&&this.addIndicesForPlacedSymbol(this.icon,h)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}le(z1,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),z1.MAX_GLYPHS=65535,z1.addDynamicAttributes=wd;var bg=z1;const QP=wn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:tL}=QP,eL=wn([{name:"a_packed",components:4,type:"Float32"}]),{members:nL}=eL,rL=_1.types,iL=Math.cos(Math.PI/180*37.5);class O1{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new zf,this.layoutVertexArray2=new Ai,this.indexArray=new ur,this.programConfigurations=new Ga(t.layers,t.zoom),this.segments=new Cn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,r,i){this.hasPattern=Qi("line",this.layers,n);const o=this.layers[0].layout.get("line-sort-key"),s=[];for(const{feature:d,id:m,index:g,sourceLayerIndex:x}of t){const v=this.layers[0]._featureFilter.needGeometry,w=$a(d,v);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom),w,r))continue;const A=o?o.evaluate(w,{},r):void 0,E={id:m,properties:d.properties,type:d.type,sourceLayerIndex:x,index:g,geometry:v?w.geometry:ks(d,r,i),patterns:{},sortKey:A};s.push(E)}o&&s.sort((d,m)=>d.sortKey-m.sortKey);const{lineAtlas:a,featureIndex:c}=n,h=this.addConstantDashes(a);for(const d of s){const{geometry:m,index:g,sourceLayerIndex:x}=d;if(h&&this.addFeatureDashes(d,a),this.hasPattern){const v=Ti("line",this.layers,d,this.zoom,n);this.patternFeatures.push(v)}else this.addFeature(d,m,g,r,a.positions,n.availableImages,n.brightness);c.insert(t[g].feature,m,g,x,this.index)}}addConstantDashes(t){let n=!1;for(const r of this.layers){const i=r.paint.get("line-dasharray").value,o=r.layout.get("line-cap").value;if(i.kind!=="constant"||o.kind!=="constant")n=!0;else{const s=o.value,a=i.value;if(!a)continue;t.addDash(a,s)}}return n}addFeatureDashes(t,n){const r=this.zoom;for(const i of this.layers){const o=i.paint.get("line-dasharray").value,s=i.layout.get("line-cap").value;if(o.kind==="constant"&&s.kind==="constant")continue;let a,c;if(o.kind==="constant"){if(a=o.value,!a)continue}else a=o.evaluate({zoom:r},t);c=s.kind==="constant"?s.value:s.evaluate({zoom:r},t),n.addDash(a,c),t.patterns[i.id]=n.getKey(a,c)}}update(t,n,r,i,o){const s=Object.keys(t).length!==0;s&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,n,s?this.stateDependentLayers:this.layers,r,i,o)}addFeatures(t,n,r,i,o,s){for(const a of this.patternFeatures)this.addFeature(a,a.geometry,a.index,n,r,i,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,nL)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,tL),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,r,i,o,s,a){const c=this.layers[0].layout,h=c.get("line-join").evaluate(t,{}),d=c.get("line-cap").evaluate(t,{}),m=c.get("line-miter-limit"),g=c.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const x of n)this.addLine(x,t,h,d,m,g);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,o,s,i,a)}addLine(t,n,r,i,o,s){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let E=0;E<t.length-1;E++)this.totalDistance+=t[E].dist(t[E+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const a=rL[n.type]==="Polygon";let c=t.length;for(;c>=2&&t[c-1].equals(t[c-2]);)c--;let h=0;for(;h<c-1&&t[h].equals(t[h+1]);)h++;if(c<(a?3:2))return;r==="bevel"&&(o=1.05);const d=this.overscaling<=16?15*gt/(512*this.overscaling):0,m=this.segments.prepareSegment(10*c,this.layoutVertexArray,this.indexArray);let g,x,v,w,A;this.e1=this.e2=-1,a&&(g=t[c-2],A=t[h].sub(g)._unit()._perp());for(let E=h;E<c;E++){if(v=E===c-1?a?t[h+1]:void 0:t[E+1],v&&t[E].equals(v))continue;A&&(w=A),g&&(x=g),g=t[E],A=v?v.sub(g)._unit()._perp():w,w=w||A;let S=w.add(A);S.x===0&&S.y===0||S._unit();const I=w.x*A.x+w.y*A.y,B=S.x*A.x+S.y*A.y,M=B!==0?1/B:1/0,D=2*Math.sqrt(2-2*B),R=B<iL&&x&&v,z=w.x*A.y-w.y*A.x>0;if(R&&E>h){const j=g.dist(x);if(j>2*d){const H=g.sub(g.sub(x)._mult(d/j)._round());this.updateDistance(x,H),this.addCurrentVertex(H,w,0,0,m),x=H}}const N=x&&v;let V=N?r:a?"butt":i;if(N&&V==="round"&&(M<s?V="miter":M<=2&&(V="fakeround")),V==="miter"&&M>o&&(V="bevel"),V==="bevel"&&(M>2&&(V="flipbevel"),M<o&&(V="miter")),x&&this.updateDistance(x,g),V==="miter")S._mult(M),this.addCurrentVertex(g,S,0,0,m);else if(V==="flipbevel"){if(M>100)S=A.mult(-1);else{const j=M*w.add(A).mag()/w.sub(A).mag();S._perp()._mult(j*(z?-1:1))}this.addCurrentVertex(g,S,0,0,m),this.addCurrentVertex(g,S.mult(-1),0,0,m)}else if(V==="bevel"||V==="fakeround"){const j=-Math.sqrt(M*M-1),H=z?j:0,$=z?0:j;if(x&&this.addCurrentVertex(g,w,H,$,m),V==="fakeround"){const G=Math.round(180*D/Math.PI/20);for(let Q=1;Q<G;Q++){let et=Q/G;if(et!==.5){const Y=et-.5;et+=et*Y*(et-1)*((1.0904+I*(I*(3.55645-1.43519*I)-3.2452))*Y*Y+(.848013+I*(.215638*I-1.06021)))}const st=A.sub(w)._mult(et)._add(w)._unit()._mult(z?-1:1);this.addHalfVertex(g,st.x,st.y,!1,z,0,m)}}v&&this.addCurrentVertex(g,A,-H,-$,m)}else if(V==="butt")this.addCurrentVertex(g,S,0,0,m);else if(V==="square"){const j=x?1:-1;x||this.addCurrentVertex(g,S,j,j,m),this.addCurrentVertex(g,S,0,0,m),x&&this.addCurrentVertex(g,S,j,j,m)}else V==="round"&&(x&&(this.addCurrentVertex(g,w,0,0,m),this.addCurrentVertex(g,w,1,1,m,!0)),v&&(this.addCurrentVertex(g,A,-1,-1,m,!0),this.addCurrentVertex(g,A,0,0,m)));if(R&&E<c-1){const j=g.dist(v);if(j>2*d){const H=g.add(v.sub(g)._mult(d/j)._round());this.updateDistance(g,H),this.addCurrentVertex(H,A,0,0,m),g=H}}}}addCurrentVertex(t,n,r,i,o,s=!1){const a=n.y*i-n.x,c=-n.y-n.x*i;this.addHalfVertex(t,n.x+n.y*r,n.y-n.x*r,s,!1,r,o),this.addHalfVertex(t,a,c,s,!0,-i,o)}addHalfVertex({x:t,y:n},r,i,o,s,a,c){this.layoutVertexArray.emplaceBack((t<<1)+(o?1:0),(n<<1)+(s?1:0),Math.round(63*r)+128,Math.round(63*i)+128,1+(a===0?0:a<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const h=c.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,h),c.primitiveLength++),s?this.e2=h:this.e1=h}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}le(O1,"LineBucket",{omit:["layers","patternFeatures"]});class _r{constructor(t,n,r,i){this.context=t,this.format=r,this.texture=t.gl.createTexture(),this.update(n,i)}update(t,n,r){const{width:i,height:o}=t,{context:s}=this,{gl:a}=s,{HTMLImageElement:c,HTMLCanvasElement:h,HTMLVideoElement:d,ImageData:m,ImageBitmap:g}=k;if(a.bindTexture(a.TEXTURE_2D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(this.format===a.RGBA&&(!n||n.premultiply!==!1)),r||this.size&&this.size[0]===i&&this.size[1]===o){const{x,y:v}=r||{x:0,y:0};if(t instanceof c||t instanceof h||t instanceof d||t instanceof m||g&&t instanceof g)a.texSubImage2D(a.TEXTURE_2D,0,x,v,a.RGBA,a.UNSIGNED_BYTE,t);else{let w=this.format,A=a.UNSIGNED_BYTE;this.format===a.R32F&&(w=a.RED,A=a.FLOAT),a.texSubImage2D(a.TEXTURE_2D,0,x,v,i,o,w,A,t.data)}}else if(this.size=[i,o],t instanceof c||t instanceof h||t instanceof d||t instanceof m||g&&t instanceof g){let x=this.format;this.format===a.R8&&(x=a.RED),a.texImage2D(a.TEXTURE_2D,0,this.format,x,a.UNSIGNED_BYTE,t)}else{let x=this.format,v=this.format,w=a.UNSIGNED_BYTE;this.format===a.DEPTH_COMPONENT&&(x=a.DEPTH_COMPONENT16,w=a.UNSIGNED_SHORT),this.format===a.R32F&&(w=a.FLOAT,v=a.RED),a.texImage2D(a.TEXTURE_2D,0,x,i,o,0,v,w,t.data)}this.useMipmap=!!(n&&n.useMipmap),this.useMipmap&&a.generateMipmap(a.TEXTURE_2D)}bind(t,n){const{context:r}=this,{gl:i}=r;i.bindTexture(i.TEXTURE_2D,this.texture),t!==this.minFilter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,this.useMipmap?t===i.NEAREST?i.NEAREST_MIPMAP_NEAREST:i.LINEAR_MIPMAP_NEAREST:t),this.minFilter=t),n!==this.wrapS&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(t,n,r,i){const{context:o}=this,{gl:s}=o;s.bindTexture(s.TEXTURE_2D,this.texture),n!==this.magFilter&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,n),this.magFilter=n),t!==this.minFilter&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,this.useMipmap?t===s.NEAREST?s.NEAREST_MIPMAP_NEAREST:s.LINEAR_MIPMAP_NEAREST:t),this.minFilter=t),r!==this.wrapS&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,r),this.wrapS=r),i!==this.wrapT&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,i),this.wrapT=i)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class N1{constructor(t,n){this.context=t,this.texture=n}bind(t,n){const{context:r}=this,{gl:i}=r;i.bindTexture(i.TEXTURE_2D,this.texture),t!==this.minFilter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t),this.minFilter=t),n!==this.wrapS&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,n),this.wrapS=n)}}const zs=32,Ya=33,ec=new Uint16Array(8184);for(let e=0;e<2046;e++){let t=e+2,n=0,r=0,i=0,o=0,s=0,a=0;for(1&t?i=o=s=zs:n=r=a=zs;(t>>=1)>1;){const h=n+i>>1,d=r+o>>1;1&t?(i=n,o=r,n=s,r=a):(n=i,r=o,i=s,o=a),s=h,a=d}const c=4*e;ec[c+0]=n,ec[c+1]=r,ec[c+2]=i,ec[c+3]=o}const Qa=new Uint16Array(2178),nc=new Uint8Array(1089),U1=new Uint16Array(1089);function GC(e){return e===0?-.03125:e===32?.03125:0}var Mb=wn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const jC={type:2,extent:gt,loadGeometry:()=>[[new nt(0,0),new nt(gt+1,0),new nt(gt+1,gt+1),new nt(0,gt+1),new nt(0,0)]]};class Ag{constructor(t,n,r,i,o){this.tileID=t,this.uid=su(),this.uses=0,this.tileSize=n,this.tileZoom=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=o,i&&i.style&&(this._lastUpdatedBrightness=i.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",i&&i.transform&&(this.projection=i.transform.projection)}registerFadeDuration(t){const n=t+this.timeAdded;n<ze.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Eh(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,n,r){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(i,o){const s={};if(!o)return s;for(const a of i){const c=a.layerIds.map(h=>o.getLayer(h)).filter(Boolean);if(c.length!==0){a.layers=c,a.stateDependentLayerIds&&(a.stateDependentLayers=a.stateDependentLayerIds.map(h=>c.filter(d=>d.id===h)[0]));for(const h of c)s[h.fqid]=a}}return s}(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const i in this.buckets){const o=this.buckets[i];if(o instanceof bg){if(this.hasSymbolBuckets=!0,!r)break;o.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const i in this.buckets){const o=this.buckets[i];if(o instanceof bg&&o.hasRTLText){this.hasRTLText=!0,xo.isLoading()||xo.isLoaded()||hm()!=="deferred"||fm();break}}this.queryPadding=0;for(const i in this.buckets){const o=this.buckets[i],s=n.style.getOwnLayer(i);if(!s)continue;const a=s.queryRadius(o);this.queryPadding=Math.max(this.queryPadding,a)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new bm}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const r in this.buckets){const i=this.buckets[r];i.uploadPending()&&i.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new _r(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new _r(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new _r(t,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t,n,r){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,r),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const i=n.style.getBrightness();(this._lastUpdatedBrightness||i)&&(this._lastUpdatedBrightness&&i&&Math.abs(this._lastUpdatedBrightness-i)<.001||(this._lastUpdatedBrightness=i,this.updateBuckets(void 0,n)))}queryRenderedFeatures(t,n,r,i,o,s,a,c){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:i,pixelPosMatrix:a,transform:s,params:o,tileTransform:this.tileTransform},t,n,r):{}}querySourceFeatures(t,n){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const i=r.loadVTLayers(),o=n?n.sourceLayer:"",s=i._geojsonTileLayer||i[o];if(!s)return;const a=Pl(n&&n.filter),{z:c,x:h,y:d}=this.tileID.canonical,m={z:c,x:h,y:d};for(let g=0;g<s.length;g++){const x=s.feature(g);if(a.needGeometry){const A=$a(x,!0);if(!a.filter(new rr(this.tileID.overscaledZ),A,this.tileID.canonical))continue}else if(!a.filter(new rr(this.tileID.overscaledZ),x))continue;const v=r.getId(x,o),w=new nC(x,c,h,d,v);w.tile=m,t.push(w)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(const t in this.buckets)if(this.buckets[t].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const r=xe(t.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const r=Date.now();let i=!1;if(this.expirationTime>r)i=!1;else if(n)if(this.expirationTime<n)i=!0;else{const o=this.expirationTime-n;o?this.expirationTime=r+Math.max(o,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,n){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0&&n&&this.updateBuckets(t,n)}updateBuckets(t,n){if(!this.latestFeatureIndex)return;const r=this.latestFeatureIndex.loadVTLayers(),i=n.style.listImages(),o=n.style.getBrightness();for(const s in this.buckets){if(!n.style.hasLayer(s))continue;const a=this.buckets[s],c=a.layers[0].sourceLayer||"_geojsonTileLayer",h=r[c];let d={};if(t&&(d=t[c],!h||!d||Object.keys(d).length===0))continue;if(a.update(d,h,i,this.imageAtlas&&this.imageAtlas.patternPositions||{},o),a instanceof O1||a instanceof Fi){const g=n.style.getOwnSourceCache(a.layers[0].source);n._terrain&&n._terrain.enabled&&g&&a.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(g.id,this.tileID)}const m=n&&n.style&&n.style.getOwnLayer(s);m&&(this.queryPadding=Math.max(this.queryPadding,m.queryRadius(a)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ze.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=ze.now()+t}setTexture(t,n){const r=n.context,i=r.gl;this.texture=this.texture||n.getTileTexture(t.width),this.texture&&this.texture instanceof _r?this.texture.update(t,{useMipmap:!0}):(this.texture=new _r(r,t,i.RGBA,{useMipmap:!0}),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE))}setDependencies(t,n){const r={};for(const i of n)r[i]=!0;this.dependencies[t]=r}hasDependency(t,n){for(const r of t){const i=this.dependencies[r];if(i){for(const o of n)if(i[o])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;const r=ks(jC,this.tileID.canonical,this.tileTransform)[0],i=new bi,o=new Vu;for(let s=0;s<r.length;s++){const{x:a,y:c}=r[s];i.emplaceBack(a,c),o.emplaceBack(s)}o.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(o),this._tileDebugBuffer=t.createVertexBuffer(i,Ps.members),this._tileDebugSegments=Cn.simpleSegment(0,0,i.length,o.length)}_makeTileBoundsBuffers(t,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;const r=ks(jC,this.tileID.canonical,this.tileTransform)[0];let i,o;if(this.isRaster){const s=function(a,c){const h=Eh(a,c),d=Math.pow(2,a.z);for(let A=0;A<Ya;A++)for(let E=0;E<Ya;E++){const S=uo((a.x+(E+GC(E))/zs)/d),I=Br((a.y+(A+GC(A))/zs)/d),B=c.project(S,I),M=A*Ya+E;Qa[2*M+0]=Math.round((B.x*h.scale-h.x)*gt),Qa[2*M+1]=Math.round((B.y*h.scale-h.y)*gt)}nc.fill(0),U1.fill(0);for(let A=2045;A>=0;A--){const E=4*A,S=ec[E+0],I=ec[E+1],B=ec[E+2],M=ec[E+3],D=S+B>>1,R=I+M>>1,z=D+R-I,N=R+S-D,V=I*Ya+S,j=M*Ya+B,H=R*Ya+D,$=Math.hypot((Qa[2*V+0]+Qa[2*j+0])/2-Qa[2*H+0],(Qa[2*V+1]+Qa[2*j+1])/2-Qa[2*H+1])>=16;nc[H]=nc[H]||($?1:0),A<1022&&(nc[H]=nc[H]||nc[(I+N>>1)*Ya+(S+z>>1)]||nc[(M+N>>1)*Ya+(B+z>>1)])}const m=new sa,g=new ur;let x=0;function v(A,E){const S=E*Ya+A;return U1[S]===0&&(m.emplaceBack(Qa[2*S+0],Qa[2*S+1],A*gt/zs,E*gt/zs),U1[S]=++x),U1[S]-1}function w(A,E,S,I,B,M){const D=A+S>>1,R=E+I>>1;if(Math.abs(A-B)+Math.abs(E-M)>1&&nc[R*Ya+D])w(B,M,A,E,D,R),w(S,I,B,M,D,R);else{const z=v(A,E),N=v(S,I),V=v(B,M);g.emplaceBack(z,N,V)}}return w(0,0,zs,zs,zs,0),w(zs,zs,0,0,0,zs),{vertices:m,indices:g}}(this.tileID.canonical,n);i=s.vertices,o=s.indices}else{i=new sa,o=new ur;for(const{x:a,y:c}of r)i.emplaceBack(a,c,0,0);const s=Ye(i.int16,void 0,4);for(let a=0;a<s.length;a+=3)o.emplaceBack(s[a],s[a+1],s[a+2])}this._tileBoundsBuffer=t.createVertexBuffer(i,Mb.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(o),this._tileBoundsSegments=Cn.simpleSegment(0,0,i.length,o.length)}_makeGlobeTileDebugBuffers(t,n){const r=n.projection;if(!r||r.name!=="globe"||n.freezeTileCoverage)return;const i=this.tileID.canonical,o=Ar(Uy(i,n)),s=$r(n.zoom);let a;s>0&&(a=lt.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,i,n,o,a,s),this._makeGlobeTileDebugTextBuffer(t,i,n,o,a,s)}_globePoint(t,n,r,i,o,s,a){let c=xh(t,n,r);if(s){const h=1<<r.z,d=Ir(i.center.lng),m=Fr(i.center.lat),g=(r.x+.5)/h-d;let x=0;g>.5?x=-1:g<-.5&&(x=1);let v=(t/gt+r.x)/h+x,w=(n/gt+r.y)/h;v=(v-d)*i._pixelsPerMercatorPixel+d,w=(w-m)*i._pixelsPerMercatorPixel+m;const A=[v*i.worldSize,w*i.worldSize,0];J.transformMat4(A,A,s),c=fa(c,A,a)}return J.transformMat4(c,c,o)}_makeGlobeTileDebugBorderBuffer(t,n,r,i,o,s){const a=new bi,c=new Vu,h=new ih,d=(g,x,v,w,A)=>{const E=(v-g)/(A-1),S=(w-x)/(A-1),I=a.length;for(let B=0;B<A;B++){const M=g+B*E,D=x+B*S;a.emplaceBack(M,D);const R=this._globePoint(M,D,n,r,i,o,s);h.emplaceBack(R[0],R[1],R[2]),c.emplaceBack(I+B)}},m=gt;d(0,0,m,0,16),d(m,0,m,m,16),d(m,m,0,m,16),d(0,m,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(c),this._tileDebugBuffer=t.createVertexBuffer(a,Ps.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(h,Zu.members),this._tileDebugSegments=Cn.simpleSegment(0,0,a.length,c.length)}_makeGlobeTileDebugTextBuffer(t,n,r,i,o,s){const a=gt/4,c=new bi,h=new ur,d=new ih,m=25;h.reserve(32),c.reserve(m),d.reserve(m);const g=(x,v)=>m*x+v;for(let x=0;x<m;x++){const v=x*a;for(let w=0;w<m;w++){const A=w*a;c.emplaceBack(A,v);const E=this._globePoint(A,v,n,r,i,o,s);d.emplaceBack(E[0],E[1],E[2])}}for(let x=0;x<4;x++)for(let v=0;v<4;v++){const w=g(x,v),A=g(x,v+1),E=g(x+1,v),S=g(x+1,v+1);h.emplaceBack(w,A,E),h.emplaceBack(E,A,S)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(h),this._tileDebugTextBuffer=t.createVertexBuffer(c,Ps.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(d,Zu.members),this._tileDebugTextSegments=Cn.simpleSegment(0,0,m,32)}destroy(t=!1){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof _r&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.latestFeatureIndex=null,this.state="unloaded"}}class oL{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,r){const i=t.wrapped().key;this.data[i]===void 0&&(this.data[i]=[]);const o={value:n,timeout:void 0};if(r!==void 0&&(o.timeout=setTimeout(()=>{this.remove(t,o)},r)),this.data[i].push(o),this.order.push(i),this.order.length>this.max){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const r=t.wrapped().key,i=n===void 0?0:this.data[r].indexOf(n),o=this.data[r][i];return this.data[r].splice(i,1),o.timeout&&clearTimeout(o.timeout),this.data[r].length===0&&delete this.data[r],this.onRemove(o.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const r in this.data)for(const i of this.data[r])t(i.value)||n.push(i);for(const r of n)this.remove(r.value.tileID,r)}}class rc{constructor(t,n,r,i){this.id=rc.uniqueIdxCounter,rc.uniqueIdxCounter++,this.context=t;const o=t.gl;this.buffer=o.createBuffer(),this.dynamicDraw=!!r,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),o.bufferData(o.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?o.DYNAMIC_DRAW:o.STATIC_DRAW),this.dynamicDraw||i||n.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=rc.uniqueIdxCounter,rc.uniqueIdxCounter++;const n=this.context.gl;this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}rc.uniqueIdxCounter=0;const sL={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class aL{constructor(t,n,r,i,o,s){this.length=n.length,this.attributes=r,this.itemSize=n.bytesPerElement,this.dynamicDraw=i,this.instanceCount=s,this.context=t;const a=t.gl;this.buffer=a.createBuffer(),t.bindVertexBuffer.set(this.buffer),a.bufferData(a.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?a.DYNAMIC_DRAW:a.STATIC_DRAW),this.dynamicDraw||o||n.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let r=0;r<this.attributes.length;r++){const i=n.attributes[this.attributes[r].name];i!==void 0&&t.enableVertexAttribArray(i)}}setVertexAttribPointers(t,n,r){for(let i=0;i<this.attributes.length;i++){const o=this.attributes[i],s=n.attributes[o.name];s!==void 0&&t.vertexAttribPointer(s,o.components,t[sL[o.type]],!1,this.itemSize,o.offset+this.itemSize*(r||0))}}setVertexAttribDivisor(t,n,r){for(let i=0;i<this.attributes.length;i++){const o=n.attributes[this.attributes[i].name];o!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(o,r)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ir{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class lL extends ir{getDefault(){return Me.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class uL extends ir{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class cL extends ir{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class hL extends ir{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class fL extends ir{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class dL extends ir{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class pL extends ir{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class mL extends ir{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class gL extends ir{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class _L extends ir{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class yL extends ir{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class xL extends ir{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class vL extends ir{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class wL extends ir{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class bL extends ir{getDefault(){return Me.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class AL extends ir{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class EL extends ir{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class TL extends ir{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class CL extends ir{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let SL=class extends ir{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}};class ML extends ir{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class IL extends ir{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class BL extends ir{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class DL extends ir{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class PL extends ir{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class LL extends ir{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class RL extends ir{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class kL extends ir{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class FL extends ir{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class zL extends ir{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class OL extends ir{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Ib extends ir{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class NL extends Ib{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class HC extends Ib{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,this.attachment(),n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class UL extends Ib{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,this.attachment(),n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class VL extends HC{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class GL{constructor(t,n,r,i,o){this.context=t,this.width=n,this.height=r;const s=this.framebuffer=t.gl.createFramebuffer();i&&(this.colorAttachment=new NL(t,s)),o&&(this.depthAttachmentType=o,this.depthAttachment=o==="renderbuffer"?new HC(t,s):new UL(t,s))}destroy(){const t=this.context.gl;if(this.colorAttachment){const n=this.colorAttachment.get();n&&t.deleteTexture(n)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const n=this.depthAttachment.get();n&&t.deleteRenderbuffer(n)}else{const n=this.depthAttachment.get();n&&t.deleteTexture(n)}t.deleteFramebuffer(this.framebuffer)}}class De{constructor(t,n,r){this.func=t,this.mask=n,this.range=r}}De.ReadOnly=!1,De.ReadWrite=!0,De.disabled=new De(519,De.ReadOnly,[0,1]);const Bb=7680;class Ke{constructor(t,n,r,i,o,s){this.test=t,this.ref=n,this.mask=r,this.fail=i,this.depthFail=o,this.pass=s}}Ke.disabled=new Ke({func:519,mask:0},0,0,Bb,Bb,Bb);const V1=771;class xn{constructor(t,n,r,i){this.blendFunction=t,this.blendColor=n,this.mask=r,this.blendEquation=i}}xn.Replace=[1,0,1,0],xn.disabled=new xn(xn.Replace,Me.transparent,[!1,!1,!1,!1]),xn.unblended=new xn(xn.Replace,Me.transparent,[!0,!0,!0,!0]),xn.alphaBlended=new xn([1,V1,1,V1],Me.transparent,[!0,!0,!0,!0]),xn.multiply=new xn([774,0,774,0],Me.transparent,[!0,!0,!0,!0]);const Db=1029,Pb=2305;class Qe{constructor(t,n,r){this.enable=t,this.mode=n,this.frontFace=r}}Qe.disabled=new Qe(!1,Db,Pb),Qe.backCCW=new Qe(!0,Db,Pb),Qe.backCW=new Qe(!0,Db,2304),Qe.frontCW=new Qe(!0,1028,2304),Qe.frontCCW=new Qe(!0,1028,Pb);class jL{constructor(t,n){this.gl=t,this.clearColor=new lL(this),this.clearDepth=new uL(this),this.clearStencil=new cL(this),this.colorMask=new hL(this),this.depthMask=new fL(this),this.stencilMask=new dL(this),this.stencilFunc=new pL(this),this.stencilOp=new mL(this),this.stencilTest=new gL(this),this.depthRange=new _L(this),this.depthTest=new yL(this),this.depthFunc=new xL(this),this.blend=new vL(this),this.blendFunc=new wL(this),this.blendColor=new bL(this),this.blendEquation=new AL(this),this.cullFace=new EL(this),this.cullFaceSide=new TL(this),this.frontFace=new CL(this),this.program=new SL(this),this.activeTexture=new ML(this),this.viewport=new IL(this),this.bindFramebuffer=new BL(this),this.bindRenderbuffer=new DL(this),this.bindTexture=new PL(this),this.bindVertexBuffer=new LL(this),this.bindElementBuffer=new RL(this),this.bindVertexArrayOES=new kL(this),this.pixelStoreUnpack=new FL(this),this.pixelStoreUnpackPremultiplyAlpha=new zL(this),this.pixelStoreUnpackFlipY=new OL(this),this.options=n?{...n}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n,r){return new rc(this,t,n,r)}createVertexBuffer(t,n,r,i,o){return new aL(this,t,n,r,i,o)}createRenderbuffer(t,n,r){const i=this.gl,o=i.createRenderbuffer();return this.bindRenderbuffer.set(o),i.renderbufferStorage(i.RENDERBUFFER,t,n,r),this.bindRenderbuffer.set(null),o}createFramebuffer(t,n,r,i){return new GL(this,t,n,r,i)}clear({color:t,depth:n,stencil:r,colorMask:i}){const o=this.gl;let s=0;t&&(s|=o.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(i||[!0,!0,!0,!0])),n!==void 0&&(s|=o.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),r!==void 0&&(s|=o.STENCIL_BUFFER_BIT,this.clearStencil.set(r),this.stencilMask.set(255)),o.clear(s)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){Re(t.blendFunction,xn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class _a extends Sr{constructor(t,n,r){super(),this.id=t,this._onlySymbols=r,n.on("data",i=>{i.dataType==="source"&&i.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&i.dataType==="source"&&i.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new oL(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new lP,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const n=this._tiles[t];if(n.state!=="errored"&&(n.state!=="loaded"||!n.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,n){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const r=this._tiles[n];r.upload(t),r.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return hi(this._tiles).map(t=>t.tileID).sort(ZC).map(t=>t.key)}getRenderableIds(t,n){const r=[];for(const i in this._tiles)this._isIdRenderable(+i,t,n)&&r.push(this._tiles[i]);return t?r.sort((i,o)=>{const s=i.tileID,a=o.tileID,c=new nt(s.canonical.x,s.canonical.y)._rotate(this.transform.angle),h=new nt(a.canonical.x,a.canonical.y)._rotate(this.transform.angle);return s.overscaledZ-a.overscaledZ||h.y-c.y||h.x-c.x}).map(i=>i.tileID.key):r.map(i=>i.tileID).sort(ZC).map(i=>i.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n,r){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())&&(r||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,n){const r=this._tiles[t];r&&(r.state!=="loading"&&(r.state=n),this._loadTile(r,this._tileLoaded.bind(this,r,t,n)))}_tileLoaded(t,n,r,i){if(i)if(t.state="errored",i.status!==404)this._source.fire(new Ie(i,{tile:t}));else{if(!(t.tileID.key in this._loadedParentTiles))return void this._source.fire(new Nt("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const o=this.map.painter.terrain;this.update(this.transform,o.getScaledDemTileSize(),!0),o.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=ze.now(),r==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new Nt("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const n=this.getRenderableIds();for(let i=0;i<n.length;i++){const o=n[i];if(t.neighboringTiles&&t.neighboringTiles[o]){const s=this.getTileByID(o);r(t,s),r(s,t)}}function r(i,o){if(!i.dem||i.dem.borderReady)return;i.needsHillshadePrepare=!0,i.needsDEMTextureUpload=!0;let s=o.tileID.canonical.x-i.tileID.canonical.x;const a=o.tileID.canonical.y-i.tileID.canonical.y,c=Math.pow(2,i.tileID.canonical.z),h=o.tileID.key;s===0&&a===0||Math.abs(a)>1||(Math.abs(s)>1&&(Math.abs(s+c)===1?s+=c:Math.abs(s-c)===1&&(s-=c)),o.dem&&i.dem&&(i.dem.backfillBorder(o.dem,s,a),i.neighboringTiles&&i.neighboringTiles[h]&&(i.neighboringTiles[h].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,r,i){for(const o in this._tiles){let s=this._tiles[o];if(i[o]||!s.hasData()||s.tileID.overscaledZ<=n||s.tileID.overscaledZ>r)continue;let a=s.tileID;for(;s&&s.tileID.overscaledZ>n+1;){const h=s.tileID.scaledTo(s.tileID.overscaledZ-1);s=this._tiles[h.key],s&&s.hasData()&&(a=h)}let c=a;for(;c.overscaledZ>n;)if(c=c.scaledTo(c.overscaledZ-1),t[c.key]){i[a.key]=a;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const r=this._loadedParentTiles[t.key];return r&&r.tileID.overscaledZ>=n?r:null}for(let r=t.overscaledZ-1;r>=n;r--){const i=t.scaledTo(r),o=this._getLoadedTile(i);if(o)return o}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,n){n=n||this._source.tileSize;const r=Math.ceil(t.width/n)+1,i=Math.ceil(t.height/n)+1,o=Math.floor(r*i*5),s=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,o):o,a=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,s):s;this._cache.setMaxSize(a)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,n){const r={};for(const i in this._tiles){const o=this._tiles[i];o.tileID=o.tileID.unwrapTo(o.tileID.wrap+n),r[o.tileID.key]=o}this._tiles=r;for(const i in this._timers)clearTimeout(this._timers[i]),delete this._timers[i];for(const i in this._tiles)this._setTileReloadTimer(+i,this._tiles[i])}}update(t,n,r,i){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!r)return;let o;if(this.updateCacheSize(t,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?o=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(c=>new sn(c.canonical.z,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y)):(o=t.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(o=o.filter(c=>this._source.hasTile(c)))):o=[],o.length>0&&this.castsShadows&&i&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Lb(this._source.type)){const c=t.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!r}),h=Math.min(c,this._source.maxzoom),d=t.extendTileCoverForShadows(o,i,h);for(const m of d)this._shadowCasterTiles[m.key]=!0,o.push(m)}const s=this._updateRetainedTiles(o);if(Lb(this._source.type)&&o.length!==0){const c={},h={},d=Object.keys(s);for(const g of d){const x=s[g],v=this._tiles[g];if(!v||v.fadeEndTime&&v.fadeEndTime<=ze.now())continue;const w=this.findLoadedParent(x,Math.max(x.overscaledZ-_a.maxOverzooming,this._source.minzoom));w&&(this._addTile(w.tileID),c[w.tileID.key]=w.tileID),h[g]=x}const m=o[o.length-1].overscaledZ;for(const g in this._tiles){const x=this._tiles[g];if(s[g]||!x.hasData())continue;let v=x.tileID;for(;v.overscaledZ>m;){v=v.scaledTo(v.overscaledZ-1);const w=this._tiles[v.key];if(w&&w.hasData()&&h[v.key]){s[g]=x.tileID;break}}}for(const g in c)s[g]||(this._coveredTiles[g]=!0,s[g]=c[g])}for(const c in s)this._tiles[c].clearFadeHold();const a=function(c,h){const d=[];for(const m in c)m in h||d.push(m);return d}(this._tiles,s);for(const c of a){const h=this._tiles[c];h.hasSymbolBuckets&&!h.holdingForFade()?h.setHoldDuration(this.map._fadeDuration):h.hasSymbolBuckets&&!h.symbolFadeFinished()||this._removeTile(+c)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const n={};if(t.length===0)return n;const r={},i=t.reduce((h,d)=>Math.min(h,d.overscaledZ),1/0),o=t[0].overscaledZ,s=Math.max(o-_a.maxOverzooming,this._source.minzoom),a=Math.max(o+_a.maxUnderzooming,this._source.minzoom),c={};for(const h of t){const d=this._addTile(h);n[h.key]=h,d.hasData()||i<this._source.maxzoom&&(c[h.key]=h)}this._retainLoadedChildren(c,i,a,n);for(const h of t){let d=this._tiles[h.key];if(d.hasData())continue;if(h.canonical.z>=this._source.maxzoom){const g=h.children(this._source.maxzoom)[0],x=this.getTile(g);if(x&&x.hasData()){n[g.key]=g;continue}}else{const g=h.children(this._source.maxzoom);if(n[g[0].key]&&n[g[1].key]&&n[g[2].key]&&n[g[3].key])continue}let m=d.wasRequested();for(let g=h.overscaledZ-1;g>=s;--g){const x=h.scaledTo(g);if(r[x.key]||(r[x.key]=!0,d=this.getTile(x),!d&&m&&(d=this._addTile(x)),d&&(n[x.key]=x,m=d.wasRequested(),d.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let r,i=this._tiles[t].tileID;for(;i.overscaledZ>0;){if(i.key in this._loadedParentTiles){r=this._loadedParentTiles[i.key];break}n.push(i.key);const o=i.scaledTo(i.overscaledZ-1);if(r=this._getLoadedTile(o),r)break;i=o}for(const o of n)this._loadedParentTiles[o]=r}}_addTile(t){let n=this._tiles[t.key];if(n)return n.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const r=!!n;if(!r){const i=this.map?this.map.painter:null;n=new Ag(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,i,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))}return n?(n.uses++,this._tiles[t.key]=n,r||this._source.fire(new Nt("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const r=n.getExpiryTimeout();r&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},r))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,n,r){const i=[],o=this.transform;if(!o)return i;const s=o.projection.name==="globe",a=Ir(o.center.lng);for(const c in this._tiles){const h=this._tiles[c];if(r&&h.clearQueryDebugViz(),h.holdingForFade())continue;let d;if(s){const m=h.tileID.canonical;if(m.z===0){const g=[Math.abs($t(a,...Eg(m,-1))-a),Math.abs($t(a,...Eg(m,1))-a)];d=[0,2*g.indexOf(Math.min(...g))-1]}else{const g=[Math.abs($t(a,...Eg(m,-1))-a),Math.abs($t(a,...Eg(m,0))-a),Math.abs($t(a,...Eg(m,1))-a)];d=[g.indexOf(Math.min(...g))-1]}}else d=[0];for(const m of d){const g=t.containsTile(h,o,n,m);g&&i.push(g)}}return i}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,n){const r=this.getRenderableIds(t,n).map(o=>this._tiles[o].tileID),i=this.transform.projection.name==="globe";for(const o of r)o.projMatrix=this.transform.calculateProjMatrix(o.toUnwrapped()),o.expandedProjMatrix=i?this.transform.calculateProjMatrix(o.toUnwrapped(),!1,!0):o.projMatrix;return r}sortCoordinatesByDistance(t){const n=t.slice(),r=this.transform._camera.position,i=this.transform._camera.forward(),o={};for(const s of n){const a=1/(1<<s.canonical.z);o[s.key]=((s.canonical.x+.5)*a+s.wrap-r[0])*i[0]+((s.canonical.y+.5)*a-r[1])*i[1]-r[2]*i[2]}return n.sort((s,a)=>o[s.key]-o[a.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(Lb(this._source.type))for(const t in this._tiles){const n=this._tiles[t];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=ze.now())return!0}return!1}setFeatureState(t,n,r){this._state.updateState(t=t||"_geojsonTileLayer",n,r)}removeFeatureState(t,n,r){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,r)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,r){const i=this._tiles[t];i&&i.setDependencies(n,r)}reloadTilesForDependencies(t,n){for(const r in this._tiles)this._tiles[r].hasDependency(t,n)&&this._reloadTile(+r,"reloading");this._cache.filter(r=>!r.hasDependency(t,n))}_preloadTiles(t,n){if(!this._sourceLoaded){const a=()=>{this._sourceLoaded&&(this._source.off("data",a),this._preloadTiles(t,n))};return void this._source.on("data",a)}const r=new Map,i=Array.isArray(t)?t:[t],o=this.map.painter.terrain,s=this.usedForTerrain&&o?o.getScaledDemTileSize():this._source.tileSize;for(const a of i){const c=a.coveringTiles({tileSize:s,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const h of c)r.set(h.key,h);this.usedForTerrain&&a.updateElevation(!1)}Mi(Array.from(r.values()),(a,c)=>{const h=new Ag(a,this._source.tileSize*a.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(h,d=>{this._source.type==="raster-dem"&&h.dem&&this._backfillDEM(h),c(d,h)})},n)}}function ZC(e,t){const n=Math.abs(2*e.wrap)-+(e.wrap<0),r=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||r-n||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function Lb(e){return e==="raster"||e==="image"||e==="video"||e==="custom"}function Eg(e,t){const n=1<<e.z;return[e.x/n+t,(e.x+1)/n+t]}_a.maxOverzooming=10,_a.maxUnderzooming=3;const HL=wn([{name:"a_pos_3f",components:3,type:"Float32"}]),ZL=wn([{name:"a_color_3f",components:3,type:"Float32"}]),WL=wn([{name:"a_color_4f",components:4,type:"Float32"}]),qL=wn([{name:"a_uv_2f",components:2,type:"Float32"}]),JL=wn([{name:"a_normal_3f",components:3,type:"Float32"}]),$L=wn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),KL=wn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class Rb{constructor(t=0,n=0,r=0,i=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(r)||r<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=r,this.right=i}interpolate(t,n,r){return n.top!=null&&t.top!=null&&(this.top=Ce(t.top,n.top,r)),n.bottom!=null&&t.bottom!=null&&(this.bottom=Ce(t.bottom,n.bottom,r)),n.left!=null&&t.left!=null&&(this.left=Ce(t.left,n.left,r)),n.right!=null&&t.right!=null&&(this.right=Ce(t.right,n.right,r)),this}getCenter(t,n){const r=$t((this.left+t-this.right)/2,0,t),i=$t((this.top+n-this.bottom)/2,0,n);return new nt(r,i)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Rb(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function WC(e,t){const n=Qn(e,3);lt.fromQuat(e,t),Nr(e,3,n)}function kb(e,t){const n=En.identity([]);return En.rotateZ(n,n,-t),En.rotateX(n,n,-e),n}function qC(e,t){const n=[e[0],e[1],0],r=[t[0],t[1],0];if(J.length(n)>=1e-15){const s=J.normalize([],n);J.scale(r,s,J.dot(r,s)),t[0]=r[0],t[1]=r[1]}const i=J.cross([],t,e);if(J.len(i)<1e-15)return null;const o=Math.atan2(-i[1],i[0]);return kb(Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2]),o)}class JC{constructor(t,n){this.position=t,this.orientation=n}get position(){return this._position}set position(t){if(t){const n=t instanceof an?t:new an(t[0],t[1],t[2]);this._renderWorldCopies&&(n.x=ci(n.x,0,1)),this._position=n}else this._position=null}lookAtPoint(t,n){if(this.orientation=null,!this.position)return;const r=this.position,i=this._elevation?this._elevation.getAtPointOrZero(an.fromLngLat(t)):0,o=an.fromLngLat(t,i),s=[o.x-r.x,o.y-r.y,o.z-r.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=qC(s,n)}setPitchBearing(t,n){this.orientation=kb(Ae(t),Ae(-n))}}class G1{constructor(t,n){this._transform=lt.identity([]),this.orientation=n,this.position=t}get mercatorPosition(){const t=this.position;return new an(t[0],t[1],t[2])}get position(){const t=Qn(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var n;t&&Nr(this._transform,3,[(n=t)[0],n[1],n[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||En.identity([]),t&&WC(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),n=this.right();return{bearing:Math.atan2(-n[1],n[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,n){this._orientation=kb(t,n),WC(this._transform,this._orientation)}forward(){const t=Qn(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=Qn(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=Qn(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,n){const r=new Float64Array(16);return lt.invert(r,this.getWorldToCamera(t,n)),r}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,n,r){const i=this.position;J.scale(i,i,-t);const o=new Float64Array(16);return lt.fromScaling(o,[r,r,r]),lt.translate(o,o,i),o[10]*=n,o}getWorldToCamera(t,n){const r=new Float64Array(16),i=new Float64Array(4),o=this.position;return En.conjugate(i,this._orientation),J.scale(o,o,-t),lt.fromQuat(r,i),lt.translate(r,r,o),r[1]*=-1,r[5]*=-1,r[9]*=-1,r[13]*=-1,r[8]*=n,r[9]*=n,r[10]*=n,r[11]*=n,r}getCameraToClipPerspective(t,n,r,i){const o=new Float64Array(16);return lt.perspective(o,t,n,r,i),o}getCameraToClipOrthographic(t,n,r,i,o,s){const a=new Float64Array(16);return lt.ortho(a,t,n,r,i,o,s),a}getDistanceToElevation(t,n=!1){const r=t===0?0:Rn(t,n?Br(this.position[1]):this.position[1]),i=this.forward();return(r-this.position[2])/i[2]}clone(){return new G1([...this.position],[...this.orientation])}}function $C(e,t){const n=Tg(e.projection,e.zoom,e.width,e.height),r=function(o,s,a,c,h){const d=new Be(a.lng-180*ic,a.lat),m=new Be(a.lng+180*ic,a.lat),g=o.project(d.lng,d.lat),x=o.project(m.lng,m.lat),v=-Math.atan2(x.y-g.y,x.x-g.x),w=an.fromLngLat(a);w.y=$t(w.y,-1+ic,1-ic);const A=w.toLngLat(),E=o.project(A.lng,A.lat),S=an.fromLngLat(A);S.x+=ic;const I=S.toLngLat(),B=o.project(I.lng,I.lat),M=YC(B.x-E.x,B.y-E.y,v),D=an.fromLngLat(A);D.y+=ic;const R=D.toLngLat(),z=o.project(R.lng,R.lat),N=YC(z.x-E.x,z.y-E.y,v),V=Math.abs(M.x)/Math.abs(N.y),j=lt.identity([]);lt.rotateZ(j,j,-v*(1-(h?0:c)));const H=lt.identity([]);return lt.scale(H,H,[1,1-(1-V)*c,1]),H[4]=-N.x/N.y*c,lt.rotateZ(H,H,v),lt.multiply(H,j,H),H}(e.projection,0,e.center,n,t),i=KC(e);return lt.scale(r,r,[i,i,1]),r}function KC(e){const t=e.projection,n=Tg(e.projection,e.zoom,e.width,e.height),r=XC(t,e.center),i=XC(t,Be.convert(t.center));return Math.pow(2,r*n+(1-n)*i)}function Tg(e,t,n,r,i=1/0){const o=e.range;if(!o)return 0;const s=Math.min(i,Math.max(n,r)),a=Math.log(s/1024)/Math.LN2;return Ui(o[0]+a,o[1]+a,t)}const ic=1/4e4;function XC(e,t){const n=$t(t.lat,-xr,xr),r=new Be(t.lng-180*ic,n),i=new Be(t.lng+180*ic,n),o=e.project(r.lng,n),s=e.project(i.lng,n),a=an.fromLngLat(r),c=an.fromLngLat(i),h=s.x-o.x,d=s.y-o.y,m=c.x-a.x,g=c.y-a.y,x=Math.sqrt((m*m+g*g)/(h*h+d*d));return Math.log(x)/Math.LN2}function YC(e,t,n){const r=Math.cos(n),i=Math.sin(n);return{x:e*r-t*i,y:e*i+t*r}}function Th(e,t,n){return t*(gt/(e.tileSize*Math.pow(2,n-e.tileID.overscaledZ)))}const bd={unknown:0,flipRequired:1,flipNotRequired:2},XL=Math.tan(85*Math.PI/180);function j1(e,t,n,r,i,o,s){const a=lt.create();if(n)if(o.name==="globe"){const c=function(h,d){const{x:m,y:g}=h.point,x=Hy(m,g,h.worldSize/h._pixelsPerMercatorPixel,0,0);return lt.multiply(x,x,Ri(To(d)))}(i,t);lt.multiply(a,a,c)}else{const c=Hu.invert([],s);a[0]=c[0],a[1]=c[1],a[4]=c[2],a[5]=c[3],r||lt.rotateZ(a,a,i.angle)}else lt.multiply(a,i.labelPlaneMatrix,e);return a}function QC(e,t,n,r,i,o,s){const a=j1(e,t,n,r,i,o,s);return o.name==="globe"&&n||(a[2]=a[6]=a[10]=a[14]=0),a}function tS(e,t,n,r,i,o,s){if(n){if(o.name==="globe"){const a=j1(e,t,n,r,i,o,s);return lt.invert(a,a),lt.multiply(a,e,a),a}{const a=lt.clone(e),c=lt.identity([]);return c[0]=s[0],c[1]=s[1],c[4]=s[2],c[5]=s[3],lt.multiply(a,a,c),r||lt.rotateZ(a,a,-i.angle),a}}return i.glCoordMatrix}function ya(e,t,n,r){const i=[e,t,n,1];n?Bn.transformMat4(i,i,r):aS(i,i,r);const o=i[3];return i[0]/=o,i[1]/=o,i[2]/=o,i}function eS(e,t){return Math.min(.5+e/t*.5,1.5)}function YL(e,t){const n=e[0]/e[3],r=e[1]/e[3];return n>=-t[0]&&n<=t[0]&&r>=-t[1]&&r<=t[1]}function QL(e,t,n,r,i,o,s,a,c,h){const d=n.transform,m=r?e.textSizeData:e.iconSizeData,g=Xa(m,n.transform.zoom),x=d.projection.name==="globe",v=[256/n.width*2+1,256/n.height*2+1],w=r?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;w.clear();let A=null;x&&(A=r?e.text.globeExtVertexArray:e.icon.globeExtVertexArray);const E=e.lineVertexArray,S=r?e.text.placedSymbolArray:e.icon.placedSymbolArray,I=n.transform.width/n.transform.height;let B,M=!1;for(let D=0;D<S.length;D++){const R=S.get(D),{numGlyphs:z,writingMode:N}=R;if(N!==fr.vertical||M||B===fr.horizontal||(M=!0),B=N,(R.hidden||N===fr.vertical)&&!M){Ad(z,w);continue}M=!1;const V=new nt(R.tileAnchorX,R.tileAnchorY);let{x:j,y:H,z:$}=d.projection.projectTilePoint(V.x,V.y,h.canonical);if(c){const[wt,bt,Et]=c(V);j+=wt,H+=bt,$+=Et}const G=[j,H,$,1];if(Bn.transformMat4(G,G,t),!YL(G,v)){Ad(z,w);continue}const Q=G[3],et=eS(n.transform.getCameraToCenterDistance(d.projection),Q),st=dg(m,g,R),Y=s?st/et:st*et,tt=ya(j,H,$,i);if(tt[3]<=0){Ad(z,w);continue}let ct={};const pt=s?null:c,dt=iS(R,Y,!1,a,t,i,o,e.glyphOffsetArray,E,w,A,tt,V,ct,I,pt,d.projection,h,s);M=dt.useVertical,pt&&dt.needsFlipping&&(ct={}),(dt.notEnoughRoom||M||dt.needsFlipping&&iS(R,Y,!0,a,t,i,o,e.glyphOffsetArray,E,w,A,tt,V,ct,I,pt,d.projection,h,s).notEnoughRoom)&&Ad(z,w)}r?(e.text.dynamicLayoutVertexBuffer.updateData(w),A&&e.text.globeExtVertexBuffer&&e.text.globeExtVertexBuffer.updateData(A)):(e.icon.dynamicLayoutVertexBuffer.updateData(w),A&&e.icon.globeExtVertexBuffer&&e.icon.globeExtVertexBuffer.updateData(A))}function nS(e,t,n,r,i,o,s,a,c,h,d,m,g,x,v,w){const{lineStartIndex:A,glyphStartIndex:E,segment:S}=a,I=E+a.numGlyphs,B=A+a.lineLength,M=t.getoffsetX(E),D=t.getoffsetX(I-1),R=H1(e*M,n,r,i,o,s,S,A,B,c,h,d,m,g,!0,x,v,w);if(!R)return null;const z=H1(e*D,n,r,i,o,s,S,A,B,c,h,d,m,g,!0,x,v,w);return z?{first:R,last:z}:null}function rS(e,t,n,r){return e===fr.horizontal&&Math.abs(r)>Math.abs(n)?{useVertical:!0}:e===fr.vertical?r>0?{needsFlipping:!0}:null:t!==bd.unknown&&function(i,o){return i===0||Math.abs(o/i)>XL}(n,r)?t===bd.flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null}function iS(e,t,n,r,i,o,s,a,c,h,d,m,g,x,v,w,A,E,S){const I=t/24,B=e.lineOffsetX*I,M=e.lineOffsetY*I,{lineStartIndex:D,glyphStartIndex:R,numGlyphs:z,segment:N,writingMode:V,flipState:j}=e,H=D+e.lineLength,$=G=>{if(d){const[Y,tt,ct]=G.up,pt=h.length;F1(d,pt+0,Y,tt,ct),F1(d,pt+1,Y,tt,ct),F1(d,pt+2,Y,tt,ct),F1(d,pt+3,Y,tt,ct)}const[Q,et,st]=G.point;wd(h,Q,et,st,G.angle)};if(z>1){const G=nS(I,a,B,M,n,m,g,e,c,o,x,w,!1,A,E,S);if(!G)return{notEnoughRoom:!0};if(r&&!n){let[Q,et,st]=G.first.point,[Y,tt,ct]=G.last.point;[Q,et]=ya(Q,et,st,s),[Y,tt]=ya(Y,tt,ct,s);const pt=rS(V,j,(Y-Q)*v,tt-et);if(e.flipState=pt&&pt.needsFlipping?bd.flipRequired:bd.flipNotRequired,pt)return pt}$(G.first);for(let Q=R+1;Q<R+z-1;Q++){const et=H1(I*a.getoffsetX(Q),B,M,n,m,g,N,D,H,c,o,x,w,!1,!1,A,E,S);if(!et)return h.length-=4*(Q-R),{notEnoughRoom:!0};$(et)}$(G.last)}else{if(r&&!n){const Q=ya(g.x,g.y,0,i),et=D+N+1,st=new nt(c.getx(et),c.gety(et)),Y=ya(st.x,st.y,0,i),tt=Y[3]>0?Y:sS(g,st,Q,1,i,void 0,A,E.canonical),ct=rS(V,j,(tt[0]-Q[0])*v,tt[1]-Q[1]);if(e.flipState=ct&&ct.needsFlipping?bd.flipRequired:bd.flipNotRequired,ct)return ct}const G=H1(I*a.getoffsetX(R),B,M,n,m,g,N,D,H,c,o,x,w,!1,!1,A,E,S);if(!G)return{notEnoughRoom:!0};$(G)}return{}}function oS(e,t,n,r,i){const{x:o,y:s,z:a}=r.projectTilePoint(e.x,e.y,t);if(!i)return ya(o,s,a,n);const[c,h,d]=i(e);return ya(o+c,s+h,a+d,n)}function sS(e,t,n,r,i,o,s,a){const c=oS(e.sub(t)._unit()._add(e),a,i,s,o);return J.sub(c,n,c),J.normalize(c,c),J.scaleAndAdd(c,n,c,r)}function H1(e,t,n,r,i,o,s,a,c,h,d,m,g,x,v,w,A,E){const S=r?e-t:e+t;let I=S>0?1:-1,B=0;r&&(I*=-1,B=Math.PI),I<0&&(B+=Math.PI);let M=a+s+(I>0?0:1)|0,D=i,R=i,z=0,N=0;const V=Math.abs(S),j=[],H=[];let $=o,G=$;const Q=()=>sS(G,$,R,V-z+1,d,g,w,A.canonical);for(;z+N<=V;){if(M+=I,M<a||M>=c)return null;if(R=D,G=$,j.push(R),x&&H.push(G),$=new nt(h.getx(M),h.gety(M)),D=m[M],!D){const bt=oS($,A.canonical,d,w,g);D=bt[3]>0?m[M]=bt:Q()}z+=N,N=J.distance(R,D)}v&&g&&(m[M]&&(D=Q(),N=J.distance(R,D)),m[M]=D);const et=(V-z)/N,st=$.sub(G)._mult(et)._add(G),Y=J.sub([],D,R),tt=J.scaleAndAdd([],R,Y,et);let ct=[0,0,1],pt=Y[0],dt=Y[1];if(E&&(ct=w.upVector(A.canonical,st.x,st.y),ct[0]!==0||ct[1]!==0||ct[2]!==1)){const bt=[ct[2],0,-ct[0]],Et=J.cross([],ct,bt);J.normalize(bt,bt),J.normalize(Et,Et),pt=J.dot(Y,bt),dt=J.dot(Y,Et)}if(n){const bt=J.cross([],ct,Y);J.normalize(bt,bt),J.scaleAndAdd(tt,tt,bt,n*I)}const wt=B+Math.atan2(dt,pt);return j.push(tt),x&&H.push(st),{point:tt,angle:wt,path:j,tilePath:H,up:ct}}function Ad(e,t){const n=t.length,r=n+4*e;t.resize(r),t.float32.fill(-1/0,4*n,4*r)}function aS(e,t,n){const r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e[3]=n[3]*r+n[7]*i+n[15],e}const lS=(e,t,n)=>(1-n)*e+n*t,uS=e=>e*e*e*e*e;class Fb{constructor(t,n,r,i,o,s,a){this.tileSize=512,this._renderWorldCopies=o===void 0||o,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=r??0,this._maxPitch=i??60,this.setProjection(s),this.setMaxBounds(a),this.width=0,this.height=0,this._center=new Be(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Rb,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new G1,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const t=new Fb(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,n=!1){const r=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||r)&&this._updateCameraOnTerrain(),(t||r)&&this._constrainCamera(n),this._calcMatrices()}getProjection(){return fi(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const n=this.projection?this.getProjection():void 0;this.projection=D1(this.projectionOptions);const r=!Re(n,this.getProjection());return r&&this._calcMatrices(),this.mercatorFromTransition=!1,r}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=D1({name:"mercator"});const n=t!==this.projection.name;return n&&this._calcMatrices(),n}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return Rn(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new nt(this.width,this.height)}get bearing(){return ci(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const n=-t*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=Hu.create(),Hu.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=$t(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=Ae(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._setZoom(n),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,n=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!n||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;n||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&r.exaggeration()&&this._centerAltitudeValidForExaggeration!==r.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*r.exaggeration(),this._centerAltitudeValidForExaggeration=r.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=r.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,n=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],r=this.horizonLineFromTop();let i=0,o=0;for(let s=0;s<n.length;s++){const a=new nt(n[s][0]*this.width,r+n[s][1]*(this.height-r)),c=t.pointCoordinate(a);if(!c)continue;const h=1/Math.hypot(c[0]-this._camera.position[0],c[1]-this._camera.position[1]);i+=c[3]*h,o+=h}return o===0?NaN:i/o}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,n=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),r=this.pixelsPerMeter/this.worldSize*n,i=this._mercatorZfromZoom(t),o=this._mercatorZfromZoom(this._maxZoom),s=Math.max(i-r,o);this._setZoom(this._zoomFromMercatorZ(s))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const n=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let r;r=t.z<this._camera.position[2]?[n.x,n.y,n.z]:[t.x,t.y,t.z];const i=J.length(J.sub([],this._camera.position,r));return $t(this._zoomFromMercatorZ(i),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let n=!1;if(t.orientation&&!En.exactEquals(t.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(t.orientation)),t.position){const r=[t.position.x,t.position.y,t.position.z];J.exactEquals(r,this._camera.position)||(this._setCameraPosition(r),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,n=new JC;return n.position=new an(t[0],t[1],t[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this.renderWorldCopies,n}_setCameraOrientation(t){if(!En.length(t))return!1;En.normalize(t,t);const n=J.transformQuat([],[0,0,-1],t),r=J.transformQuat([],[0,-1,0],t);if(r[2]<0)return!1;const i=qC(n,r);return!!i&&(this._camera.orientation=i,!0)}_setCameraPosition(t){const n=this.zoomScale(this.minZoom)*this.tileSize,r=this.zoomScale(this.maxZoom)*this.tileSize,i=this.cameraToCenterDistance;t[2]=$t(t[2],i/r,i/n),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,r){this._unmodified=!1,this._edgeInsets.interpolate(t,n,r),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new Yi(0,t)];if(this.renderWorldCopies){const r=this.pointCoordinate(new nt(0,0)),i=this.pointCoordinate(new nt(this.width,0)),o=this.pointCoordinate(new nt(this.width,this.height)),s=this.pointCoordinate(new nt(0,this.height)),a=Math.floor(Math.min(r.x,i.x,o.x,s.x)),c=Math.floor(Math.max(r.x,i.x,o.x,s.x)),h=1;for(let d=a-h;d<=c+h;d++)d!==0&&n.push(new Yi(d,t))}return n}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(t,n,r){let i=[];if(n[0]===0&&n[1]===0)return i;for(const s of t){const a=s.canonical,c=s.overscaledZ,h=s.wrap,d=1<<a.z,m=a.x+1<d,g=a.x>0,x=a.y+1<d,v=a.y>0,w=s.wrap-(g?0:1),A=s.wrap+(m?0:1),E=g?a.x-1:d-1,S=m?a.x+1:0;n[0]<0?(i.push(new sn(c,A,a.z,S,a.y)),n[1]<0&&x&&(i.push(new sn(c,h,a.z,a.x,a.y+1)),i.push(new sn(c,A,a.z,S,a.y+1))),n[1]>0&&v&&(i.push(new sn(c,h,a.z,a.x,a.y-1)),i.push(new sn(c,A,a.z,S,a.y-1)))):n[0]>0?(i.push(new sn(c,w,a.z,E,a.y)),n[1]<0&&x&&(i.push(new sn(c,h,a.z,a.x,a.y+1)),i.push(new sn(c,w,a.z,E,a.y+1))),n[1]>0&&v&&(i.push(new sn(c,h,a.z,a.x,a.y-1)),i.push(new sn(c,w,a.z,E,a.y-1)))):n[1]<0&&x?i.push(new sn(c,h,a.z,a.x,a.y+1)):v&&i.push(new sn(c,h,a.z,a.x,a.y-1))}if(i.length>1){i.sort((c,h)=>c.overscaledZ-h.overscaledZ||c.wrap-h.wrap||c.canonical.z-h.canonical.z||c.canonical.x-h.canonical.x||c.canonical.y-h.canonical.y);let s=0,a=0;for(;a<i.length;)i[a].equals(i[s])?++a:i[++s]=i[a++];i.length=s+1}const o=[];for(const s of i)i.some(a=>s.isChildOf(a))||o.push(s);return i=o.filter(s=>!t.some(a=>!!(s.overscaledZ<r&&a.isChildOf(s))||s.equals(a)||s.isChildOf(a))),i}coveringTiles(t){let n=this.coveringZoomLevel(t);const r=n,i=this.elevation&&this.elevation.exaggeration(),o=i&&!t.isTerrainDEM,s=this.projection.name==="mercator";if(t.minzoom!==void 0&&n<t.minzoom)return[];t.maxzoom!==void 0&&n>t.maxzoom&&(n=t.maxzoom);const a=this.locationCoordinate(this.center),c=this.center.lat,h=1<<n,d=[h*a.x,h*a.y,0],m=this.projection.name==="globe",g=!m,x=Rs.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,g),v=m?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),w=h*Rn(1,this.center.lat),A=this._camera.position[2]/Rn(1,this.center.lat),E=[h*v.x,h*v.y,A*(g?1:w)],S=m||i,I=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),B=this.isLODDisabled(!0)?n:0;let M;if(this._elevation&&t.isTerrainDEM)M=1e4*this._elevation.exaggeration();else if(this._elevation){const Y=this._elevation.getMinMaxForVisibleTiles();M=Y?Y.max:this._centerAltitude}else M=this._centerAltitude;const D=t.isTerrainDEM?-M:this._elevation?this._elevation.getMinElevationBelowMSL():0,R=this.projection.isReprojectedInTileSpace?KC(this):1,z=Y=>{const ct=new an(Y.x+25e-6,Y.y,Y.z),pt=new an(Y.x,Y.y+25e-6,Y.z),dt=Y.toLngLat(),wt=ct.toLngLat(),bt=pt.toLngLat(),Et=this.locationCoordinate(dt),_t=this.locationCoordinate(wt),Mt=this.locationCoordinate(bt),qt=Math.hypot(_t.x-Et.x,_t.y-Et.y),Jt=Math.hypot(Mt.x-Et.x,Mt.y-Et.y);return Math.sqrt(qt*Jt)*R/25e-6},N=Y=>{const tt=M,ct=D;return{aabb:RC(this,h,0,0,0,Y,ct,tt,this.projection),zoom:0,x:0,y:0,minZ:ct,maxZ:tt,wrap:Y,fullyVisible:!1}},V=[];let j=[];const H=n,$=t.reparseOverscaled?r:n,G=Y=>Y*Y,Q=G((A-this._centerAltitude)*w),et=Y=>{if(!this._elevation||!Y.tileID||!s)return;const tt=this._elevation.getMinMaxForTile(Y.tileID),ct=Y.aabb;tt?(ct.min[2]=tt.min,ct.max[2]=tt.max,ct.center[2]=(ct.min[2]+ct.max[2])/2):(Y.shouldSplit=st(Y),Y.shouldSplit||(ct.min[2]=ct.max[2]=ct.center[2]=this._centerAltitude))},st=Y=>{if(Y.zoom<B)return!0;if(Y.zoom===H)return!1;if(Y.shouldSplit!=null)return Y.shouldSplit;const tt=Y.aabb.distanceX(E),ct=Y.aabb.distanceY(E);let pt=Q,dt=1;if(m){pt=G(Y.aabb.distanceZ(E));const Et=Math.pow(2,Y.zoom),_t=Br((Y.y+1)/Et),Mt=Br(Y.y/Et),qt=Math.min(Math.max(c,_t),Mt),Jt=id(qt)/id(c);if(dt=qt===c?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Jt/this._mercatorScaleRatio),this.zoom<=Wu&&Y.zoom===H-1&&Jt>=.9)return!0}else if(o&&(pt=G(Y.aabb.distanceZ(E)*w)),this.projection.isReprojectedInTileSpace&&r<=5){const Et=Math.pow(2,Y.zoom),_t=z(new an((Y.x+.5)/Et,(Y.y+.5)/Et));dt=_t>.85?1:_t}const wt=tt*tt+ct*ct+pt,bt=G((1<<H-Y.zoom)*I*dt*((Et,_t)=>{if(_t*G(.707)<Et)return 1;const Mt=Math.sqrt(_t/Et);return Mt/(1.4144271570014144+(Math.pow(1.1,Mt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(pt,Q),wt));return wt<bt};if(this.renderWorldCopies)for(let Y=1;Y<=3;Y++)V.push(N(-Y)),V.push(N(Y));for(V.push(N(0));V.length>0;){const Y=V.pop(),tt=Y.x,ct=Y.y;let pt=Y.fullyVisible;const dt=()=>this.projection.name==="globe"&&(Y.y===0||Y.y===(1<<Y.zoom)-1);if(!pt){let wt=S?Y.aabb.intersects(x):Y.aabb.intersectsFlat(x);if(wt===0&&dt()){const bt=new Xi(Y.zoom,tt,ct);wt=Ym(this,h,bt,!0).intersects(x)}if(wt===0)continue;pt=wt===2}if(Y.zoom!==H&&st(Y))for(let wt=0;wt<4;wt++){const bt=(tt<<1)+wt%2,Et=(ct<<1)+(wt>>1),_t={aabb:s?Y.aabb.quadrant(wt):RC(this,h,Y.zoom+1,bt,Et,Y.wrap,Y.minZ,Y.maxZ,this.projection),zoom:Y.zoom+1,x:bt,y:Et,wrap:Y.wrap,fullyVisible:pt,tileID:void 0,shouldSplit:void 0,minZ:Y.minZ,maxZ:Y.maxZ};o&&!m&&(_t.tileID=new sn(Y.zoom+1===H?$:Y.zoom+1,Y.wrap,Y.zoom+1,bt,Et),et(_t)),V.push(_t)}else{const wt=Y.zoom===H?$:Y.zoom;if(t.minzoom&&t.minzoom>wt)continue;if(!pt){let Mt=S?Y.aabb.intersectsPrecise(x):Y.aabb.intersectsPreciseFlat(x);if(Mt===0&&dt()){const qt=new Xi(Y.zoom,tt,ct);Mt=Ym(this,h,qt,!0).intersectsPrecise(x)}if(Mt===0)continue}const bt=d[0]-(.5+tt+(Y.wrap<<Y.zoom))*(1<<n-Y.zoom),Et=d[1]-.5-ct,_t=Y.tileID?Y.tileID:new sn(wt,Y.wrap,Y.zoom,tt,ct);j.push({tileID:_t,distanceSq:bt*bt+Et*Et})}}if(this.fogCullDistSq){const Y=this.fogCullDistSq,tt=this.horizonLineFromTop();j=j.filter(ct=>{const pt=[0,0,0,1],dt=[gt,gt,0,1],wt=this.calculateFogTileMatrix(ct.tileID.toUnwrapped());Bn.transformMat4(pt,pt,wt),Bn.transformMat4(dt,dt,wt);const bt=function(Mt,qt,Jt){let ne=0;for(let se=0;se<2;++se)Mt[se]>0&&(ne+=(Mt[se]-0)*(Mt[se]-0)),qt[se]<0&&(ne+=(0-qt[se])*(0-qt[se]));return ne}(Bn.min([],pt,dt),Bn.max([],pt,dt));if(bt===0)return!0;let Et=!1;const _t=this._elevation;if(_t&&bt>Y&&tt!==0){const Mt=this.calculateProjMatrix(ct.tileID.toUnwrapped());let qt;t.isTerrainDEM||(qt=_t.getMinMaxForTile(ct.tileID)),qt||(qt={min:D,max:M});const Jt=function(se){const Pe=Math.round((se+45+360)%360/90)%4;return Bo[Pe]}(this.rotation),ne=[Jt[0]*gt,Jt[1]*gt,qt.max];J.transformMat4(ne,ne,Mt),Et=(1-ne[1])*this.height*.5<tt}return bt<Y||Et})}return j.sort((Y,tt)=>Y.distanceSq-tt.distanceSq).map(Y=>Y.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const n=$t(t.lat,-xr,xr),r=this.projection.project(t.lng,n);return new nt(r.x*this.worldSize,r.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/Rn(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,n){let r,i;const o=this.centerPoint;if(this.projection.name==="globe"){const a=this.worldSize;r=(n.x-o.x)/a,i=(n.y-o.y)/a}else{const a=this.pointCoordinate(n),c=this.pointCoordinate(o);r=a.x-c.x,i=a.y-c.y}const s=this.locationCoordinate(t);this.setLocation(new an(s.x-r,s.y-i))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,n){const r=n?Rn(n,t.lat):void 0,i=this.projection.project(t.lng,t.lat);return new an(i.x,i.y,r)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,n){const r=n??this._centerAltitude,i=[t.x,t.y,0,1],o=[t.x,t.y,1,1];Bn.transformMat4(i,i,this.pixelMatrixInverse),Bn.transformMat4(o,o,this.pixelMatrixInverse);const s=o[3];Bn.scale(i,i,1/i[3]),Bn.scale(o,o,1/s);const a=i[2],c=o[2];return{p0:i,p1:o,t:a===c?0:(r-a)/(c-a)}}screenPointToMercatorRay(t){const n=[t.x,t.y,0,1],r=[t.x,t.y,1,1];return Bn.transformMat4(n,n,this.pixelMatrixInverse),Bn.transformMat4(r,r,this.pixelMatrixInverse),Bn.scale(n,n,1/n[3]),Bn.scale(r,r,1/r[3]),n[2]=Rn(n[2],this._center.lat)*this.worldSize,r[2]=Rn(r[2],this._center.lat)*this.worldSize,Bn.scale(n,n,1/this.worldSize),Bn.scale(r,r,1/this.worldSize),new td([n[0],n[1],n[2]],J.normalize([],J.sub([],r,n)))}rayIntersectionCoordinate(t){const{p0:n,p1:r,t:i}=t,o=Rn(n[2],this._center.lat),s=Rn(r[2],this._center.lat);return new an(Ce(n[0],r[0],i)/this.worldSize,Ce(n[1],r[1],i)/this.worldSize,Ce(o,s,i))}pointCoordinate(t,n=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,n)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let n=this.projection.pointCoordinate3D(this,t.x,t.y);if(n)return new an(n[0],n[1],n[2]);let r=0,i=this.horizonLineFromTop();if(t.y>i)return this.pointCoordinate(t);const o=.02*i,s=t.clone();for(let a=0;a<10&&i-r>o;a++){s.y=Ce(r,i,.66);const c=this.projection.pointCoordinate3D(this,s.x,s.y);c?(i=s.y,n=c):r=s.y}return n?new an(n[0],n[1],n[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=Za)return!this.isPointAboveHorizon(t);const n=this.pointCoordinate(t);return n.y>=0&&n.y<=1}_coordinatePoint(t,n){const r=n&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,i=[t.x*this.worldSize,t.y*this.worldSize,r+t.toAltitude(),1];return Bn.transformMat4(i,i,this.pixelMatrix),i[3]>0?new nt(i[0]/i[3],i[1]/i[3]):new nt(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:n}=this._edgeInsets,r=this.height-this._edgeInsets.bottom,i=this.width-this._edgeInsets.right,o=this.pointLocation3D(new nt(n,t)),s=this.pointLocation3D(new nt(i,t)),a=this.pointLocation3D(new nt(i,r)),c=this.pointLocation3D(new nt(n,r));let h=Math.min(o.lng,s.lng,a.lng,c.lng),d=Math.max(o.lng,s.lng,a.lng,c.lng),m=Math.min(o.lat,s.lat,a.lat,c.lat),g=Math.max(o.lat,s.lat,a.lat,c.lat);const x=Math.pow(2,-this.zoom)/16*270,v=this.projection.name==="globe"?1:4,w=(A,E,S,I,B)=>{const M=(A+S)/2,D=(E+I)/2,R=new nt(M,D),{lng:z,lat:N}=this.pointLocation3D(R),V=Math.max(0,h-z,m-N,z-d,N-g);h=Math.min(h,z),d=Math.max(d,z),m=Math.min(m,N),g=Math.max(g,N),(B<v||V>x)&&(w(A,E,M,D,B+1),w(M,D,S,I,B+1))};if(w(n,t,i,t,1),w(i,t,i,r,1),w(i,r,n,r,1),w(n,r,n,t,1),this.projection.name==="globe"){const[A,E]=function(S){const I=lt.identity(new Float64Array(16));lt.multiply(I,S.pixelMatrix,S.globeMatrix);const B=[0,Vo,0],M=[0,Go,0];return J.transformMat4(B,B,I),J.transformMat4(M,M,I),[B[0]>0&&B[0]<=S.width&&B[1]>0&&B[1]<=S.height&&!vh(S,new Be(S.center.lat,90)),M[0]>0&&M[0]<=S.width&&M[1]>0&&M[1]<=S.height&&!vh(S,new Be(S.center.lat,-90))]}(this);A?(g=90,d=180,h=-180):E&&(m=-90,d=180,h=-180)}return new lo(new Be(h,m),new Be(d,g))}_getBoundsRectangular(t,n){const{top:r,left:i}=this._edgeInsets,o=this.height-this._edgeInsets.bottom,s=this.width-this._edgeInsets.right,a=new nt(i,r),c=new nt(s,r),h=new nt(s,o),d=new nt(i,o);let m=this.pointCoordinate(a,t),g=this.pointCoordinate(c,t);const x=this.pointCoordinate(h,n),v=this.pointCoordinate(d,n),w=(A,E)=>(E.y-A.y)/(E.x-A.x);return m.y>1&&g.y>=0?m=new an((1-v.y)/w(v,m)+v.x,1):m.y<0&&g.y<=1&&(m=new an(-v.y/w(v,m)+v.x,0)),g.y>1&&m.y>=0?g=new an((1-x.y)/w(x,g)+x.x,1):g.y<0&&m.y<=1&&(g=new an(-x.y/w(x,g)+x.x,0)),new lo().extend(this.coordinateLocation(m)).extend(this.coordinateLocation(g)).extend(this.coordinateLocation(v)).extend(this.coordinateLocation(x))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const n=t.visibleDemTiles.reduce((r,i)=>{if(i.dem){const o=i.dem.tree;r.min=Math.min(r.min,o.minimums[0]),r.max=Math.max(r.max,o.maximums[0])}return r},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(n.min*t.exaggeration(),n.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const n=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,r=this.height/2-n*(1-this._horizonShift);return t?Math.max(0,r):r}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-xr,this.maxLat=xr,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=Ir(this.minLng)*this.tileSize,this.worldMaxX=Ir(this.maxLng)*this.tileSize,this.worldMinY=Fr(this.maxLat)*this.tileSize,this.worldMaxY=Fr(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,n){return this.projection.createTileMatrix(this,n,t)}calculateDistanceTileData(t){const n=t.key,r=this._distanceTileDataCache;if(r[n])return r[n];const i=t.canonical,o=1/this.height,s=this.cameraWorldSize,a=s/this.zoomScale(i.z),c=(i.x+Math.pow(2,i.z)*t.wrap)*a,h=i.y*a,d=this.point;d.x*=s/this.worldSize,d.y*=s/this.worldSize;const m=this.angle,g=Math.sin(-m),x=-Math.cos(-m);return r[n]={bearing:[g,x],center:[(d.x-c)*o,(d.y-h)*o],scale:a/gt*o},r[n]}calculateFogTileMatrix(t){const n=t.key,r=this._fogTileMatrixCache;if(r[n])return r[n];const i=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return lt.multiply(i,this.worldToFogMatrix,i),r[n]=new Float32Array(i),r[n]}calculateProjMatrix(t,n=!1,r=!1){const i=t.key;let o;if(o=r?this._expandedProjMatrixCache:n?this._alignedProjMatrixCache:this._projMatrixCache,o[i])return o[i];const s=this.calculatePosMatrix(t,this.worldSize);let a;return a=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:r?this.expandedFarZProjMatrix:n?this.alignedProjMatrix:this.projMatrix,lt.multiply(s,a,s),o[i]=new Float32Array(s),o[i]}calculatePixelsToTileUnitsMatrix(t){const n=t.tileID.key,r=this._pixelsToTileUnitsCache;if(r[n])return r[n];const i=function(o,s){const{scale:a}=o.tileTransform,c=a*gt/(o.tileSize*Math.pow(2,s.zoom-o.tileID.overscaledZ+o.tileID.canonical.z));return Hu.scale(new Float32Array(4),s.inverseAdjustmentMatrix,[c,c])}(t,this);return r[n]=i,r[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,n=lt.fromScaling([],[t,t,t]);return lt.multiply(n,n,this.globeMatrix),n}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const n=Rn(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(n),i=this._camera.forward(),o=Rn(1,this._center.lat);r[2]/=o,i[2]/=o,J.normalize(i,i);const s=t.raycast(r,i,t.exaggeration());if(s){const a=J.scaleAndAdd([],r,i,s),c=new an(a[0],a[1],Rn(a[2],Br(a[1]))),h=(c.z+J.length([c.x-r[0],c.y-r[1],c.z-r[2]*o]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(h),this._centerAltitude=c.toAltitude(),this._center=this.coordinateLocation(c),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const n=this._elevation,r=Rn(1,this._center.lat)*this.worldSize,i=this._computeCameraPosition(r),o=n.getAtPointOrZero(new an(...i)),s=this.pixelsPerMeter/this.worldSize*o,a=this._minimumHeightOverTerrain(),c=i[2]-s;if(c<=a)if(c<0||t){const h=this.locationCoordinate(this._center,this._centerAltitude),d=[i[0],i[1],h.z-i[2]],m=J.length(d);d[2]-=(a-c)/this._pixelsPerMercatorPixel;const g=J.length(d);if(g===0)return;J.scale(d,d,m/g*this._pixelsPerMercatorPixel),this._camera.position=[i[0],i[1],h.z*this._pixelsPerMercatorPixel-d[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const g=this.center;return g.lat=$t(g.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(g.lng=$t(g.lng,this.minLng,this.maxLng)),this.center=g,void(this._constraining=!1)}const n=this._unmodified,{x:r,y:i}=this.point;let o=0,s=r,a=i;const c=this.width/2,h=this.height/2,d=this.worldMinY*this.scale,m=this.worldMaxY*this.scale;if(i-h<d&&(a=d+h),i+h>m&&(a=m-h),m-d<this.height&&(o=Math.max(o,this.height/(m-d)),a=(m+d)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const g=this.worldMinX*this.scale,x=this.worldMaxX*this.scale,v=this.worldSize/2-(g+x)/2;s=(r+v+this.worldSize)%this.worldSize-v,s-c<g&&(s=g+c),s+c>x&&(s=x-c),x-g<this.width&&(o=Math.max(o,this.width/(x-g)),s=(x+g)/2)}s===r&&a===i||(this.center=this.unproject(new nt(s,a))),o&&(this.zoom+=this.scaleZoom(o)),this._constrainCamera(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n=this.projection.name==="globe",r=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=Rn(1,this.center.lat)/Rn(1,45));const i=Tg(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,i),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const o=this.projection.zAxisUnit==="meters"?r:1,s=this._camera.getWorldToCamera(this.worldSize,o);let a;const c=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(c[8]=2*-t.x/this.width,c[9]=2*t.y/this.height,this.isOrthographic){let N=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),V=N*this.aspect,j=-V,H=-N;V-=t.x,j-=t.x,N+=t.y,H+=t.y,a=this._camera.getCameraToClipOrthographic(j,V,H,N,this._nearZ,this._farZ),(($,G,Q,et)=>{for(let st=0;st<16;st++)$[st]=lS(G[st],Q[st],et)})(a,a,c,uS(this.pitch>=15?1:this.pitch/15))}else a=c;const h=lt.mul([],c,s);let d=lt.mul([],a,s);if(this.projection.isReprojectedInTileSpace){const N=this.locationCoordinate(this.center),V=lt.identity([]);lt.translate(V,V,[N.x*this.worldSize,N.y*this.worldSize,0]),lt.multiply(V,V,$C(this)),lt.translate(V,V,[-N.x*this.worldSize,-N.y*this.worldSize,0]),lt.multiply(d,d,V),lt.multiply(h,h,V),this.inverseAdjustmentMatrix=function(j){const H=$C(j,!0);return Hu.invert([],[H[0],H[1],H[4],H[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=lt.scale([],d,[this.worldSize,this.worldSize,this.worldSize/o,1]),this.projMatrix=d,this.invProjMatrix=lt.invert(new Float64Array(16),this.projMatrix),n){const N=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);N[8]=2*-t.x/this.width,N[9]=2*t.y/this.height,this.expandedFarZProjMatrix=lt.mul([],N,s)}else this.expandedFarZProjMatrix=this.projMatrix;const m=lt.invert([],a);this.frustumCorners=$m.fromInvProjectionMatrix(m,this.horizonLineFromTop(),this.height),this.cameraFrustum=Rs.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!n);const g=new Float32Array(16);lt.identity(g),lt.scale(g,g,[1,-1,1]),lt.rotateX(g,g,this._pitch),lt.rotateZ(g,g,this.angle);const x=lt.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=lt.clone(x);const v=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;x[8]=2*-t.x/this.width,x[9]=2*(t.y+v)/this.height,this.skyboxMatrix=lt.multiply(g,x,g);const w=this.point,A=w.x,E=w.y,S=this.width%2/2,I=this.height%2/2,B=Math.cos(this.angle),M=Math.sin(this.angle),D=A-Math.round(A)+B*S+M*I,R=E-Math.round(E)+B*I+M*S,z=new Float64Array(d);if(lt.translate(z,z,[D>.5?D-1:D,R>.5?R-1:R,0]),this.alignedProjMatrix=z,d=lt.create(),lt.scale(d,d,[this.width/2,-this.height/2,1]),lt.translate(d,d,[1,-1,0]),this.labelPlaneMatrix=d,d=lt.create(),lt.scale(d,d,[1,-1,1]),lt.translate(d,d,[-1,-1,0]),lt.scale(d,d,[2/this.width,2/this.height,1]),this.glCoordMatrix=d,this.pixelMatrix=lt.multiply(new Float64Array(16),this.labelPlaneMatrix,h),this._calcFogMatrices(),this._distanceTileDataCache={},d=lt.invert(new Float64Array(16),this.pixelMatrix),!d)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=d,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=function(V){const{x:j,y:H}=V.point,{lng:$,lat:G}=V._center;return Hy(j,H,V.worldSize,$,G)}(this);const N=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=J.transformMat4(N,N,s),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=d;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,n=this.cameraPixelsPerMeter,r=this._camera.position,i=1/this.height/this._pixelsPerMercatorPixel,o=[t,t,n];J.scale(o,o,i),J.scale(r,r,-1),J.multiply(r,r,o);const s=lt.create();lt.translate(s,s,r),lt.scale(s,s,o),this.mercatorFogMatrix=s,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,n,i)}_computeCameraPosition(t){const n=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,r=this._camera.forward(),i=this.point,o=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*n-t/this.worldSize*this._centerAltitude;return[i.x/this.worldSize-r[0]*o,i.y/this.worldSize-r[1]*o,t/this.worldSize*this._centerAltitude-r[2]*o]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),r=this._camera.position[2],i=t[2];let o=1;this.projection.wrap&&(this.center=this.center.wrap()),i>0&&(o=Math.min((n-r)/i,1)),this._camera.position=J.scaleAndAdd([],this._camera.position,t,o),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,n=this._camera.forward(),{pitch:r,bearing:i}=this._camera.getPitchBearing(),o=Rn(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,s=this._mercatorZfromZoom(this._maxZoom)*Math.cos(Ae(this._maxPitch)),a=Math.max((t[2]-o)/Math.cos(r),s),c=this._zoomFromMercatorZ(a);J.scaleAndAdd(t,t,n,a),this._pitch=$t(r,Ae(this.minPitch),Ae(this.maxPitch)),this.angle=ci(i,-Math.PI,Math.PI),this._setZoom($t(c,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new an(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let n=0,r=Za,i=0,o=1/0;for(;r-n>1e-6&&r>n;){const s=n+.5*(r-n),a=this.tileSize*Math.pow(2,s),c=this.getCameraToCenterDistance(this.projection,s,a),h=this.scaleZoom(c/(t*this.tileSize)),d=Math.abs(s-h);d<o&&(o=d,i=s),s<h?n=s:r=s}return i}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(rt("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,n){const r=Math.min(t.x,n.x),i=Math.max(t.x,n.x),o=Math.min(t.y,n.y),s=Math.max(t.y,n.y);if(o<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const a=[new nt(r,o),new nt(i,s),new nt(r,s),new nt(i,o)],c=this.renderWorldCopies?-3:0,h=this.renderWorldCopies?4:1;for(const d of a){const m=this.pointRayIntersection(d);if(m.t<0)return!0;const g=this.rayIntersectionCoordinate(m);if(g.x<c||g.y<0||g.x>h||g.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+dr(this.fovAboveCenter)>88||this.anyCornerOffEdge(new nt(0,0),new nt(this.width,this.height))}zoomDeltaToMovement(t,n){const r=J.length(J.sub([],this._camera.position,t)),i=this._zoomFromMercatorZ(r)+n;return r-this._mercatorZfromZoom(i)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([n,r,i],o){const s=[n,r,i,1];Bn.transformMat4(s,s,o);const a=s[3]=Math.max(s[3],1e-6);return s[0]/=a,s[1]/=a,s[2]/=a,s}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new nt(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new nt(0,t))}}getCameraToCenterDistance(t,n=this.zoom,r=this.worldSize){const i=Tg(t,n,this.width,this.height,1024),o=t.pixelSpaceConversion(this.center.lat,r,i);let s=.5/Math.tan(.5*this._fov)*this.height*o;return this.isOrthographic&&(s=lS(1,s,uS(this.pitch>=15?1:this.pitch/15))),s}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&lt.multiply(t,t,this.globeMatrix),t}getFrustum(t){return Rs.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}function cS(e,t,n){lt.identity(e),lt.rotateZ(e,e,Ae(t[2])),lt.rotateX(e,e,Ae(t[0])),lt.rotateY(e,e,Ae(t[1])),lt.scale(e,e,n),lt.multiply(e,e,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Z1(e,t,n,r,i,o,s,a){const c=[n[0]-t[0],n[1]-t[1],0],h=[r[0]-t[0],r[1]-t[1],0];if(J.length(c)<1e-12||J.length(h)<1e-12)return En.identity(e);const d=J.cross([],c,h);J.normalize(d,d),J.subtract(h,r,t),c[2]=(o-i)*a,h[2]=(s-i)*a;const m=c;return J.cross(m,c,h),J.normalize(m,m),En.rotationTo(e,d,m)}function hS(e,t,n=!1){const r=$r(t.zoom),i=function(o,s,a){const c=s.worldSize,h=[o[12],o[13],o[14]],d=Br(h[1]/c),m=uo(h[0]/c),g=lt.identity([]),x=Rn(1,d)*c,v=Rn(1,0)*c*Ja(d,s.zoom),w=1/Qm(c);let A=v*w;if(a){const B=Tg(s.projection,s.zoom,s.width,s.height,1024);A=w*s.projection.pixelSpaceConversion(s.center.lat,c,B)}const E=Ei(d,m);J.add(E,E,J.scale([],J.normalize([],E),x*A*h[2]));const S=function(B){const M=[B[0],B[1],B[2]];let D=[0,1,0];const R=J.cross([],D,M);return J.cross(D,M,R),J.squaredLength(D)===0&&(D=[0,1,0],J.cross(R,M,D)),J.normalize(R,R),J.normalize(D,D),J.normalize(M,M),[R[0],R[1],R[2],0,D[0],D[1],D[2],0,M[0],M[1],M[2],0,B[0],B[1],B[2],1]}(E);lt.scale(g,g,[A,A,A*x]),lt.translate(g,g,[-h[0],-h[1],-h[2]]);const I=lt.multiply([],s.globeMatrix,S);return lt.multiply(I,I,g),lt.multiply(I,I,o),I}(e,t,n);if(r>0){const o=function(s,a){const c=a.worldSize,h=Rn(1,0)*c*Ja(a.center.lat,a.zoom)/Qm(c),d=Rn(1,a.center.lat)*c,m=lt.identity([]);return lt.rotateY(m,m,Ae(a.center.lng)),lt.rotateX(m,m,Ae(a.center.lat)),lt.translate(m,m,[0,0,dn]),lt.scale(m,m,[h,h,h*d]),lt.translate(m,m,[a.point.x-.5*c,a.point.y-.5*c,0]),lt.multiply(m,m,s),lt.multiply(m,a.globeMatrix,m)}(e,t);return function(s,a,c){const h=(v,w,A)=>{const E=J.length(v),S=J.length(w),I=fa(v,w,A);return J.scale(I,I,1/J.length(I)*Ce(E,S,A))},d=h([s[0],s[1],s[2]],[a[0],a[1],a[2]],c),m=h([s[4],s[5],s[6]],[a[4],a[5],a[6]],c),g=h([s[8],s[9],s[10]],[a[8],a[9],a[10]],c),x=fa([s[12],s[13],s[14]],[a[12],a[13],a[14]],c);return[d[0],d[1],d[2],0,m[0],m[1],m[2],0,g[0],g[1],g[2],0,x[0],x[1],x[2],1]}(i,o,r)}return i}const Ch=64,tR=[1,1,1];class fS{constructor(t,n,r,i){this.id=t,this.position=n!=null?new Be(n[0],n[1]):new Be(0,0),this.orientation=r??[0,0,0],this.nodes=i,this.uploaded=!1,this.aabb=new yn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,n){if(lt.multiply(t.matrix,n,t.matrix),t.meshes)for(const r of t.meshes){const i=yn.applyTransform(r.aabb,t.matrix);this.aabb.encapsulate(i)}if(t.children)for(const r of t.children)this._applyTransformations(r,t.matrix)}computeBoundsAndApplyParent(){const t=lt.identity([]);for(const n of this.nodes)this._applyTransformations(n,t)}_positionModelOnTerrain(t,n){const r=t.elevation;if(!r)return 0;const i=yn.projectAabbCorners(this.aabb,this.matrix),o=Rn(1,this.position.lat)*t.worldSize,s=function(E,S){const I=[0,0,1],B=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const M of B){const D=E[M.corners[0]],R=E[M.corners[1]],z=E[M.corners[2]],N=[R[0]-D[0],R[1]-D[1],S*(R[2]-D[2])],V=J.cross(N,N,[z[0]-D[0],z[1]-D[1],S*(z[2]-D[2])]);J.normalize(V,V),M.dotProductWithUp=J.dot(V,I)}return B.sort((M,D)=>M.dotProductWithUp-D.dotProductWithUp),B[0].corners}(i,o),a=i[s[0]],c=i[s[1]],h=i[s[2]],d=i[s[3]],m=r.getAtPointOrZero(new an(a[0]/t.worldSize,a[1]/t.worldSize),0),g=r.getAtPointOrZero(new an(c[0]/t.worldSize,c[1]/t.worldSize),0),x=r.getAtPointOrZero(new an(h[0]/t.worldSize,h[1]/t.worldSize),0),v=r.getAtPointOrZero(new an(d[0]/t.worldSize,d[1]/t.worldSize),0),w=(m+v)/2,A=(g+x)/2;return w>A?g<x?Z1(n,c,d,a,g,v,m,o):Z1(n,h,a,d,x,m,v,o):m<v?Z1(n,a,c,h,m,g,x,o):Z1(n,d,h,c,v,x,g,o),Math.max(w,A)}computeModelMatrix(t,n,r,i,o,s,a=!1){const c=t.transform,h=c.zoom,d=c.project(this.position),m=Ja(this.position.lat,h),g=1/m;lt.identity(this.matrix),lt.translate(this.matrix,this.matrix,[d.x+i[0]*g,d.y+i[1]*g,i[2]]);let x=1,v=1;const w=c.worldSize;if(a){if(c.projection.name==="mercator"){let I=0;c.elevation&&(I=c.elevation.getAtPointOrZero(new an(d.x/w,d.y/w),0));const B=Bn.transformMat4([],[d.x,d.y,I,1],c.projMatrix)[3]/c.cameraToCenterDistance;x=B,v=B*Ja(c.center.lat,h)}else if(c.projection.name==="globe"){const I=hS(this.matrix,c),B=lt.multiply([],c.projMatrix,I),M=[0,0,0,1];Bn.transformMat4(M,M,B);const D=M[3]/c.cameraToCenterDistance,R=$r(h),z=c.projection.pixelsPerMeter(this.position.lat,w)*Ja(this.position.lat,h),N=c.projection.pixelsPerMeter(c.center.lat,w)*Ja(c.center.lat,h);x=D/Ce(z,Ky(c.center.lat),R),v=D*m/z,x*=N,v*=N}}else x=g;lt.scale(this.matrix,this.matrix,[x,x,v]);const A=[...this.matrix],E=this.orientation,S=[];if(cS(S,[E[0]+n[0],E[1]+n[1],E[2]+n[2]],r),lt.multiply(this.matrix,A,S),o&&c.elevation){let I=0;const B=[];if(s&&c.elevation){I=this._positionModelOnTerrain(c,B);const M=lt.fromQuat([],B),D=lt.multiply([],M,S);lt.multiply(this.matrix,A,D)}else I=c.elevation.getAtPointOrZero(new an(d.x/w,d.y/w),0);I!==0&&(this.matrix[14]+=I)}}upload(t){if(!this.uploaded){for(const n of this.nodes)zb(n,t);for(const n of this.nodes)W1(n);this.uploaded=!0}}destroy(){for(const t of this.nodes)q1(t)}}function Cg(e,t,n=!1){e.uploaded||(e.gfxTexture=new _r(t,e.image,n?t.gl.R8:t.gl.RGBA,{useMipmap:e.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),e.uploaded=!0,e.image=null)}function eR(e,t,n){e.indexBuffer=t.createIndexBuffer(e.indexArray,!1,!0),e.vertexBuffer=t.createVertexBuffer(e.vertexArray,HL.members,!1,!0),e.normalArray&&(e.normalBuffer=t.createVertexBuffer(e.normalArray,JL.members,!1,!0)),e.texcoordArray&&(e.texcoordBuffer=t.createVertexBuffer(e.texcoordArray,qL.members,!1,!0)),e.colorArray&&(e.colorBuffer=t.createVertexBuffer(e.colorArray,(e.colorArray.bytesPerElement===12?ZL:WL).members,!1,!0)),e.featureArray&&(e.pbrBuffer=t.createVertexBuffer(e.featureArray,KL.members,!0)),e.segments=Cn.simpleSegment(0,0,e.vertexArray.length,e.indexArray.length);const r=e.material;r.pbrMetallicRoughness.baseColorTexture&&Cg(r.pbrMetallicRoughness.baseColorTexture,t),r.pbrMetallicRoughness.metallicRoughnessTexture&&Cg(r.pbrMetallicRoughness.metallicRoughnessTexture,t),r.normalTexture&&Cg(r.normalTexture,t),r.occlusionTexture&&Cg(r.occlusionTexture,t,n),r.emissionTexture&&Cg(r.emissionTexture,t)}function zb(e,t,n){if(e.meshes)for(const r of e.meshes)eR(r,t,n);if(e.children)for(const r of e.children)zb(r,t,n)}function W1(e){if(e.meshes)for(const t of e.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(e.children)for(const t of e.children)W1(t)}function q1(e){if(e.meshes)for(const n of e.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((t=n.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(e.children)for(const n of e.children)q1(n)}class dS{constructor(t,n){this.feature=t,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class pS{constructor(){this.instancedDataArray=new xm,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class mS{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=t.projection,this.index=t.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(t,n,r,i){this.tileToMeter=wh(r);const o=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:s,id:a,index:c,sourceLayerIndex:h}of t){const d=$a(s,o);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom),d,r))continue;const m={id:a,sourceLayerIndex:h,index:c,geometry:o?d.geometry:ks(s,r,i),properties:s.properties,type:s.type,patterns:{}},g=this.addFeature(m,m.geometry,d);g&&n.featureIndex.insert(s,m.geometry,c,h,this.index,this.instancesPerModel[g].instancedDataArray.length)}this.lookup=null}update(t,n,r,i){for(const o in this.instancesPerModel){const s=this.instancesPerModel[o];for(const a in t)s.idToFeaturesIndex.hasOwnProperty(a)&&this.evaluate(s.features[s.idToFeaturesIndex[a]],t[a],s,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const n in this.instancesPerModel){const r=this.instancesPerModel[n];for(const i of r.features){const o=this.layers[0],s=i.feature,a=this.canonical,c=o.paint.get("model-rotation").evaluate(s,{},a),h=o.paint.get("model-scale").evaluate(s,{},a),d=o.paint.get("model-translation").evaluate(s,{},a);J.exactEquals(i.rotation,c)&&J.exactEquals(i.scale,h)&&J.exactEquals(i.translation,d)||(this.evaluate(i,i.featureStates,r,!0),t=!0)}}return t}isEmpty(){for(const t in this.instancesPerModel)if(this.instancesPerModel[t].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const n in this.instancesPerModel){const r=this.instancesPerModel[n];r.instancedDataArray.length<0||r.instancedDataArray.length===0||(r.instancedDataBuffer?r.instancedDataBuffer.updateData(r.instancedDataArray):r.instancedDataBuffer=t.createVertexBuffer(r.instancedDataArray,$L.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const t in this.instancesPerModel){const n=this.instancesPerModel[t];n.instancedDataArray.length!==0&&n.instancedDataBuffer&&n.instancedDataBuffer.destroy()}}addFeature(t,n,r){const i=this.layers[0],o=i.layout.get("model-id").evaluate(r,{},this.canonical);if(!o)return rt(`modelId is not evaluated for layer ${i.id} and it is not going to get rendered.`),o;this.instancesPerModel[o]||(this.instancesPerModel[o]=new pS);const s=this.instancesPerModel[o],a=s.instancedDataArray,c=new dS(r,a.length);for(const h of n)for(const d of h){if(d.x<0||d.x>=gt||d.y<0||d.y>=gt)continue;const m=(this.lookupDim-1)/gt,g=this.lookupDim*(d.y*m|0)+d.x*m|0;if(this.lookup){if(this.lookup[g]!==0)continue;this.lookup[g]=1}this.instanceCount++;const x=a.length;a.resize(x+1),s.instancesEvaluatedElevation.push(0),a.float32[16*x]=d.x,a.float32[16*x+1]=d.y}return c.instancedDataCount=s.instancedDataArray.length-c.instancedDataOffset,c.instancedDataCount>0&&(t.id&&(s.idToFeaturesIndex[t.id]=s.features.length),s.features.push(c),this.evaluate(c,{},s,!1)),o}evaluate(t,n,r,i){const o=this.layers[0],s=t.feature,a=this.canonical,c=t.rotation=o.paint.get("model-rotation").evaluate(s,n,a),h=t.scale=o.paint.get("model-scale").evaluate(s,n,a),d=t.translation=o.paint.get("model-translation").evaluate(s,n,a),m=o.paint.get("model-color").evaluate(s,n,a);m.a=o.paint.get("model-color-mix-intensity").evaluate(s,n,a);const g=[];this.maxVerticalOffset<d[2]&&(this.maxVerticalOffset=d[2]),this.maxScale=Math.max(Math.max(this.maxScale,h[0]),Math.max(h[1],h[2])),cS(g,c,h);const x=Math.round(100*m.a)+m.b/1.05;for(let v=0;v<t.instancedDataCount;++v){const w=t.instancedDataOffset+v,A=16*w,E=r.instancedDataArray.float32;let S=0;i&&(S=E[A+6]-r.instancesEvaluatedElevation[w]);const I=0|E[A+1];E[A]=(0|E[A])+m.r/1.05,E[A+1]=I+m.g/1.05,E[A+2]=x,E[A+3]=1/(a.z>10?this.tileToMeter:wh(a,I)),E[A+4]=d[0],E[A+5]=d[1],E[A+6]=d[2]+S,E[A+7]=g[0],E[A+8]=g[1],E[A+9]=g[2],E[A+10]=g[4],E[A+11]=g[5],E[A+12]=g[6],E[A+13]=g[8],E[A+14]=g[9],E[A+15]=g[10],r.instancesEvaluatedElevation[w]=d[2]}}}le(mS,"ModelBucket",{omit:["layers"]}),le(pS,"PerModelAttributes"),le(dS,"ModelFeature");const nR=new lr({visibility:new Rt(ut.layout_model.visibility),"model-id":new ge(ut.layout_model["model-id"])});var rR={paint:new lr({"model-opacity":new Rt(ut.paint_model["model-opacity"]),"model-rotation":new ge(ut.paint_model["model-rotation"]),"model-scale":new ge(ut.paint_model["model-scale"]),"model-translation":new ge(ut.paint_model["model-translation"]),"model-color":new ge(ut.paint_model["model-color"]),"model-color-mix-intensity":new ge(ut.paint_model["model-color-mix-intensity"]),"model-type":new Rt(ut.paint_model["model-type"]),"model-cast-shadows":new Rt(ut.paint_model["model-cast-shadows"]),"model-receive-shadows":new Rt(ut.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Rt(ut.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new ge(ut.paint_model["model-emissive-strength"]),"model-roughness":new ge(ut.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new ge(ut.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Rt(ut.paint_model["model-cutoff-fade-range"])}),layout:nR};const Ob=new Float32Array(262144),Sh=new Uint8Array(262144);function gS(e){let t=0;if(e.meshes)for(const n of e.meshes)t=Math.max(t,n.aabb.max[2]);if(e.children)for(const n of e.children)t=Math.max(t,gS(n));return t}const _S=["","wall","door","roof","window","lamp","logo"];class yS{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:t.id,geometry:[],properties:{height:gS(t)}}}}class xS{constructor(t,n,r,i){this.nodes=t,this.id=n,this.modelTraits|=1,this.uploaded=!1,this.hasPattern=!1,r&&(this.modelTraits|=4),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=i,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const n=this.getNodesInfo();for(const r of n){const i=r.node;this.uploaded?this.updatePbrBuffer(i):zb(i,t,!0)}for(const r of n)W1(r.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let n=!1;if(!t.meshes)return n;for(const r of t.meshes)r.pbrBuffer&&(r.pbrBuffer.updateData(r.featureArray),n=!0);return n}needsReEvaluation(t,n,r){const i=t.transform.projectionOptions,o=t.style.getBrightness(),s=this.brightness!==o;return!!(!this.uploaded||this.dirty||i.name!==this.projection.name||Sg(r.paint.get("model-color").value,s)||Sg(r.paint.get("model-color-mix-intensity").value,s)||Sg(r.paint.get("model-roughness").value,s)||Sg(r.paint.get("model-emissive-strength").value,s)||Sg(r.paint.get("model-height-based-emissive-strength-multiplier").value,s))&&(this.projection=i,this.brightness=o,!0)}evaluateScale(t,n){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const r=this.getNodesInfo(),i=this.id.canonical;for(const o of r){const s=o.feature;o.evaluatedScale=n.paint.get("model-scale").evaluate(s,{},i)}}evaluate(t){const n=this.getNodesInfo();for(const r of n){if(!r.node.meshes)continue;const i=r.feature,o=r.node.meshes&&r.node.meshes[0].featureData,s=r.evaluatedColor[2],a=r.evaluatedRMEA[2],c=this.id.canonical;if(r.hasTranslucentParts=!1,o){for(let h=0;h<_S.length;h++){const d=_S[h];d.length&&(i.properties.part=d);const m=t.paint.get("model-color").evaluate(i,{},c),g=t.paint.get("model-color-mix-intensity").evaluate(i,{},c);r.evaluatedColor[h]=[m.r,m.g,m.b,g],r.evaluatedRMEA[h][0]=t.paint.get("model-roughness").evaluate(i,{},c),r.evaluatedRMEA[h][2]=t.paint.get("model-emissive-strength").evaluate(i,{},c),r.evaluatedRMEA[h][3]=m.a,r.emissionHeightBasedParams[h]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(i,{},c),!r.hasTranslucentParts&&m.a<1&&(r.hasTranslucentParts=!0)}delete i.properties.part,oR(r,s!==r.evaluatedColor[2]||a!==r.evaluatedRMEA[2])}r.evaluatedScale=t.paint.get("model-scale").evaluate(i,{},c),this.updatePbrBuffer(r.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,n,r,i){const o=t.findDEMTileFor(r);if(o&&(o.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(o.dem&&o.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=o.tileID.overscaledZ;const s=md.create(t,r,o);if(!s)return;4&this.modelTraits&&this.updateDEM(t,s,r,i);for(const a of this.getNodesInfo()){const c=a.node;if(!c.footprint||!c.footprint.vertices||!c.footprint.vertices.length)continue;const h=c.footprint.vertices;let d=s.getElevationAt(h[0].x,h[0].y,!0,!0);for(let m=1;m<h.length;m++)d=Math.min(d,s.getElevationAt(h[m].x,h[m].y,!0,!0));c.elevation=d}}this.terrainTile=o.tileID.canonical,this.terrainExaggeration=n}}updateDEM(t,n,r,i){let o=n._dem._modifiedForSources[i];if(o===void 0&&(n._dem._modifiedForSources[i]=[],o=n._dem._modifiedForSources[i]),o.includes(r.canonical))return;const s=n._dem.dim;o.push(r.canonical);let a=!1;for(const c of this.getNodesInfo()){const h=c.node;if(!h.footprint||!h.footprint.grid)continue;const d=h.footprint.grid,m=n.tileCoordToPixel(d.min.x,d.min.y),g=n.tileCoordToPixel(d.max.x,d.max.y),x=Math.min(Math.min(s-g.y,m.x),Math.min(m.y,s-g.x));if(x<0)continue;const v=$t(x,2,5);let w=Math.max(0,m.x-v),A=Math.max(0,m.y-v),E=Math.min(g.x+v,s-1),S=Math.min(g.y+v,s-1);for(let D=A;D<=S;++D)for(let R=w;R<=E;++R)Sh[D*s+R]=255;let I=0,B=0;for(let D=0;D<d.cellsY;++D)for(let R=0;R<d.cellsX;++R){if(!d.cells[D*d.cellsX+R])continue;const z=n.tileCoordToPixel(d.min.x+R/d.xScale,d.min.y+D/d.yScale),N=n.tileCoordToPixel(d.min.x+(R+1)/d.xScale,d.min.y+(D+1)/d.yScale);for(let V=z.y;V<=Math.min(N.y+1,s-1);++V)for(let j=z.x;j<=Math.min(N.x+1,s-1);++j)Sh[V*s+j]===255&&(Sh[V*s+j]=0,I+=n.getElevationAtPixel(j,V),B++)}const M=I/B;w=Math.max(1,m.x-v),A=Math.max(1,m.y-v),E=Math.min(g.x+v,s-2),S=Math.min(g.y+v,s-2),a=!0;for(let D=A;D<=S;++D)for(let R=w;R<=E;++R)Sh[D*s+R]===0&&(Ob[D*s+R]=n._dem.set(R,D,M));for(let D=1;D<v;++D){w=Math.max(1,m.x-D),A=Math.max(1,m.y-D),E=Math.min(g.x+D,s-2),S=Math.min(g.y+D,s-2);for(let R=A;R<=S;++R)for(let z=w;z<=E;++z){const N=R*s+z;if(Sh[N]===255){let V=0,j=0,H=-1,$=-1;for(let G=-1;G<=1;++G)for(let Q=-1;Q<=1;++Q){const et=(R+G)*s+z+Q;if(Sh[et]>=D)continue;const st=Ob[et],Y=Math.abs(st);Y>j&&(V=st,j=Y,H=Q,$=G)}if(j>.1){const G=1-(D+.5*Math.abs(H*$))/v;let Q=n._dem.get(z,R)+V*G;const et=n._dem.get(z+H,R+$),st=n._dem.get(z-H,R-$,!0);(Q-et)*(Q-st)>0&&(Q=(et+st)/2),Ob[N]=n._dem.set(z,R,Q),Sh[N]=D}}}}}a&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=ze.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(const t of this.nodes)this.nodesInfo.push(new yS(t));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(const t of this.nodes)q1(t);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();const t=this.getNodesInfo();for(const n of t)W1(n.node),q1(n.node)}isEmpty(){return!this.nodes.length}updateReplacement(t,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const r=n.getReplacementRegionsForTile(t.toUnwrapped()),i=this.getNodesInfo();for(let o=0;o<this.nodesInfo.length;o++){const s=i[o].node;i[o].hiddenByReplacement=!!s.footprint&&!r.find(a=>a.footprint===s.footprint)}}getHeightAtTileCoord(t,n){const r=this.getNodesInfo(),i=[];for(let o=0;o<this.nodesInfo.length;o++){const s=r[o],a=s.node.meshes[0];if(t<a.aabb.min[0]||n<a.aabb.min[1]||t>a.aabb.max[0]||n>a.aabb.max[1])continue;const c=(t-a.aabb.min[0])/(a.aabb.max[0]-a.aabb.min[0])*Ch|0,h=Math.min(63,(n-a.aabb.min[1])/(a.aabb.max[1]-a.aabb.min[1])*Ch|0)*Ch+Math.min(63,c);if(!(a.heightmap[h]<0&&s.node.footprint))return s.hiddenByReplacement?void 0:{height:a.heightmap[h],maxHeight:s.feature.properties.height,hidden:!1,verticalScale:s.evaluatedScale[2]};if(s.node.footprint.grid.query(new nt(t,n),new nt(t,n),i),i.length>0)return{height:void 0,maxHeight:s.feature.properties.height,hidden:s.hiddenByReplacement,verticalScale:s.evaluatedScale[2]}}}}function Sg(e,t){return!e.isLightConstant&&t}function iR(e,t,n,r,i,o,s,a){let c=(61440&t|(61440&t)>>4)>>8,h=(3840&t|(3840&t)>>4)>>4,d=240&t|(240&t)>>4;n[3]>0&&(c=Ce(c,255*n[0],n[3]),h=Ce(h,255*n[1],n[3]),d=Ce(d,255*n[2],n[3]));const m=c<<8|h,g=d<<8|Math.floor(255*r[3]),x=function(D){const R=$t(D,0,2);return Math.min(Math.round(.5*R*255),255)}(r[2])<<8|15*r[0]<<4|15*r[1],v=$t(i[0],0,1),w=$t(i[1],0,1),A=$t(i[2],0,1),E=$t(i[3],0,1);let S,I,B,M;if(v!==w&&s!==o&&w!==v){const D=s-o;I=1/(D*(w-v)),B=-(o+D*v)/(D*(w-v));const R=$t(i[4],-1,1);M=Math.pow(10,R),S=255*A<<8|255*E}else S=65535,I=0,B=1,M=1;if(e.emplaceBack(m,g,x,S,I,B,M),a){const D=a.length;a.clear();for(let R=0;R<D;R++)a.emplaceBack(m,g,x,S,I,B,M)}}function oR(e,t){const n=e.node;let r=0;for(const i of n.meshes){if(n.lights&&n.lightMeshIndex===r||!i.featureData)continue;i.featureArray=new ch,i.featureArray.reserve(i.featureData.length);let o=t;for(const s of i.featureData){let a;const c=65535&s,h=(15&c)<8?15&c:0,d=s>>16&65535,m=e.evaluatedRMEA[h],g=e.evaluatedColor[h],x=e.emissionHeightBasedParams[h];if(o&&h===2&&n.lights&&(a=new ch,a.resize(10*n.lights.length)),iR(i.featureArray,d,g,m,x,i.aabb.min[2],i.aabb.max[2],a),a&&o){o=!1;const v=n.meshes[n.lightMeshIndex];v.featureArray=a,v.featureArray._trim()}}i.featureArray._trim(),r++}}le(xS,"Tiled3dModelBucket",{omit:["layers"]}),le(yS,"Tiled3dModelFeature");class sR{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){const n=bS(new nt(0,0),new nt(gt,gt),t),r=[];for(const i of this._activeRegions){if(i.hiddenByOverlap||!wS(n,i))continue;const o=aR(i.min,i.max,t);r.push({min:o.min,max:o.max,sourceId:this._sourceIds[i.priority],footprint:i.footprint,footprintTileId:i.tileId})}return r}setSources(t){this._setSources(t.map(n=>({getSourceId:()=>n.cache.id,getFootprints:()=>{const r=[];for(const i of n.cache.getVisibleCoordinates()){const o=n.cache.getTile(i).buckets[n.layer];if(o)for(const s of o.getNodesInfo()){const a=s.node;a.footprint&&r.push({footprint:a.footprint,id:i.toUnwrapped()})}}return r}})))}_addSource(t){const n=t.getFootprints();if(n.length!==0){for(const r of n){if(!r.footprint)continue;const i=bS(r.footprint.min,r.footprint.max,r.id);this._activeRegions.push({min:i.min,max:i.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:r.id,footprint:r.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((n,r)=>n.priority-r.priority||J1(n.min,r.min)||J1(n.max,r.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let n=0,r=0;for(;!t&&n!==this._activeRegions.length;){const i=this._activeRegions[n],o=this._prevRegions[r];t=i.priority!==o.priority||!vS(i,o),++n,++r}}if(t){++this._updateTime;const n=r=>{const i=this._activeRegions;if(r>=i.length)return r;const o=i[r].priority;for(;r<i.length&&i[r].priority===o;)++r;return r};if(this._sourceIds.length>1){let r=0,i=n(r);for(;r!==i;){let o=r;const s=r;for(;o!==i;){const a=this._activeRegions[o];a.hiddenByOverlap=!1;for(let c=0;c<s;c++){const h=this._activeRegions[c];if(!h.hiddenByOverlap&&wS(a,h)&&(a.hiddenByOverlap=ES(a.footprint,a.tileId,h.footprint,h.tileId),a.hiddenByOverlap))break}++o}r=i,i=n(r)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let n=t.length-1;n>=0;n--)this._addSource(t[n]);this._computeReplacement()}}function J1(e,t){return e.x-t.x||e.y-t.y}function vS(e,t){return J1(e.min,t.min)===0&&J1(e.max,t.max)===0}function wS(e,t){return!(e.min.x>t.max.x||e.max.x<t.min.x||e.min.y>t.max.y||e.max.y<t.min.y)}function bS(e,t,n){const r=1/gt,i=1/(1<<n.canonical.z),o=(t.x*r+n.canonical.x)*i+n.wrap,s=(t.y*r+n.canonical.y)*i;return{min:new nt((e.x*r+n.canonical.x)*i+n.wrap,(e.y*r+n.canonical.y)*i),max:new nt(o,s)}}function aR(e,t,n){const r=1<<n.canonical.z,i=((t.x-n.wrap)*r-n.canonical.x)*gt,o=(t.y*r-n.canonical.y)*gt;return{min:new nt(((e.x-n.wrap)*r-n.canonical.x)*gt,(e.y*r-n.canonical.y)*gt),max:new nt(i,o)}}function AS(e,t,n,r,i,o,s){const a=e.indices,c=e.vertices,h=[];for(let d=r;d<r+i;d+=3){const m=t[n[d+0]+o],g=t[n[d+1]+o],x=t[n[d+2]+o],v=Math.min(m.x,g.x,x.x),w=Math.max(m.x,g.x,x.x),A=Math.min(m.y,g.y,x.y),E=Math.max(m.y,g.y,x.y);h.length=0,e.grid.query(new nt(v,A),new nt(w,E),h);for(let S=0;S<h.length;S++){const I=h[S];if(ki(c[a[3*I+0]],c[a[3*I+1]],c[a[3*I+2]],m,g,x,s))return!0}}return!1}function ES(e,t,n,r){if(!e||!n)return!1;let i=e.vertices;if(!t.canonical.equals(r.canonical)||t.wrap!==r.wrap){if(n.vertices.length<e.vertices.length)return ES(n,r,e,t);const o=t.canonical,s=r.canonical,a=Math.pow(2,s.z-o.z);i=e.vertices.map(c=>new nt(c.x*o.x*gt*a-s.x*gt,c.y*o.y*gt*a-s.y*gt))}return AS(n,i,e.indices,0,e.indices.length,0,0)}const lR=_1.types,uR=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],cR=["fill-extrusion-flood-light-ground-radius"],hR=Math.pow(2,13),fR=Math.pow(2,15)-1,TS=new nt(0,1),tl=2147483648;function Mg(e,t,n,r,i,o,s,a){e.emplaceBack((t<<1)+s,(n<<1)+o,(Math.floor(r*hR)<<1)+i,Math.round(a))}function $1(e,t,n,r,i,o){e.emplaceBack(t.x,t.y,(n.x<<1)+r,(n.y<<1)+i,o)}function Ig(e,t,n){e.emplaceBack(t.x,t.y,t.z,n[0]*16384,n[1]*16384,n[2]*16384)}class CS{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class SS{constructor(){this.centroidXY=new nt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new nt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new nt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new nt(this.max.x-this.min.x,this.max.y-this.min.y)}}class MS{constructor(){this.acc=new nt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,n){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=n.x,t.min.y=t.max.y=n.y)}appendEdge(t,n,r){this.accCount++,this.acc._add(n);let i=!!this.borders;n.x<t.min.x?(t.min.x=n.x,i=!0):n.x>t.max.x&&(t.max.x=n.x,i=!0),n.y<t.min.y?(t.min.y=n.y,i=!0):n.y>t.max.y&&(t.max.y=n.y,i=!0),((n.x===0||n.x===gt)&&n.x===r.x)!=((n.y===0||n.y===gt)&&n.y===r.y)&&this.processBorderOverlap(n,r),i&&this.checkBorderIntersection(n,r)}checkBorderIntersection(t,n){n.x<0!=t.x<0&&this.addBorderIntersection(0,Ce(n.y,t.y,(0-n.x)/(t.x-n.x))),n.x>gt!=t.x>gt&&this.addBorderIntersection(1,Ce(n.y,t.y,(gt-n.x)/(t.x-n.x))),n.y<0!=t.y<0&&this.addBorderIntersection(2,Ce(n.x,t.x,(0-n.y)/(t.y-n.y))),n.y>gt!=t.y>gt&&this.addBorderIntersection(3,Ce(n.x,t.x,(gt-n.y)/(t.y-n.y)))}addBorderIntersection(t,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const r=this.borders[t];n<r[0]&&(r[0]=n),n>r[1]&&(r[1]=n)}processBorderOverlap(t,n){if(t.x===n.x){if(t.y===n.y)return;const r=t.x===0?0:1;this.addBorderIntersection(r,n.y),this.addBorderIntersection(r,t.y)}else{const r=t.y===0?2:3;this.addBorderIntersection(r,n.x),this.addBorderIntersection(r,t.x)}}centroid(){return this.accCount===0?new nt(0,0):new nt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((t,n)=>t+ +(n[0]!==Number.MAX_VALUE),0):0}}function IS(e,t){const n=e.add(t)._unit(),r=$t(e.x*n.x+e.y*n.y,-1,1);var i,o,s;return i=Math.acos(r),Math.min(4,Math.max(-4,Math.tan(i)))/4*fR*((o=e).x*(s=t).y-o.y*s.x<0?-1:1)}const dR=[e=>e.x<0,e=>e.x>gt,e=>e.y<0,e=>e.y>gt];function pR(e,t,n,r){const i=[4];if(r===0)return i;n._mult(r);const o=e.sub(n),s=t.sub(n),a=[e,t,o,s];for(let c=0;c<4;c++)for(const h of a)if(dR[c](h)){i.push(c);break}return i}class BS{constructor(t){this.vertexArray=new mm,this.indexArray=new ur,this.programConfigurations=new Ga(t.layers,t.zoom,n=>cR.includes(n)),this._segments=new Cn,this.hiddenByLandmarkVertexArray=new vm,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Cn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(t,n,r,i=!1){const o=t.length;if(o>2){let s=Math.max(0,this._segments.get().length-1);const a=this._segments._prepareSegment(4*o,this.vertexArray.length,2*this._segmentToGroundQuads[s].length);let c;s!==this._segments.get().length-1&&(s++,this._segmentToGroundQuads[s]=[],this._segmentToRegionTriCounts[s]=[0,0,0,0,0]);{const h=t[0],d=t[1];c=IS(h.sub(t[o-1])._perp()._unit(),d.sub(h)._perp()._unit())}for(let h=0;h<o;h++){const d=h===o-1?0:h+1,m=t[h],g=t[d],x=t[d===o-1?0:d+1],v=g.sub(m)._perp()._unit(),w=IS(v,x.sub(g)._perp()._unit()),A=c,E=w;if(Nb(m,g,n)||i&&LS(m,n)&&LS(g,n)){c=w;continue}const S=a.vertexLength;$1(this.vertexArray,m,g,1,1,A),$1(this.vertexArray,m,g,1,0,A),$1(this.vertexArray,m,g,0,1,E),$1(this.vertexArray,m,g,0,0,E),a.vertexLength+=4;const I=pR(m,g,v,r);for(const B of I)this._segmentToGroundQuads[s].push({id:S,region:B}),this._segmentToRegionTriCounts[s][B]+=2,a.primitiveLength+=2;c=w}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),n=t.length;for(let r=0;r<n;r++)this._segmentToGroundQuads[r].sort((i,o)=>i.region-o.region);for(let r=0;r<n;r++){const i=this._segmentToGroundQuads[r],o=t[r],s=this._segmentToRegionTriCounts[r];s.reduce((c,h)=>c+h,0);let a=0;for(let c=0;c<=4;c++){const h=s[c];if(h!==0){let d=this.regionSegments[c];d||(d=this.regionSegments[c]=new Cn);const m={vertexOffset:o.vertexOffset,primitiveOffset:o.primitiveOffset+a,vertexLength:o.vertexLength,primitiveLength:h};d.get().push(m)}a+=h}for(let c=0;c<i.length;c++){const h=i[c].id;this.indexArray.emplaceBack(h,h+1,h+3),this.indexArray.emplaceBack(h,h+3,h+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,n,r,i,o,s){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,n,r,i,o,s)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,m1.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,n,r,i,o,s){this.hasData()&&this.programConfigurations.updatePaintArrays(t,n,r,i,o,s)}updateHiddenByLandmark(t){if(!this.hasData())return;const n=t.groundVertexCount+t.groundVertexArrayOffset;if(t.groundVertexCount===0)return;const r=t.flags&tl?1:0;for(let i=t.groundVertexArrayOffset;i<n;++i)this.hiddenByLandmarkVertexArray.emplace(i,r);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,V3.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const n=this.regionSegments[t];n&&n.destroy()}}}}class Bg{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ur,this.footprintVertices=new bi,this.footprintSegments=[],this.layoutVertexArray=new sa,this.centroidVertexArray=new D0,this.indexArray=new ur,this.programConfigurations=new Ga(t.layers,t.zoom,n=>uR.includes(n)),this.segments=new Cn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new BS(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(t,n,r,i){this.features=[],this.hasPattern=Qi("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=wh(r),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:o,id:s,index:a,sourceLayerIndex:c}of t){const h=this.layers[0]._featureFilter.needGeometry,d=$a(o,h);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom),d,r))continue;const m={id:s,sourceLayerIndex:c,index:a,geometry:h?d.geometry:ks(o,r,i),properties:o.properties,type:o.type,patterns:{}},g=this.layoutVertexArray.length;this.hasPattern?this.features.push(Ti("fill-extrusion",this.layers,m,this.zoom,n)):this.addFeature(m,m.geometry,a,r,{},n.availableImages,i,n.brightness),n.featureIndex.insert(o,m.geometry,a,c,this.index,g)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,n,r,i,o,s){for(const a of this.features){const{geometry:c}=a;this.addFeature(a,c,a.index,n,r,i,o,s)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(t,n,r,i,o){const s=Object.keys(t).length!==0;if(s&&!this.stateDependentLayers.length)return;const a=s?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(t,n,a,r,i,o),this.groundEffect.update(t,n,a,r,i,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,j3),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,G3.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,U3.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,r,i,o,s,a,c){const h=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,d=[new nt(0,0),new nt(gt,gt)],m=a.projection,g=m.name==="globe",x=lR[t.type]==="Polygon",v=new MS;v.centroidDataIndex=this.centroidData.length;const w=new SS,A=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},i)<=0,E=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},i);w.height=E,w.vertexArrayOffset=this.layoutVertexArray.length,w.groundVertexArrayOffset=this.groundEffect.vertexArray.length,g&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Of);const S=Dn(n,500);for(let z=S.length-1;z>=0;z--){const N=S[z];(N.length===0||(I=N[0]).every(V=>V.x<=0)||I.every(V=>V.x>=gt)||I.every(V=>V.y<=0)||I.every(V=>V.y>=gt))&&S.splice(z,1)}var I;let B;if(g)B=zS(S,d,i);else{B=[];for(const z of S)B.push({polygon:z,bounds:d})}const M=x?this.edgeRadius:0,D=M>0&&this.zoom<17,R=(z,N)=>{if(z.length===0)return!1;const V=z[z.length-1];return N.x===V.x&&N.y===V.y};for(const{polygon:z,bounds:N}of B){let V=0,j=0;for(const Q of z)x&&!Q[0].equals(Q[Q.length-1])&&Q.push(Q[0]),j+=x?Q.length-1:Q.length;const H=this.segments.prepareSegment((x?5:4)*j,this.layoutVertexArray,this.indexArray);w.footprintSegIdx<0&&(w.footprintSegIdx=this.footprintSegments.length),w.polygonSegIdx<0&&(w.polygonSegIdx=this.polygonSegments.length);const $={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},G=new CS;if(G.vertexOffset=this.footprintVertices.length,G.indexOffset=3*this.footprintIndices.length,G.ringIndices=[],x){const Q=[],et=[];V=H.vertexLength;for(let Y=0;Y<z.length;Y++){const tt=z[Y];tt.length&&Y!==0&&et.push(Q.length/2);const ct=[];let pt,dt;pt=tt[1].sub(tt[0])._perp()._unit(),G.ringIndices.push(tt.length-1);for(let wt=1;wt<tt.length;wt++){const bt=tt[wt],Et=tt[wt===tt.length-1?1:wt+1],_t=bt.clone();if(M){dt=Et.sub(bt)._perp()._unit();const Mt=pt.add(dt)._unit(),qt=M*Math.min(4,1/(pt.x*Mt.x+pt.y*Mt.y));_t.x+=qt*Mt.x,_t.y+=qt*Mt.y,_t.x=Math.round(_t.x),_t.y=Math.round(_t.y),pt=dt}!A||M!==0&&!D||R(ct,_t)||ct.push(_t),Mg(this.layoutVertexArray,_t.x,_t.y,0,0,1,1,0),H.vertexLength++,this.footprintVertices.emplaceBack(bt.x,bt.y),Q.push(bt.x,bt.y),g&&Ig(this.layoutVertexExtArray,m.projectTilePoint(_t.x,_t.y,i),m.upVector(i,_t.x,_t.y))}A&&(M===0||D)&&(ct.length!==0&&R(ct,ct[0])&&ct.pop(),this.groundEffect.addData(ct,N,h))}const st=Ye(Q,et);for(let Y=0;Y<st.length;Y+=3)this.footprintIndices.emplaceBack(G.vertexOffset+st[Y+0],G.vertexOffset+st[Y+1],G.vertexOffset+st[Y+2]),this.indexArray.emplaceBack(V+st[Y],V+st[Y+2],V+st[Y+1]),H.primitiveLength++;G.indexCount+=st.length,G.vertexCount+=this.footprintVertices.length-G.vertexOffset}for(let Q=0;Q<z.length;Q++){const et=z[Q];v.startRing(w,et[0]);let st=et.length>4&&RS(et[et.length-2],et[0],et[1]),Y=M?mR(et[et.length-2],et[0],et[1],M):0;const tt=[];let ct,pt,dt;pt=et[1].sub(et[0])._perp()._unit();let wt=!0;for(let bt=1,Et=0;bt<et.length;bt++){let _t=et[bt-1],Mt=et[bt];const qt=et[bt===et.length-1?1:bt+1];if(v.appendEdge(w,Mt,_t),Nb(Mt,_t,N)){M&&(pt=qt.sub(Mt)._perp()._unit(),wt=!wt);continue}const Jt=Mt.sub(_t)._perp(),ne=Jt.x/(Math.abs(Jt.x)+Math.abs(Jt.y)),se=Jt.y>0?1:0,Pe=_t.dist(Mt);if(Et+Pe>32768&&(Et=0),M){dt=qt.sub(Mt)._perp()._unit();let Le=PS(_t,Mt,qt,DS(pt,dt),M);isNaN(Le)&&(Le=0);const Se=Mt.sub(_t)._unit();_t=_t.add(Se.mult(Y))._round(),Mt=Mt.add(Se.mult(-Le))._round(),Y=Le,pt=dt,A&&this.zoom>=17&&(R(tt,_t)||tt.push(_t),R(tt,Mt)||tt.push(Mt))}const pe=H.vertexLength,pn=et.length>4&&RS(_t,Mt,qt);let rn=kS(Et,st,wt);if(Mg(this.layoutVertexArray,_t.x,_t.y,ne,se,0,0,rn),Mg(this.layoutVertexArray,_t.x,_t.y,ne,se,0,1,rn),Et+=Pe,rn=kS(Et,pn,!wt),st=pn,Mg(this.layoutVertexArray,Mt.x,Mt.y,ne,se,0,0,rn),Mg(this.layoutVertexArray,Mt.x,Mt.y,ne,se,0,1,rn),H.vertexLength+=4,this.indexArray.emplaceBack(pe+0,pe+1,pe+2),this.indexArray.emplaceBack(pe+1,pe+3,pe+2),H.primitiveLength+=2,M){const Le=V+(bt===1?et.length-2:bt-2),Se=bt===1?V:Le+1;if(this.indexArray.emplaceBack(pe+1,Le,pe+3),this.indexArray.emplaceBack(Le,Se,pe+3),H.primitiveLength+=2,ct===void 0&&(ct=pe),!Nb(qt,et[bt],N)){const _e=bt===et.length-1?ct:H.vertexLength;this.indexArray.emplaceBack(pe+2,pe+3,_e),this.indexArray.emplaceBack(pe+3,_e+1,_e),this.indexArray.emplaceBack(pe+3,Se,_e+1),H.primitiveLength+=3}wt=!wt}if(g){const Le=this.layoutVertexExtArray,Se=m.projectTilePoint(_t.x,_t.y,i),_e=m.projectTilePoint(Mt.x,Mt.y,i),ln=m.upVector(i,_t.x,_t.y),cn=m.upVector(i,Mt.x,Mt.y);Ig(Le,Se,ln),Ig(Le,Se,ln),Ig(Le,_e,cn),Ig(Le,_e,cn)}}x&&(V+=et.length-1),A&&M&&this.zoom>=17&&(tt.length!==0&&R(tt,tt[0])&&tt.pop(),this.groundEffect.addData(tt,N,h,M>0))}this.footprintSegments.push(G),$.triangleCount=this.indexArray.length-$.triangleArrayOffset,this.polygonSegments.push($),++w.footprintSegLen,++w.polygonSegLen}if(w.vertexCount=this.layoutVertexArray.length-w.vertexArrayOffset,w.groundVertexCount=this.groundEffect.vertexArray.length-w.groundVertexArrayOffset,w.vertexCount!==0){if(w.centroidXY=v.borders?TS:this.encodeCentroid(v,w),this.centroidData.push(w),v.borders){this.featuresOnBorder.push(v);const z=this.featuresOnBorder.length-1;for(let N=0;N<v.borders.length;N++)v.borders[N][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[N].push(z)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,o,s,i,c),this.groundEffect.addPaintPropertiesData(t,r,o,s,i,c),this.maxHeight=Math.max(this.maxHeight,E)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort((n,r)=>this.featuresOnBorder[n].borders[t][0]-this.featuresOnBorder[r].borders[t][0])}splitToSubtiles(){const t=[];for(let a=0;a<this.centroidData.length;a++){const c=this.centroidData[a],h=+(c.min.y+c.max.y>gt),d=2*h+(+(c.min.x+c.max.x>gt)^h);for(let m=0;m<c.polygonSegLen;m++){const g=c.polygonSegIdx+m;t.push({centroidIdx:a,subtile:d,polygonSegmentIdx:g,triangleSegmentIdx:this.polygonSegments[g].triangleSegIdx})}}const n=new ur;t.sort((a,c)=>a.triangleSegmentIdx===c.triangleSegmentIdx?a.subtile-c.subtile:a.triangleSegmentIdx-c.triangleSegmentIdx);let r=0,i=0,o=0;for(const a of t){if(a.triangleSegmentIdx!==r)break;o++}const s=t.length;for(;i!==t.length;){r=t[i].triangleSegmentIdx;let a=0,c=i,h=i;for(let d=c;d<o&&t[d].subtile===a;d++)h++;for(;c!==o;){const d=t[c];a=d.subtile;const m=this.centroidData[d.centroidIdx].min.clone(),g=this.centroidData[d.centroidIdx].max.clone(),x={vertexOffset:this.segments.segments[r].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[r].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let v=c;v<h;v++){const w=t[v],A=this.polygonSegments[w.polygonSegmentIdx],E=this.centroidData[w.centroidIdx].min,S=this.centroidData[w.centroidIdx].max,I=this.indexArray.uint16;for(let B=A.triangleArrayOffset;B<A.triangleArrayOffset+A.triangleCount;B++)n.emplaceBack(I[3*B],I[3*B+1],I[3*B+2]);x.primitiveLength+=A.triangleCount,m.x=Math.min(m.x,E.x),m.y=Math.min(m.y,E.y),g.x=Math.max(g.x,S.x),g.y=Math.max(g.y,S.y)}x.primitiveLength>0&&this.triangleSubSegments.push({segment:x,min:m,max:g}),c=h;for(let v=c;v<o&&t[v].subtile===t[c].subtile;v++)h++}i=o;for(let d=i;d<s&&t[d].triangleSegmentIdx===t[i].triangleSegmentIdx;d++)o++}n._trim(),this.indexArray=n}getVisibleSegments(t,n,r){let i=0,o=0;const s=1<<t.canonical.z;if(n){const w=n.getMinMaxForTile(t);w&&(i=w.min,o=w.max)}o+=this.maxHeight;const a=t.toUnwrapped();let c;const h=[a.canonical.x/s+a.wrap,a.canonical.y/s],d=[(a.canonical.x+1)/s+a.wrap,(a.canonical.y+1)/s],m=new Cn,g=(w,A,E)=>[w[0]*(1-E[0])+A[0]*E[0],w[1]*(1-E[1])+A[1]*E[1]],x=[],v=[];for(const w of this.triangleSubSegments){x[0]=w.min.x/gt,x[1]=w.min.y/gt,v[0]=w.max.x/gt,v[1]=w.max.y/gt;const A=g(h,d,x),E=g(h,d,v);if(new yn([A[0],A[1],i],[E[0],E[1],o]).intersectsPrecise(r)===0){c&&(m.segments.push(c),c=void 0);continue}const S=w.segment;c&&c.vertexOffset!==S.vertexOffset&&(m.segments.push(c),c=void 0),c?(c.vertexLength+=S.vertexLength,c.primitiveLength+=S.primitiveLength):c={vertexOffset:S.vertexOffset,primitiveLength:S.primitiveLength,vertexLength:S.vertexLength,primitiveOffset:S.primitiveOffset,sortKey:void 0,vaos:{}}}return c&&m.segments.push(c),m}encodeCentroid(t,n){const r=t.centroid(),i=n.span(),o=Math.min(7,Math.round(i.x*this.tileToMeter/10)),s=Math.min(7,Math.round(i.y*this.tileToMeter/10));return new nt($t(r.x,1,gt-1)<<3|o,$t(r.y,1,gt-1)<<3|s)}showCentroid(t){const n=this.centroidData[t.centroidDataIndex];n.flags&=tl,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const n=t.vertexArrayOffset,r=t.vertexCount+t.vertexArrayOffset,i=t.flags&tl?TS:t.centroidXY,o=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==i.y||o!==i.x){for(let s=n;s<r;++s)this.centroidVertexArray.emplace(s,i.x,i.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const r=n.getReplacementRegionsForTile(t.toUnwrapped());if(function(o,s){if(o.length!==s.length)return!1;for(let a=0;a<o.length;a++)if(o[a].sourceId!==s[a].sourceId||!vS(o[a],s[a]))return!1;return!0}(this.activeReplacements,r))return;if(this.activeReplacements=r,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const o of this.centroidData)o.flags&=2147483647;const i=[];for(const o of this.activeReplacements){const s=Math.pow(2,o.footprintTileId.canonical.z-t.canonical.z);for(const a of this.centroidData)if(!(a.flags&tl||o.min.x>a.max.x||a.min.x>o.max.x||o.min.y>a.max.y||a.min.y>o.max.y))for(let c=0;c<a.footprintSegLen;c++){const h=this.footprintSegments[a.footprintSegIdx+c];if(i.length=0,gR(this.footprintVertices,h.vertexOffset,h.vertexCount,o.footprintTileId.canonical,t.canonical,i),AS(o.footprint,i,this.footprintIndices.uint16,h.indexOffset,h.indexCount,-h.vertexOffset,-s)){a.flags|=tl;break}}}for(const o of this.centroidData)this.writeCentroidToBuffer(o);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,n,r){let i=!1;for(let o=0;o<r.footprintSegLen;o++){const s=this.footprintSegments[r.footprintSegIdx+o];let a=0;for(const c of s.ringIndices){for(let h=a,d=c+a-1;h<c+a;d=h++){const m=this.footprintVertices.int16[2*(h+s.vertexOffset)+0],g=this.footprintVertices.int16[2*(h+s.vertexOffset)+1],x=this.footprintVertices.int16[2*(d+s.vertexOffset)+1];g>n!=x>n&&t<(this.footprintVertices.int16[2*(d+s.vertexOffset)+0]-m)*(n-g)/(x-g)+m&&(i=!i)}a=c}}return i}getHeightAtTileCoord(t,n){let r=Number.NEGATIVE_INFINITY,i=!0;const o=4*(t+gt)*gt+(n+gt);if(this.partLookup.hasOwnProperty(o)){const s=this.partLookup[o];return s?{height:s.height,hidden:!!(s.flags&tl)}:void 0}for(const s of this.centroidData)t>s.max.x||s.min.x>t||n>s.max.y||s.min.y>n||this.footprintContainsPoint(t,n,s)&&s&&s.height>r&&(r=s.height,this.partLookup[o]=s,i=!!(s.flags&tl));if(r!==Number.NEGATIVE_INFINITY)return{height:r,hidden:i};this.partLookup[o]=void 0}}function DS(e,t){const n=e.add(t)._unit();return e.x*n.x+e.y*n.y}function mR(e,t,n,r){const i=t.sub(e)._perp()._unit(),o=n.sub(t)._perp()._unit();return PS(e,t,n,DS(i,o),r)}function PS(e,t,n,r,i){const o=Math.sqrt(1-r*r);return Math.min(e.dist(t)/3,t.dist(n)/3,i*o/r)}function Nb(e,t,n){return e.x<n[0].x&&t.x<n[0].x||e.x>n[1].x&&t.x>n[1].x||e.y<n[0].y&&t.y<n[0].y||e.y>n[1].y&&t.y>n[1].y}function LS(e,t){return e.x<t[0].x||e.x>t[1].x||e.y<t[0].y||e.y>t[1].y}function RS(e,t,n){if(e.x<0||e.x>=gt||t.x<0||t.x>=gt||n.x<0||n.x>=gt)return!1;const r=n.sub(t),i=r.perp(),o=e.sub(t);return(r.x*o.x+r.y*o.y)/Math.sqrt((r.x*r.x+r.y*r.y)*(o.x*o.x+o.y*o.y))>-.866&&i.x*o.x+i.y*o.y<0}function kS(e,t,n){const r=t?2|e:-3&e;return n?1|r:-2&r}function FS(){const e=Math.PI/32,t=Math.tan(e),n=$u;return n*Math.sqrt(1+2*t*t)-n}function zS(e,t,n){const r=1<<n.z,i=uo(n.x/r),o=uo((n.x+1)/r),s=Br(n.y/r),a=Br((n.y+1)/r);return function(c,h,d,m,g=0,x){const v=[];if(!c.length||!d||!m)return v;const w=(D,R)=>{for(const z of D)v.push({polygon:z,bounds:R})},A=Math.ceil(Math.log2(d)),E=Math.ceil(Math.log2(m)),S=A-E,I=[];for(let D=0;D<Math.abs(S);D++)I.push(S>0?0:1);for(let D=0;D<Math.min(A,E);D++)I.push(0),I.push(1);let B=c;if(B=y1(B,h[0].y-g,h[1].y+g,1),B=y1(B,h[0].x-g,h[1].x+g,0),!B.length)return v;const M=[];for(I.length?M.push({polygons:B,bounds:h,depth:0}):w(B,h);M.length;){const D=M.pop(),R=D.depth,z=I[R],N=D.bounds[0],V=D.bounds[1],j=z===0?N.x:N.y,H=z===0?V.x:V.y,$=x?x(z,j,H):.5*(j+H),G=y1(D.polygons,j-g,$+g,z),Q=y1(D.polygons,$-g,H+g,z);if(G.length){const et=[N,new nt(z===0?$:V.x,z===1?$:V.y)];I.length>R+1?M.push({polygons:G,bounds:et,depth:R+1}):w(G,et)}if(Q.length){const et=[new nt(z===0?$:N.x,z===1?$:N.y),V];I.length>R+1?M.push({polygons:Q,bounds:et,depth:R+1}):w(Q,et)}}return v}(e,t,Math.ceil((o-i)/11.25),Math.ceil((s-a)/11.25),1,(c,h,d)=>{if(c===0)return .5*(h+d);{const m=Br((n.y+h/gt)/r);return(Fr(.5*(Br((n.y+d/gt)/r)+m))*r-n.y)*gt}})}function gR(e,t,n,r,i,o){const s=Math.pow(2,r.z-i.z);for(let a=0;a<n;a++){let c=e.int16[2*(a+t)+0],h=e.int16[2*(a+t)+1];c=(c+i.x*gt)*s-r.x*gt,h=(h+i.y*gt)*s-r.y*gt,o.push(new nt(c,h))}}le(Bg,"FillExtrusionBucket",{omit:["layers","features"]}),le(SS,"PartData"),le(CS,"FootprintSegment"),le(MS,"BorderCentroidData"),le(BS,"GroundEffect");const _R=new lr({visibility:new Rt(ut["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Rt(ut["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var yR={paint:new lr({"fill-extrusion-opacity":new Rt(ut["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ge(ut["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Rt(ut["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Rt(ut["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ge(ut["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ge(ut["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ge(ut["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Rt(ut["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Rt(ut["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Rt(ut["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Rt(ut["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Rt(ut["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Rt(ut["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Rt(ut["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Rt(ut["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new ge(ut["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new ge(ut["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Rt(ut["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Rt(ut["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Rt(ut["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Rt(ut["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Rt(ut["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:_R};class Ed extends nt{constructor(t,n,r){super(t,n),this.z=r}}function Dg(e,t){return e.x*t.x+e.y*t.y}function OS(e,t){if(e.length===1){let n=0;const r=t[n++];let i;for(;!i||r.equals(i);)if(i=t[n++],!i)return 1/0;for(;n<t.length;n++){const o=t[n],s=e[0],a=i.sub(r),c=o.sub(r),h=s.sub(r),d=Dg(a,a),m=Dg(a,c),g=Dg(c,c),x=Dg(h,a),v=Dg(h,c),w=d*g-m*m,A=(g*x-m*v)/w,E=(d*v-m*x)/w,S=r.z*(1-A-E)+i.z*A+o.z*E;if(isFinite(S))return S}return 1/0}{let n=1/0;for(const r of t)n=Math.min(n,r.z);return n}}function NS(e,t,n,r,i,o,s,a){const c=s*i.getElevationAt(e,t,!0,!0),h=o[0]!==0,d=h?o[1]===0?s*(o[0]/7-450):s*function(m,g,x){const v=Math.floor(g[0]/8),w=Math.floor(g[1]/8),A=10*(g[0]-8*v),E=10*(g[1]-8*w),S=m.getElevationAt(v,w,!0,!0),I=m.getMeterToDEM(x),B=Math.floor(.5*(A*I-1)),M=Math.floor(.5*(E*I-1)),D=m.tileCoordToPixel(v,w),R=2*B+1,z=2*M+1,N=function(Q,et,st,Y,tt){return[Q.getElevationAtPixel(et,st,!0),Q.getElevationAtPixel(et+tt,st,!0),Q.getElevationAtPixel(et,st+tt,!0),Q.getElevationAtPixel(et+Y,st+tt,!0)]}(m,D.x-B,D.y-M,R,z),V=Math.abs(N[0]-N[1]),j=Math.abs(N[2]-N[3]),H=Math.abs(N[0]-N[2])+Math.abs(N[1]-N[3]),$=Math.min(.25,.5*I*(V+j)/R),G=Math.min(.25,.5*I*H/z);return S+Math.max($*A,G*E)}(i,o,a):c;return{base:c+(n===0)?-1:n,top:h?Math.max(d+r,c+n+2):c+r}}const xR=new lr({"line-cap":new ge(ut.layout_line["line-cap"]),"line-join":new ge(ut.layout_line["line-join"]),"line-miter-limit":new Rt(ut.layout_line["line-miter-limit"]),"line-round-limit":new Rt(ut.layout_line["line-round-limit"]),"line-sort-key":new ge(ut.layout_line["line-sort-key"]),visibility:new Rt(ut.layout_line.visibility)});var US={paint:new lr({"line-opacity":new ge(ut.paint_line["line-opacity"]),"line-color":new ge(ut.paint_line["line-color"]),"line-translate":new Rt(ut.paint_line["line-translate"]),"line-translate-anchor":new Rt(ut.paint_line["line-translate-anchor"]),"line-width":new ge(ut.paint_line["line-width"]),"line-gap-width":new ge(ut.paint_line["line-gap-width"]),"line-offset":new ge(ut.paint_line["line-offset"]),"line-blur":new ge(ut.paint_line["line-blur"]),"line-dasharray":new ge(ut.paint_line["line-dasharray"]),"line-pattern":new ge(ut.paint_line["line-pattern"]),"line-gradient":new nh(ut.paint_line["line-gradient"]),"line-trim-offset":new Rt(ut.paint_line["line-trim-offset"]),"line-emissive-strength":new Rt(ut.paint_line["line-emissive-strength"]),"line-border-width":new ge(ut.paint_line["line-border-width"]),"line-border-color":new ge(ut.paint_line["line-border-color"])}),layout:xR};const vR=(e,t,n,r,i,o,s)=>{const a=e.transform,c=a.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:GS(e,t,n,r),u_pixels_to_tile_units:c,u_device_pixel_ratio:o,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:i,u_texsize:HS(n)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:VS(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:s,u_emissive_strength:n.paint.get("line-emissive-strength")}},wR=(e,t,n,r,i)=>{const o=e.transform;return{u_matrix:GS(e,t,n,r),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:o.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:i,u_image:0,u_tile_units_to_pixels:VS(t,o),u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function VS(e,t){return 1/Th(e,1,t.tileZoom)}function GS(e,t,n,r){return e.translatePosMatrix(r||t.tileID.projMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const jS=e=>{const t=[];HS(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const n=e.paint.get("line-trim-offset");return n[0]===0&&n[1]===0||t.push("RENDER_LINE_TRIM_OFFSET"),e.paint.get("line-border-width").constantOr(1)!==0&&t.push("RENDER_LINE_BORDER"),t};function HS(e){const t=e.paint.get("line-dasharray").value;return t.value||t.kind!=="constant"}const ZS=new class extends ge{possiblyEvaluate(e,t){return t=new rr(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,n,r){return t=re({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,n,r)}}(US.paint.properties["line-width"].specification);function WS(e,t){return t>0?t+2*e:e}ZS.useIntegerZoom=!0;const bR=new lr({visibility:new Rt(ut.layout_background.visibility)});var AR={paint:new lr({"background-color":new Rt(ut.paint_background["background-color"]),"background-pattern":new Rt(ut.paint_background["background-pattern"]),"background-opacity":new Rt(ut.paint_background["background-opacity"]),"background-emissive-strength":new Rt(ut.paint_background["background-emissive-strength"])}),layout:bR};const ER=new lr({visibility:new Rt(ut.layout_raster.visibility)});var TR={paint:new lr({"raster-opacity":new Rt(ut.paint_raster["raster-opacity"]),"raster-color":new nh(ut.paint_raster["raster-color"]),"raster-color-mix":new Rt(ut.paint_raster["raster-color-mix"]),"raster-color-range":new Rt(ut.paint_raster["raster-color-range"]),"raster-hue-rotate":new Rt(ut.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Rt(ut.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Rt(ut.paint_raster["raster-brightness-max"]),"raster-saturation":new Rt(ut.paint_raster["raster-saturation"]),"raster-contrast":new Rt(ut.paint_raster["raster-contrast"]),"raster-resampling":new Rt(ut.paint_raster["raster-resampling"]),"raster-fade-duration":new Rt(ut.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Rt(ut.paint_raster["raster-emissive-strength"]),"raster-array-band":new Rt(ut.paint_raster["raster-array-band"]),"raster-elevation":new Rt(ut.paint_raster["raster-elevation"])}),layout:ER};function qS(e,t,n,r,i,o,s,a){const c=[e,n,i,t,r,o,1,1,1],h=[s,a,1],d=Ki.adjoint([],c),[m,g,x]=J.transformMat3(h,h,Ki.transpose(d,d));return Ki.multiply(c,[m,0,0,0,g,0,0,0,x],c)}class Os extends Sr{constructor(t,n,r,i){super(),this.id=t,this.dispatcher=r,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(i),this.options=n,this._dirty=!1}load(t,n){if(this._loaded=n||!1,this.fire(new Nt("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=Ze(this.map._requestManager.transformRequest(this.url,At.Image),(r,i)=>{if(this._imageRequest=null,this._loaded=!0,r)this.fire(new Ie(r));else if(i){const{HTMLImageElement:o}=k;this.image=i instanceof o?ze.getImageData(i):i,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading()}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new N1(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Nt("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof N1||this.texture.destroy()}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=t[0][1],r=t[0][1];for(const o of t)o[1]>r&&(r=o[1]),o[1]<n&&(n=o[1]);const i=(r+n)/2;if(i>xr?this.onNorthPole=!0:i<-xr&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const o=t.map(an.fromLngLat);this.tileID=function(s){let a=1/0,c=1/0,h=-1/0,d=-1/0;for(const v of s)a=Math.min(a,v.x),c=Math.min(c,v.y),h=Math.max(h,v.x),d=Math.max(d,v.y);const m=Math.max(h-a,d-c),g=Math.max(0,Math.floor(-Math.log(m)/Math.LN2)),x=Math.pow(2,g);return new Xi(g,Math.floor((a+h)/2*x),Math.floor((c+d)/2*x))}(o),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Nt("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(t){for(const c in this.tiles){const h=this.tiles[c];h.state!=="loaded"&&(h.state="loaded",h.texture=this.texture)}if(this._boundsArray)return;const n=Eh(this.tileID,this.map.transform.projection),[r,i,o,s]=this.coordinates.map(c=>{const h=n.projection.project(c[0],c[1]);return kC(n,h)._round()});this.perspectiveTransform=function(c,h,d,m,g,x,v,w,A,E){const S=qS(0,0,c,0,0,h,c,h),I=qS(d,m,g,x,v,w,A,E);return Ki.multiply(I,Ki.adjoint(S,S),I),[I[6]/I[8]*c/gt,I[7]/I[8]*h/gt]}(this.width,this.height,r.x,r.y,i.x,i.y,s.x,s.y,o.x,o.y);const a=this._boundsArray=new sa;a.emplaceBack(r.x,r.y,0,0),a.emplaceBack(i.x,i.y,gt,0),a.emplaceBack(s.x,s.y,0,gt),a.emplaceBack(o.x,o.y,gt,gt),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=t.createVertexBuffer(a,Mb.members),this.boundsSegments=Cn.simpleSegment(0,0,4,2)}prepare(){const t=Object.keys(this.tiles).length!==0;if(this.tileID&&!t)return;const n=this.map.painter.context,r=n.gl;!this._dirty||this.texture instanceof N1||(this.texture?this.texture.update(this.image):(this.texture=new _r(n,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(n)}loadTile(t,n){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},n(null)):(t.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class CR extends Di{constructor(t){super(t,{}),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(t){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}const SR=new lr({visibility:new Rt(ut.layout_sky.visibility)});var MR={paint:new lr({"sky-type":new Rt(ut.paint_sky["sky-type"]),"sky-atmosphere-sun":new Rt(ut.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Rt(ut.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Rt(ut.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Rt(ut.paint_sky["sky-gradient-radius"]),"sky-gradient":new nh(ut.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Rt(ut.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Rt(ut.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Rt(ut.paint_sky["sky-opacity"])}),layout:SR};function Ub(e,t,n){const r=[0,0,1],i=En.identity([]);return En.rotateY(i,i,n?-Ae(e)+Math.PI:Ae(e)),En.rotateX(i,i,-Ae(t)),J.transformQuat(r,r,i),J.normalize(r,r)}var IR={paint:new lr({})};const BR={circle:class extends Di{constructor(e,t){super(e,cg,t)}createBucket(e){return new ag(e)}queryRadius(e){const t=e;return Ka("circle-radius",this,t)+Ka("circle-stroke-width",this,t)+ld(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,n,r,i,o,s,a){const c=s1(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),h=this.paint.get("circle-radius").evaluate(t,n)+this.paint.get("circle-stroke-width").evaluate(t,n);return l1(e,r,o,s,a,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",c,h)}getProgramIds(){return["circle"]}getDefaultProgramParams(e,t){const n=a1(this);return{config:new Vl(this,t),defines:n,overrideFog:!1}}},heatmap:class extends Di{createBucket(e){return new h1(e)}constructor(e,t){super(e,nb,t),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=cd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return Ka("heatmap-radius",this,e)}queryIntersectsFeature(e,t,n,r,i,o,s,a){const c=this.paint.get("heatmap-radius").evaluate(t,n);return l1(e,r,o,s,a,!0,!0,new nt(0,0),c)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(e,t){return e==="heatmap"?{config:new Vl(this,t),overrideFog:!1}:{}}},hillshade:class extends Di{constructor(e,t){super(e,ib,t)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},fill:class extends Di{constructor(e,t){super(e,os,t)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),n=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(e,t){return{config:new Vl(this,t),overrideFog:!1}}recalculate(e,t){super.recalculate(e,t);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Fi(e)}queryRadius(){return ld(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,n,r,i,o){return!e.queryGeometry.isAboveHorizon&&t1(o1(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),r)}isTileClipped(){return!0}},"fill-extrusion":class extends Di{constructor(e,t){super(e,yR,t),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new Bg(e)}queryRadius(){return ld(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(e,t,n,r,i,o,s,a,c){const h=s1(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),d=this.paint.get("fill-extrusion-height").evaluate(t,n),m=this.paint.get("fill-extrusion-base").evaluate(t,n),g=[0,0],x=a&&o.elevation,v=o.elevation?o.elevation.exaggeration():1,w=e.tile.getBucket(this);if(x&&w instanceof Bg){const B=w.centroidVertexArray,M=c+1;M<B.length&&(g[0]=B.geta_centroid_pos0(M),g[1]=B.geta_centroid_pos1(M))}if(g[0]===0&&g[1]===1)return!1;o.projection.name==="globe"&&(r=zS([r],[new nt(0,0),new nt(gt,gt)],e.tileID.canonical).map(B=>B.polygon).flat());const A=x?a:null,[E,S]=function(B,M,D,R,z,N,V,j,H,$,G){return B.projection.name==="globe"?function(Q,et,st,Y,tt,ct,pt,dt,wt,bt,Et){const _t=[],Mt=[],qt=Q.projection.upVectorScale(Et,Q.center.lat,Q.worldSize).metersToTile,Jt=[0,0,0,1],ne=[0,0,0,1],se=(pe,pn,rn,Le)=>{pe[0]=pn,pe[1]=rn,pe[2]=Le,pe[3]=1},Pe=FS();st>0&&(st+=Pe),Y+=Pe;for(const pe of et){const pn=[],rn=[];for(const Le of pe){const Se=Le.x+tt.x,_e=Le.y+tt.y,ln=Q.projection.projectTilePoint(Se,_e,Et),cn=Q.projection.upVector(Et,Le.x,Le.y);let Je=st,Gn=Y;if(pt){const Tr=NS(Se,_e,st,Y,pt,dt,wt,bt);Je+=Tr.base,Gn+=Tr.top}st!==0?se(Jt,ln.x+cn[0]*qt*Je,ln.y+cn[1]*qt*Je,ln.z+cn[2]*qt*Je):se(Jt,ln.x,ln.y,ln.z),se(ne,ln.x+cn[0]*qt*Gn,ln.y+cn[1]*qt*Gn,ln.z+cn[2]*qt*Gn),J.transformMat4(Jt,Jt,ct),J.transformMat4(ne,ne,ct),pn.push(new Ed(Jt[0],Jt[1],Jt[2])),rn.push(new Ed(ne[0],ne[1],ne[2]))}_t.push(pn),Mt.push(rn)}return[_t,Mt]}(B,M,D,R,z,N,V,j,H,$,G):V?function(Q,et,st,Y,tt,ct,pt,dt,wt){const bt=[],Et=[],_t=[0,0,0,1];for(const Mt of Q){const qt=[],Jt=[];for(const ne of Mt){const se=ne.x+Y.x,Pe=ne.y+Y.y,pe=NS(se,Pe,et,st,ct,pt,dt,wt);_t[0]=se,_t[1]=Pe,_t[2]=pe.base,_t[3]=1,Bn.transformMat4(_t,_t,tt),_t[3]=Math.max(_t[3],1e-5);const pn=new Ed(_t[0]/_t[3],_t[1]/_t[3],_t[2]/_t[3]);_t[0]=se,_t[1]=Pe,_t[2]=pe.top,_t[3]=1,Bn.transformMat4(_t,_t,tt),_t[3]=Math.max(_t[3],1e-5);const rn=new Ed(_t[0]/_t[3],_t[1]/_t[3],_t[2]/_t[3]);qt.push(pn),Jt.push(rn)}bt.push(qt),Et.push(Jt)}return[bt,Et]}(M,D,R,z,N,V,j,H,$):function(Q,et,st,Y,tt){const ct=[],pt=[],dt=tt[8]*et,wt=tt[9]*et,bt=tt[10]*et,Et=tt[11]*et,_t=tt[8]*st,Mt=tt[9]*st,qt=tt[10]*st,Jt=tt[11]*st;for(const ne of Q){const se=[],Pe=[];for(const pe of ne){const pn=pe.x+Y.x,rn=pe.y+Y.y,Le=tt[0]*pn+tt[4]*rn+tt[12],Se=tt[1]*pn+tt[5]*rn+tt[13],_e=tt[2]*pn+tt[6]*rn+tt[14],ln=tt[3]*pn+tt[7]*rn+tt[15],cn=Le+dt,Je=Se+wt,Gn=_e+bt,Tr=Math.max(ln+Et,1e-5),On=Le+_t,Xn=Se+Mt,Dr=_e+qt,Cr=Math.max(ln+Jt,1e-5);se.push(new Ed(cn/Tr,Je/Tr,Gn/Tr)),Pe.push(new Ed(On/Cr,Xn/Cr,Dr/Cr))}ct.push(se),pt.push(Pe)}return[ct,pt]}(M,D,R,z,N)}(o,r,m,d,h,s,A,g,v,o.center.lat,e.tileID.canonical),I=e.queryGeometry;return function(B,M,D){let R=1/0;t1(D,M)&&(R=OS(D,M[0]));for(let z=0;z<M.length;z++){const N=M[z],V=B[z];for(let j=0;j<N.length-1;j++){const H=N[j],$=[H,N[j+1],V[j+1],V[j],H];Qy(D,$)&&(R=Math.min(R,OS(D,$)))}}return R!==1/0&&R}(E,S,I.isPointQuery()?I.screenBounds:I.screenGeometry)}},line:class extends Di{constructor(e,t){super(e,US,t),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof zp,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=ZS.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new O1(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(e,t){const n=jS(this);return{config:new Vl(this,t),defines:n,overrideFog:!1}}queryRadius(e){const t=e,n=WS(Ka("line-width",this,t),Ka("line-gap-width",this,t)),r=Ka("line-offset",this,t);return n/2+Math.abs(r)+ld(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,n,r,i,o){if(e.queryGeometry.isAboveHorizon)return!1;const s=o1(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),a=e.pixelToTileUnitsFactor/2*WS(this.paint.get("line-width").evaluate(t,n),this.paint.get("line-gap-width").evaluate(t,n)),c=this.paint.get("line-offset").evaluate(t,n);return c&&(r=function(h,d){const m=[],g=new nt(0,0);for(let x=0;x<h.length;x++){const v=h[x],w=[];for(let A=0;A<v.length;A++){const E=v[A],S=v[A+1],I=A===0?g:E.sub(v[A-1])._unit()._perp(),B=A===v.length-1?g:S.sub(E)._unit()._perp(),M=I._add(B)._unit();M._mult(1/(M.x*B.x+M.y*B.y)),w.push(M._mult(d)._add(E))}m.push(w)}return m}(r,c*e.pixelToTileUnitsFactor)),function(h,d,m){for(let g=0;g<d.length;g++){const x=d[g];if(h.length>=3){for(let v=0;v<x.length;v++)if(Fs(h,x[v]))return!0}if(lg(h,x,m))return!0}return!1}(s,r,a)}isTileClipped(){return!0}},symbol:P1,background:class extends Di{constructor(e,t){super(e,AR,t)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},raster:class extends Di{constructor(e,t){super(e,TR,t),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(e){return!(e&&e._source instanceof Os)||!e._source.onNorthPole&&!e._source.onSouthPole&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-color"].value.expression,[t,n]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=cd({expression:e,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:t,end:n}],resolution:256}),this.colorRampTexture=null}},sky:class extends Di{constructor(e,t){super(e,MR,t),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="sky-gradient"?this._updateColorRamp():e!=="sky-atmosphere-sun"&&e!=="sky-atmosphere-halo-color"&&e!=="sky-atmosphere-color"&&e!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=cd({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if(this.paint.get("sky-type")==="atmosphere"){const r=this.paint.get("sky-atmosphere-sun"),i=!r,o=e.style.light,s=o.properties.get("position");return i&&o.properties.get("anchor")==="viewport"&&rt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),i?Ub(s.azimuthal,90-s.polar,t):Ub(r[0],90-r[1],t)}const n=this.paint.get("sky-gradient-center");return Ub(n[0],90-n[1],t)}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return e==="atmosphere"?["skyboxCapture","skybox"]:e==="gradient"?["skyboxGradient"]:null}},slot:class extends Di{constructor(e,t){super(e,IR)}},model:class extends Di{constructor(e,t){super(e,rR,t)}createBucket(e){return new mS(e)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven()||e!=="model-color"&&e!=="model-color-mix-intensity"&&e!=="model-rotation"&&e!=="model-scale"&&e!=="model-translation"&&e!=="model-emissive-strength")}_isPropertyZoomDependent(e){const t=this._transitionablePaint._values[e];return t!=null&&t.value!=null&&t.value.expression!=null&&t.value.expression instanceof Fo}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};function K1(e,t){return e.type==="custom"?new CR(e):new BR[e.type](e,t)}function DR(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class PR extends Sr{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new Er({width:1,height:1})}isLoaded(){for(const t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,n){if(this.loaded[n]!==t&&(this.loaded[n]=t,t)){for(const{ids:r,callback:i}of this.requestors)this._notify(r,n,i);this.requestors=[]}}hasImage(t,n){return!!this.getImage(t,n)}getImage(t,n){return this.images[n][t]}addImage(t,n,r){this._validate(t,r)&&(this.images[n][t]=r)}_validate(t,n){let r=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new Ie(new Error(`Image "${t}" has invalid "stretchX" value`))),r=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new Ie(new Error(`Image "${t}" has invalid "stretchY" value`))),r=!1),this._validateContent(n.content,n)||(this.fire(new Ie(new Error(`Image "${t}" has invalid "content" value`))),r=!1),r}_validateStretch(t,n){if(!t)return!0;let r=0;for(const i of t){if(i[0]<r||i[1]<i[0]||n<i[1])return!1;r=i[1]}return!0}_validateContent(t,n){return!(t&&(t.length!==4||t[0]<0||n.data.width<t[0]||t[1]<0||n.data.height<t[1]||t[2]<0||n.data.width<t[2]||t[3]<0||n.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,n,r){r.version=this.images[n][t].version+1,this.images[n][t]=r,this.updatedImages[n][t]=!0}removeImage(t,n){const r=this.images[n][t];delete this.images[n][t],delete this.patterns[n][t],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,n,r){let i=!0;const o=!!this.loaded[n];if(!o)for(const s of t)this.images[n][s]||(i=!1);o||i?this._notify(t,n,r):this.requestors.push({ids:t,scope:n,callback:r})}getUpdatedImages(t){return this.updatedImages[t]}_notify(t,n,r){const i={};for(const o of t){this.images[n][o]||this.fire(new Nt("styleimagemissing",{id:o}));const s=this.images[n][o];s?i[o]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,stretchX:s.stretchX,stretchY:s.stretchY,content:s.content,hasRenderCallback:!!(s.userImage&&s.userImage.render)}:rt(`Image "${o}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}r(null,i)}getPixelSize(t){const{width:n,height:r}=this.atlasImage[t];return{width:n,height:r}}getPattern(t,n){const r=this.patterns[n][t],i=this.getImage(t,n);if(!i)return null;if(r&&r.position.version===i.version)return r.position;if(r)r.position.version=i.version;else{const o={w:i.data.width+2,h:i.data.height+2,x:0,y:0},s=new vb(o,i);this.patterns[n][t]={bin:o,position:s}}return this._updatePatternAtlas(n),this.patterns[n][t].position}bind(t,n){const r=t.gl;let i=this.atlasTexture[n];i?this.dirty&&(i.update(this.atlasImage[n]),this.dirty=!1):(i=new _r(t,this.atlasImage[n],r.RGBA),this.atlasTexture[n]=i),i.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(t){const n=[];for(const s in this.patterns[t])n.push(this.patterns[t][s].bin);const{w:r,h:i}=xb(n),o=this.atlasImage[t];o.resize({width:r||1,height:i||1});for(const s in this.patterns[t]){const{bin:a}=this.patterns[t][s],c=a.x+1,h=a.y+1,d=this.images[t][s].data,m=d.width,g=d.height;Er.copy(d,o,{x:0,y:0},{x:c,y:h},{width:m,height:g}),Er.copy(d,o,{x:0,y:g-1},{x:c,y:h-1},{width:m,height:1}),Er.copy(d,o,{x:0,y:0},{x:c,y:h+g},{width:m,height:1}),Er.copy(d,o,{x:m-1,y:0},{x:c-1,y:h},{width:1,height:g}),Er.copy(d,o,{x:0,y:0},{x:c+m,y:h},{width:1,height:g})}this.dirty=!0}beginFrame(){for(const t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,n){for(const r of t){if(this.callbackDispatchedThisFrame[n][r])continue;this.callbackDispatchedThisFrame[n][r]=!0;const i=this.images[n][r];DR(i)&&this.updateImage(r,n,i)}}}const LR=new lr({anchor:new Rt(ut.light.anchor),position:new class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return te(e.expression.evaluate(t))}interpolate(e,t,n){return{x:Ce(e.x,t.x,n),y:Ce(e.y,t.y,n),z:Ce(e.z,t.z,n),azimuthal:Ce(e.azimuthal,t.azimuthal,n),polar:Ce(e.polar,t.polar,n)}}}(ut.light.position),color:new Rt(ut.light.color),intensity:new Rt(ut.light.intensity)});class JS extends Sr{constructor(t,n="flat"){super(),this._transitionable=new pi(LR),this.setLight(t,n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n,r={}){this._validate(dw,t,r)||(this._transitionable.setTransitionOrValue(t),this.id=n)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,r){return(!r||r.validate!==!1)&&Df(this,t.call(Rl,re({value:n,style:{glyphs:!0,sprite:!0},styleSpec:ut})))}}const RR=new lr({source:new Rt(ut.terrain.source),exaggeration:new Rt(ut.terrain.exaggeration)});let kR=class extends Sr{constructor(e,t,n,r){super(),this.scope=n,this._transitionable=new pi(RR,r),this._transitionable.setTransitionOrValue(e,r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(e,t){this._transitionable.setTransitionOrValue(e,t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}getExaggeration(e){return this._transitioning.possiblyEvaluate(new rr(e)).get("exaggeration")}isZoomDependent(){const e=this._transitionable._values.exaggeration;return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Fo}};const $S=45,KS=65,Mh=.05;function X1(e,t,n,r){const i=Ui($S,KS,n),[o,s]=XS(e,r);let a=1-Math.min(1,Math.exp((t-o)/(s-o)*-6));return a*=a*a,a=Math.min(1,1.00747*a),a*i*e.alpha}function XS(e,t){const n=.5/Math.tan(.5*t);return[e.range[0]+n,e.range[1]+n]}function YS(e,t,n,r,i){const o=J.transformMat4([],[t,n,r],i.mercatorFogMatrix);return X1(e,J.length(o),i.pitch,i._fov)}function QS(e,t,n,r,i,o,s){const a=[[n,r,0],[i,r,0],[i,o,0],[n,o,0]];let c=Number.MAX_VALUE,h=-Number.MAX_VALUE;for(const d of a){const m=J.transformMat4([],d,t),g=J.length(m);c=Math.min(c,g),h=Math.max(h,g)}return[X1(e,c,s.pitch,s._fov),X1(e,h,s.pitch,s._fov)]}const FR=new lr({range:new Rt(ut.fog.range),color:new Rt(ut.fog.color),"high-color":new Rt(ut.fog["high-color"]),"space-color":new Rt(ut.fog["space-color"]),"horizon-blend":new Rt(ut.fog["horizon-blend"]),"star-intensity":new Rt(ut.fog["star-intensity"]),"vertical-range":new Rt(ut.fog["vertical-range"])});class zR extends Sr{constructor(t,n){super(),this._transitionable=new pi(FR),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=n}get state(){const t=this._transform,n=t.projection.name==="globe",r=$r(t.zoom),i=this.properties.get("range"),o=[.5,3];return{range:n?[Ce(o[0],i[0],r),Ce(o[1],i[1],r)]:i,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,n={}){if(this._validate(rm,t,n))return;const r=re({},t);for(const i of Object.keys(ut.fog))r[i]===void 0&&(r[i]=ut.fog[i].default);this._transitionable.setTransitionOrValue(r)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const n=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:Ui($S,KS,t))*n.a}getOpacityAtLatLng(t,n){return this._transform.projection.supportsFog?function(r,i,o){const s=an.fromLngLat(i),a=o.elevation?o.elevation.getAtPointOrZero(s):0;return YS(r,s.x,s.y,a,o)}(this.state,t,n):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const n=this._transform.calculateFogTileMatrix(t.toUnwrapped());return QS(this.state,n,0,0,gt,gt,this._transform)}getOpacityForBounds(t,n,r,i,o){return this._transform.projection.supportsFog?QS(this.state,t,n,r,i,o,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?XS(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const n=[4,5,6,7];for(const r of n){const i=t.points[r];let o;if(i[2]>=0)o=i;else{const s=t.points[r-4];o=Gc(s,i,s[2]/(s[2]-i[2]))}if(YS(this.state,o[0],o[1],0,this._transform)>=Mh)return!0}return!1}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,r){return(!r||r.validate!==!1)&&Df(this,t.call(Rl,re({value:n,style:{glyphs:!0,sprite:!0},styleSpec:ut})))}}class OR{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class NR{constructor(){this.tasks={},this.taskQueue=[],Jn(["process"],this),this.invoker=new OR(this.process),this.nextId=0}add(t,n){const r=this.nextId++,i=function({type:o,isSymbolTile:s,zoom:a}){return a=a||0,o==="message"?0:o!=="maybePrepare"||s?o!=="parseTile"||s?o==="parseTile"&&s?300-a:o==="maybePrepare"&&s?400-a:500:200-a:100-a}(n);if(i===0){Pt();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[r]={fn:t,metadata:n,priority:i,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r]}}}process(){Pt();try{if(this.taskQueue=this.taskQueue.filter(r=>!!this.tasks[r]),!this.taskQueue.length)return;const t=this.pick();if(t===null)return;const n=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let t=null,n=1/0;for(let i=0;i<this.taskQueue.length;i++){const o=this.tasks[this.taskQueue[i]];o.priority<n&&(n=o.priority,t=i)}if(t===null)return null;const r=this.taskQueue[t];return this.taskQueue.splice(t,1),r}remove(){this.invoker.remove()}}class tM{constructor(t,n,r){this.target=t,this.parent=n,this.mapId=r,this.callbacks={},this.cancelCallbacks={},Jn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new NR}send(t,n,r,i,o=!1,s){const a=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=s,this.callbacks[a]=r);const c=new Set;return this.target.postMessage({id:a,type:t,hasCallback:!!r,targetMapId:i,mustQueue:o,sourceMapId:this.mapId,data:kl(n,c)},c),{cancel:()=>{r&&delete this.callbacks[a],this.target.postMessage({id:a,type:"<cancel>",targetMapId:i,sourceMapId:this.mapId})}}}receive(t){const n=t.data,r=n.id;if(r&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){const i=this.cancelCallbacks[r];delete this.cancelCallbacks[r],i&&i.cancel()}else if(n.mustQueue||Pt()){const i=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,n),i&&i.metadata||{type:"message"})}else this.processTask(r,n)}processTask(t,n){if(n.type==="<response>"){const r=this.callbacks[t];delete this.callbacks[t],r&&(n.error?r(Fl(n.error)):r(null,Fl(n.data)))}else{const r=new Set,i=n.hasCallback?(s,a)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:s?kl(s):null,data:kl(a,r)},r)}:s=>{},o=Fl(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,o,i);else if(this.parent.getWorkerSource){const s=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,s[0],o.source,o.scope)[s[1]](o,i)}else i(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class Ih{constructor(t,n){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=su();const r=this.workerPool.acquire(this.id);for(let i=0;i<r.length;i++){const o=new Ih.Actor(r[i],n,this.id);o.name=`Worker ${i}`,this.actors.push(o)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,n,r){Mi(this.actors,(i,o)=>{i.send(t,n,o)},r=r||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}Ih.Actor=tM;class eM extends Sr{constructor(t,n,r,i){super(),this.scope=r,this._options=t,this.properties=new Ts(n),this._transitionable=new pi(n,new Map(i)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,n){this._options=t,this._transitionable.setTransitionOrValue(t.properties,n)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const UR=new lr({color:new Rt(ut.properties_light_ambient.color),intensity:new Rt(ut.properties_light_ambient.intensity)}),VR=new lr({direction:new class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return function([n,r]){const i=te([1,n,r]);return{x:i.x,y:i.y,z:i.z}}(e.expression.evaluate(t))}interpolate(e,t,n){return{x:Ce(e.x,t.x,n),y:Ce(e.y,t.y,n),z:Ce(e.z,t.z,n)}}}(ut.properties_light_directional.direction),color:new Rt(ut.properties_light_directional.color),intensity:new Rt(ut.properties_light_directional.intensity),"cast-shadows":new Rt(ut.properties_light_directional["cast-shadows"]),"shadow-intensity":new Rt(ut.properties_light_directional["shadow-intensity"])});class Vb{constructor(t,n,r,i){this.screenBounds=t,this.cameraPoint=n,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=r,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,i)}static createFromScreenPoints(t,n){let r,i;if(t instanceof nt||typeof t[0]=="number"){const o=nt.convert(t);r=[o],i=n.isPointAboveHorizon(o)}else{const o=nt.convert(t[0]),s=nt.convert(t[1]);r=[o,s],i=He(o,s).every(a=>n.isPointAboveHorizon(a))}return new Vb(r,n.getCameraPoint(),i,n)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return He(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const n=this.screenBounds[0],r=this.screenBounds.length===1?this.screenBounds[0].add(new nt(1,1)):this.screenBounds[1],i=He(n,r,0,!1);return this.cameraPoint.y>r.y&&(this.cameraPoint.x>n.x&&this.cameraPoint.x<r.x?i.splice(3,0,this.cameraPoint):this.cameraPoint.x>=r.x?i[2]=this.cameraPoint:this.cameraPoint.x<=n.x&&(i[3]=this.cameraPoint)),function(o,s){const a=[];for(let c=0;c<o.length;c++){const h=ci(c-1,-1,o.length-1),d=ci(c+1,-1,o.length-1),m=o[c],g=o[d],x=o[h].sub(m).unit(),v=g.sub(m).unit(),w=v.angleWithSep(x.x,x.y),A=x.add(v).unit().mult(-1*s/Math.sin(w/2));a.push(m.add(A))}return a}(i,t)}bufferedCameraGeometryGlobe(t){const n=this.screenBounds[0],r=this.screenBounds.length===1?this.screenBounds[0].add(new nt(1,1)):this.screenBounds[1],i=He(n,r,t),o=this.cameraPoint.clone();switch(3*((o.y>n.y)+(o.y>r.y))+((o.x>n.x)+(o.x>r.x))){case 0:i[0]=o,i[4]=o.clone();break;case 1:i.splice(1,0,o);break;case 2:i[1]=o;break;case 3:i.splice(4,0,o);break;case 5:i.splice(2,0,o);break;case 6:i[3]=o;break;case 7:i.splice(3,0,o);break;case 8:i[2]=o}return i}containsTile(t,n,r,i=0){const o=t.queryPadding/n._pixelsPerMercatorPixel+1,s=r?this._bufferedCameraMercator(o,n):this._bufferedScreenMercator(o,n);let a=t.tileID.wrap+(s.unwrapped?i:0);const c=s.polygon.map(A=>kC(t.tileTransform,A,a));if(!i1(c,0,0,gt,gt))return;a=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?i:0);const h=this.screenGeometryMercator.polygon.map(A=>FC(t.tileTransform,A,a)),d=h.map(A=>new nt(A[0],A[1])),m=n.getFreeCameraOptions().position||new an(0,0,0),g=FC(t.tileTransform,m,a),x=h.map(A=>{const E=J.sub(A,A,g);return J.normalize(E,E),new td(g,E)}),v=Th(t,1,n.zoom)*n._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:d,tilespaceRays:x,bufferedTilespaceGeometry:c,bufferedTilespaceBounds:(w=fe(c),w.min.x=$t(w.min.x,0,gt),w.min.y=$t(w.min.y,0,gt),w.max.x=$t(w.max.x,0,gt),w.max.y=$t(w.max.y,0,gt),w),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:v};var w}_bufferedScreenMercator(t,n){const r=nM(t);if(this._screenRaycastCache[r])return this._screenRaycastCache[r];{let i;return i=n.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),n):{polygon:this.bufferedScreenGeometry(t).map(o=>n.pointCoordinate3D(o)),unwrapped:!0},this._screenRaycastCache[r]=i,i}}_bufferedCameraMercator(t,n){const r=nM(t);if(this._cameraRaycastCache[r])return this._cameraRaycastCache[r];{let i;return i=n.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),n):{polygon:this.bufferedCameraGeometry(t).map(o=>n.pointCoordinate3D(o)),unwrapped:!0},this._cameraRaycastCache[r]=i,i}}_projectAndResample(t,n){const r=function(o,s){const a=lt.multiply([],s.pixelMatrix,s.globeMatrix),c=[0,-dn,0,1],h=[0,dn,0,1],d=[0,0,0,1];Bn.transformMat4(c,c,a),Bn.transformMat4(h,h,a),Bn.transformMat4(d,d,a);const m=new nt(c[0]/c[3],c[1]/c[3]),g=new nt(h[0]/h[3],h[1]/h[3]),x=Fs(o,m)&&c[3]<d[3],v=Fs(o,g)&&h[3]<d[3];if(!x&&!v)return null;const w=function(R,z,N){for(let V=1;V<R.length;V++){const j=Pg(z.pointCoordinate3D(R[V-1]).x),H=Pg(z.pointCoordinate3D(R[V]).x);if(N<0){if(j<H)return{idx:V,t:-j/(H-1-j)}}else if(H<j)return{idx:V,t:(1-j)/(H+1-j)}}return null}(o,s,x?-1:1);if(!w)return null;const{idx:A,t:E}=w;let S=A>1?Gb(o.slice(0,A),s):[],I=A<o.length?Gb(o.slice(A),s):[];S=S.map(R=>new nt(Pg(R.x),R.y)),I=I.map(R=>new nt(Pg(R.x),R.y));const B=[...S];B.length===0&&B.push(I[I.length-1]);const M=Ce(B[B.length-1].y,(I.length===0?S[0]:I[0]).y,E);let D;return D=x?[new nt(0,M),new nt(0,0),new nt(1,0),new nt(1,M)]:[new nt(1,M),new nt(1,1),new nt(0,1),new nt(0,M)],B.push(...D),I.length===0?B.push(S[0]):B.push(...I),{polygon:B.map(R=>new an(R.x,R.y)),unwrapped:!1}}(t,n);if(r)return r;const i=function(o,s){let a=!1,c=-1/0,h=0;for(let m=0;m<o.length-1;m++)o[m].x>c&&(c=o[m].x,h=m);for(let m=0;m<o.length-1;m++){const g=(h+m)%(o.length-1),x=o[g],v=o[g+1];Math.abs(x.x-v.x)>.5&&(x.x<v.x?(x.x+=1,g===0&&(o[o.length-1].x+=1)):(v.x+=1,g+1===o.length-1&&(o[0].x+=1)),a=!0)}const d=Ir(s.center.lng);return a&&d<Math.abs(d-1)&&o.forEach(m=>{m.x-=1}),{polygon:o,unwrapped:a}}(Gb(t,n).map(o=>new nt(Pg(o.x),o.y)),n);return{polygon:i.polygon.map(o=>new an(o.x,o.y)),unwrapped:i.unwrapped}}}function Gb(e,t){return Xy(e,n=>{const r=t.pointCoordinate3D(n);n.x=r.x,n.y=r.y},1/256)}function Pg(e){return e<0?1+e%1:e%1}function nM(e){return 100*e|0}function jb(e,t,n,r,i){const o=function(s,a){if(s)return i(s);if(a){e.url&&a.tiles&&e.tiles&&delete e.tiles;const c=fi(re(a,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);a.vector_layers&&(c.vectorLayers=a.vector_layers,c.vectorLayerIds=c.vectorLayers.map(h=>h.id)),c.tiles=t.canonicalizeTileset(c,e.url),i(null,c)}};return e.url?jt(t.transformRequest(t.normalizeSourceURL(e.url,null,n,r),At.Source),o):ze.frame(()=>o(null,e))}class Y1{constructor(t,n,r){this.bounds=lo.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=r||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),r=Math.floor(Ir(this.bounds.getWest())*n),i=Math.floor(Fr(this.bounds.getNorth())*n),o=Math.ceil(Ir(this.bounds.getEast())*n),s=Math.ceil(Fr(this.bounds.getSouth())*n);return t.x>=r&&t.x<o&&t.y>=i&&t.y<s}}class rM{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.image=new da({width:t,height:n}),this.positions={},this.uploaded=!1}getDash(t,n){const r=this.getKey(t,n);return this.positions[r]}trim(){const t=this.width,n=this.height=dl(this.nextRow);this.image.resize({width:t,height:n})}getKey(t,n){return t.join(",")+n}getDashRanges(t,n,r){const i=[];let o=t.length%2==1?-t[t.length-1]*r:0,s=t[0]*r,a=!0;i.push({left:o,right:s,isDash:a,zeroLength:t[0]===0});let c=t[0];for(let h=1;h<t.length;h++){a=!a;const d=t[h];o=c*r,c+=d,s=c*r,i.push({left:o,right:s,isDash:a,zeroLength:d===0})}return i}addRoundDash(t,n,r){const i=n/2;for(let o=-r;o<=r;o++){const s=this.width*(this.nextRow+r+o);let a=0,c=t[a];for(let h=0;h<this.width;h++){h/c.right>1&&(c=t[++a]);const d=Math.abs(h-c.left),m=Math.abs(h-c.right),g=Math.min(d,m);let x;const v=o/r*(i+1);if(c.isDash){const w=i-Math.abs(v);x=Math.sqrt(g*g+w*w)}else x=i-Math.sqrt(g*g+v*v);this.image.data[s+h]=Math.max(0,Math.min(255,x+128))}}}addRegularDash(t,n){for(let c=t.length-1;c>=0;--c){const h=t[c],d=t[c+1];h.zeroLength?t.splice(c,1):d&&d.isDash===h.isDash&&(d.left=h.left,t.splice(c,1))}const r=t[0],i=t[t.length-1];r.isDash===i.isDash&&(r.left=i.left-this.width,i.right=r.right+this.width);const o=this.width*this.nextRow;let s=0,a=t[s];for(let c=0;c<this.width;c++){c/a.right>1&&(a=t[++s]);const h=Math.abs(c-a.left),d=Math.abs(c-a.right),m=Math.min(h,d);this.image.data[o+c]=Math.max(0,Math.min(255,(a.isDash?m:-m)+n+128))}}addDash(t,n){const r=this.getKey(t,n);if(this.positions[r])return this.positions[r];const i=n==="round",o=i?7:0,s=2*o+1;if(this.nextRow+s>this.height)return rt("LineAtlas out of space"),null;t.length===0&&t.push(1);let a=0;for(let d=0;d<t.length;d++)t[d]<0&&(rt("Negative value is found in line dasharray, replacing values with 0"),t[d]=0),a+=t[d];if(a!==0){const d=this.width/a,m=this.getDashRanges(t,this.width,d);i?this.addRoundDash(m,d,o):this.addRegularDash(m,n==="square"?.5*d:0)}const c=this.nextRow+o;this.nextRow+=s;const h={tl:[c,o],br:[a,0]};return this.positions[r]=h,h}}le(rM,"LineAtlas");const iM=1*ga;class oM{constructor(t){const n={},r=[];for(const a in t){const c=t[a],h=n[a]={};for(const d in c.glyphs){const m=c.glyphs[+d];if(!m||m.bitmap.width===0||m.bitmap.height===0)continue;const g=m.metrics.localGlyph?iM:1,x={x:0,y:0,w:m.bitmap.width+2*g,h:m.bitmap.height+2*g};r.push(x),h[d]=x}}const{w:i,h:o}=xb(r),s=new da({width:i||1,height:o||1});for(const a in t){const c=t[a];for(const h in c.glyphs){const d=c.glyphs[+h];if(!d||d.bitmap.width===0||d.bitmap.height===0)continue;const m=n[a][h],g=d.metrics.localGlyph?iM:1;da.copy(d.bitmap,s,{x:0,y:0},{x:m.x+g,y:m.y+g},d.bitmap)}}this.image=s,this.positions=n}}le(oM,"GlyphAtlas");class GR{constructor(t){this.tileID=new sn(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.scope=t.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.promoteId=t.promoteId,this.isSymbolTile=t.isSymbolTile,this.tileTransform=Eh(t.tileID.canonical,t.projection),this.projection=t.projection,this.brightness=t.brightness,this.extraShadowCaster=!!t.extraShadowCaster}parse(t,n,r,i,o){this.status="parsing",this.data=t,this.collisionBoxArray=new bm;const s=new KT(Object.keys(t.layers).sort()),a=new mb(this.tileID,this.promoteId);a.bucketLayerIDs=[];const c={},h=new rM(256,256),d={featureIndex:a,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:h,availableImages:r,brightness:this.brightness},m=n.familiesBySource[this.source];for(const S in m){const I=t.layers[S];if(!I)continue;let B=!1,M=!1,D=!1;for(const N of m[S])N[0].type==="symbol"?B=!0:M=!0,N[0].is3D()&&N[0].type!=="model"&&(D=!0);if(this.extraShadowCaster&&!D||this.isSymbolTile===!0&&!B||this.isSymbolTile===!1&&!M)continue;I.version===1&&rt(`Vector tile source "${this.source}" layer "${S}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const R=s.encode(S),z=[];for(let N=0;N<I.length;N++){const V=I.feature(N),j=a.getId(V,S);z.push({feature:V,id:j,index:N,sourceLayerIndex:R})}for(const N of m[S]){const V=N[0];(!this.extraShadowCaster||V.is3D()&&V.type!=="model")&&(this.isSymbolTile!==void 0&&V.type==="symbol"!==this.isSymbolTile||V.minzoom&&this.zoom<Math.floor(V.minzoom)||V.maxzoom&&this.zoom>=V.maxzoom||V.visibility!=="none"&&(Hb(N,this.zoom,d.brightness,r),(c[V.id]=V.createBucket({index:a.bucketLayerIDs.length,layers:N,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:R,sourceID:this.source,projection:this.projection.spec})).populate(z,d,this.tileID.canonical,this.tileTransform),a.bucketLayerIDs.push(N.map(j=>j.id))))}}let g,x,v,w;h.trim();const A={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},E=()=>{if(g)return this.status="done",o(g);if(this.extraShadowCaster)this.status="done",o(null,{buckets:hi(c).filter(S=>!S.isEmpty()),featureIndex:a,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:d.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(x&&v&&w){const S=new oM(x),I=new CC(v,w);for(const B in c){const M=c[B];M instanceof bg?(Hb(M.layers,this.zoom,d.brightness,r),OP(M,x,S.positions,v,I.iconPositions,this.showCollisionBoxes,r,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):M.hasPattern&&(M instanceof O1||M instanceof Fi||M instanceof Bg)&&(Hb(M.layers,this.zoom,d.brightness,r),M.addFeatures(d,this.tileID.canonical,I.patternPositions,r,this.tileTransform,this.brightness))}this.status="done",o(null,{buckets:hi(c).filter(B=>!B.isEmpty()),featureIndex:a,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:S.image,lineAtlas:h,imageAtlas:I,brightness:d.brightness})}};if(!this.extraShadowCaster){const S=au(d.glyphDependencies,M=>Object.keys(M).map(Number));Object.keys(S).length?i.send("getGlyphs",{uid:this.uid,stacks:S,scope:this.scope},(M,D)=>{g||(g=M,x=D,E())},void 0,!1,A):x={};const I=Object.keys(d.iconDependencies);I.length?i.send("getImages",{icons:I,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(M,D)=>{g||(g=M,v=D,E())},void 0,!1,A):v={};const B=Object.keys(d.patternDependencies);B.length?i.send("getImages",{icons:B,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(M,D)=>{g||(g=M,w=D,E())},void 0,!1,A):w={}}E()}}function Hb(e,t,n,r){const i=new rr(t,{brightness:n});for(const o of e)o.recalculate(i,r)}class sM{constructor(t){this.entries={},this.scheduler=t}request(t,n,r,i){const o=this.entries[t]=this.entries[t]||{callbacks:[]};if(o.result){const[s,a]=o.result;return this.scheduler?this.scheduler.add(()=>{i(s,a)},n):i(s,a),()=>{}}return o.callbacks.push(i),o.cancel||(o.cancel=r((s,a)=>{o.result=[s,a];for(const c of o.callbacks)this.scheduler?this.scheduler.add(()=>{c(s,a)},n):c(s,a);setTimeout(()=>delete this.entries[t],3e3)})),()=>{o.result||(o.callbacks=o.callbacks.filter(s=>s!==i),o.callbacks.length||(o.cancel(),delete this.entries[t]))}}}function aM(e,t,n){const r=JSON.stringify(e.request);return e.data&&(this.deduped.entries[r]={result:[null,e.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},i=>{const o=Kt(e.request,(s,a,c,h)=>{s?i(s):a&&i(null,{vectorTile:n?void 0:new db(new w1(a)),rawData:a,cacheControl:c,expires:h})});return()=>{o.cancel(),i()}},t)}class lM extends Sr{constructor(t,n,r,i){if(super(),this.id=t,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,re(this,fi(n,["url","scheme","tileSize","promoteId"])),this._options=re({type:"vector"},n),this._collectResourceTiming=!!n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(i),this._tileWorkers={},this._deduped=new sM}load(t){this._loaded=!1,this.fire(new Nt("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map._worldview;this._tileJSONRequest=jb(this._options,this.map._requestManager,n,r,(i,o)=>{this._tileJSONRequest=null,this._loaded=!0,i?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),r&&r.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new Ie(i))):o&&(re(this,o),o.bounds&&(this.tileBounds=new Y1(o.bounds,this.minzoom,this.maxzoom)),fu(o.tiles,this.map._requestManager._customAccessToken),this.fire(new Nt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Nt("data",{dataType:"source",sourceDataType:"content"}))),t&&t(i)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=wi(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return re({},this._options)}loadTile(t,n){const r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),i={request:this.map._requestManager.transformRequest(r,At.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:ze.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster};if(i.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=n:t.request=t.actor.send("reloadTile",i,o.bind(this));else if(t.actor=this._tileWorkers[r]=this._tileWorkers[r]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",i,o.bind(this),void 0,!0);else{const s=aM.call({deduped:this._deduped},i,(a,c)=>{a||!c?o.call(this,a):(i.data={cacheControl:c.cacheControl,expires:c.expires,rawData:c.rawData.slice(0)},t.actor&&t.actor.send("loadTile",i,o.bind(this),void 0,!0))},!0);t.request={cancel:s}}function o(s,a){return delete t.request,t.aborted?n(null):s&&s.status!==404?n(s):(a&&a.resourceTiming&&(t.resourceTiming=a.resourceTiming),this.map._refreshExpiredTiles&&a&&t.setExpiryData(a),t.loadVectorData(a,this.map.painter),uu(this.dispatcher),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Zb extends Sr{constructor(t,n,r,i){super(),this.id=t,this.dispatcher=r,this.setEventedParent(i),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=re({type:"raster"},n),re(this,fi(n,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new Nt("dataloading",{dataType:"source"})),this._tileJSONRequest=jb(this._options,this.map._requestManager,null,null,(n,r)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new Ie(n)):r&&(re(this,r),r.bounds&&(this.tileBounds=new Y1(r.bounds,this.minzoom,this.maxzoom)),fu(r.tiles),this.fire(new Nt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Nt("data",{dataType:"source",sourceDataType:"content"}))),t&&t(n)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=wi(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return re({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,n){const r=ze.devicePixelRatio>=2,i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),r,this.tileSize);t.request=Ze(this.map._requestManager.transformRequest(i,At.Tile),(o,s,a,c)=>(delete t.request,t.aborted?(t.state="unloaded",n(null)):o?(t.state="errored",n(o)):s?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:a,expires:c}),t.setTexture(s,this.map.painter),t.state="loaded",uu(this.dispatcher),void n(null)):n(null)))}abortTile(t,n){t.request&&(t.request.cancel(),delete t.request),n()}unloadTile(t,n){t.texture&&t.texture instanceof _r?(t.destroy(!0),t.texture&&t.texture instanceof _r&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),n()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function jR(){return wx.workerClass!=null?new wx.workerClass:new k.Worker(wx.workerUrl)}const Wb="mapboxgl_preloaded_worker_pool";class Td{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Td.workerCount;)this.workers.push(new jR);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Wb]}numActive(){return Object.keys(this.active).length}}let Lg;function Rg(){return Lg||(Lg=new Td),Lg}Td.workerCount=2;let Q1,qb,xa,Jb=null;function uM(){return Pt()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:qb||X.DRACO_URL}const $b=5123,Kb=5126,Xb={5120:Int8Array,5121:Uint8Array,5122:Int16Array,[$b]:Uint16Array,5125:Uint32Array,[Kb]:Float32Array},HR={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",[$b]:"DT_UINT16",5125:"DT_UINT32",[Kb]:"DT_FLOAT32"},Yb={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function cM(e,t,n){const r=n.json.bufferViews.length,i=n.buffers.length;t.bufferView=r,n.json.bufferViews[r]={buffer:i,byteLength:e.byteLength},n.buffers[i]=e}const Qb="KHR_draco_mesh_compression";function ZR(e,t){const n=e.extensions&&e.extensions[Qb];if(!n)return;const r=new xa.Decoder,i=pM(t,n.bufferView),o=new xa.Mesh;if(!r.DecodeArrayToMesh(i,i.byteLength,o))throw new Error("Failed to decode Draco mesh");const s=t.json.accessors[e.indices],a=Xb[s.componentType],c=s.count*a.BYTES_PER_ELEMENT,h=xa._malloc(c);a===Uint16Array?r.GetTrianglesUInt16Array(o,c,h):r.GetTrianglesUInt32Array(o,c,h),cM(xa.memory.buffer.slice(h,h+c),s,t),xa._free(h);for(const d of Object.keys(n.attributes)){const m=r.GetAttributeByUniqueId(o,n.attributes[d]),g=t.json.accessors[e.attributes[d]],x=HR[g.componentType],v=g.count*Yb[g.type]*Xb[g.componentType].BYTES_PER_ELEMENT,w=xa._malloc(v);r.GetAttributeDataArrayForAllPoints(o,m,xa[x],v,w),cM(xa.memory.buffer.slice(w,w+v),g,t),xa._free(w)}r.destroy(),o.destroy(),delete e.extensions[Qb]}const hM=1179937895,fM=new TextDecoder("utf8");function dM(e,t){return new URL(e,t).href}function WR(e,t,n,r){return fetch(dM(e.uri,r)).then(i=>i.arrayBuffer()).then(i=>{t.buffers[n]=i})}function pM(e,t){const n=e.json.bufferViews[t];return new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function qR(e,t,n,r){if(e.uri){const i=dM(e.uri,r);return fetch(i).then(o=>o.blob()).then(o=>k.createImageBitmap(o)).then(o=>{t.images[n]=o})}if(e.bufferView!==void 0){const i=pM(t,e.bufferView),o=new k.Blob([i],{type:e.mimeType});return k.createImageBitmap(o).then(s=>{t.images[n]=s})}}function mM(e,t=0,n){const r={json:null,images:[],buffers:[]};if(new Uint32Array(e,t,1)[0]===hM){const h=new Uint32Array(e,t);let d=2;const m=(h[d++]>>2)-3,g=h[d++]>>2;if(d++,r.json=JSON.parse(fM.decode(h.subarray(d,d+g))),d+=g,d<m){const x=h[d++];d++;const v=t+(d<<2);r.buffers[0]=e.slice(v,v+x)}}else r.json=JSON.parse(fM.decode(new Uint8Array(e,t)));const{buffers:i,images:o,meshes:s,extensionsUsed:a}=r.json;let c=Promise.resolve();if(i){const h=[];for(let d=0;d<i.length;d++){const m=i[d];m.uri?h.push(WR(m,r,d,n)):r.buffers[d]||(r.buffers[d]=null)}c=Promise.all(h)}return c.then(()=>{const h=[],d=a&&a.includes(Qb);if(d&&h.push(function(){if(!xa)return Q1||(Q1=function(m){let g,x=null;function v(){g=new Uint8Array(x.buffer)}function w(){throw new Error("Unexpected Draco error.")}const A={a:{a:w,d:function(E,S,I){return g.copyWithin(E,S,S+I)},c:function(E){const S=g.length,I=Math.max(E>>>0,Math.ceil(1.2*S)),B=Math.ceil((I-S)/65536);try{return x.grow(B),v(),!0}catch{return!1}},b:w}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(m,A):m.then(E=>E.arrayBuffer()).then(E=>WebAssembly.instantiate(E,A))).then(E=>{const{Rb:S,Qb:I,P:B,T:M,X:D,Ja:R,La:z,Qa:N,Va:V,Wa:j,eb:H,jb:$,f:G,e:Q,yb:et,zb:st,Ab:Y,Bb:tt,Db:ct,Gb:pt}=E.instance.exports;x=Q;const dt=(()=>{let wt=0,bt=0,Et=0,_t=0;return Mt=>{Et&&(S(_t),S(wt),bt+=Et,Et=wt=0),wt||(bt+=128,wt=I(bt));const qt=Mt.length+7&-8;let Jt=wt;qt>=bt&&(Et=qt,Jt=_t=I(qt));for(let ne=0;ne<Mt.length;ne++)g[Jt+ne]=Mt[ne];return Jt}})();return v(),G(),{memory:Q,_free:S,_malloc:I,Mesh:class{constructor(){this.ptr=B()}destroy(){M(this.ptr)}},Decoder:class{constructor(){this.ptr=R()}destroy(){$(this.ptr)}DecodeArrayToMesh(wt,bt,Et){const _t=dt(wt),Mt=z(this.ptr,_t,bt,Et.ptr);return!!D(Mt)}GetAttributeByUniqueId(wt,bt){return{ptr:N(this.ptr,wt.ptr,bt)}}GetTrianglesUInt16Array(wt,bt,Et){V(this.ptr,wt.ptr,bt,Et)}GetTrianglesUInt32Array(wt,bt,Et){j(this.ptr,wt.ptr,bt,Et)}GetAttributeDataArrayForAllPoints(wt,bt,Et,_t,Mt){H(this.ptr,wt.ptr,bt.ptr,Et,_t,Mt)}},DT_INT8:et(),DT_UINT8:st(),DT_INT16:Y(),DT_UINT16:tt(),DT_UINT32:ct(),DT_FLOAT32:pt()}})}(fetch(uM())),Q1.then(m=>{xa=m,Q1=void 0}))}()),o)for(let m=0;m<o.length;m++)h.push(qR(o[m],r,m,n));return(h.length?Promise.all(h):Promise.resolve()).then(()=>{if(d&&s)for(const{primitives:m}of s)for(const g of m)ZR(g,r);return r})})}function gM(e){return fetch(e).then(t=>t.arrayBuffer()).then(t=>mM(t,0,e))}class _M{constructor(t,n,r){if(this.triangleCount=n.length/3,this.min=new nt(0,0),this.max=new nt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||t.length===0||r===0)return;const i=t.map(d=>d.x),o=t.map(d=>d.y);this.min=new nt(Math.min(...i),Math.min(...o)),this.max=new nt(Math.max(...i),Math.max(...o));const s=this.max.sub(this.min);s.x=Math.max(s.x,1),s.y=Math.max(s.y,1);const a=Math.max(s.x,s.y)/r;this.cellsX=Math.max(1,Math.ceil(s.x/a)),this.cellsY=Math.max(1,Math.ceil(s.y/a)),this.xScale=1/a,this.yScale=1/a;const c=[];for(let d=0;d<this.triangleCount;d++){const m=t[n[3*d+0]].sub(this.min),g=t[n[3*d+1]].sub(this.min),x=t[n[3*d+2]].sub(this.min),v=oc(Math.floor(Math.min(m.x,g.x,x.x)),this.xScale,this.cellsX),w=oc(Math.floor(Math.max(m.x,g.x,x.x)),this.xScale,this.cellsX),A=oc(Math.floor(Math.min(m.y,g.y,x.y)),this.yScale,this.cellsY),E=oc(Math.floor(Math.max(m.y,g.y,x.y)),this.yScale,this.cellsY),S=new nt(0,0),I=new nt(0,0),B=new nt(0,0),M=new nt(0,0);for(let D=A;D<=E;++D){S.y=I.y=D*a,B.y=M.y=(D+1)*a;for(let R=v;R<=w;++R)S.x=B.x=R*a,I.x=M.x=(R+1)*a,(ki(m,g,x,S,I,M)||ki(m,g,x,S,M,B))&&c.push({cellIdx:D*this.cellsX+R,triIdx:d})}}if(c.length===0)return;c.sort((d,m)=>d.cellIdx-m.cellIdx||d.triIdx-m.triIdx);let h=0;for(;h<c.length;){const d=c[h].cellIdx,m={start:this.payload.length,len:0};for(;h<c.length&&c[h].cellIdx===d;)++m.len,this.payload.push(c[h++].triIdx);this.cells[d]=m}}query(t,n,r){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>n.x||t.y>this.max.y||this.min.y>n.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let c=0;c<this.lookup.length;c++)this.lookup[c]=0;const i=oc(t.x-this.min.x,this.xScale,this.cellsX),o=oc(n.x-this.min.x,this.xScale,this.cellsX),s=oc(t.y-this.min.y,this.yScale,this.cellsY),a=oc(n.y-this.min.y,this.yScale,this.cellsY);for(let c=s;c<=a;c++)for(let h=i;h<=o;h++){const d=this.cells[c*this.cellsX+h];if(d)for(let m=0;m<d.len;m++){const g=this.payload[d.start+m],x=Math.floor(g/8),v=1<<g%8;if(!(this.lookup[x]&v)&&(this.lookup[x]|=v,r.push(g),r.length===this.triangleCount))return}}}}function oc(e,t,n){return Math.max(0,Math.min(n-1,Math.floor(e*t)))}function Bh(e,t){const n=e.json.bufferViews[t.bufferView];return new Xb[t.componentType](e.buffers[n.buffer],(t.byteOffset||0)+(n.byteOffset||0),t.count*Yb[t.type])}function JR(e,t,n){const r=e.indices,i=e.attributes,o={};o.indexArray=new ur;const s=t.json.accessors[r],a=s.count/3;o.indexArray.reserve(a);const c=Bh(t,s);for(let g=0;g<a;g++)o.indexArray.emplaceBack(c[3*g],c[3*g+1],c[3*g+2]);o.indexArray._trim(),o.vertexArray=new Ur;const h=t.json.accessors[i.POSITION];o.vertexArray.reserve(h.count);const d=Bh(t,h);for(let g=0;g<h.count;g++)o.vertexArray.emplaceBack(d[3*g],d[3*g+1],d[3*g+2]);if(o.vertexArray._trim(),o.aabb=new yn(h.min,h.max),o.centroid=function(g,x){const v=[0,0,0],w=g.length;if(w>0){for(let A=0;A<w;A++){const E=3*g[A];v[0]+=x[E],v[1]+=x[E+1],v[2]+=x[E+2]}v[0]/=w,v[1]/=w,v[2]/=w}return v}(c,d),i.COLOR_0!==void 0){const g=t.json.accessors[i.COLOR_0],x=Yb[g.type];if(g.componentType===Kb){o.colorArray=x===3?new Ur:new Ai,o.colorArray.reserve(g.count);const v=Bh(t,g);if(x===3)for(let w=0;w<g.count;w++)o.colorArray.emplaceBack(v[3*w],v[3*w+1],v[3*w+2]);else for(let w=0;w<g.count;w++)o.colorArray.emplaceBack(v[4*w],v[4*w+1],v[4*w+2],v[4*w+3]);o.colorArray._trim()}else if(g.componentType===$b&&x===4){o.colorArray=new Ai,o.colorArray.resize(g.count);const v=Bh(t,g),w=1/65535,A=o.colorArray.float32;for(let E=0;E<4*v.length;++E)A[E]=v[E]*w}else rt(`glTF color buffer parsing for accessor ${JSON.stringify(g)} is not supported`)}if(i.NORMAL!==void 0){o.normalArray=new Ur;const g=t.json.accessors[i.NORMAL];o.normalArray.reserve(g.count);const x=Bh(t,g);for(let v=0;v<g.count;v++)o.normalArray.emplaceBack(x[3*v],x[3*v+1],x[3*v+2]);o.normalArray._trim()}if(i.TEXCOORD_0!==void 0&&n.length>0){o.texcoordArray=new uh;const g=t.json.accessors[i.TEXCOORD_0];o.texcoordArray.reserve(g.count);const x=Bh(t,g);for(let v=0;v<g.count;v++)o.texcoordArray.emplaceBack(x[2*v],x[2*v+1]);o.texcoordArray._trim()}const m=e.material;return o.material=function(g,x){const{emissiveFactor:v=[0,0,0],alphaMode:w="OPAQUE",alphaCutoff:A=.5,normalTexture:E,occlusionTexture:S,emissiveTexture:I,doubleSided:B}=g,{baseColorFactor:M=[1,1,1,1],metallicFactor:D=1,roughnessFactor:R=1,baseColorTexture:z,metallicRoughnessTexture:N}=g.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new Me(...M),metallicFactor:D,roughnessFactor:R,baseColorTexture:z?x[z.index]:void 0,metallicRoughnessTexture:N?x[N.index]:void 0},doubleSided:B,emissiveFactor:v,alphaMode:w,alphaCutoff:A,normalTexture:E?x[E.index]:void 0,occlusionTexture:S?x[S.index]:void 0,emissionTexture:I?x[I.index]:void 0,defined:g.defined===void 0}}(m!==void 0?t.json.materials[m]:{defined:!1},n),i._FEATURE_RGBA4444!==void 0&&(o.featureData=new Uint32Array(Bh(t,t.json.accessors[i._FEATURE_RGBA4444]).buffer)),o}function yM(e,t,n){const{matrix:r,rotation:i,translation:o,scale:s,mesh:a,extras:c,children:h}=e,d={};if(d.matrix=r||lt.fromRotationTranslationScale([],i||[0,0,0,1],o||[0,0,0],s||[1,1,1]),a!==void 0){d.meshes=n[a];const m=d.anchor=[0,0];for(const g of d.meshes){const{min:x,max:v}=g.aabb;m[0]+=x[0]+v[0],m[1]+=x[1]+v[1]}m[0]=Math.floor(m[0]/d.meshes.length/2),m[1]=Math.floor(m[1]/d.meshes.length/2)}if(c&&(c.id&&(d.id=c.id),c.lights&&(d.lights=function(m){if(!m.length)return[];const g=function(E){const S=atob(E),I=new Uint8Array(S.length);for(let B=0;B<S.length;B++)I[B]=S.codePointAt(B);return I}(m),x=[],v=g.length/24,w=new Uint16Array(g.buffer),A=new Float32Array(g.buffer);for(let E=0;E<v;E++){const S=w[2*E*6]/30,I=w[2*E*6+1]/30,B=w[2*E*6+10]/100,M=A[6*E+1],D=A[6*E+2],R=A[6*E+3],z=A[6*E+4],N=R-M,V=z-D,j=Math.hypot(N,V);x.push({pos:[M+.5*N,D+.5*V,I],normal:[V/j,-N/j,0],width:j,height:S,depth:B,points:[M,D,R,z]})}return x}(c.lights))),h){const m=[];for(const g of h)m.push(yM(t.json.nodes[g],t,n));d.children=m}return d}function $R(e){if(e.vertices.length===0||e.indices.length===0)return null;const[t,n]=[e.vertices[0].clone(),e.vertices[0].clone()];for(let s=1;s<e.vertices.length;++s){const a=e.vertices[s];t.x=Math.min(t.x,a.x),t.y=Math.min(t.y,a.y),n.x=Math.max(n.x,a.x),n.y=Math.max(n.y,a.y)}const r=Math.ceil(Math.max(n.x-t.x,n.y-t.y)/256),i=Math.max(8,r),o=new _M(e.vertices,e.indices,i);return{vertices:e.vertices,indices:e.indices,grid:o,min:t,max:n}}function KR(e){if(!e.extras||!e.extras.ground)return null;const t=e.extras.ground;if(!t||!Array.isArray(t)||t.length===0)return null;const n=t[0];if(!n||!Array.isArray(n)||n.length===0)return null;const r=[];for(const s of n){if(!Array.isArray(s)||s.length!==2)continue;const a=s[0],c=s[1];typeof a=="number"&&typeof c=="number"&&r.push(new nt(a,c))}if(r.length<3)return null;r.length>1&&r[r.length-1].equals(r[0])&&r.pop();let i=0;for(let s=0;s<r.length;s++){const a=r[s],c=r[(s+1)%r.length],h=r[(s+2)%r.length];i+=(a.x-c.x)*(h.y-c.y)-(h.x-c.x)*(a.y-c.y)}i>0&&r.reverse();const o=Ye(r.flatMap(s=>[s.x,s.y]),[]);return o.length===0?null:{vertices:r,indices:o}}function XR(e){const t=[],n=[];let r=0;for(const i of e){r=t.length;const o=i.vertexArray.float32,s=i.indexArray.uint16;for(let a=0;a<i.vertexArray.length;a++)t.push(new nt(o[3*a+0],o[3*a+1]));for(let a=0;a<3*i.indexArray.length;a++)n.push(s[a]+r)}if(n.length%3!=0)return null;for(let i=0;i<n.length;i+=3){const o=t[n[i+0]],s=t[n[i+1]],a=t[n[i+2]];(o.x-s.x)*(a.y-s.y)-(a.x-s.x)*(o.y-s.y)>0&&([n[i+1],n[i+2]]=[n[i+2],n[i+1]])}return{vertices:t,indices:n}}function tA(e){const t=function(c,h){const d=[],m=k.WebGL2RenderingContext;if(c.json.textures)for(const g of c.json.textures){const x={magFilter:m.LINEAR,minFilter:m.NEAREST,wrapS:m.REPEAT,wrapT:m.REPEAT};g.sampler!==void 0&&Object.assign(x,c.json.samplers[g.sampler]),d.push({image:h[g.source],sampler:x,uploaded:!1})}return d}(e,e.images),n=function(c,h){const d=[];for(const m of c.json.meshes){const g=[];for(const x of m.primitives)g.push(JR(x,c,h));d.push(g)}return d}(e,t),{scenes:r,scene:i,nodes:o}=e.json,s=r?r[i||0].nodes:o,a=[];for(const c of s)a.push(yM(o[c],e,n));return function(c,h,d){const m={},g=new Set;for(let x=0;x<c.length;x++){const v=d[h[x]];if(!v.extras)continue;const w=v.extras["mapbox:footprint:version"],A=v.extras["mapbox:footprint:id"];(w||A)&&g.add(x),w==="1.0.0"&&A&&(m[A]=x)}for(let x=0;x<c.length;x++){if(g.has(x))continue;const v=c[x],w=d[h[x]];if(!w.extras)continue;let A=null;v.id in m&&(A=XR(c[m[v.id]].meshes)),A||(A=KR(w)),A&&(v.footprint=$R(A))}if(g.size>0){const x=Array.from(g.values()).sort((v,w)=>v-w);for(let v=x.length-1;v>=0;v--)c.splice(x[v],1)}}(a,s,e.json.nodes),a}function YR(e){e.heightmap=new Float32Array(4096),e.heightmap.fill(-1);const t=e.vertexArray.float32,n=e.aabb.min[0]-1,r=e.aabb.min[1]-1,i=Ch/(e.aabb.max[0]-n+2),o=Ch/(e.aabb.max[1]-r+2);for(let s=0;s<t.length;s+=3){const a=t[s+2],c=(t[s+0]-n)*i|0,h=(t[s+1]-r)*o|0;a>e.heightmap[h*Ch+c]&&(e.heightmap[h*Ch+c]=a)}}function QR(e,t){const n={};n.indexArray=new ur,n.indexArray.reserve(4*e.length),n.vertexArray=new Ur,n.vertexArray.reserve(10*e.length),n.colorArray=new Ai,n.vertexArray.reserve(10*e.length);let r=0;for(const s of e){const a=Math.min(10,Math.max(4,1.3*s.height))*t,c=[-s.normal[1],s.normal[0],0],h=Math.min(.29,.1*s.width/s.depth),d=s.width-2*s.depth*t*(h+.01),m=J.scaleAndAdd([],s.pos,c,d/2),g=J.scaleAndAdd([],s.pos,c,-d/2),x=[m[0],m[1],m[2]+s.height],v=[g[0],g[1],g[2]+s.height],w=J.scaleAndAdd([],s.normal,c,h);J.scale(w,w,a);const A=J.scaleAndAdd([],s.normal,c,-h);J.scale(A,A,a),J.add(w,m,w),J.add(A,g,A),m[2]+=.1,g[2]+=.1,n.vertexArray.emplaceBack(w[0],w[1],w[2]),n.vertexArray.emplaceBack(A[0],A[1],A[2]),n.vertexArray.emplaceBack(m[0],m[1],m[2]),n.vertexArray.emplaceBack(g[0],g[1],g[2]),n.vertexArray.emplaceBack(x[0],x[1],x[2]),n.vertexArray.emplaceBack(v[0],v[1],v[2]),n.vertexArray.emplaceBack(m[0],m[1],m[2]),n.vertexArray.emplaceBack(g[0],g[1],g[2]),n.vertexArray.emplaceBack(w[0],w[1],w[2]),n.vertexArray.emplaceBack(A[0],A[1],A[2]);const E=d/a/2;n.colorArray.emplaceBack(-E-h,-1,E,.8),n.colorArray.emplaceBack(E+h,-1,E,.8),n.colorArray.emplaceBack(-E,0,E,1.3),n.colorArray.emplaceBack(E,0,E,1.3),n.colorArray.emplaceBack(E+h,-.8,E,.7),n.colorArray.emplaceBack(E+h,-.8,E,.7),n.colorArray.emplaceBack(0,0,E,1.3),n.colorArray.emplaceBack(0,0,E,1.3),n.colorArray.emplaceBack(E+h,-1.2,E,.8),n.colorArray.emplaceBack(E+h,-1.2,E,.8),n.indexArray.emplaceBack(6+r,4+r,8+r),n.indexArray.emplaceBack(7+r,9+r,5+r),n.indexArray.emplaceBack(0+r,1+r,2+r),n.indexArray.emplaceBack(1+r,3+r,2+r),r+=10}const i={defined:!0,emissiveFactor:[0,0,0]},o={};return o.baseColorFactor=Me.white,i.pbrMetallicRoughness=o,n.material=i,n.aabb=new yn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}le(_M,"TriangleGridIndex");const eA={vector:lM,raster:Zb,"raster-dem":class extends Zb{constructor(e,t,n,r){super(e,t,n,r),this.type="raster-dem",this.maxzoom=22,this._options=re({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(e,t){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function r(i,o){i&&(e.state="errored",t(i)),o&&(e.dem=o,e.dem.onDeserialize(),e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0,e.state="loaded",t(null))}e.request=Ze(this.map._requestManager.transformRequest(n,At.Tile),(function(i,o,s,a){if(delete e.request,e.aborted)e.state="unloaded",t(null);else if(i)e.state="errored",t(i);else if(o){this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:s,expires:a});const h=k.ImageBitmap&&o instanceof k.ImageBitmap&&dp(),d=1-(o.width-((c=o.width)<=1?1:Math.pow(2,Math.floor(Math.log(c)/Math.LN2))))/2;d<1||e.neighboringTiles||(e.neighboringTiles=this._getNeighboringTiles(e.tileID));const m=h?o:ze.getImageData(o,d),g={uid:e.uid,coord:e.tileID,source:this.id,scope:this.scope,rawImageData:m,encoding:this.encoding,padding:d};e.actor&&e.state!=="expired"||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",g,r.bind(this),void 0,!0))}var c}).bind(this))}_getNeighboringTiles(e){const t=e.canonical,n=Math.pow(2,t.z),r=(t.x-1+n)%n,i=t.x===0?e.wrap-1:e.wrap,o=(t.x+1+n)%n,s=t.x+1===n?e.wrap+1:e.wrap,a={};return a[new sn(e.overscaledZ,i,t.z,r,t.y).key]={backfilled:!1},a[new sn(e.overscaledZ,s,t.z,o,t.y).key]={backfilled:!1},t.y>0&&(a[new sn(e.overscaledZ,i,t.z,r,t.y-1).key]={backfilled:!1},a[new sn(e.overscaledZ,e.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},a[new sn(e.overscaledZ,s,t.z,o,t.y-1).key]={backfilled:!1}),t.y+1<n&&(a[new sn(e.overscaledZ,i,t.z,r,t.y+1).key]={backfilled:!1},a[new sn(e.overscaledZ,e.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},a[new sn(e.overscaledZ,s,t.z,o,t.y+1).key]={backfilled:!1}),a}},geojson:class extends Sr{constructor(e,t,n,r){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(r),this._data=t.data,this._options=re({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const i=gt/this.tileSize;this.workerOptions=re({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*i,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*i,extent:gt,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:gt,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*i,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterLeaves(e,t,n,r){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:e,limit:t,offset:n},r),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new Nt("dataloading",{dataType:"source"})),this._loaded=!1;const e=re({},this.workerOptions);e.scope=this.scope;const t=this._data;typeof t=="string"?(e.request=this.map._requestManager.transformRequest(ze.resolveURL(t),At.Source),e.request.collectResourceTiming=this._collectResourceTiming):e.data=JSON.stringify(t),this._pendingLoad=this.actor.send(`${this.type}.loadData`,e,(n,r)=>{if(this._loaded=!0,this._pendingLoad=null,n)this.fire(new Ie(n));else{const i={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&r&&r.resourceTiming&&r.resourceTiming[this.id]&&(i.resourceTiming=r.resourceTiming[this.id]),this.fire(new Nt("data",i)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(e,t){const n=e.actor?"reloadTile":"loadTile";e.actor=this.actor;const r={type:this.type,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:ze.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};e.request=this.actor.send(n,r,(i,o)=>(delete e.request,e.destroy(),e.aborted?t(null):i?t(i):(e.loadVectorData(o,this.map.painter,n==="reloadTile"),t(null))),void 0,n==="loadTile")}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return re({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Os{constructor(e,t,n,r){super(e,t,n,r),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const e=this.options;this.urls=[];for(const t of e.urls)this.urls.push(this.map._requestManager.transformRequest(t,At.Source).url);(function(t,n){const r=k.document.createElement("video");r.muted=!0,r.onloadstart=function(){n(null,r)};for(let i=0;i<t.length;i++){const o=k.document.createElement("source");Qt(t[i])||(r.crossOrigin="Anonymous"),o.src=t[i],r.appendChild(o)}})(this.urls,(t,n)=>{this._loaded=!0,t?this.fire(new Ie(t)):n&&(this.video=n,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const t=this.video.seekable;e<t.start(0)||e>t.end(0)?this.fire(new Ie(new ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,t=e.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new _r(e,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(e)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Os,model:class extends Sr{constructor(e,t,n,r){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const e=[];for(const t in this._options.models){const n=this._options.models[t],r=gM(this.map._requestManager.transformRequest(n.uri,At.Model).url).then(i=>{if(!i)return;const o=tA(i),s=new fS(t,n.position,n.orientation,o);s.computeBoundsAndApplyParent(),this.models.push(s)}).catch(i=>{this.fire(new Ie(new Error(`Could not load model ${t} from ${n.uri}: ${i.message}`)))});e.push(r)}return Promise.allSettled(e).then(()=>{this._loaded=!0,this.fire(new Nt("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new Ie(new Error(`Could not load models: ${t.message}`)))})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,t){}serialize(){return{type:"model"}}},"batched-model":class extends Sr{constructor(e,t,n,r){super(),this.type="batched-model",this.id=e,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=n,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(r)}onAdd(e){this.map=e,this.load()}load(e){this._loaded=!1,this.fire(new Nt("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map._worldview;this._tileJSONRequest=jb(this._options,this.map._requestManager,t,n,(r,i)=>{this._tileJSONRequest=null,this._loaded=!0,r?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),n&&n.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new Ie(r))):i&&(re(this,i),i.bounds&&(this.tileBounds=new Y1(i.bounds,this.minzoom,this.maxzoom)),fu(i.tiles,this.map._requestManager._customAccessToken),this.fire(new Nt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Nt("data",{dataType:"source",sourceDataType:"content"}))),e&&e(r)})}hasTransition(){return!1}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loaded(){return this._loaded}loadTile(e,t){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(n,At.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(e.actor&&e.state!=="expired")if(e.state==="loading")e.reloadCallback=t;else{if(e.buckets){const o=Object.values(e.buckets);for(const s of o)s.dirty=!0;return void(e.state="loaded")}e.request=e.actor.send("reloadTile",r,i.bind(this))}else e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",r,i.bind(this),void 0,!0);function i(o,s){return e.aborted?t(null):o&&o.status!==404?t(o):(s&&(s.resourceTiming&&(e.resourceTiming=s.resourceTiming),this.map._refreshExpiredTiles&&e.setExpiryData(s),e.buckets={...e.buckets,...s.buckets}),e.state="loaded",void t(null))}}serialize(){return re({},this._options)}},canvas:class extends Os{constructor(e,t,n,r){super(e,t,n,r),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(i=>!Array.isArray(i)||i.length!==2||i.some(o=>typeof o!="number"))||this.fire(new Ie(new ae(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new Ie(new ae(`sources.${e}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new Ie(new ae(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof k.HTMLCanvasElement||this.fire(new Ie(new ae(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new Ie(new ae(`sources.${e}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof k.HTMLCanvasElement?this.options.canvas:k.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new Ie(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!e&&!this._playing||this.texture instanceof N1||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new _r(t,this.canvas,t.gl.RGBA,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends Sr{constructor(e,t,n,r){super(),this.id=e,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=t,this.setEventedParent(r),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new Ie(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new Ie(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Y1(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),re(this,fi(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return fi(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new Nt("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Nt("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(e){this._map=e,this._loaded=!1,this.fire(new Nt("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(e),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){const{x:t,y:n,z:r}=e.canonical;return this._implementation.hasTile({x:t,y:n,z:r})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,t){const{x:n,y:r,z:i}=e.tileID.canonical,o=new k.AbortController;e.request=Promise.resolve(this._implementation.loadTile({x:n,y:r,z:i},{signal:o.signal})).then((function(s){return delete e.request,e.aborted?(e.state="unloaded",t(null)):s===void 0?(e.state="errored",t(null)):s===null?(this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",t(null)):function(a){return a instanceof k.ImageData||a instanceof k.HTMLCanvasElement||a instanceof k.ImageBitmap||a instanceof k.HTMLImageElement}(s)?(this.loadTileData(e,s),e.state="loaded",void t(null)):(e.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(s=>{s.code!==20&&(e.state="errored",t(s))}),e.request.cancel=()=>o.abort()}loadTileData(e,t){e.setTexture(t,this._map.painter)}unloadTile(e,t){if(e.texture&&e.texture instanceof _r?(e.destroy(!0),e.texture&&e.texture instanceof _r&&this._map.painter.saveTileTexture(e.texture)):e.destroy(),this._implementation.unloadTile){const{x:n,y:r,z:i}=e.tileID.canonical;this._implementation.unloadTile({x:n,y:r,z:i})}t()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z}))}_clearTiles(){const e=wi(this.id,this.scope);this._map.style.clearSource(e)}_update(){this.fire(new Nt("data",{dataType:"source",sourceDataType:"content"}))}}},nA=function(e,t,n,r){const i=new eA[t.type](e,t,n,r);if(i.id!==e)throw new Error(`Expected Source id to be ${e} instead of ${i.id}`);return Jn(["load","abort","unload","serialize","prepare"],i),i};function tk(e,t){const n=lt.identity([]);return lt.scale(n,n,[.5*e.width,.5*-e.height,1]),lt.translate(n,n,[1,-1,0]),lt.multiply(n,n,e.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(n)}function ek(e,t,n,r,i,o,s,a=!1){const c=e.tilesIn(r,s,a);c.sort(xM);const h=[];for(const m of c)h.push({wrappedTileID:m.tile.tileID.wrapped().key,queryResults:m.tile.queryRenderedFeatures(t,n,e._state,m,i,o,tk(e.transform,m.tile.tileID),a)});const d=function(m){const g={},x={};for(const v of m){const w=v.queryResults,A=v.wrappedTileID,E=x[A]=x[A]||{};for(const S in w){const I=w[S],B=E[S]=E[S]||{},M=g[S]=g[S]||[];for(const D of I)B[D.featureIndex]||(B[D.featureIndex]=!0,M.push(D))}}return g}(h);for(const m in d)d[m].forEach(g=>{const x=g.feature,v=x.layer;v&&v.type!=="background"&&v.type!=="sky"&&v.type!=="slot"&&(x.source=v.source,v["source-layer"]&&(x.sourceLayer=v["source-layer"]),x.state=x.id!==void 0?e.getFeatureState(v["source-layer"],x.id):{})});return d}function nk(e,t){const n=e.getRenderableIds().map(o=>e.getTileByID(o)),r=[],i={};for(let o=0;o<n.length;o++){const s=n[o],a=s.tileID.canonical.key;i[a]||(i[a]=!0,s.querySourceFeatures(r,t))}return r}function xM(e,t){const n=e.tileID,r=t.tileID;return n.overscaledZ-r.overscaledZ||n.canonical.y-r.canonical.y||n.wrap-r.wrap||n.canonical.x-r.canonical.x}class rk{constructor(t){this.style=t}processLayersChanged(){this.layers=[];for(const t in this.style._mergedLayers){const n=this.style._mergedLayers[t];if(n.type==="fill-extrusion")this.layers.push(n);else if(n.type==="model"){const r=this.style.getLayerSource(n);r&&r.type==="batched-model"&&this.layers.push(n)}}}updateZOffset(t,n){this.currentBuildingBuckets=[];for(let i=0;i<this.layers.length;++i){const o=this.layers[i],s=this.style.getLayerSourceCache(o);let a=1;o.type==="fill-extrusion"&&(a=o.paint.get("fill-extrusion-opacity")>0?o.paint.get("fill-extrusion-vertical-scale"):0);let c=s?s.getTile(n):null;if(!c&&s&&n.canonical.z>s.getSource().minzoom){let h=n.scaledTo(Math.min(s.getSource().maxzoom,n.overscaledZ-1));for(;h.overscaledZ>=s.getSource().minzoom&&(c=s.getTile(h),!c&&h.overscaledZ!==0);)h=h.scaledTo(h.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:c?c.getBucket(o):null,tileID:c?c.tileID:n,verticalScale:a})}t.hasAnyZOffset=!1;let r=!1;for(let i=0;i<t.symbolInstances.length;i++){const o=t.symbolInstances.get(i),s=o.zOffset,a=this._getHeightAtTileOffset(n,o.tileAnchorX,o.tileAnchorY);o.zOffset=a!==-1?a:s,r||s===o.zOffset||(r=!0),t.hasAnyZOffset||o.zOffset===0||(t.hasAnyZOffset=!0)}r&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,n,r,i){let o=n,s=r;if(t.canonical.z!==i.canonical.z){const a=i.canonical,c=1/(1<<t.canonical.z-a.z);o=(n+t.canonical.x*gt)*c-a.x*gt|0,s=(r+t.canonical.y*gt)*c-a.y*gt|0}return{tileX:o,tileY:s}}_getHeightAtTileOffset(t,n,r){let i;for(let o=0;o<this.layers.length;++o){if(this.layers[o].type!=="fill-extrusion")continue;const{bucket:s,tileID:a,verticalScale:c}=this.currentBuildingBuckets[o];if(!s)continue;const{tileX:h,tileY:d}=this._mapCoordToOverlappingTile(t,n,r,a),m=s.getHeightAtTileCoord(h,d);if(m&&m.height!==void 0){if(!m.hidden)return m.height*c;i=m.height}}for(let o=0;o<this.layers.length;++o){if(this.layers[o].type!=="model")continue;const{bucket:s,tileID:a}=this.currentBuildingBuckets[o];if(!s)continue;const{tileX:c,tileY:h}=this._mapCoordToOverlappingTile(t,n,r,a),d=s.getHeightAtTileCoord(c,h);if(d&&!d.hidden)return d.height===void 0&&i!==void 0?Math.min(d.maxHeight,i)*d.verticalScale:(d.height||0)*d.verticalScale}return-1}}var vM=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ik(e,t){const n={};for(const r in e)r!=="ref"&&(n[r]=e[r]);return vM.forEach(r=>{r in t&&(n[r]=t[r])}),n}function wM(e){e=e.slice();const t=Object.create(null);for(let n=0;n<e.length;n++)t[e[n].id]=e[n];for(let n=0;n<e.length;n++)"ref"in e[n]&&(e[n]=ik(e[n],t[e[n].ref]));return e}const Tn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function bM(e,t,n){n.push({command:Tn.addSource,args:[e,t[e]]})}function AM(e,t,n){t.push({command:Tn.removeSource,args:[e]}),n[e]=!0}function ok(e,t,n,r){AM(e,n,r),bM(e,t,n)}function sk(e,t,n){let r;for(r in e[n])if(e[n].hasOwnProperty(r)&&r!=="data"&&!Re(e[n][r],t[n][r]))return!1;for(r in t[n])if(t[n].hasOwnProperty(r)&&r!=="data"&&!Re(e[n][r],t[n][r]))return!1;return!0}function tx(e,t,n,r,i,o){let s;for(s in t=t||{},e=e||{})e.hasOwnProperty(s)&&(Re(e[s],t[s])||n.push({command:o,args:[r,s,t[s],i]}));for(s in t)t.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(Re(e[s],t[s])||n.push({command:o,args:[r,s,t[s],i]}))}function ex(e){return e.id}function nx(e,t){return e[t.id]=t,e}class ak{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let r=1;r<this.points.length;r++)this._distances[r]=this._distances[r-1]+this.points[r].dist(this.points[r-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=$t(t,0,1);let n=1,r=this._distances[n];const i=t*this.paddedLength+this.padding;for(;r<i&&n<this._distances.length;)r=this._distances[++n];const o=n-1,s=this._distances[o],a=r-s,c=a>0?(i-s)/a:0;return this.points[o].mult(1-c).add(this.points[n].mult(c))}}class EM{constructor(t,n,r){const i=this.boxCells=[],o=this.circleCells=[];this.xCellCount=Math.ceil(t/r),this.yCellCount=Math.ceil(n/r);for(let s=0;s<this.xCellCount*this.yCellCount;s++)i.push([]),o.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,r,i,o){this._forEachCell(n,r,i,o,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i),this.bboxes.push(o)}insertCircle(t,n,r,i){this._forEachCell(n-i,r-i,n+i,r+i,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(r),this.circles.push(i)}_insertBoxCell(t,n,r,i,o,s){this.boxCells[o].push(s)}_insertCircleCell(t,n,r,i,o,s){this.circleCells[o].push(s)}_query(t,n,r,i,o,s){if(r<0||t>this.width||i<0||n>this.height)return!o&&[];const a=[];if(t<=0&&n<=0&&this.width<=r&&this.height<=i){if(o)return!0;for(let c=0;c<this.boxKeys.length;c++)a.push({key:this.boxKeys[c],x1:this.bboxes[4*c],y1:this.bboxes[4*c+1],x2:this.bboxes[4*c+2],y2:this.bboxes[4*c+3]});for(let c=0;c<this.circleKeys.length;c++){const h=this.circles[3*c],d=this.circles[3*c+1],m=this.circles[3*c+2];a.push({key:this.circleKeys[c],x1:h-m,y1:d-m,x2:h+m,y2:d+m})}return s?a.filter(s):a}return this._forEachCell(t,n,r,i,this._queryCell,a,{hitTest:o,seenUids:{box:{},circle:{}}},s),o?a.length>0:a}_queryCircle(t,n,r,i,o){const s=t-r,a=t+r,c=n-r,h=n+r;if(a<0||s>this.width||h<0||c>this.height)return!i&&[];const d=[];return this._forEachCell(s,c,a,h,this._queryCellCircle,d,{hitTest:i,circle:{x:t,y:n,radius:r},seenUids:{box:{},circle:{}}},o),i?d.length>0:d}query(t,n,r,i,o){return this._query(t,n,r,i,!1,o)}hitTest(t,n,r,i,o){return this._query(t,n,r,i,!0,o)}hitTestCircle(t,n,r,i){return this._queryCircle(t,n,r,!0,i)}_queryCell(t,n,r,i,o,s,a,c){const h=a.seenUids,d=this.boxCells[o];if(d!==null){const g=this.bboxes;for(const x of d)if(!h.box[x]){h.box[x]=!0;const v=4*x;if(t<=g[v+2]&&n<=g[v+3]&&r>=g[v+0]&&i>=g[v+1]&&(!c||c(this.boxKeys[x]))){if(a.hitTest)return s.push(!0),!0;s.push({key:this.boxKeys[x],x1:g[v],y1:g[v+1],x2:g[v+2],y2:g[v+3]})}}}const m=this.circleCells[o];if(m!==null){const g=this.circles;for(const x of m)if(!h.circle[x]){h.circle[x]=!0;const v=3*x;if(this._circleAndRectCollide(g[v],g[v+1],g[v+2],t,n,r,i)&&(!c||c(this.circleKeys[x]))){if(a.hitTest)return s.push(!0),!0;{const w=g[v],A=g[v+1],E=g[v+2];s.push({key:this.circleKeys[x],x1:w-E,y1:A-E,x2:w+E,y2:A+E})}}}}}_queryCellCircle(t,n,r,i,o,s,a,c){const h=a.circle,d=a.seenUids,m=this.boxCells[o];if(m!==null){const x=this.bboxes;for(const v of m)if(!d.box[v]){d.box[v]=!0;const w=4*v;if(this._circleAndRectCollide(h.x,h.y,h.radius,x[w+0],x[w+1],x[w+2],x[w+3])&&(!c||c(this.boxKeys[v])))return s.push(!0),!0}}const g=this.circleCells[o];if(g!==null){const x=this.circles;for(const v of g)if(!d.circle[v]){d.circle[v]=!0;const w=3*v;if(this._circlesCollide(x[w],x[w+1],x[w+2],h.x,h.y,h.radius)&&(!c||c(this.circleKeys[v])))return s.push(!0),!0}}}_forEachCell(t,n,r,i,o,s,a,c){const h=this._convertToXCellCoord(t),d=this._convertToYCellCoord(n),m=this._convertToXCellCoord(r),g=this._convertToYCellCoord(i);for(let x=h;x<=m;x++)for(let v=d;v<=g;v++)if(o.call(this,t,n,r,i,this.xCellCount*v+x,s,a,c))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,r,i,o,s){const a=i-t,c=o-n,h=r+s;return h*h>a*a+c*c}_circleAndRectCollide(t,n,r,i,o,s,a){const c=(s-i)/2,h=Math.abs(t-(i+c));if(h>c+r)return!1;const d=(a-o)/2,m=Math.abs(n-(o+d));if(m>d+r)return!1;if(h<=c||m<=d)return!0;const g=h-c,x=m-d;return g*g+x*x<=r*r}}const el=100;class lk{constructor(t,n,r=new EM(t.width+200,t.height+200,25),i=new EM(t.width+200,t.height+200,25)){this.transform=t,this.grid=r,this.ignoredGrid=i,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+el,this.screenBottomBoundary=t.height+el,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=n}placeCollisionBox(t,n,r,i,o,s,a,c){let h=r.projectedAnchorX,d=r.projectedAnchorY,m=r.projectedAnchorZ;const g=r.elevation,x=r.tileID,v=t.getProjection();if(g&&x){const[D,R,z]=v.upVector(x.canonical,r.tileAnchorX,r.tileAnchorY),N=v.upVectorScale(x.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;h+=D*g*N,d+=R*g*N,m+=z*g*N}const w=this.projectAndGetPerspectiveRatio(a,h,d,m,r.tileID,v.name==="globe"||!!g||this.transform.pitch>0,v),A=s*w.perspectiveRatio,E=(r.x1*n+i.x-r.padding)*A+w.point.x,S=(r.y1*n+i.y-r.padding)*A+w.point.y,I=(r.x2*n+i.x+r.padding)*A+w.point.x,B=(r.y2*n+i.y+r.padding)*A+w.point.y,M=w.perspectiveRatio<=.55||w.occluded;return!this.isInsideGrid(E,S,I,B)||!o&&this.grid.hitTest(E,S,I,B,c)||M?{box:[],offscreen:!1,occluded:w.occluded}:{box:[E,S,I,B],offscreen:this.isOffscreen(E,S,I,B),occluded:!1}}placeCollisionCircles(t,n,r,i,o,s,a,c,h,d,m,g,x,v,w){const A=[],E=this.transform.elevation,S=t.getProjection(),I=E?E.getAtTileOffsetFunc(w,this.transform.center.lat,this.transform.worldSize,S):null,B=new nt(r.tileAnchorX,r.tileAnchorY);let{x:M,y:D,z:R}=S.projectTilePoint(B.x,B.y,w.canonical);if(I){const[st,Y,tt]=I(B);M+=st,D+=Y,R+=tt}const z=S.name==="globe",N=this.projectAndGetPerspectiveRatio(a,M,D,R,w,z||!!E||this.transform.pitch>0,S),{perspectiveRatio:V}=N,j=(m?s/V:s*V)/li,H=ya(M,D,R,c),$=N.signedDistanceFromCamera>0?nS(j,o,r.lineOffsetX*j,r.lineOffsetY*j,!1,H,B,r,i,c,{},E&&!m?I:null,m&&!!E,S,w,m):null;let G=!1,Q=!1,et=!0;if($&&!N.occluded){const st=.5*x*V+v,Y=new nt(-100,-100),tt=new nt(this.screenRightBoundary,this.screenBottomBoundary),ct=new ak,{first:pt,last:dt}=$,wt=pt.path.length;let bt=[];for(let Mt=wt-1;Mt>=1;Mt--)bt.push(pt.path[Mt]);for(let Mt=1;Mt<dt.path.length;Mt++)bt.push(dt.path[Mt]);const Et=2.5*st;h&&(bt=bt.map(([Mt,qt,Jt],ne)=>(I&&!z&&(Jt=I(ne<wt-1?pt.tilePath[wt-1-ne]:dt.tilePath[ne-wt+2])[2]),ya(Mt,qt,Jt,h))),bt.some(Mt=>Mt[3]<=0)&&(bt=[]));let _t=[];if(bt.length>0){let Mt=1/0,qt=-1/0,Jt=1/0,ne=-1/0;for(const se of bt)Mt=Math.min(Mt,se[0]),Jt=Math.min(Jt,se[1]),qt=Math.max(qt,se[0]),ne=Math.max(ne,se[1]);qt>=Y.x&&Mt<=tt.x&&ne>=Y.y&&Jt<=tt.y&&(_t=[bt.map(se=>new nt(se[0],se[1]))],(Mt<Y.x||qt>tt.x||Jt<Y.y||ne>tt.y)&&(_t=TC(_t,Y.x,Y.y,tt.x,tt.y)))}for(const Mt of _t){ct.reset(Mt,.25*st);let qt=0;qt=ct.length<=.5*st?1:Math.ceil(ct.paddedLength/Et)+1;for(let Jt=0;Jt<qt;Jt++){const ne=Jt/Math.max(qt-1,1),se=ct.lerp(ne),Pe=se.x+el,pe=se.y+el;A.push(Pe,pe,st,0);const pn=Pe-st,rn=pe-st,Le=Pe+st,Se=pe+st;if(et=et&&this.isOffscreen(pn,rn,Le,Se),Q=Q||this.isInsideGrid(pn,rn,Le,Se),!n&&this.grid.hitTestCircle(Pe,pe,st,g)&&(G=!0,!d))return{circles:[],offscreen:!1,collisionDetected:G,occluded:!1}}}}return{circles:!d&&G||!Q?[]:A,offscreen:et,collisionDetected:G,occluded:N.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let r=1/0,i=1/0,o=-1/0,s=-1/0;for(const d of t){const m=new nt(d.x+el,d.y+el);r=Math.min(r,m.x),i=Math.min(i,m.y),o=Math.max(o,m.x),s=Math.max(s,m.y),n.push(m)}const a=this.grid.query(r,i,o,s).concat(this.ignoredGrid.query(r,i,o,s)),c={},h={};for(const d of a){const m=d.key;c[m.bucketInstanceId]===void 0&&(c[m.bucketInstanceId]={}),c[m.bucketInstanceId][m.featureIndex]||Qy(n,[new nt(d.x1,d.y1),new nt(d.x2,d.y1),new nt(d.x2,d.y2),new nt(d.x1,d.y2)])&&(c[m.bucketInstanceId][m.featureIndex]=!0,h[m.bucketInstanceId]===void 0&&(h[m.bucketInstanceId]=[]),h[m.bucketInstanceId].push(m.featureIndex))}return h}insertCollisionBox(t,n,r,i,o){(n?this.ignoredGrid:this.grid).insert({bucketInstanceId:r,featureIndex:i,collisionGroupID:o},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,r,i,o){const s=n?this.ignoredGrid:this.grid,a={bucketInstanceId:r,featureIndex:i,collisionGroupID:o};for(let c=0;c<t.length;c+=4)s.insertCircle(a,t[c],t[c+1],t[c+2])}projectAndGetPerspectiveRatio(t,n,r,i,o,s,a){const c=[n,r,i,1];let h=!1;i||this.transform.pitch>0?(Bn.transformMat4(c,c,t),this.fogState&&o&&a.name!=="globe"&&(h=function(g,x,v,w,A,E){const S=E.calculateFogTileMatrix(A),I=[x,v,w];return J.transformMat4(I,I,S),X1(g,J.length(I),E.pitch,E._fov)}(this.fogState,n,r,i,o.toUnwrapped(),this.transform)>.9)):aS(c,c,t);const d=c[3];return{point:new nt((c[0]/d+1)/2*this.transform.width+el,(-c[1]/d+1)/2*this.transform.height+el),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(a)/d*.5,1.5),signedDistanceFromCamera:d,occluded:s&&c[2]>d||h}}isOffscreen(t,n,r,i){return r<el||t>=this.screenRightBoundary||i<el||n>this.screenBottomBoundary}isInsideGrid(t,n,r,i){return r>=0&&t<this.gridRightBoundary&&i>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=lt.identity([]);return lt.translate(t,t,[-100,-100,0]),t}}function rA(e,t,n){const r=t.createTileMatrix(e,e.worldSize,n.toUnwrapped());return lt.multiply(new Float32Array(16),e.projMatrix,r)}function uk(e,t,n){if(t.projection.name===n.projection.name)return e.projMatrix;const r=n.clone();return r.setProjection(t.projection),rA(r,t.getProjection(),e)}function iA(e,t,n){return t.name===n.projection.name?e.projMatrix:rA(n,t,e)}class TM{constructor(t,n,r,i){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):i&&r?1:0,this.placed=r}isHidden(){return this.opacity===0&&!this.placed}}class kg{constructor(t,n,r,i,o,s=!1){this.text=new TM(t?t.text:null,n,r,o),this.icon=new TM(t?t.icon:null,n,i,o),this.clipped=s}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class oA{constructor(t,n,r,i=!1){this.text=t,this.icon=n,this.skipFade=r,this.clipped=i}}class ck{constructor(){this.invProjMatrix=lt.create(),this.viewportMatrix=lt.create(),this.circles=[]}}class hk{constructor(t,n,r,i,o){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=r,this.bucketIndex=i,this.tileID=o}}class fk{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:r=>r.collisionGroupID===n}}return this.collisionGroups[t]}}function CM(e,t,n,r,i){const{horizontalAlign:o,verticalAlign:s}=E1(e),a=-(o-.5)*t,c=-(s-.5)*n,h=bb(e,r);return new nt(a+h[0]*i,c+h[1]*i)}function sA(e,t,n,r,i){const o=new nt(e,t);return n&&o._rotate(r?i:-i),o}class dk{constructor(t,n,r,i,o,s){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new lk(this.transform,o),this.buildingIndex=s,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new fk(r),this.collisionCircleArrays={},this.prevPlacement=i,i&&(i.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,r,i){const o=r.getBucket(n),s=r.latestFeatureIndex;if(!o||!s||n.fqid!==o.layerIds[0])return;const a=o.layers[0].layout,c=r.collisionBoxArray,h=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),d=r.tileSize/gt,m=r.tileID.toUnwrapped();this.transform.setProjection(o.projection);const g=(x=r.tileID,v=o.getProjection(),w=this.transform,v.name===this.projection?w.calculateProjMatrix(x.toUnwrapped()):rA(w,v,x));var x,v,w;const A=a.get("text-pitch-alignment")==="map",E=a.get("text-rotation-alignment")==="map";n.compileFilter();const S=n.dynamicFilter(),I=n.dynamicFilterNeedsFeature(),B=this.transform.calculatePixelsToTileUnitsMatrix(r),M=QC(g,r.tileID.canonical,A,E,this.transform,o.getProjection(),B);let D=null;if(A){const N=tS(g,r.tileID.canonical,A,E,this.transform,o.getProjection(),B);D=lt.multiply([],this.transform.labelPlaneMatrix,N)}let R=null;S&&r.latestFeatureIndex&&(R={unwrappedTileID:m,dynamicFilter:S,dynamicFilterNeedsFeature:I,featureIndex:r.latestFeatureIndex}),this.retainedQueryData[o.bucketInstanceId]=new hk(o.bucketInstanceId,s,o.sourceLayerIndex,o.index,r.tileID);const z={bucket:o,layout:a,posMatrix:g,textLabelPlaneMatrix:M,labelToScreenMatrix:D,clippingData:R,scale:h,textPixelRatio:d,holdingForFade:r.holdingForFade(),collisionBoxArray:c,partiallyEvaluatedTextSize:Xa(o.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:Xa(o.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(i)for(const N of o.sortKeyRanges){const{sortKey:V,symbolInstanceStart:j,symbolInstanceEnd:H}=N;t.push({sortKey:V,symbolInstanceStart:j,symbolInstanceEnd:H,parameters:z})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:z})}attemptAnchorPlacement(t,n,r,i,o,s,a,c,h,d,m,g,x,v,w,A,E,S){const{textOffset0:I,textOffset1:B,crossTileID:M}=g,D=[I,B],R=CM(t,r,i,D,o),z=this.collisionIndex.placeCollisionBox(v,o,n,sA(R.x,R.y,s,a,this.transform.angle),m,c,h,d.predicate);if(A){const N=v.getSymbolInstanceIconSize(S,this.transform.zoom,g.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(v,N,A,sA(R.x,R.y,s,a,this.transform.angle),m,c,h,d.predicate).box.length===0)return}if(z.box.length>0){let N;return this.prevPlacement&&this.prevPlacement.variableOffsets[M]&&this.prevPlacement.placements[M]&&this.prevPlacement.placements[M].text&&(N=this.prevPlacement.variableOffsets[M].anchor),this.variableOffsets[M]={textOffset:D,width:r,height:i,anchor:t,textScale:o,prevAnchor:N},this.markUsedJustification(v,t,g,w),v.allowVerticalPlacement&&(this.markUsedOrientation(v,w,g),this.placedOrientations[M]=w),{shift:R,placedGlyphBoxes:z}}}placeLayerBucketPart(t,n,r,i){const{bucket:o,layout:s,posMatrix:a,textLabelPlaneMatrix:c,labelToScreenMatrix:h,clippingData:d,textPixelRatio:m,holdingForFade:g,collisionBoxArray:x,partiallyEvaluatedTextSize:v,partiallyEvaluatedIconSize:w,collisionGroup:A}=t.parameters,E=s.get("text-optional"),S=s.get("icon-optional"),I=s.get("text-allow-overlap"),B=s.get("icon-allow-overlap"),M=s.get("text-rotation-alignment")==="map",D=s.get("text-pitch-alignment")==="map",R=s.get("symbol-z-order")==="viewport-y",z=s.get("symbol-z-elevate");this.transform.setProjection(o.projection);let N=I&&(B||!o.hasIconData()||S),V=B&&(I||!o.hasTextData()||E);!o.collisionArrays&&x&&o.deserializeCollisionBoxes(x),r&&i&&o.updateCollisionDebugBuffers(this.transform.zoom,x);const j=(H,$,G)=>{const{crossTileID:Q,numVerticalGlyphVertices:et}=H;if(d){const Le={zoom:this.transform.zoom,pitch:this.transform.pitch};let Se=null;if(d.dynamicFilterNeedsFeature){const _e=this.retainedQueryData[o.bucketInstanceId];Se=d.featureIndex.loadFeature({featureIndex:H.featureIndex,bucketIndex:_e.bucketIndex,sourceLayerIndex:_e.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,d.dynamicFilter)(Le,Se,this.retainedQueryData[o.bucketInstanceId].tileID.canonical,new nt(H.tileAnchorX,H.tileAnchorY),this.transform.calculateDistanceTileData(d.unwrappedTileID)))return this.placements[Q]=new oA(!1,!1,!1,!0),void n.add(Q)}if(n.has(Q))return;if(g)return void(this.placements[Q]=new oA(!1,!1,!1));let st=!1,Y=!1,tt=!0,ct=!1,pt=!1,dt=null,wt={box:null,offscreen:null,occluded:null},bt={box:null,offscreen:null,occluded:null},Et=null,_t=null,Mt=null,qt=0,Jt=0,ne=0;G.textFeatureIndex?qt=G.textFeatureIndex:H.useRuntimeCollisionCircles&&(qt=H.featureIndex),G.verticalTextFeatureIndex&&(Jt=G.verticalTextFeatureIndex);const se=Le=>{Le.tileID=this.retainedQueryData[o.bucketInstanceId].tileID;const Se=this.transform.elevation;Le.elevation=H.zOffset+(Se?Se.getAtTileOffset(Le.tileID,Le.tileAnchorX,Le.tileAnchorY):0)},Pe=G.textBox;if(Pe){se(Pe);const Le=_e=>{let ln=fr.horizontal;if(o.allowVerticalPlacement&&!_e&&this.prevPlacement){const cn=this.prevPlacement.placedOrientations[Q];cn&&(this.placedOrientations[Q]=cn,ln=cn,this.markUsedOrientation(o,ln,H))}return ln},Se=(_e,ln)=>{if(o.allowVerticalPlacement&&et>0&&G.verticalTextBox){for(const cn of o.writingModes)if(cn===fr.vertical?(wt=ln(),bt=wt):wt=_e(),wt&&wt.box&&wt.box.length)break}else wt=_e()};if(s.get("text-variable-anchor")){let _e=s.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Q]){const Je=this.prevPlacement.variableOffsets[Q];_e.indexOf(Je.anchor)>0&&(_e=_e.filter(Gn=>Gn!==Je.anchor),_e.unshift(Je.anchor))}const ln=(Je,Gn,Tr)=>{const On=o.getSymbolInstanceTextSize(v,H,this.transform.zoom,$),Xn=(Je.x2-Je.x1)*On+2*Je.padding,Dr=(Je.y2-Je.y1)*On+2*Je.padding,Cr=H.hasIconTextFit&&!B?Gn:null;Cr&&se(Cr);let or={box:[],offscreen:!1,occluded:!1};const kn=I?2*_e.length:_e.length;for(let mi=0;mi<kn;++mi){const rl=this.attemptAnchorPlacement(_e[mi%_e.length],Je,Xn,Dr,On,M,D,m,a,A,mi>=_e.length,H,$,o,Tr,Cr,v,w);if(rl&&(or=rl.placedGlyphBoxes,or&&or.box&&or.box.length)){st=!0,dt=rl.shift;break}}return or};Se(()=>ln(Pe,G.iconBox,fr.horizontal),()=>{const Je=G.verticalTextBox;return Je&&se(Je),o.allowVerticalPlacement&&!(wt&&wt.box&&wt.box.length)&&et>0&&Je?ln(Je,G.verticalIconBox,fr.vertical):{box:null,offscreen:null,occluded:null}}),wt&&(st=wt.box,tt=wt.offscreen,ct=wt.occluded);const cn=Le(!(!wt||!wt.box));if(!st&&this.prevPlacement){const Je=this.prevPlacement.variableOffsets[Q];Je&&(this.variableOffsets[Q]=Je,this.markUsedJustification(o,Je.anchor,H,cn))}}else{const _e=(ln,cn)=>{const Je=o.getSymbolInstanceTextSize(v,H,this.transform.zoom,$),Gn=this.collisionIndex.placeCollisionBox(o,Je,ln,new nt(0,0),I,m,a,A.predicate);return Gn&&Gn.box&&Gn.box.length&&(this.markUsedOrientation(o,cn,H),this.placedOrientations[Q]=cn),Gn};Se(()=>_e(Pe,fr.horizontal),()=>{const ln=G.verticalTextBox;return o.allowVerticalPlacement&&et>0&&ln?(se(ln),_e(ln,fr.vertical)):{box:null,offscreen:null,occluded:null}}),Le(!!(wt&&wt.box&&wt.box.length))}}if(Et=wt,st=Et&&Et.box&&Et.box.length>0,tt=Et&&Et.offscreen,ct=Et&&Et.occluded,H.useRuntimeCollisionCircles){const Le=o.text.placedSymbolArray.get(H.centerJustifiedTextSymbolIndex>=0?H.centerJustifiedTextSymbolIndex:H.verticalPlacedTextSymbolIndex),Se=dg(o.textSizeData,v,Le),_e=s.get("text-padding");_t=this.collisionIndex.placeCollisionCircles(o,I,Le,o.lineVertexArray,o.glyphOffsetArray,Se,a,c,h,r,D,A.predicate,H.collisionCircleDiameter*Se/li,_e,this.retainedQueryData[o.bucketInstanceId].tileID),st=I||_t.circles.length>0&&!_t.collisionDetected,tt=tt&&_t.offscreen,ct=_t.occluded}if(G.iconFeatureIndex&&(ne=G.iconFeatureIndex),G.iconBox){const Le=Se=>{se(Se);const _e=H.hasIconTextFit&&dt?sA(dt.x,dt.y,M,D,this.transform.angle):new nt(0,0),ln=o.getSymbolInstanceIconSize(w,this.transform.zoom,H.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(o,ln,Se,_e,B,m,a,A.predicate)};bt&&bt.box&&bt.box.length&&G.verticalIconBox?(Mt=Le(G.verticalIconBox),Y=Mt.box.length>0):(Mt=Le(G.iconBox),Y=Mt.box.length>0),tt=tt&&Mt.offscreen,pt=Mt.occluded}const pe=E||H.numHorizontalGlyphVertices===0&&et===0,pn=S||H.numIconVertices===0;if(pe||pn?pn?pe||(Y=Y&&st):st=Y&&st:Y=st=Y&&st,st&&Et&&Et.box&&this.collisionIndex.insertCollisionBox(Et.box,s.get("text-ignore-placement"),o.bucketInstanceId,bt&&bt.box&&Jt?Jt:qt,A.ID),Y&&Mt&&this.collisionIndex.insertCollisionBox(Mt.box,s.get("icon-ignore-placement"),o.bucketInstanceId,ne,A.ID),_t&&(st&&this.collisionIndex.insertCollisionCircles(_t.circles,s.get("text-ignore-placement"),o.bucketInstanceId,qt,A.ID),r)){const Le=o.bucketInstanceId;let Se=this.collisionCircleArrays[Le];Se===void 0&&(Se=this.collisionCircleArrays[Le]=new ck);for(let _e=0;_e<_t.circles.length;_e+=4)Se.circles.push(_t.circles[_e+0]),Se.circles.push(_t.circles[_e+1]),Se.circles.push(_t.circles[_e+2]),Se.circles.push(_t.collisionDetected?1:0)}const rn=o.projection.name!=="globe";N=N&&(rn||!ct),V=V&&(rn||!pt),this.placements[Q]=new oA(st||N,Y||V,tt||o.justReloaded),n.add(Q)};if(z&&this.buildingIndex&&(this.buildingIndex.updateZOffset(o,this.retainedQueryData[o.bucketInstanceId].tileID),o.updateZOffset()),R){const H=o.getSortedSymbolIndexes(this.transform.angle);for(let $=H.length-1;$>=0;--$){const G=H[$];j(o.symbolInstances.get(G),G,o.collisionArrays[G])}o.hasAnyZOffset&&rt(`${o.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(o.hasAnyZOffset){const H=o.getSortedIndexesByZOffset();for(let $=0;$<H.length;++$){const G=H[$];j(o.symbolInstances.get(G),G,o.collisionArrays[G])}}else for(let H=t.symbolInstanceStart;H<t.symbolInstanceEnd;H++)j(o.symbolInstances.get(H),H,o.collisionArrays[H]);if(r&&o.bucketInstanceId in this.collisionCircleArrays){const H=this.collisionCircleArrays[o.bucketInstanceId];lt.invert(H.invProjMatrix,a),H.viewportMatrix=this.collisionIndex.getViewportMatrix()}o.justReloaded=!1}markUsedJustification(t,n,r,i){const{leftJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:s,rightJustifiedTextSymbolIndex:a,verticalPlacedTextSymbolIndex:c,crossTileID:h}=r,d=Ab(n),m=i===fr.vertical?c:d==="left"?o:d==="center"?s:d==="right"?a:-1;o>=0&&(t.text.placedSymbolArray.get(o).crossTileID=m>=0&&o!==m?0:h),s>=0&&(t.text.placedSymbolArray.get(s).crossTileID=m>=0&&s!==m?0:h),a>=0&&(t.text.placedSymbolArray.get(a).crossTileID=m>=0&&a!==m?0:h),c>=0&&(t.text.placedSymbolArray.get(c).crossTileID=m>=0&&c!==m?0:h)}markUsedOrientation(t,n,r){const i=n===fr.horizontal||n===fr.horizontalOnly?n:0,o=n===fr.vertical?n:0,{leftJustifiedTextSymbolIndex:s,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:c,verticalPlacedTextSymbolIndex:h}=r,d=t.text.placedSymbolArray;s>=0&&(d.get(s).placedOrientation=i),a>=0&&(d.get(a).placedOrientation=i),c>=0&&(d.get(c).placedOrientation=i),h>=0&&(d.get(h).placedOrientation=o)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let r=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const i=n?n.symbolFadeChange(t):1,o=n?n.opacities:{},s=n?n.variableOffsets:{},a=n?n.placedOrientations:{};for(const c in this.placements){const h=this.placements[c],d=o[c];d?(this.opacities[c]=new kg(d,i,h.text,h.icon,null,h.clipped),r=r||h.text!==d.text.placed||h.icon!==d.icon.placed):(this.opacities[c]=new kg(null,i,h.text,h.icon,h.skipFade,h.clipped),r=r||h.text||h.icon)}for(const c in o){const h=o[c];if(!this.opacities[c]){const d=new kg(h,i,!1,!1);d.isHidden()||(this.opacities[c]=d,r=r||h.text.placed||h.icon.placed)}}for(const c in s)this.variableOffsets[c]||!this.opacities[c]||this.opacities[c].isHidden()||(this.variableOffsets[c]=s[c]);for(const c in a)this.placedOrientations[c]||!this.opacities[c]||this.opacities[c].isHidden()||(this.placedOrientations[c]=a[c]);r?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n){const r=new Set;for(const i of n){const o=i.getBucket(t);o&&i.latestFeatureIndex&&t.fqid===o.layerIds[0]&&(this.updateBucketOpacities(o,r,i.collisionBoxArray),o.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(o,i.tileID),o.updateZOffset()))}}updateBucketOpacities(t,n,r){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const i=t.layers[0].layout,o=!!t.layers[0].dynamicFilter(),s=new kg(null,0,!1,!1,!0),a=i.get("text-allow-overlap"),c=i.get("icon-allow-overlap"),h=i.get("text-variable-anchor"),d=i.get("text-rotation-alignment")==="map",m=i.get("text-pitch-alignment")==="map",g=new kg(null,0,a&&(c||!t.hasIconData()||i.get("icon-optional")),c&&(a||!t.hasTextData()||i.get("text-optional")),!0);!t.collisionArrays&&r&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(r);const x=(w,A,E)=>{for(let S=0;S<A/4;S++)w.opacityVertexArray.emplaceBack(E)};let v=0;for(let w=0;w<t.symbolInstances.length;w++){const A=t.symbolInstances.get(w),{numHorizontalGlyphVertices:E,numVerticalGlyphVertices:S,crossTileID:I,numIconVertices:B}=A,M=n.has(I);let D=this.opacities[I];M?D=s:D||(D=g,this.opacities[I]=D),n.add(I);const R=E>0||S>0,z=B>0,N=this.placedOrientations[I],V=N===fr.vertical,j=N===fr.horizontal||N===fr.horizontalOnly;if(!R&&!z||D.isHidden()||v++,R){const H=SM(D.text);x(t.text,E,V?ix:H),x(t.text,S,j?ix:H);const $=D.text.isHidden(),{leftJustifiedTextSymbolIndex:G,centerJustifiedTextSymbolIndex:Q,rightJustifiedTextSymbolIndex:et,verticalPlacedTextSymbolIndex:st}=A,Y=t.text.placedSymbolArray,tt=$||V?1:0;G>=0&&(Y.get(G).hidden=tt),Q>=0&&(Y.get(Q).hidden=tt),et>=0&&(Y.get(et).hidden=tt),st>=0&&(Y.get(st).hidden=$||j?1:0);const ct=this.variableOffsets[I];ct&&this.markUsedJustification(t,ct.anchor,A,N);const pt=this.placedOrientations[I];pt&&(this.markUsedJustification(t,"left",A,pt),this.markUsedOrientation(t,pt,A))}if(z){const H=SM(D.icon),{placedIconSymbolIndex:$,verticalPlacedIconSymbolIndex:G}=A,Q=t.icon.placedSymbolArray,et=D.icon.isHidden()?1:0;$>=0&&(x(t.icon,B,V?ix:H),Q.get($).hidden=et),G>=0&&(x(t.icon,A.numVerticalIconVertices,j?ix:H),Q.get(G).hidden=et)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const H=t.collisionArrays[w];if(H){let $=new nt(0,0),G=!0;if(H.textBox||H.verticalTextBox){if(h){const et=this.variableOffsets[I];et?($=CM(et.anchor,et.width,et.height,et.textOffset,et.textScale),d&&$._rotate(m?this.transform.angle:-this.transform.angle)):G=!1}o&&(G=!D.clipped),H.textBox&&rx(t.textCollisionBox.collisionVertexArray,D.text.placed,!G||V,$.x,$.y),H.verticalTextBox&&rx(t.textCollisionBox.collisionVertexArray,D.text.placed,!G||j,$.x,$.y)}const Q=G&&!!(!j&&H.verticalIconBox);H.iconBox&&rx(t.iconCollisionBox.collisionVertexArray,D.icon.placed,Q,A.hasIconTextFit?$.x:0,A.hasIconTextFit?$.y:0),H.verticalIconBox&&rx(t.iconCollisionBox.collisionVertexArray,D.icon.placed,!Q,A.hasIconTextFit?$.x:0,A.hasIconTextFit?$.y:0)}}}if(t.fullyClipped=v===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const w=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=w.invProjMatrix,t.placementViewportMatrix=w.viewportMatrix,t.collisionCircleArray=w.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const r=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*r>t}setStale(){this.stale=!0}}function rx(e,t,n,r,i){e.emplaceBack(t?1:0,n?1:0,r||0,i||0),e.emplaceBack(t?1:0,n?1:0,r||0,i||0),e.emplaceBack(t?1:0,n?1:0,r||0,i||0),e.emplaceBack(t?1:0,n?1:0,r||0,i||0)}const pk=Math.pow(2,25),mk=Math.pow(2,24),gk=Math.pow(2,17),_k=Math.pow(2,16),yk=Math.pow(2,9),xk=Math.pow(2,8),vk=Math.pow(2,1);function SM(e){if(e.opacity===0&&!e.placed)return 0;if(e.opacity===1&&e.placed)return 4294967295;const t=e.placed?1:0,n=Math.floor(127*e.opacity);return n*pk+t*mk+n*gk+t*_k+n*yk+t*xk+n*vk+t}const ix=0;class wk{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,n,r,i,o){const s=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(s,i,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,o())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,s.sort((a,c)=>a.sortKey-c.sortKey));this._currentPartIndex<s.length;){const a=s[this._currentPartIndex];if(n.placeLayerBucketPart(a,this._seenCrossTileIDs,r,a.symbolInstanceStart===0),this._currentPartIndex++,o())return!0}return!1}}class bk{constructor(t,n,r,i,o,s,a,c,h){this.placement=new dk(t,o,s,a,c,h),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=i,this._done=!1}isDone(){return this._done}continuePlacement(t,n,r,i){const o=ze.now(),s=()=>{const a=ze.now()-o;return!this._forceFullPlacement&&a>2};for(;this._currentPlacementIndex>=0;){const a=n[t[this._currentPlacementIndex]],c=this.placement.collisionIndex.transform.zoom;if(a.type==="symbol"&&(!a.minzoom||a.minzoom<=c)&&(!a.maxzoom||a.maxzoom>c)){const h=a,d=h.layout.get("symbol-z-elevate"),m=this._inProgressLayer=this._inProgressLayer||new wk(h),g=wi(a.source,a.scope);if(m.continuePlacement(d?i[g]:r[g],this.placement,this._showCollisionBoxes,a,s))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const MM=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class ox{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,r]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const i=r>>4;if(i!==1)throw new Error(`Got v${i} data when expected v1.`);const o=MM[15&r];if(!o)throw new Error("Unrecognized array type.");const[s]=new Uint16Array(t,2,1),[a]=new Uint32Array(t,4,1);return new ox(a,s,o,t)}constructor(t,n=64,r=Float64Array,i){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=r,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const o=MM.indexOf(this.ArrayType),s=2*t*this.ArrayType.BYTES_PER_ELEMENT,a=t*this.IndexArrayType.BYTES_PER_ELEMENT,c=(8-a%8)%8;if(o<0)throw new Error(`Unexpected typed array class: ${r}.`);i&&i instanceof ArrayBuffer?(this.data=i,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+a+c,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+s+a+c),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+a+c,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+o]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const r=this._pos>>1;return this.ids[r]=r,this.coords[this._pos++]=t,this.coords[this._pos++]=n,r}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return aA(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,r,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:o,coords:s,nodeSize:a}=this,c=[0,o.length-1,0],h=[];for(;c.length;){const d=c.pop()||0,m=c.pop()||0,g=c.pop()||0;if(m-g<=a){for(let A=g;A<=m;A++){const E=s[2*A],S=s[2*A+1];E>=t&&E<=r&&S>=n&&S<=i&&h.push(o[A])}continue}const x=g+m>>1,v=s[2*x],w=s[2*x+1];v>=t&&v<=r&&w>=n&&w<=i&&h.push(o[x]),(d===0?t<=v:n<=w)&&(c.push(g),c.push(x-1),c.push(1-d)),(d===0?r>=v:i>=w)&&(c.push(x+1),c.push(m),c.push(1-d))}return h}within(t,n,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:i,coords:o,nodeSize:s}=this,a=[0,i.length-1,0],c=[],h=r*r;for(;a.length;){const d=a.pop()||0,m=a.pop()||0,g=a.pop()||0;if(m-g<=s){for(let A=g;A<=m;A++)BM(o[2*A],o[2*A+1],t,n)<=h&&c.push(i[A]);continue}const x=g+m>>1,v=o[2*x],w=o[2*x+1];BM(v,w,t,n)<=h&&c.push(i[x]),(d===0?t-r<=v:n-r<=w)&&(a.push(g),a.push(x-1),a.push(1-d)),(d===0?t+r>=v:n+r>=w)&&(a.push(x+1),a.push(m),a.push(1-d))}return c}}function aA(e,t,n,r,i,o){if(i-r<=n)return;const s=r+i>>1;IM(e,t,s,r,i,o),aA(e,t,n,r,s-1,1-o),aA(e,t,n,s+1,i,1-o)}function IM(e,t,n,r,i,o){for(;i>r;){if(i-r>600){const h=i-r+1,d=n-r+1,m=Math.log(h),g=.5*Math.exp(2*m/3),x=.5*Math.sqrt(m*g*(h-g)/h)*(d-h/2<0?-1:1);IM(e,t,n,Math.max(r,Math.floor(n-d*g/h+x)),Math.min(i,Math.floor(n+(h-d)*g/h+x)),o)}const s=t[2*n+o];let a=r,c=i;for(Fg(e,t,r,n),t[2*i+o]>s&&Fg(e,t,r,i);a<c;){for(Fg(e,t,a,c),a++,c--;t[2*a+o]<s;)a++;for(;t[2*c+o]>s;)c--}t[2*r+o]===s?Fg(e,t,r,c):(c++,Fg(e,t,c,i)),c<=n&&(r=c+1),n<=c&&(i=c-1)}}function Fg(e,t,n,r){lA(e,n,r),lA(t,2*n,2*r),lA(t,2*n+1,2*r+1)}function lA(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function BM(e,t,n,r){const i=e-n,o=t-r;return i*i+o*o}const uA=512/gt/2;class Ak{constructor(t,n,r){this.tileID=t,this.bucketInstanceId=r,this.index=new ox(n.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const i=t.canonical.x*gt,o=t.canonical.y*gt;for(let s=0;s<n.length;s++){const{key:a,crossTileID:c,tileAnchorX:h,tileAnchorY:d}=n.get(s),m=Math.floor((i+h)*uA),g=Math.floor((o+d)*uA);this.index.add(m,g),this.keys.push(a),this.crossTileIDs.push(c)}this.index.finish()}findMatches(t,n,r){const i=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z),o=uA/Math.pow(2,n.canonical.z-this.tileID.canonical.z),s=n.canonical.x*gt,a=n.canonical.y*gt;for(let c=0;c<t.length;c++){const h=t.get(c);if(h.crossTileID)continue;const{key:d,tileAnchorX:m,tileAnchorY:g}=h,x=Math.floor((s+m)*o),v=Math.floor((a+g)*o),w=this.index.range(x-i,v-i,x+i,v+i);for(const A of w){const E=this.crossTileIDs[A];if(this.keys[A]===d&&!r.has(E)){r.add(E),h.crossTileID=E;break}}}}}class Ek{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Tk{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const r in this.indexes){const i=this.indexes[r],o={};for(const s in i){const a=i[s];a.tileID=a.tileID.unwrapTo(a.tileID.wrap+n),o[a.tileID.key]=a}this.indexes[r]=o}this.lng=t}addBucket(t,n,r){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let o=0;o<n.symbolInstances.length;o++)n.symbolInstances.get(o).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const i=this.usedCrossTileIDs[t.overscaledZ];for(const o in this.indexes){const s=this.indexes[o];if(Number(o)>t.overscaledZ)for(const a in s){const c=s[a];c.tileID.isChildOf(t)&&c.findMatches(n.symbolInstances,t,i)}else{const a=s[t.scaledTo(Number(o)).key];a&&a.findMatches(n.symbolInstances,t,i)}}for(let o=0;o<n.symbolInstances.length;o++){const s=n.symbolInstances.get(o);s.crossTileID||(s.crossTileID=r.generate(),i.add(s.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ak(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const r of n.crossTileIDs)this.usedCrossTileIDs[t].delete(r)}removeStaleBuckets(t){let n=!1;for(const r in this.indexes){const i=this.indexes[r];for(const o in i)t[i[o].bucketInstanceId]||(this.removeBucketCrossTileIDs(r,i[o]),delete i[o],n=!0)}return n}}class Ck{constructor(){this.layerIndexes={},this.crossTileIDs=new Ek,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,r,i){let o=this.layerIndexes[t.fqid];o===void 0&&(o=this.layerIndexes[t.fqid]=new Tk);let s=!1;const a={};i.name!=="globe"&&o.handleWrapJump(r);for(const c of n){const h=c.getBucket(t);h&&t.fqid===h.layerIds[0]&&(h.bucketInstanceId||(h.bucketInstanceId=++this.maxBucketInstanceId),o.addBucket(c.tileID,h,this.crossTileIDs)&&(s=!0),a[h.bucketInstanceId]=!0)}return o.removeStaleBuckets(a)&&(s=!0),s}pruneUnusedLayers(t){const n={};t.forEach(r=>{n[r]=!0});for(const r in this.layerIndexes)n[r]||delete this.layerIndexes[r]}}var DM=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w-0.0001;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,PM="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",LM=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,RM=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,kM=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,FM=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);vec4 _raTexLinearCoord(vec2 texCoord,vec2 texResolution,out vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return (texCoord.xxyy+vec2(1.5,0.5).xyxy)/texResolution.xxyy;}vec2 _raTexLinearMix(vec2 fxy,vec4 colorMix,float colorOffset,vec4 t00,vec4 t10,vec4 t01,vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image0,c.yz),texture(u_image0,c.xz),texture(u_image0,c.yw),texture(u_image0,c.xw)
);}vec2 raTexture2D_image1_linear(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image1,c.yz),texture(u_image1,c.xz),texture(u_image1,c.yw),texture(u_image1,c.xw)
);}vec2 raTexture2D_image0_nearest(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec4 t=texture(u_image0,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec4 t=texture(u_image1,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,zM=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,OM=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const NM=[];lx(DM,NM);const sx={"_prelude_fog.vertex.glsl":RM,"_prelude_terrain.vertex.glsl":LM,"_prelude_shadow.vertex.glsl":zM,"_prelude_fog.fragment.glsl":kM,"_prelude_shadow.fragment.glsl":OM,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":FM},ax={};Pn("",LM),Pn(kM,RM),Pn(OM,zM),Pn(FM,"");const UM=Pn(`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif`,`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`),VM=DM;var GM={background:Pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Pn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Pn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Pn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Pn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Pn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Pn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in vec2 v_pos;in vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;out vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#ifdef RENDER_CUTOFF
invariant gl_Position;
#endif
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),fillExtrusionDepth:Pn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Pn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Pn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;HANDLE_WIREFRAME_DEBUG;
#endif
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;
#ifdef FORCE_ABS_FL_GROUND_RADIUS
fl_ground_radius=abs(flood_light_ground_radius);
#endif
float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Pn(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform vec4 u_tl_br;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#elif defined(PROJECTION_GLOBE_VIEW)
in vec2 a_pos;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec2 globe_tl=vec2(u_tl_br.x,u_tl_br.y);vec2 globe_br=vec2(u_tl_br.z,u_tl_br.w);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=1.0-((mercatorY-globe_br.y)/(globe_tl.y-globe_br.y));float mercatorX=mercatorXfromLng(latLng[1]);float uvX=(mercatorX-globe_br.x)/(globe_tl.x-globe_br.x);vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);uv=vec2(uvX,uvY);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
uv=a_texture_pos/8192.0;
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),symbolIcon:Pn(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
uniform mediump float u_icon_saturation;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;
#else
out_color=texture(u_texture,v_tex_a)*alpha;
#endif
#ifdef SATURATION
vec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:Pn(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:Pn(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:Pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Pn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Pn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,PM),skyboxGradient:Pn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,PM),skyboxCapture:Pn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Pn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
texColor.rgb=sRGBToLinear(texColor.rgb);if(u_baseTextureIsAlpha) {if (texColor.w < 0.5) {discard;}albedo*=mix(vec4(texColor.rgb,texColor.a),vec4(texColor.a),float(u_baseTextureIsAlpha));} else {albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 diffuse=getDiffuseShadedColor(getBaseColor().rgb,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(diffuse,1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
ao=(texture(u_occlusionTexture,uv_2f).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=local_pos;
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Pn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Pn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function lx(e,t){const n=e.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let r of n)if(r=r.trim(),r[0]==="#"&&r.includes("if")&&!r.includes("endif")){r=r.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const i=r.split(" ");for(const o of i)t.includes(o)||t.push(o)}}function Pn(e,t){const n=/#include\s+"([^"]+)"/g,r=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let i=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);i&&(i=i.map(h=>{const d=h.split(" ");return d[d.length-1]}),i=[...new Set(i)]);const o={},s=[],a=[];e=e.replace(n,(h,d)=>(a.push(d),"")),t=t.replace(n,(h,d)=>(s.push(d),""));let c=[...NM];lx(e,c),lx(t,c);for(const h of[...s,...a])sx[h]||console.error(`Undefined include: ${h}`),ax[h]||(ax[h]=[],lx(sx[h],ax[h])),c=[...c,...ax[h]];return{fragmentSource:e=e.replace(r,(h,d,m,g,x)=>(o[x]=!0,d==="define"?`
#ifndef HAS_UNIFORM_u_${x}
in ${m} ${g} ${x};
#else
uniform ${m} ${g} u_${x};
#endif
`:d==="initialize"?`
#ifdef HAS_UNIFORM_u_${x}
    ${m} ${g} ${x} = u_${x};
#endif
`:d==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${x}
    in ${m} ${g} ${x};
#endif
`:d==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(r,(h,d,m,g,x)=>{const v=g==="float"?"vec2":g,w=x.match(/color/)?"color":v;return d==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${x}
in ${m} ${g} a_${x};
#endif
`:o[x]?d==="define"?`
#ifndef HAS_UNIFORM_u_${x}
uniform lowp float u_${x}_t;
in ${m} ${v} a_${x};
out ${m} ${g} ${x};
#else
uniform ${m} ${g} u_${x};
#endif
`:d==="initialize"?w==="vec4"?`
#ifndef HAS_UNIFORM_u_${x}
    ${x} = a_${x};
#else
    ${m} ${g} ${x} = u_${x};
#endif
`:`
#ifndef HAS_UNIFORM_u_${x}
    ${x} = unpack_mix_${w}(a_${x}, u_${x}_t);
#else
    ${m} ${g} ${x} = u_${x};
#endif
`:d==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${x}
    in ${m} ${g} a_${x};
    out ${m} ${g} ${x};
#endif
`:d==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${x}
    ${x} = a_${x};
#endif
`:void 0:d==="define"?`
#ifndef HAS_UNIFORM_u_${x}
uniform lowp float u_${x}_t;
in ${m} ${v} a_${x};
#else
uniform ${m} ${g} u_${x};
#endif
`:d==="define-instanced"?w==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${x}0;
in vec4 a_${x}1;
in vec4 a_${x}2;
in vec4 a_${x}3;
#else
uniform ${m} ${g} u_${x};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${m} ${v} a_${x};
#else
uniform ${m} ${g} u_${x};
#endif
`:d==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${x}
    ${m} ${g} ${x} = a_${x};
#endif
`:w==="vec4"?`
#ifndef HAS_UNIFORM_u_${x}
    ${m} ${g} ${x} = a_${x};
#else
    ${m} ${g} ${x} = u_${x};
#endif
`:`
#ifndef HAS_UNIFORM_u_${x}
    ${m} ${g} ${x} = unpack_mix_${w}(a_${x}, u_${x}_t);
#else
    ${m} ${g} ${x} = u_${x};
#endif
`}),staticAttributes:i,usedDefines:c,vertexIncludes:s,fragmentIncludes:a}}class Sk{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,n,r,i,o,s,a,c){this.context=t;let h=this.boundPaintVertexBuffers.length!==i.length;for(let m=0;!h&&m<i.length;m++)this.boundPaintVertexBuffers[m]!==i[m]&&(h=!0);let d=this.boundDynamicVertexBuffers.length!==a.length;for(let m=0;!d&&m<a.length;m++)this.boundDynamicVertexBuffers[m]!==a[m]&&(d=!0);if(!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==r||h||d||this.boundIndexBuffer!==o||this.boundVertexOffset!==s)this.freshBind(n,r,i,o,s,a,c);else{t.bindVertexArrayOES.set(this.vao);for(const m of a)m&&(m.bind(),c&&m.instanceCount&&m.setVertexAttribDivisor(t.gl,n,c));o&&o.dynamicDraw&&o.bind()}}freshBind(t,n,r,i,o,s,a){const c=t.numAttributes,h=this.context,d=h.gl;this.vao&&this.destroy(),this.vao=h.gl.createVertexArray(),h.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=r,this.boundIndexBuffer=i,this.boundVertexOffset=o,this.boundDynamicVertexBuffers=s,n.enableAttributes(d,t),n.bind(),n.setVertexAttribPointers(d,t,o);for(const m of r)m.enableAttributes(d,t),m.bind(),m.setVertexAttribPointers(d,t,o);for(const m of s)m&&(m.enableAttributes(d,t),m.bind(),m.setVertexAttribPointers(d,t,o),a&&m.instanceCount&&m.setVertexAttribDivisor(d,t,a));i&&i.bind(),h.currentNumAttributes=c}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Mk(e,t){const n=Math.pow(2,t.canonical.z),r=t.canonical.y;return[new an(0,r/n).toLngLat().lat,new an(0,(r+1)/n).toLngLat().lat]}function Ik(e,t,n,r,i,o,s){const a=e.context,c=a.gl,h=n.hillshadeFBO;if(!h)return;e.prepareDrawTile();const d=e.isTileAffectedByFog(t),m=e.getOrCreateProgram("hillshade",{overrideFog:d});a.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,h.colorAttachment.get());const g=((A,E,S,I)=>{const B=S.paint.get("hillshade-shadow-color"),M=S.paint.get("hillshade-highlight-color"),D=S.paint.get("hillshade-accent-color"),R=S.paint.get("hillshade-emissive-strength");let z=Ae(S.paint.get("hillshade-illumination-direction"));if(S.paint.get("hillshade-illumination-anchor")==="viewport")z-=A.transform.angle;else if(A.style&&A.style.enable3dLights()&&A.style.directionalLight){const V=A.style.directionalLight.properties.get("direction");z=Ae(de(V.x,V.y,V.z)[1])}const N=!A.options.moving;return{u_matrix:I||A.transform.calculateProjMatrix(E.tileID.toUnwrapped(),N),u_image:0,u_latrange:Mk(0,E.tileID),u_light:[S.paint.get("hillshade-exaggeration"),z],u_shadow:B,u_highlight:M,u_emissive_strength:R,u_accent:D}})(e,n,r,e.terrain?t.projMatrix:null);e.uploadCommonUniforms(a,m,t.toUnwrapped());const{tileBoundsBuffer:x,tileBoundsIndexBuffer:v,tileBoundsSegments:w}=e.getTileBoundsBuffers(n);m.draw(e,c.TRIANGLES,i,o,s,Qe.disabled,g,r.id,x,v,w)}function jM(e,t,n){if(!t.needsDEMTextureUpload)return;const r=e.context,i=r.gl;r.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||e.getTileTexture(n.stride);const o=n.getPixels();t.demTexture?t.demTexture.update(o,{premultiply:!1}):t.demTexture=new _r(r,o,i.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Bk(e,t,n){const r=e.context,i=r.gl;if(!t.dem)return;const o=t.dem;if(r.activeTexture.set(i.TEXTURE1),jM(e,t,o),!t.demTexture)return;t.demTexture.bind(i.NEAREST,i.CLAMP_TO_EDGE);const s=o.dim;r.activeTexture.set(i.TEXTURE0);let a=t.hillshadeFBO;if(!a){const g=new _r(r,{width:s,height:s,data:null},i.RGBA);g.bind(i.LINEAR,i.CLAMP_TO_EDGE),a=t.hillshadeFBO=r.createFramebuffer(s,s,!0,"renderbuffer"),a.colorAttachment.set(g.texture)}r.bindFramebuffer.set(a.framebuffer),r.viewport.set([0,0,s,s]);const{tileBoundsBuffer:c,tileBoundsIndexBuffer:h,tileBoundsSegments:d}=e.getMercatorTileBoundsBuffers(),m=[];e.linearFloatFilteringSupported()&&m.push("TERRAIN_DEM_FLOAT_FORMAT"),e.getOrCreateProgram("hillshadePrepare",{defines:m}).draw(e,i.TRIANGLES,De.disabled,Ke.disabled,xn.unblended,Qe.disabled,((g,x)=>{const v=x.stride,w=lt.create();return lt.ortho(w,0,gt,-gt,0,0,1),lt.translate(w,w,[0,-gt,0]),{u_matrix:w,u_image:1,u_dimension:[v,v],u_zoom:g.overscaledZ}})(t.tileID,o),n.id,c,h,d),t.needsHillshadePrepare=!1}const HM=e=>({u_matrix:new Ne(e),u_image0:new Oe(e),u_skirt_height:new Bt(e),u_ground_shadow_factor:new Ve(e)}),ZM=(e,t,n)=>({u_matrix:e,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:n}),WM=(e,t,n,r,i,o,s,a,c,h,d,m,g,x,v)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(r),u_merc_matrix:n,u_zoom_transition:i,u_merc_center:o,u_image0:0,u_frustum_tl:s,u_frustum_tr:a,u_frustum_br:c,u_frustum_bl:h,u_globe_pos:d,u_globe_radius:m,u_viewport:g,u_grid_matrix:v?Float32Array.from(v):new Float32Array(9),u_skirt_height:x}),Cd=(e,t)=>{if(t>0&&e.terrain&&rt("Cutoff is currently disabled on terrain"),t<=0||e.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,0]}};const n=e.transform,r=Math.max(Math.abs(n._zoom-(e.minCutoffZoom-1)),1),i=n.isLODDisabled(!1)?Ui(60,45,n.pitch):Ui(30,15,n.pitch),o=n._farZ-n._nearZ,s=t*n.height,a=((1-(c=i))*(.75*n.cameraToCenterDistance)+c*(n._farZ+s))*r;var c;return{shouldRenderCutoff:i<1,uniformValues:{u_cutoff_params:[n._nearZ,n._farZ,(a-n._nearZ)/o,(a-s-n._nearZ)/o]}}};function qM(e,t){return e!=null&&t!=null&&!(!e.hasData()||!t.hasData())&&e.demTexture!=null&&t.demTexture!=null&&e.tileID.key!==t.tileID.key}const Sd=new class{constructor(){this.operations={}}newMorphing(e,t,n,r,i){if(e in this.operations){const o=this.operations[e];o.to.tileID.key!==n.tileID.key&&(o.queued=n)}else this.operations[e]={startTime:r,phase:0,duration:i,from:t,to:n,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const n=this.operations[t];for(n.phase=(e-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},JM={0:null,1:"TERRAIN_VERTEX_MORPHING"};function $M(e,t,n){if(t===0)return 0;const r=t<1&&n===514?.25/t:1;return 6*Math.pow(1.5,22-e)*Math.max(t,1)*r}function Dk(e,t){const n=1<<e.z;return!t&&(e.x===0||e.x===n-1)||e.y===0||e.y===n-1}const cA=e=>({u_matrix:e});function KM(e,t,n,r,i){if(i>0){const o=ze.now(),s=(o-e.timeAdded)/i,a=t?(o-t.timeAdded)/i:-1,c=n.getSource(),h=r.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),d=!t||Math.abs(t.tileID.overscaledZ-h)>Math.abs(e.tileID.overscaledZ-h),m=d&&e.refreshedUponExpiration?1:$t(d?s:1-a,0,1);return e.refreshedUponExpiration&&s>=1&&(e.refreshedUponExpiration=!1),t?{opacity:1,mix:1-m}:{opacity:m,mix:0}}return{opacity:1,mix:0}}class Pk extends _a{constructor(t){const n={type:"raster-dem",maxzoom:t.transform.maxZoom},r=new Ih(Rg(),null),i=nA("mock-dem",n,r,t.style);super("mock-dem",i,!1),i.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,n){t.state="loaded",n(null)}}class Lk extends _a{constructor(t){const n=nA("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new Ih(Rg(),null),t.style);super("proxy",n,!1),n.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,n,r){if(t.freezeTileCoverage)return;this.transform=t;const i=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((o,s)=>{if(o[s.key]="",!this._tiles[s.key]){const a=new Ag(s,this._source.tileSize*s.overscaleFactor(),t.tileZoom);a.state="loaded",this._tiles[s.key]=a}return o},{});for(const o in this._tiles)o in i||(this.freeFBO(o),this._tiles[o].unloadVectorData(),delete this._tiles[o])}freeFBO(t){const n=this.proxyCachedFBO[t];if(n!==void 0){const r=Object.values(n);this.renderCachePool.push(...r),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class XM extends sn{constructor(t,n,r){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=n,this.projMatrix=r}}class Rk extends fP{constructor(t,n){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[r,i,o]=function(c){const h=new bi,d=new ur,m=131;h.reserve(17161),d.reserve(33800);const g=gt/128,x=gt+g/2,v=x+g;for(let A=-g;A<v;A+=g)for(let E=-g;E<v;E+=g){const S=E<0||E>x||A<0||A>x?24575:0,I=$t(Math.round(E),0,gt),B=$t(Math.round(A),0,gt);h.emplaceBack(I+S,B)}const w=(A,E)=>{const S=E*m+A;d.emplaceBack(S+1,S,S+m),d.emplaceBack(S+m,S+m+1,S+1)};for(let A=1;A<129;A++)for(let E=1;E<129;E++)w(E,A);return[0,129].forEach(A=>{for(let E=0;E<130;E++)w(E,A),w(A,E)}),[h,d,32768]}(),s=t.context;this.gridBuffer=s.createVertexBuffer(r,Ps.members),this.gridIndexBuffer=s.createIndexBuffer(i),this.gridSegments=Cn.simpleSegment(0,0,r.length,i.length),this.gridNoSkirtSegments=Cn.simpleSegment(0,0,r.length,o),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Lk(n.map),this.orthoMatrix=lt.create(),lt.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,gt,0,gt,0,1);const a=s.gl;this._overlapStencilMode=new Ke({func:a.GEQUAL,mask:255},0,255,a.KEEP,a.KEEP,a.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=n,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Pk(n.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,n,r){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const i=t.terrain.properties,o=t.terrain.drapeRenderMode===0,s=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=ze.now();const a=t.terrain&&t.terrain.scope,c=i.get("source"),h=o?this._mockSourceCache:t.getSourceCache(c,a);if(!h)return void rt(`Couldn't find terrain source "${c}".`);if(this.sourceCache=h,this._exaggeration=s?this.calculateExaggeration(n):i.get("exaggeration"),!n.projection.requiresDraping&&s&&this._exaggeration===0)return void this._disable();this.enabled=!0;const d=()=>{this.sourceCache.used&&rt(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const m=this.getScaledDemTileSize();this.sourceCache.update(n,m,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,d(),this._initializing=!0),d(),n.updateElevation(!0,r),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(n),this._emptyDEMTextureDirty=!0,this._previousZoom=n.zoom}else this._disable()}calculateExaggeration(t){const n=this._previousCameraAltitude,r=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=r;const i=n!=null?r-n:Number.MAX_VALUE;if(Math.abs(i)<2)return this._exaggeration;const o=t.zoom,s=this._style.terrain;if(!this._previousUpdateTimestamp)return s.getExaggeration(o);let a=o-this._previousZoom;const c=this._previousUpdateTimestamp;let h=o;this._evaluationZoom!=null&&(h=this._evaluationZoom,Math.abs(o-h)>.5&&(a=.5*(o-h+a)),a*i<0&&(h+=a)),this._evaluationZoom=h;const d=s.getExaggeration(h),m=d===s.getExaggeration(Math.max(0,h-.1));if(m&&Math.abs(d-this._exaggeration)<.01)return d;let g=Math.min(.1,.00375*(this._updateTimestamp-c));return(m||d<.1||Math.abs(a)<1e-4)&&(g=Math.min(.2,4*g)),Ce(this._exaggeration,d,g)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const n=this.proxySourceCache,r=this.painter.transform;this._initializing&&(this._initializing=r._centerAltitude===0&&this.getAtPointOrZero(an.fromLngLat(r.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const i=this.proxyCoords=n.getIds().map(c=>{const h=n.getTileByID(c).tileID;return h.projMatrix=r.calculateProjMatrix(h.toUnwrapped()),h});(function(c,h){const d=h.transform.pointCoordinate(h.transform.getCameraPoint()),m=new nt(d.x,d.y);c.sort((g,x)=>{if(x.overscaledZ-g.overscaledZ)return x.overscaledZ-g.overscaledZ;const v=new nt(g.canonical.x+(1<<g.canonical.z)*g.wrap,g.canonical.y),w=new nt(x.canonical.x+(1<<x.canonical.z)*x.wrap,x.canonical.y),A=m.mult(1<<g.canonical.z);return A.x-=.5,A.y-=.5,A.distSqr(v)-A.distSqr(w)})})(i,this.painter);const o=this.proxyToSource||{};this.proxyToSource={},i.forEach(c=>{this.proxyToSource[c.key]={}}),this.terrainTileForTile={};const s=this._style._mergedSourceCaches;for(const c in s){const h=s[c];if(!h.used||(h!==this.sourceCache&&this.resetTileLookupCache(h.id),this._setupProxiedCoordsForOrtho(h,t[c],o),h.usedForTerrain))continue;const d=t[c];h.getSource().reparseOverscaled&&this._assignTerrainTiles(d)}this.proxiedCoords[n.id]=i.map(c=>new XM(c,c.key,this.orthoMatrix)),this._assignTerrainTiles(i),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(o),this.renderingToTexture=!1;const a={};this._visibleDemTiles=[];for(const c of this.proxyCoords){const h=this.terrainTileForTile[c.key];if(!h)continue;const d=h.tileID.key;d in a||(this._visibleDemTiles.push(h),a[d]=d)}}_assignTerrainTiles(t){this._initializing||t.forEach(n=>{if(this.terrainTileForTile[n.key])return;const r=this._findTileCoveringTileID(n,this.sourceCache);r&&(this.terrainTileForTile[n.key]=r)})}_prepareDEMTextures(){const t=this.painter.context,n=t.gl;for(const r in this.terrainTileForTile){const i=this.terrainTileForTile[r],o=i.dem;!o||i.demTexture&&!i.needsDEMTextureUpload||(t.activeTexture.set(n.TEXTURE1),jM(this.painter,i,o))}}_prepareDemTileUniforms(t,n,r,i){if(!n||n.demTexture==null)return!1;const o=t.tileID.canonical,s=Math.pow(2,n.tileID.canonical.z-o.z),a=i||"";return r[`u_dem_tl${a}`]=[o.x*s%1,o.y*s%1],r[`u_dem_scale${a}`]=s,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const t=this.painter.context,n=t.gl;if(!this._emptyDepthBufferTexture){const r=new Er({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new _r(t,r,n.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let t=0;const n=this._visibleDemTiles.reduce((r,i)=>{if(!i.dem)return r;const o=i.dem.tree.minimums[0];return o>0&&t++,r+o},0);return t?n/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,n=t.gl;t.activeTexture.set(n.TEXTURE2);const r=this._getLoadedAreaMinimum(),[i,o]=(()=>{const a=new d1({width:1,height:1},new Float32Array([r]));return[n.R32F,a]})();this._emptyDEMTextureDirty=!1;let s=this._emptyDEMTexture;return s?s.update(o,{premultiply:!1}):s=this._emptyDEMTexture=new _r(t,o,i,{premultiply:!1}),s}setupElevationDraw(t,n,r){const i=this.painter.context,o=i.gl,s={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};s.u_exaggeration=this.exaggeration();let a=null,c=null,h=1;if(r&&r.morphing&&this._useVertexMorphing){const g=r.morphing.srcDemTile,x=r.morphing.dstDemTile;h=r.morphing.phase,g&&x&&(this._prepareDemTileUniforms(t,g,s,"_prev")&&(c=g),this._prepareDemTileUniforms(t,x,s)&&(a=x))}const d=g=>g&&g.demTexture&&this.painter.linearFloatFilteringSupported()?o.LINEAR:o.NEAREST,m=g=>{s.u_dem_size=g.size[0]===1?1:g.size[0]-2};if(c&&a)i.activeTexture.set(o.TEXTURE2),a.demTexture.bind(d(a),o.CLAMP_TO_EDGE),i.activeTexture.set(o.TEXTURE4),c.demTexture.bind(d(c),o.CLAMP_TO_EDGE),a.demTexture&&m(a.demTexture),s.u_dem_lerp=h;else{a=this.terrainTileForTile[t.tileID.key],i.activeTexture.set(o.TEXTURE2);const g=this._prepareDemTileUniforms(t,a,s)?a.demTexture:this.emptyDEMTexture;g.bind(d(a),o.CLAMP_TO_EDGE),m(g)}if(i.activeTexture.set(o.TEXTURE3),r&&r.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),this._depthFBO&&(s.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),s.u_depth_size_inv=[1,1]),r&&r.useMeterToDem&&a){const g=(1<<a.tileID.canonical.z)*Rn(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;s.u_meter_to_dem=g}if(r&&r.labelPlaneMatrixInv&&(s.u_label_plane_matrix_inv=r.labelPlaneMatrixInv),n.setTerrainUniformValues(i,s),this.painter.transform.projection.name==="globe"){const g=this.globeUniformValues(this.painter.transform,t.tileID.canonical,r&&r.useDenormalizedUpVectorScale);n.setGlobeUniformValues(i,g)}}globeUniformValues(t,n,r){const i=t.projection;return{u_tile_tl_up:i.upVector(n,0,0),u_tile_tr_up:i.upVector(n,gt,0),u_tile_br_up:i.upVector(n,gt,gt),u_tile_bl_up:i.upVector(n,0,gt),u_tile_up_scale:r?ed(1):i.upVectorScale(n,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const n=this.painter,r=this.painter.context;t.length!==0&&(r.bindFramebuffer.set(null),r.viewport.set([0,0,n.width,n.height]),n.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(i,o,s,a,c){if(i.transform.projection.name==="globe")(function(h,d,m,g,x){const v=h.context,w=v.gl;let A,E;const S=h.transform,I=Wy(h,v,S),B=($,G)=>{if(E===G)return;const Q=[JM[G],"PROJECTION_GLOBE_VIEW"];I&&Q.push("CUSTOM_ANTIALIASING");const et=h.isTileAffectedByFog($);A=h.getOrCreateProgram("globeRaster",{defines:Q,overrideFog:et}),E=G},M=h.colorModeForRenderPass(),D=new De(w.LEQUAL,De.ReadWrite,h.depthRangeFor3D);Sd.update(x);const R=tg(S),z=[Ir(S.center.lng),Fr(S.center.lat)],N=h.globeSharedBuffers,V=[S.width*ze.devicePixelRatio,S.height*ze.devicePixelRatio],j=Float32Array.from(S.globeMatrix),H={useDenormalizedUpVectorScale:!0};{const $=h.transform,G=$M($.zoom,d.exaggeration(),d.sourceCache._source.tileSize);E=-1;const Q=w.TRIANGLES;for(const et of g){const st=m.getTile(et),Y=Ke.disabled,tt=d.prevTerrainTileForTile[et.key],ct=d.terrainTileForTile[et.key];qM(tt,ct)&&Sd.newMorphing(et.key,tt,ct,x,250),v.activeTexture.set(w.TEXTURE0),st.texture&&st.texture.bind(w.LINEAR,w.CLAMP_TO_EDGE);const pt=Sd.getMorphValuesForProxy(et.key),dt=pt?1:0;pt&&Qo(H,{morphing:{srcDemTile:pt.from,dstDemTile:pt.to,phase:si(pt.phase)}});const wt=nd(et.canonical),bt=Vw(wt.getCenter().lat),Et=eg(et.canonical,wt,bt,$.worldSize/$._pixelsPerMercatorPixel),_t=Ar(To(et.canonical)),Mt=WM($.expandedFarZProjMatrix,j,R,_t,$r($.zoom),z,$.frustumCorners.TL,$.frustumCorners.TR,$.frustumCorners.BR,$.frustumCorners.BL,$.globeCenterInViewSpace,$.globeRadius,V,G,Et);if(B(et,dt),A&&(d.setupElevationDraw(st,A,H),h.uploadCommonUniforms(v,A,et.toUnwrapped()),N)){const[qt,Jt,ne]=N.getGridBuffers(bt,G!==0);A.draw(h,Q,D,Y,M,Qe.backCCW,Mt,"globe_raster",qt,Jt,ne)}}}if(N&&(h.renderDefaultNorthPole||h.renderDefaultSouthPole)){const $=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];I&&$.push("CUSTOM_ANTIALIASING"),A=h.getOrCreateProgram("globeRaster",{defines:$});for(const G of g){const{x:Q,y:et,z:st}=G.canonical,Y=et===0,tt=et===(1<<st)-1,[ct,pt,dt,wt]=N.getPoleBuffers(st,!1);if(wt&&(Y||tt)){const bt=m.getTile(G);v.activeTexture.set(w.TEXTURE0),bt.texture&&bt.texture.bind(w.LINEAR,w.CLAMP_TO_EDGE);let Et=Zy(st,Q,S);const _t=Ar(To(G.canonical)),Mt=(qt,Jt)=>qt.draw(h,w.TRIANGLES,D,Ke.disabled,M,Qe.disabled,WM(S.expandedFarZProjMatrix,Et,Et,_t,0,z,S.frustumCorners.TL,S.frustumCorners.TR,S.frustumCorners.BR,S.frustumCorners.BL,S.globeCenterInViewSpace,S.globeRadius,V,0),"globe_pole_raster",Jt,dt,wt);d.setupElevationDraw(bt,A,H),h.uploadCommonUniforms(v,A,G.toUnwrapped()),Y&&h.renderDefaultNorthPole&&Mt(A,ct),tt&&h.renderDefaultSouthPole&&(Et=lt.scale(lt.create(),Et,[1,-1,1]),Mt(A,pt))}}}})(i,o,s,a,c);else{const h=i.context,d=h.gl;let m,g;const x=i.shadowRenderer,v=Cd(i,i.longestCutoffRange),w=M=>{if(g===M)return;const D=[];D.push(JM[M]),v.shouldRenderCutoff&&D.push("RENDER_CUTOFF"),m=i.getOrCreateProgram("terrainRaster",{defines:D}),g=M},A=i.colorModeForRenderPass(),E=new De(d.LEQUAL,De.ReadWrite,i.depthRangeFor3D);Sd.update(c);const S=i.transform,I=$M(S.zoom,o.exaggeration(),o.sourceCache._source.tileSize);let B=[0,0,0];if(x){const M=i.style.directionalLight,D=i.style.ambientLight;M&&D&&(B=mA(M,D))}{g=-1;const M=d.TRIANGLES,[D,R]=[o.gridIndexBuffer,o.gridSegments];for(const z of a){const N=s.getTile(z),V=Ke.disabled,j=o.prevTerrainTileForTile[z.key],H=o.terrainTileForTile[z.key];qM(j,H)&&Sd.newMorphing(z.key,j,H,c,250),h.activeTexture.set(d.TEXTURE0),N.texture&&N.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE);const $=Sd.getMorphValuesForProxy(z.key),G=$?1:0;let Q;$&&(Q={morphing:{srcDemTile:$.from,dstDemTile:$.to,phase:si($.phase)}});const et=ZM(z.projMatrix,Dk(z.canonical,S.renderWorldCopies)?I/10:I,B);if(w(G),!m)continue;o.setupElevationDraw(N,m,Q);const st=z.toUnwrapped();x&&x.setupShadows(st,m),i.uploadCommonUniforms(h,m,st,null,v),m.draw(i,M,E,V,A,Qe.backCCW,et,"terrain_raster",o.gridBuffer,D,R)}}}}(n,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,n.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const n=this.painter,r=this.painter.context,i=this.proxySourceCache,o=this.proxiedCoords[i.id],s=this._drapedRenderBatches.shift(),a=n.style.order,c=[];let h=0;for(const d of o){const m=i.getTileByID(d.proxyTileKey),g=i.proxyCachedFBO[d.key]?i.proxyCachedFBO[d.key][t]:void 0,x=g!==void 0?i.renderCache[g]:this.pool[h++],v=g!==void 0;if(m.texture=x.tex,v&&!x.dirty){c.push(m.tileID);continue}let w;r.bindFramebuffer.set(x.fb.framebuffer),this.renderedToTile=!1,x.dirty&&(r.clear({color:Me.transparent,stencil:0}),x.dirty=!1);for(let A=s.start;A<=s.end;++A){const E=n.style._mergedLayers[a[A]];if(E.isHidden(n.transform.zoom))continue;const S=n.style.getLayerSourceCache(E),I=S?this.proxyToSource[d.key][S.id]:[d];if(!I)continue;const B=I;r.viewport.set([0,0,x.fb.width,x.fb.height]),w!==(S?S.id:null)&&(this._setupStencil(x,I,E,S),w=S?S.id:null),n.renderLayer(n,S,E,B)}if(this._drapedRenderBatches.length===0)for(const A of this._pendingGroundEffectLayers){const E=n.style._mergedLayers[a[A]];if(E.isHidden(n.transform.zoom))continue;const S=n.style.getLayerSourceCache(E),I=S?this.proxyToSource[d.key][S.id]:[d];if(!I)continue;const B=I;r.viewport.set([0,0,x.fb.width,x.fb.height]),w!==(S?S.id:null)&&(this._setupStencil(x,I,E,S),w=S?S.id:null),n.renderLayer(n,S,E,B)}this.renderedToTile?(x.dirty=!0,c.push(m.tileID)):v||--h,h===5&&(h=0,this.renderToBackBuffer(c))}return this.renderToBackBuffer(c),this.renderingToTexture=!1,r.bindFramebuffer.set(null),r.viewport.set([0,0,n.width,n.height]),s.end+1}postRender(){}isLayerOrderingCorrect(t){const n=t.order.length;let r=-1,i=n;for(let o=0;o<n;++o)this._style.isLayerDraped(t._mergedLayers[t.order[o]])?r=Math.max(r,o):i=Math.min(i,o);return i>r}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(n=>n.dem).forEach(n=>{t=Math.min(t,n.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,n,r){if(!this._visibleDemTiles)return null;const i=this._visibleDemTiles.filter(o=>o.dem).map(o=>{const s=o.tileID,a=1<<s.overscaledZ,{x:c,y:h}=s.canonical,d=c/a,m=(c+1)/a,g=h/a,x=(h+1)/a;return{minx:d,miny:g,maxx:m,maxy:x,t:o.dem.tree.raycastRoot(d,g,m,x,t,n,r),tile:o}});i.sort((o,s)=>(o.t!==null?o.t:Number.MAX_VALUE)-(s.t!==null?s.t:Number.MAX_VALUE));for(const o of i){if(o.t==null)return null;const s=o.tile.dem.tree.raycast(o.minx,o.miny,o.maxx,o.maxy,t,n,r);if(s!=null)return s}return null}_createFBO(){const t=this.painter.context,n=t.gl,r=this.drapeBufferSize;t.activeTexture.set(n.TEXTURE0);const i=new _r(t,{width:r[0],height:r[1],data:null},n.RGBA);i.bind(n.LINEAR,n.CLAMP_TO_EDGE);const o=t.createFramebuffer(r[0],r[1],!0,null);return o.colorAttachment.set(i.texture),o.depthAttachment=new VL(t,o.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,r[0],r[1]),this._stencilRef=0,o.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):o.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:o,tex:i,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const n=this._style._mergedLayers[t],r=n.isHidden(this.painter.transform.zoom);return n.type==="custom"?!r&&n.shouldRedrape():!r&&n.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const r of this._style.getSources())if(r instanceof lM){t=!0;break}if(!t)return;const n={};for(let r=0;r<this._style.order.length;++r){const i=this._style._mergedLayers[this._style.order[r]],o=this._style.getLayerSourceCache(i);if(o&&!n[o.id]&&!i.isHidden(this.painter.transform.zoom)&&i.type==="line"&&i.widthExpression()instanceof Fo){n[o.id]=!0;for(const s of this.proxyCoords){const a=this.proxyToSource[s.key][o.id];if(a)for(const c of a)this._clearRenderCacheForTile(o.id,c)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const r in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[r]._source instanceof Zb){t=!0;break}if(!t)return;const n={};for(let r=0;r<this._style.order.length;++r){const i=this._style._mergedLayers[this._style.order[r]],o=this._style.getLayerSourceCache(i);if(!o||n[o.id]||i.isHidden(this.painter.transform.zoom)||i.type!=="raster")continue;const s=i.paint.get("raster-fade-duration");for(const a of this.proxyCoords){const c=this.proxyToSource[a.key][o.id];if(c)for(const h of c){const d=KM(o.getTile(h),o.findLoadedParent(h,0),o,this.painter.transform,s);(d.opacity!==1||d.mix!==0)&&this._clearRenderCacheForTile(o.id,h)}}}}_setupDrapedRenderBatches(){const t=this._style.order,n=t.length;if(n===0)return;const r=[];this._pendingGroundEffectLayers=[];let i,o=0,s=this._style._mergedLayers[t[o]];for(;!this._style.isLayerDraped(s)&&s.isHidden(this.painter.transform.zoom)&&++o<n;)s=this._style._mergedLayers[t[o]];for(;o<n;++o){const a=this._style._mergedLayers[t[o]];a.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(a)?i===void 0&&(i=o):(a.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(o),i!==void 0&&(r.push({start:i,end:o-1}),i=void 0)))}if(i!==void 0&&r.push({start:i,end:o-1}),r.length!==0){const a=r[r.length-1];this._pendingGroundEffectLayers.every(h=>h>a.end)||rt("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=r}_setupRenderCache(t){const n=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,n.renderCache.length>n.renderCachePool.length){const s=Object.values(n.proxyCachedFBO);n.proxyCachedFBO={};for(let a=0;a<s.length;++a){const c=Object.values(s[a]);n.renderCachePool.push(...c)}}return}this._clearRasterLayersFromRenderCache();const r=this.proxyCoords,i=this._tilesDirty;for(let s=r.length-1;s>=0;s--){const a=r[s];if(n.getTileByID(a.key),n.proxyCachedFBO[a.key]!==void 0){const c=t[a.key],h=this.proxyToSource[a.key];let d=0;for(const m in h){const g=h[m],x=c[m];if(!x||x.length!==g.length||g.some((v,w)=>v!==x[w]||i[m]&&i[m].hasOwnProperty(v.key))){d=-1;break}++d}for(const m in n.proxyCachedFBO[a.key])n.renderCache[n.proxyCachedFBO[a.key][m]].dirty=d<0||d!==Object.values(c).length}}const o=[...this._drapedRenderBatches];o.sort((s,a)=>a.end-a.start-(s.end-s.start));for(const s of o)for(const a of r){if(n.proxyCachedFBO[a.key])continue;let c=n.renderCachePool.pop();c===void 0&&n.renderCache.length<50&&(c=n.renderCache.length,n.renderCache.push(this._createFBO())),c!==void 0&&(n.proxyCachedFBO[a.key]={},n.proxyCachedFBO[a.key][s.start]=c,n.renderCache[c].dirty=!0)}this._tilesDirty={}}_setupStencil(t,n,r,i){if(!i||!this._sourceTilesOverlap[i.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const o=this.painter.context,s=o.gl;if(n.length<=1)return void(this._overlapStencilType=!1);let a;if(r.isTileClipped())a=n.length,this._overlapStencilMode.test={func:s.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(n[0].overscaledZ>n[n.length-1].overscaledZ))return void(this._overlapStencilType=!1);a=1,this._overlapStencilMode.test={func:s.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+a>255&&(o.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=a,this._overlapStencilMode.ref=this._stencilRef,r.isTileClipped()&&this._renderTileClippingMasks(n,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Ke.disabled}_renderTileClippingMasks(t,n){const r=this.painter,i=this.painter.context,o=i.gl;r._tileClippingMaskIDs={},i.setColorMode(xn.disabled),i.setDepthMode(De.disabled);const s=r.getOrCreateProgram("clippingMask");for(const a of t){const c=r._tileClippingMaskIDs[a.key]=--n;s.draw(r,o.TRIANGLES,De.disabled,new Ke({func:o.ALWAYS,mask:0},c,255,o.KEEP,o.KEEP,o.REPLACE),xn.disabled,Qe.disabled,cA(a.projMatrix),"$clipping",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments)}}pointCoordinate(t){const n=this.painter.transform;if(t.x<0||t.x>n.width||t.y<0||t.y>n.height)return null;const r=[t.x,t.y,1,1];Bn.transformMat4(r,r,n.pixelMatrixInverse),Bn.scale(r,r,1/r[3]),r[0]/=n.worldSize,r[1]/=n.worldSize;const i=n._camera.position,o=Rn(1,n.center.lat),s=[i[0],i[1],i[2]/o,0],a=J.subtract([],r.slice(0,3),s);J.normalize(a,a);const c=this.raycast(s,a,this._exaggeration);return c!==null&&c?(J.scaleAndAdd(s,s,a,c),s[3]=s[2],s[2]*=o,s):null}drawDepth(){const t=this.painter,n=t.context,r=this.proxySourceCache,i=Math.ceil(t.width),o=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===i&&this._depthFBO.height===o||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const s=n.gl,a=n.createFramebuffer(i,o,!0,"renderbuffer");n.activeTexture.set(s.TEXTURE0);const c=new _r(n,{width:i,height:o,data:null},s.RGBA);c.bind(s.NEAREST,s.CLAMP_TO_EDGE),a.colorAttachment.set(c.texture);const h=n.createRenderbuffer(n.gl.DEPTH_COMPONENT16,i,o);a.depthAttachment.set(h),this._depthFBO=a,this._depthTexture=c}n.bindFramebuffer.set(this._depthFBO.framebuffer),n.viewport.set([0,0,i,o]),function(s,a,c,h){if(s.transform.projection.name==="globe")return;const d=s.context,m=d.gl;d.clear({depth:1});const g=s.getOrCreateProgram("terrainDepth"),x=new De(m.LESS,De.ReadWrite,s.depthRangeFor3D);for(const v of h){const w=c.getTile(v),A=ZM(v.projMatrix,0,[0,0,0]);a.setupElevationDraw(w,g),g.draw(s,m.TRIANGLES,x,Ke.disabled,xn.unblended,Qe.backCCW,A,"terrain_depth",a.gridBuffer,a.gridIndexBuffer,a.gridNoSkirtSegments)}}(t,this,r,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,n,r){if(t.getSource()instanceof Os)return this._setupProxiedCoordsForImageSource(t,n,r);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const i=this.proxiedCoords[t.id]=[],o=this.proxyCoords;for(let a=0;a<o.length;a++){const c=o[a],h=this._findTileCoveringTileID(c,t);if(h){const d=this._createProxiedId(c,h,r[c.key]&&r[c.key][t.id]);i.push(d),this.proxyToSource[c.key][t.id]=[d]}}let s=!1;for(let a=0;a<n.length;a++){const c=t.getTile(n[a]);if(!c||!c.hasData())continue;const h=this._findTileCoveringTileID(c.tileID,this.proxySourceCache);if(h&&h.tileID.canonical.z!==c.tileID.canonical.z){const d=this.proxyToSource[h.tileID.key][t.id],m=this._createProxiedId(h.tileID,c,r[h.tileID.key]&&r[h.tileID.key][t.id]);d?d.splice(d.length-1,0,m):this.proxyToSource[h.tileID.key][t.id]=[m],i.push(m),s=!0}}this._sourceTilesOverlap[t.id]=s}_setupProxiedCoordsForImageSource(t,n,r){if(!t.getSource().loaded())return;const i=this.proxiedCoords[t.id]=[],o=this.proxyCoords,s=t.getSource(),a=s.tileID;if(!a)return;const c=new nt(a.x,a.y)._div(1<<a.z),h=s.coordinates.map(an.fromLngLat).reduce((m,g)=>(m.min.x=Math.min(m.min.x,g.x-c.x),m.min.y=Math.min(m.min.y,g.y-c.y),m.max.x=Math.max(m.max.x,g.x-c.x),m.max.y=Math.max(m.max.y,g.y-c.y),m),{min:new nt(Number.MAX_VALUE,Number.MAX_VALUE),max:new nt(-Number.MAX_VALUE,-Number.MAX_VALUE)}),d=(m,g)=>{const x=m.wrap+m.canonical.x/(1<<m.canonical.z),v=m.canonical.y/(1<<m.canonical.z),w=gt/(1<<m.canonical.z),A=g.wrap+g.canonical.x/(1<<g.canonical.z),E=g.canonical.y/(1<<g.canonical.z);return x+w<A+h.min.x||x>A+h.max.x||v+w<E+h.min.y||v>E+h.max.y};for(let m=0;m<o.length;m++){const g=o[m];for(let x=0;x<n.length;x++){const v=t.getTile(n[x]);if(!v||!v.hasData()||d(g,v.tileID))continue;const w=this._createProxiedId(g,v,r[g.key]&&r[g.key][t.id]),A=this.proxyToSource[g.key][t.id];A?A.push(w):this.proxyToSource[g.key][t.id]=[w],i.push(w)}}}_createProxiedId(t,n,r){let i=this.orthoMatrix;if(r){const o=r.find(s=>s.key===n.tileID.key);if(o)return o}if(n.tileID.key!==t.key){const o=t.canonical.z-n.tileID.canonical.z;let s,a,c;i=lt.create();const h=n.tileID.wrap-t.wrap<<t.overscaledZ;o>0?(s=gt>>o,a=s*((n.tileID.canonical.x<<o)-t.canonical.x+h),c=s*((n.tileID.canonical.y<<o)-t.canonical.y)):(s=gt<<-o,a=gt*(n.tileID.canonical.x-(t.canonical.x+h<<-o)),c=gt*(n.tileID.canonical.y-(t.canonical.y<<-o))),lt.ortho(i,0,s,0,s,0,1),lt.translate(i,i,[a,c,0])}return new XM(n.tileID,t.key,i)}_findTileCoveringTileID(t,n){let r=n.getTile(t);if(r&&r.hasData())return r;const i=this._findCoveringTileCache[n.id],o=i[t.key];if(r=o?n.getTileByID(o):null,r&&r.hasData()||o===null)return r;let s=r?r.tileID:t,a=s.overscaledZ;const c=n.getSource().minzoom,h=[];if(!o){const m=n.getSource().maxzoom;if(t.canonical.z>=m){const g=t.canonical.z-m;n.getSource().reparseOverscaled?(a=Math.max(t.canonical.z+2,n.transform.tileZoom),s=new sn(a,t.wrap,m,t.canonical.x>>g,t.canonical.y>>g)):g!==0&&(a=m,s=new sn(a,t.wrap,m,t.canonical.x>>g,t.canonical.y>>g))}s.key!==t.key&&(h.push(s.key),r=n.getTile(s))}const d=m=>{h.forEach(g=>{i[g]=m}),h.length=0};for(a-=1;a>=c&&(!r||!r.hasData());a--){r&&d(r.tileID.key);const m=s.calculateScaledKey(a);if(r=n.getTileByID(m),r&&r.hasData())break;const g=i[m];if(g===null)break;g===void 0?h.push(m):r=n.getTileByID(g)}return d(r?r.tileID.key:null),r&&r.hasData()?r:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,n){let r=this._tilesDirty[t];r||(r=this._tilesDirty[t]={}),r[n.key]=!0}}function kk(e,t,n){const r=function(a,c,h){const d=J.dot(c,a),m=J.dot(h,[.2126,.7152,.0722]),g=(v,w,A)=>(1-A)*v+A*w,x=g(1-.3*Math.min(m,1),1,Math.min(d+1,1));return g(.92,1,Math.asin($t(c[2],-1,1))/Math.PI+.5)*x}(e,[0,0,1],t),i=[0,0,0];J.scale(i,n.slice(0,3),r);const o=[0,0,0];J.scale(o,t.slice(0,3),e[2]);const s=[0,0,0];return J.add(s,i,o),pr(s)}const Fk=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],zk=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class YM{static cacheKey(t,n,r,i){let o=`${n}${i?i.cacheKey:""}`;for(const s of r)t.usedDefines.includes(s)&&(o+=`/${s}`);return o}constructor(t,n,r,i,o,s){const a=t.gl;this.program=a.createProgram(),this.configuration=i,this.name=n,this.fixedDefines=[...s];const c=i?i.getBinderAttributes():[],h=(r.staticAttributes||[]).concat(c);let d=i?i.defines():[];d=d.concat(s.map(A=>`#define ${A}`));const m=`#version 300 es
`;let g=m+d.concat("precision mediump float;",VM,UM.fragmentSource).join(`
`);for(const A of r.fragmentIncludes)g+=`
${sx[A]}`;g+=`
${r.fragmentSource}`;let x=m+d.concat("precision highp float;",VM,UM.vertexSource).join(`
`);for(const A of r.vertexIncludes)x+=`
${sx[A]}`;x+=`
${r.vertexSource}`;const v=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);a.shaderSource(v,g),a.compileShader(v),a.attachShader(this.program,v);const w=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(w,x),a.compileShader(w),a.attachShader(this.program,w),this.attributes={},this.numAttributes=h.length;for(let A=0;A<this.numAttributes;A++)if(h[A]){const E=h[A].startsWith("a_")?h[A]:`a_${h[A]}`;a.bindAttribLocation(this.program,A,E),this.attributes[E]=A}a.linkProgram(this.program),a.deleteShader(w),a.deleteShader(v),this.fixedUniforms=o(t),this.binderUniforms=i?i.getUniforms(t):[],s.includes("TERRAIN")&&(this.terrainUniforms=(A=>({u_dem:new Oe(A),u_dem_prev:new Oe(A),u_dem_tl:new $e(A),u_dem_scale:new Bt(A),u_dem_tl_prev:new $e(A),u_dem_scale_prev:new Bt(A),u_dem_size:new Bt(A),u_dem_lerp:new Bt(A),u_exaggeration:new Bt(A),u_depth:new Oe(A),u_depth_size_inv:new $e(A),u_meter_to_dem:new Bt(A),u_label_plane_matrix_inv:new Ne(A)}))(t)),s.includes("GLOBE")&&(this.globeUniforms=(A=>({u_tile_tl_up:new Ve(A),u_tile_tr_up:new Ve(A),u_tile_br_up:new Ve(A),u_tile_bl_up:new Ve(A),u_tile_up_scale:new Bt(A)}))(t)),s.includes("FOG")&&(this.fogUniforms=(A=>({u_fog_matrix:new Ne(A),u_fog_range:new $e(A),u_fog_color:new ao(A),u_fog_horizon_blend:new Bt(A),u_fog_vertical_limit:new $e(A),u_fog_temporal_offset:new Bt(A),u_frustum_tl:new Ve(A),u_frustum_tr:new Ve(A),u_frustum_br:new Ve(A),u_frustum_bl:new Ve(A),u_globe_pos:new Ve(A),u_globe_radius:new Bt(A),u_globe_transition:new Bt(A),u_is_globe:new Oe(A),u_viewport:new $e(A)}))(t)),s.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(A=>({u_cutoff_params:new ao(A)}))(t)),s.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(A=>({u_lighting_ambient_color:new Ve(A),u_lighting_directional_dir:new Ve(A),u_lighting_directional_color:new Ve(A),u_ground_radiance:new Ve(A)}))(t)),s.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(A=>({u_light_matrix_0:new Ne(A),u_light_matrix_1:new Ne(A),u_fade_range:new $e(A),u_shadow_normal_offset:new Ve(A),u_shadow_intensity:new Bt(A),u_shadow_texel_size:new Bt(A),u_shadow_map_resolution:new Bt(A),u_shadow_direction:new Ve(A),u_shadow_bias:new Ve(A),u_shadowmap_0:new Oe(A),u_shadowmap_1:new Oe(A)}))(t))}}setTerrainUniformValues(t,n){if(!this.terrainUniforms)return;const r=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const i in n)r[i]&&r[i].set(this.program,i,n[i])}}setGlobeUniformValues(t,n){if(!this.globeUniforms)return;const r=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const i in n)r[i]&&r[i].set(this.program,i,n[i])}}setFogUniformValues(t,n){if(!this.fogUniforms)return;const r=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const i in n)r[i].set(this.program,i,n[i])}}setCutoffUniformValues(t,n){if(!this.cutoffUniforms)return;const r=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const i in n)r[i].set(this.program,i,n[i])}}setLightsUniformValues(t,n){if(!this.lightsUniforms)return;const r=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const i in n)r[i].set(this.program,i,n[i])}}setShadowUniformValues(t,n){if(this.failedToCreate||!this.shadowUniforms)return;const r=this.shadowUniforms;t.program.set(this.program);for(const i in n)r[i].set(this.program,i,n[i])}_drawDebugWireframe(t,n,r,i,o,s,a,c,h,d){const m=t.options.wireframe;if(m.terrain===!1&&m.layers2D===!1&&m.layers3D===!1)return;const g=t.context;if(!(!(!m.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!m.layers2D||t._terrain&&t._terrain.renderingToTexture||!Fk.includes(this.name))||!(!m.layers3D||!zk.includes(this.name))))return;const x=g.gl,v=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,o,g);if(!v)return;const w=[...this.fixedDefines];w.push("DEBUG_WIREFRAME");const A=t.getOrCreateProgram(this.name,{config:this.configuration,defines:w});g.program.set(A.program);const E=(B,M,D)=>{if(M[B]&&D[B])for(const R in M[B])D[B][R]&&D[B][R].set(D.program,R,M[B][R].current)};h&&h.setUniforms(A.program,g,A.binderUniforms,a,{zoom:c}),E("fixedUniforms",this,A),E("terrainUniforms",this,A),E("globeUniforms",this,A),E("fogUniforms",this,A),E("lightsUniforms",this,A),E("shadowUniforms",this,A),v.bind(),g.setColorMode(new xn([x.ONE,x.ONE_MINUS_SRC_ALPHA,x.ZERO,x.ONE],Me.transparent,[!0,!0,!0,!1])),g.setDepthMode(new De(n.func===x.LESS?x.LEQUAL:n.func,De.ReadOnly,n.range)),g.setStencilMode(Ke.disabled);const S=3*s.primitiveLength*2,I=3*s.primitiveOffset*2*2;d&&d>1?x.drawElementsInstanced(x.LINES,S,x.UNSIGNED_SHORT,I,d):x.drawElements(x.LINES,S,x.UNSIGNED_SHORT,I),o.bind(),g.program.set(this.program),g.setDepthMode(n),g.setStencilMode(r),g.setColorMode(i)}draw(t,n,r,i,o,s,a,c,h,d,m,g,x,v,w,A){const E=t.context,S=E.gl;if(this.failedToCreate)return;E.program.set(this.program),E.setDepthMode(r),E.setStencilMode(i),E.setColorMode(o),E.setCullFace(s);for(const M of Object.keys(this.fixedUniforms))this.fixedUniforms[M].set(this.program,M,a[M]);v&&v.setUniforms(this.program,E,this.binderUniforms,g,{zoom:x});const I={[S.LINES]:2,[S.TRIANGLES]:3,[S.LINE_STRIP]:1}[n],B=A&&A>0?1:void 0;for(const M of m.get()){const D=M.vaos||(M.vaos={});(D[c]||(D[c]=new Sk)).bind(E,this,h,v?v.getPaintVertexBuffers():[],d,M.vertexOffset,w||[],B),A&&A>1?S.drawElementsInstanced(n,M.primitiveLength*I,S.UNSIGNED_SHORT,M.primitiveOffset*I*2,A):S.drawElements(n,M.primitiveLength*I,S.UNSIGNED_SHORT,M.primitiveOffset*I*2),n===S.TRIANGLES&&this._drawDebugWireframe(t,r,i,o,d,M,g,x,v,A)}}}function QM(e,t){const n=Math.pow(2,t.tileID.overscaledZ),r=t.tileSize*Math.pow(2,e.transform.tileZoom)/n,i=r*(t.tileID.canonical.x+t.tileID.wrap*n),o=r*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/Th(t,1,e.transform.tileZoom),u_pixel_coord_upper:[i>>16,o>>16],u_pixel_coord_lower:[65535&i,65535&o]}}const Ok=lt.create(),tI=(e,t,n,r,i,o,s,a,c,h,d,m,g,x,v,w)=>{const A=t.style.light,E=A.properties.get("position"),S=[E.x,E.y,E.z],I=Ki.create();A.properties.get("anchor")==="viewport"&&(Ki.fromRotation(I,-t.transform.angle),J.transformMat3(S,S,I));const B=A.properties.get("color"),M=t.transform,D={u_matrix:e,u_lightpos:S,u_lightintensity:A.properties.get("intensity"),u_lightcolor:[B.r,B.g,B.b],u_vertical_gradient:+n,u_opacity:r,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ok,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:i,u_edge_radius:o,u_flood_light_color:m,u_vertical_scale:g,u_flood_light_intensity:x,u_ground_shadow_factor:v,u_emissive_strength:w};return M.projection.name==="globe"&&(D.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],D.u_zoom_transition=c,D.u_inv_rot_matrix=d,D.u_merc_center=h,D.u_up_dir=M.projection.upVector(new Xi(0,0,0),h[0]*gt,h[1]*gt),D.u_height_lift=a),D},Nk=(e,t,n)=>({u_matrix:e,u_edge_radius:t,u_vertical_scale:n}),Uk=(e,t,n,r,i,o,s,a,c,h,d,m,g,x)=>{const v=tI(e,t,n,r,i,o,s,c,h,d,m,g,x,1,[0,0,0],0),w={u_height_factor:-Math.pow(2,s.overscaledZ)/a.tileSize/8};return re(v,QM(t,a),w)},eI=(e,t)=>({u_matrix:e,u_emissive_strength:t}),nI=(e,t,n,r)=>re(eI(e,t),QM(n,r)),Vk=(e,t,n)=>({u_matrix:e,u_world:n,u_emissive_strength:t}),Gk=(e,t,n,r,i)=>re(nI(e,t,n,r),{u_world:i}),jk=(e,t,n,r)=>{const i=gt/n.tileSize;return{u_matrix:e,u_camera_to_center_distance:t.getCameraToCenterDistance(r),u_extrude_scale:[t.pixelsToGLUnits[0]/i,t.pixelsToGLUnits[1]/i]}},rI=(e,t,n=1)=>({u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:n}),Hk=lt.create(),Zk=(e,t,n,r,i,o,s)=>{const a=e.transform,c=a.projection.name==="globe",h=c?jy(a.zoom,t.canonical)*a._pixelsPerMercatorPixel:Th(n,1,o),d={u_matrix:t.projMatrix,u_extrude_scale:h,u_intensity:s,u_inv_rot_matrix:Hk,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(c){d.u_inv_rot_matrix=r,d.u_merc_center=i,d.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],d.u_zoom_transition=$r(a.zoom);const m=i[0]*gt,g=i[1]*gt;d.u_up_dir=a.projection.upVector(new Xi(0,0,0),m,g)}return d},iI=(e,t,n,r,i,o,s,a,c,h,d,m,g,x,v,w,A,E,S,I,B,M)=>{return{u_matrix:e,u_normalize_matrix:t,u_globe_matrix:n,u_merc_matrix:r,u_grid_matrix:i,u_tl_parent:o,u_scale_parent:d,u_fade_t:m.mix,u_opacity:m.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(R=g.paint.get("raster-saturation"),R>0?1-1/(1.001-R):-R),u_contrast_factor:(D=g.paint.get("raster-contrast"),D>0?1/(1-D):1+D),u_spin_weights:Wk(g.paint.get("raster-hue-rotate")),u_perspective_transform:x,u_raster_elevation:v,u_tl_br:s,u_zoom_transition:a,u_merc_center:c,u_cutoff_params:h,u_colorization_mix:qk(A,S),u_colorization_offset:Jk(E,S),u_color_ramp:w,u_texture_offset:[B/(I+2*B),I/(I+2*B)],u_texture_res:[I+2*B,I+2*B],u_emissive_strength:M};var D,R};function Wk(e){e*=Math.PI/180;const t=Math.sin(e),n=Math.cos(e);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}function qk([e,t,n,r],[i,o]){if(i===o)return[0,0,0,0];const s=259/257/(o-i);return[e*s,t*s,n*s,r*s]}function Jk(e,[t,n]){return t===n?0:((e-t)/(n-t)*259-1)/257}const oI=lt.create(),sI=(e,t,n,r,i,o,s,a,c,h,d,m,g,x,v,w,A,E)=>{const S=i.transform,I={u_is_size_zoom_constant:+(e==="constant"||e==="source"),u_is_size_feature_constant:+(e==="constant"||e==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:S.getCameraToCenterDistance(w),u_rotate_symbol:+n,u_aspect_ratio:S.width/S.height,u_fade_change:i.options.fadeDuration?i.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:s,u_coord_matrix:a,u_is_text:+c,u_pitch_with_map:+r,u_texsize:h,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:oI,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:oI,u_up_vector:[0,-1,0],u_icon_transition:E||0,u_icon_saturation:A};return w.name==="globe"&&(I.u_tile_id=[d.canonical.x,d.canonical.y,1<<d.canonical.z],I.u_zoom_transition=m,I.u_inv_rot_matrix=x,I.u_merc_center=g,I.u_camera_forward=S._camera.forward(),I.u_ecef_origin=function(B,M){const D=[0,0,0],R=Ar(To(M.canonical));return J.transformMat4(D,D,R),J.transformMat4(D,D,B),D}(S.globeMatrix,d.toUnwrapped()),I.u_tile_matrix=Float32Array.from(S.globeMatrix),I.u_up_vector=v),I},aI=(e,t,n,r,i,o,s,a,c,h,d,m,g,x,v,w,A)=>re(sI(e,t,n,r,i,o,s,a,c,h,m,g,x,v,w,A,1),{u_gamma_scale:r?i.transform.getCameraToCenterDistance(A)*Math.cos(i.terrain?0:i.transform._pitch):1,u_device_pixel_ratio:ze.devicePixelRatio,u_is_halo:+d,undefined:void 0}),$k=(e,t,n,r,i,o,s,a,c,h,d,m,g,x,v,w)=>re(aI(e,t,n,r,i,o,s,a,!0,c,!0,d,m,g,x,v,w),{u_texsize_icon:h,u_texture_icon:1}),Kk=(e,t,n,r)=>({u_matrix:e,u_emissive_strength:t,u_opacity:n,u_color:r}),Xk=(e,t,n,r,i,o,s)=>re(function(a,c,h,d){const m=h.imageManager.getPattern(a.toString(),c),{width:g,height:x}=h.imageManager.getPixelSize(c),v=Math.pow(2,d.tileID.overscaledZ),w=d.tileSize*Math.pow(2,h.transform.tileZoom)/v,A=w*(d.tileID.canonical.x+d.tileID.wrap*v),E=w*d.tileID.canonical.y;return{u_image:0,u_pattern_tl:m.tl,u_pattern_br:m.br,u_texsize:[g,x],u_pattern_size:m.displaySize,u_tile_units_to_pixels:1/Th(d,1,h.transform.tileZoom),u_pixel_coord_upper:[A>>16,E>>16],u_pixel_coord_lower:[65535&A,65535&E]}}(i,o,r,s),{u_matrix:e,u_emissive_strength:t,u_opacity:n}),Ho={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},hA=(e,t,n,r,i,o,s,a,c,h,d,m,g=[0,0,0])=>{const x=r.style.light,v=x.properties.get("position"),w=[-v.x,-v.y,v.z],A=Ki.create();x.properties.get("anchor")==="viewport"&&(Ki.fromRotation(A,-r.transform.angle),J.transformMat3(w,w,A));const E=h.alphaMode==="MASK",S=x.properties.get("color"),I=m.paint.get("model-ambient-occlusion-intensity"),B=m.paint.get("model-color").constantOr(Me.white),M=m.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:e,u_lighting_matrix:t,u_normal_matrix:n,u_lightpos:w,u_lightintensity:x.properties.get("intensity"),u_lightcolor:[S.r,S.g,S.b],u_camera_pos:g,u_opacity:i,u_baseTextureIsAlpha:0,u_alphaMask:+E,u_alphaCutoff:h.alphaCutoff,u_baseColorFactor:[o.r,o.g,o.b,o.a],u_emissiveFactor:[s[0],s[1],s[2],1],u_metallicFactor:a,u_roughnessFactor:c,u_baseColorTexture:Ho.BaseColor,u_metallicRoughnessTexture:Ho.MetallicRoughness,u_normalTexture:Ho.Normal,u_occlusionTexture:Ho.Occlusion,u_emissionTexture:Ho.Emission,u_color_mix:[B.r,B.g,B.b,M],u_aoIntensity:I,u_emissive_strength:d}},lI=new Float32Array(16),uI=(e,t=lI,n=lI)=>({u_matrix:e,u_instance:t,u_node_matrix:n}),Yk={fillExtrusion:e=>({u_matrix:new Ne(e),u_lightpos:new Ve(e),u_lightintensity:new Bt(e),u_lightcolor:new Ve(e),u_vertical_gradient:new Bt(e),u_opacity:new Bt(e),u_edge_radius:new Bt(e),u_ao:new $e(e),u_tile_id:new Ve(e),u_zoom_transition:new Bt(e),u_inv_rot_matrix:new Ne(e),u_merc_center:new $e(e),u_up_dir:new Ve(e),u_height_lift:new Bt(e),u_flood_light_color:new Ve(e),u_vertical_scale:new Bt(e),u_flood_light_intensity:new Bt(e),u_ground_shadow_factor:new Ve(e),u_emissive_strength:new Bt(e)}),fillExtrusionDepth:e=>({u_matrix:new Ne(e),u_edge_radius:new Bt(e),u_vertical_scale:new Bt(e)}),fillExtrusionPattern:e=>({u_matrix:new Ne(e),u_lightpos:new Ve(e),u_lightintensity:new Bt(e),u_lightcolor:new Ve(e),u_vertical_gradient:new Bt(e),u_height_factor:new Bt(e),u_edge_radius:new Bt(e),u_ao:new $e(e),u_tile_id:new Ve(e),u_zoom_transition:new Bt(e),u_inv_rot_matrix:new Ne(e),u_merc_center:new $e(e),u_up_dir:new Ve(e),u_height_lift:new Bt(e),u_image:new Oe(e),u_texsize:new $e(e),u_pixel_coord_upper:new $e(e),u_pixel_coord_lower:new $e(e),u_tile_units_to_pixels:new Bt(e),u_opacity:new Bt(e)}),fillExtrusionGroundEffect:e=>({u_matrix:new Ne(e),u_opacity:new Bt(e),u_ao_pass:new Bt(e),u_meter_to_tile:new Bt(e),u_ao:new $e(e),u_flood_light_intensity:new Bt(e),u_flood_light_color:new Ve(e),u_attenuation:new Bt(e),u_edge_radius:new Bt(e),u_fb:new Oe(e),u_fb_size:new Bt(e)}),fill:e=>({u_matrix:new Ne(e),u_emissive_strength:new Bt(e)}),fillPattern:e=>({u_matrix:new Ne(e),u_emissive_strength:new Bt(e),u_image:new Oe(e),u_texsize:new $e(e),u_pixel_coord_upper:new $e(e),u_pixel_coord_lower:new $e(e),u_tile_units_to_pixels:new Bt(e)}),fillOutline:e=>({u_matrix:new Ne(e),u_emissive_strength:new Bt(e),u_world:new $e(e)}),fillOutlinePattern:e=>({u_matrix:new Ne(e),u_emissive_strength:new Bt(e),u_world:new $e(e),u_image:new Oe(e),u_texsize:new $e(e),u_pixel_coord_upper:new $e(e),u_pixel_coord_lower:new $e(e),u_tile_units_to_pixels:new Bt(e)}),circle:e=>({u_camera_to_center_distance:new Bt(e),u_extrude_scale:new Cm(e),u_device_pixel_ratio:new Bt(e),u_matrix:new Ne(e),u_inv_rot_matrix:new Ne(e),u_merc_center:new $e(e),u_tile_id:new Ve(e),u_zoom_transition:new Bt(e),u_up_dir:new Ve(e),u_emissive_strength:new Bt(e)}),collisionBox:e=>({u_matrix:new Ne(e),u_camera_to_center_distance:new Bt(e),u_extrude_scale:new $e(e)}),collisionCircle:e=>({u_matrix:new Ne(e),u_inv_matrix:new Ne(e),u_camera_to_center_distance:new Bt(e),u_viewport_size:new $e(e)}),debug:e=>({u_color:new Gu(e),u_matrix:new Ne(e),u_overlay:new Oe(e),u_overlay_scale:new Bt(e)}),clippingMask:e=>({u_matrix:new Ne(e)}),heatmap:e=>({u_extrude_scale:new Bt(e),u_intensity:new Bt(e),u_matrix:new Ne(e),u_inv_rot_matrix:new Ne(e),u_merc_center:new $e(e),u_tile_id:new Ve(e),u_zoom_transition:new Bt(e),u_up_dir:new Ve(e)}),heatmapTexture:e=>({u_image:new Oe(e),u_color_ramp:new Oe(e),u_opacity:new Bt(e)}),hillshade:e=>({u_matrix:new Ne(e),u_image:new Oe(e),u_latrange:new $e(e),u_light:new $e(e),u_shadow:new Gu(e),u_highlight:new Gu(e),u_emissive_strength:new Bt(e),u_accent:new Gu(e)}),hillshadePrepare:e=>({u_matrix:new Ne(e),u_image:new Oe(e),u_dimension:new $e(e),u_zoom:new Bt(e)}),line:e=>({u_matrix:new Ne(e),u_pixels_to_tile_units:new Cm(e),u_device_pixel_ratio:new Bt(e),u_units_to_pixels:new $e(e),u_dash_image:new Oe(e),u_gradient_image:new Oe(e),u_image_height:new Bt(e),u_texsize:new $e(e),u_tile_units_to_pixels:new Bt(e),u_alpha_discard_threshold:new Bt(e),u_trim_offset:new $e(e),u_emissive_strength:new Bt(e)}),linePattern:e=>({u_matrix:new Ne(e),u_texsize:new $e(e),u_pixels_to_tile_units:new Cm(e),u_device_pixel_ratio:new Bt(e),u_image:new Oe(e),u_units_to_pixels:new $e(e),u_tile_units_to_pixels:new Bt(e),u_alpha_discard_threshold:new Bt(e)}),raster:e=>({u_matrix:new Ne(e),u_normalize_matrix:new Ne(e),u_globe_matrix:new Ne(e),u_merc_matrix:new Ne(e),u_grid_matrix:new Tm(e),u_tl_parent:new $e(e),u_scale_parent:new Bt(e),u_fade_t:new Bt(e),u_opacity:new Bt(e),u_image0:new Oe(e),u_image1:new Oe(e),u_brightness_low:new Bt(e),u_brightness_high:new Bt(e),u_saturation_factor:new Bt(e),u_contrast_factor:new Bt(e),u_spin_weights:new Ve(e),u_perspective_transform:new $e(e),u_raster_elevation:new Bt(e),u_tl_br:new ao(e),u_zoom_transition:new Bt(e),u_merc_center:new $e(e),u_cutoff_params:new ao(e),u_colorization_mix:new ao(e),u_colorization_offset:new Bt(e),u_color_ramp:new Oe(e),u_texture_offset:new $e(e),u_texture_res:new $e(e),u_emissive_strength:new Bt(e)}),symbolIcon:e=>({u_is_size_zoom_constant:new Oe(e),u_is_size_feature_constant:new Oe(e),u_size_t:new Bt(e),u_size:new Bt(e),u_camera_to_center_distance:new Bt(e),u_rotate_symbol:new Oe(e),u_aspect_ratio:new Bt(e),u_fade_change:new Bt(e),u_matrix:new Ne(e),u_label_plane_matrix:new Ne(e),u_coord_matrix:new Ne(e),u_is_text:new Oe(e),u_pitch_with_map:new Oe(e),u_texsize:new $e(e),u_tile_id:new Ve(e),u_zoom_transition:new Bt(e),u_inv_rot_matrix:new Ne(e),u_merc_center:new $e(e),u_camera_forward:new Ve(e),u_tile_matrix:new Ne(e),u_up_vector:new Ve(e),u_ecef_origin:new Ve(e),u_texture:new Oe(e),u_icon_transition:new Bt(e),u_icon_saturation:new Bt(e)}),symbolSDF:e=>({u_is_size_zoom_constant:new Oe(e),u_is_size_feature_constant:new Oe(e),u_size_t:new Bt(e),u_size:new Bt(e),u_camera_to_center_distance:new Bt(e),u_rotate_symbol:new Oe(e),u_aspect_ratio:new Bt(e),u_fade_change:new Bt(e),u_matrix:new Ne(e),u_label_plane_matrix:new Ne(e),u_coord_matrix:new Ne(e),u_is_text:new Oe(e),u_pitch_with_map:new Oe(e),u_texsize:new $e(e),u_texture:new Oe(e),u_gamma_scale:new Bt(e),u_device_pixel_ratio:new Bt(e),u_tile_id:new Ve(e),u_zoom_transition:new Bt(e),u_inv_rot_matrix:new Ne(e),u_merc_center:new $e(e),u_camera_forward:new Ve(e),u_tile_matrix:new Ne(e),u_up_vector:new Ve(e),u_ecef_origin:new Ve(e),u_is_halo:new Oe(e)}),symbolTextAndIcon:e=>({u_is_size_zoom_constant:new Oe(e),u_is_size_feature_constant:new Oe(e),u_size_t:new Bt(e),u_size:new Bt(e),u_camera_to_center_distance:new Bt(e),u_rotate_symbol:new Oe(e),u_aspect_ratio:new Bt(e),u_fade_change:new Bt(e),u_matrix:new Ne(e),u_label_plane_matrix:new Ne(e),u_coord_matrix:new Ne(e),u_is_text:new Oe(e),u_pitch_with_map:new Oe(e),u_texsize:new $e(e),u_texsize_icon:new $e(e),u_texture:new Oe(e),u_texture_icon:new Oe(e),u_gamma_scale:new Bt(e),u_device_pixel_ratio:new Bt(e),u_is_halo:new Oe(e)}),background:e=>({u_matrix:new Ne(e),u_emissive_strength:new Bt(e),u_opacity:new Bt(e),u_color:new Gu(e)}),backgroundPattern:e=>({u_matrix:new Ne(e),u_emissive_strength:new Bt(e),u_opacity:new Bt(e),u_image:new Oe(e),u_pattern_tl:new $e(e),u_pattern_br:new $e(e),u_texsize:new $e(e),u_pattern_size:new $e(e),u_pixel_coord_upper:new $e(e),u_pixel_coord_lower:new $e(e),u_tile_units_to_pixels:new Bt(e)}),terrainRaster:HM,terrainDepth:HM,skybox:e=>({u_matrix:new Ne(e),u_sun_direction:new Ve(e),u_cubemap:new Oe(e),u_opacity:new Bt(e),u_temporal_offset:new Bt(e)}),skyboxGradient:e=>({u_matrix:new Ne(e),u_color_ramp:new Oe(e),u_center_direction:new Ve(e),u_radius:new Bt(e),u_opacity:new Bt(e),u_temporal_offset:new Bt(e)}),skyboxCapture:e=>({u_matrix_3f:new Tm(e),u_sun_direction:new Ve(e),u_sun_intensity:new Bt(e),u_color_tint_r:new ao(e),u_color_tint_m:new ao(e),u_luminance:new Bt(e)}),globeRaster:e=>({u_proj_matrix:new Ne(e),u_globe_matrix:new Ne(e),u_normalize_matrix:new Ne(e),u_merc_matrix:new Ne(e),u_zoom_transition:new Bt(e),u_merc_center:new $e(e),u_image0:new Oe(e),u_grid_matrix:new Tm(e),u_skirt_height:new Bt(e),u_frustum_tl:new Ve(e),u_frustum_tr:new Ve(e),u_frustum_br:new Ve(e),u_frustum_bl:new Ve(e),u_globe_pos:new Ve(e),u_globe_radius:new Bt(e),u_viewport:new $e(e)}),globeAtmosphere:e=>({u_frustum_tl:new Ve(e),u_frustum_tr:new Ve(e),u_frustum_br:new Ve(e),u_frustum_bl:new Ve(e),u_horizon:new Bt(e),u_transition:new Bt(e),u_fadeout_range:new Bt(e),u_color:new ao(e),u_high_color:new ao(e),u_space_color:new ao(e),u_temporal_offset:new Bt(e),u_horizon_angle:new Bt(e)}),model:e=>({u_matrix:new Ne(e),u_lighting_matrix:new Ne(e),u_normal_matrix:new Ne(e),u_lightpos:new Ve(e),u_lightintensity:new Bt(e),u_lightcolor:new Ve(e),u_camera_pos:new Ve(e),u_opacity:new Bt(e),u_baseColorFactor:new ao(e),u_emissiveFactor:new ao(e),u_metallicFactor:new Bt(e),u_roughnessFactor:new Bt(e),u_baseTextureIsAlpha:new Oe(e),u_alphaMask:new Oe(e),u_alphaCutoff:new Bt(e),u_baseColorTexture:new Oe(e),u_metallicRoughnessTexture:new Oe(e),u_normalTexture:new Oe(e),u_occlusionTexture:new Oe(e),u_emissionTexture:new Oe(e),u_color_mix:new ao(e),u_aoIntensity:new Bt(e),u_emissive_strength:new Bt(e)}),modelDepth:e=>({u_matrix:new Ne(e),u_instance:new Ne(e),u_node_matrix:new Ne(e)}),groundShadow:e=>({u_matrix:new Ne(e),u_ground_shadow_factor:new Ve(e)}),stars:e=>({u_matrix:new Ne(e),u_up:new Ve(e),u_right:new Ve(e),u_intensity_multiplier:new Bt(e)})};let ux;function cI(e,t,n,r,i,o,s){const a=e.context,c=a.gl,h=e.transform,d=e.getOrCreateProgram("collisionBox"),m=[];let g=0,x=0;for(let B=0;B<r.length;B++){const M=r[B],D=t.getTile(M),R=D.getBucket(n);if(!R)continue;const z=uk(M,R,h);let N=z;i[0]===0&&i[1]===0||(N=e.translatePosMatrix(z,D,i,o));const V=s?R.textCollisionBox:R.iconCollisionBox,j=R.collisionCircleArray;if(j.length>0){const H=lt.create(),$=N;lt.mul(H,R.placementInvProjMatrix,h.glCoordMatrix),lt.mul(H,H,R.placementViewportMatrix),m.push({circleArray:j,circleOffset:x,transform:$,invTransform:H,projection:R.getProjection()}),g+=j.length/4,x=g}V&&(e.terrain&&e.terrain.setupElevationDraw(D,d),d.draw(e,c.LINES,De.disabled,Ke.disabled,e.colorModeForRenderPass(),Qe.disabled,jk(N,h,D,R.getProjection()),n.id,V.layoutVertexBuffer,V.indexBuffer,V.segments,null,h.zoom,null,[V.collisionVertexBuffer,V.collisionVertexBufferExt]))}if(!s||!m.length)return;const v=e.getOrCreateProgram("collisionCircle"),w=new ah;w.resize(4*g),w._trim();let A=0;for(const B of m)for(let M=0;M<B.circleArray.length/4;M++){const D=4*M,R=B.circleArray[D+0],z=B.circleArray[D+1],N=B.circleArray[D+2],V=B.circleArray[D+3];w.emplace(A++,R,z,N,V,0),w.emplace(A++,R,z,N,V,1),w.emplace(A++,R,z,N,V,2),w.emplace(A++,R,z,N,V,3)}(!ux||ux.length<2*g)&&(ux=function(B){const M=2*B,D=new ur;D.resize(M),D._trim();for(let R=0;R<M;R++){const z=6*R;D.uint16[z+0]=4*R+0,D.uint16[z+1]=4*R+1,D.uint16[z+2]=4*R+2,D.uint16[z+3]=4*R+2,D.uint16[z+4]=4*R+3,D.uint16[z+5]=4*R+0}return D}(g));const E=a.createIndexBuffer(ux,!0),S=a.createVertexBuffer(w,wP.members,!0);for(const B of m){const M={u_matrix:B.transform,u_inv_matrix:B.invTransform,u_camera_to_center_distance:(I=h).getCameraToCenterDistance(B.projection),u_viewport_size:[I.width,I.height]};v.draw(e,c.TRIANGLES,De.disabled,Ke.disabled,e.colorModeForRenderPass(),Qe.disabled,M,n.id,S,E,Cn.simpleSegment(0,2*B.circleOffset,B.circleArray.length,B.circleArray.length/2),null,h.zoom)}var I;S.destroy(),E.destroy()}const hI=lt.create();function Qk({width:e,height:t,anchor:n,textOffset:r,textScale:i},o){const{horizontalAlign:s,verticalAlign:a}=E1(n),c=-(s-.5)*e,h=-(a-.5)*t,d=bb(n,r);return new nt((c/i+d[0])*o,(h/i+d[1])*o)}function tF(e,t,n,r,i,o,s,a,c,h,d){const m=e.text.placedSymbolArray,g=e.text.dynamicLayoutVertexArray,x=e.icon.dynamicLayoutVertexArray,v={},w=e.getProjection(),A=iA(a,w,o),E=o.elevation,S=w.upVectorScale(a.canonical,o.center.lat,o.worldSize).metersToTile;g.clear();for(let I=0;I<m.length;I++){const B=m.get(I),{tileAnchorX:M,tileAnchorY:D,numGlyphs:R}=B,z=B.hidden||!B.crossTileID||e.allowVerticalPlacement&&!B.placedOrientation?null:r[B.crossTileID];if(z){let N=0,V=0,j=0;if(E){const ct=E?E.getAtTileOffset(a,M,D):0,[pt,dt,wt]=w.upVector(a.canonical,M,D);N=ct*pt*S,V=ct*dt*S,j=ct*wt*S}let[H,$,G,Q]=ya(B.projectedAnchorX+N,B.projectedAnchorY+V,B.projectedAnchorZ+j,n?A:s);const et=eS(o.getCameraToCenterDistance(w),Q);let st=i.evaluateSizeForFeature(e.textSizeData,h,B)*et/li;n&&(st*=e.tilePixelRatio/c);const Y=Qk(z,st);n?({x:H,y:$,z:G}=w.projectTilePoint(M+Y.x,D+Y.y,a.canonical),[H,$,G]=ya(H+N,$+V,G+j,s)):(t&&Y._rotate(-o.angle),H+=Y.x,$+=Y.y,G=0);const tt=e.allowVerticalPlacement&&B.placedOrientation===fr.vertical?Math.PI/2:0;for(let ct=0;ct<R;ct++)wd(g,H,$,G,tt);d&&B.associatedIconIndex>=0&&(v[B.associatedIconIndex]={x:H,y:$,z:G,angle:tt})}else Ad(R,g)}if(d){x.clear();const I=e.icon.placedSymbolArray;for(let B=0;B<I.length;B++){const M=I.get(B),{numGlyphs:D}=M,R=v[B];if(M.hidden||!R)Ad(D,x);else{const{x:z,y:N,z:V,angle:j}=R;for(let H=0;H<D;H++)wd(x,z,N,V,j)}}e.icon.dynamicLayoutVertexBuffer.updateData(x)}e.text.dynamicLayoutVertexBuffer.updateData(g)}function eF(e,t,n){return n.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function fI(e,t,n,r,i,o,s,a,c,h,d,m,g){const x=e.context,v=x.gl,w=e.transform,A=a==="map",E=c==="map",S=A&&n.layout.get("symbol-placement")!=="point",I=A&&!E&&!S,B=n.layout.get("symbol-sort-key").constantOr(1)!==void 0;let M=!1;const D=e.depthModeForSublayer(0,De.ReadOnly),R=[Ir(w.center.lng),Fr(w.center.lat)],z=n.layout.get("text-variable-anchor"),N=w.projection.name==="globe",V=[],j=[0,-1,0];let H=j;!N&&!w.mercatorFromTransition||A||(H=function($){const G=$._camera.getWorldToCamera($.worldSize,1),Q=lt.multiply([],G,$.globeMatrix);lt.invert(Q,Q);const et=[0,0,0],st=[0,1,0,0];return Bn.transformMat4(st,st,Q),et[0]=st[0],et[1]=st[1],et[2]=st[2],J.normalize(et,et),et}(w));for(const $ of r){const G=t.getTile($),Q=G.getBucket(n);if(!Q||Q.projection.name==="mercator"&&N)continue;const et=i?Q.text:Q.icon;if(!et||Q.fullyClipped||!et.segments.get().length)continue;const st=et.programConfigurations.get(n.id),Y=i||Q.sdfIcons,tt=i?Q.textSizeData:Q.iconSizeData,ct=E||w.pitch!==0,pt=Xa(tt,w.zoom);let dt,wt,bt,Et,_t=[0,0],Mt=null;if(i)wt=G.glyphAtlasTexture?G.glyphAtlasTexture:null,bt=v.LINEAR,dt=G.glyphAtlasTexture?G.glyphAtlasTexture.size:[0,0],Q.iconsInText&&(_t=G.imageAtlasTexture?G.imageAtlasTexture.size:[0,0],Mt=G.imageAtlasTexture?G.imageAtlasTexture:null,Et=ct||e.options.rotating||e.options.zooming||tt.kind==="composite"||tt.kind==="camera"?v.LINEAR:v.NEAREST);else{const or=n.layout.get("icon-size").constantOr(0)!==1||Q.iconsNeedLinear;wt=G.imageAtlasTexture?G.imageAtlasTexture:null,bt=Y||e.options.rotating||e.options.zooming||or||ct?v.LINEAR:v.NEAREST,dt=G.imageAtlasTexture?G.imageAtlasTexture.size:[0,0]}const qt=Q.projection.name==="globe",Jt=qt?H:j,ne=qt?$r(w.zoom):0,se=iA($,Q.getProjection(),w),Pe=w.calculatePixelsToTileUnitsMatrix(G),pe=j1(se,G.tileID.canonical,E,A,w,Q.getProjection(),Pe),pn=e.terrain&&E&&S?lt.invert(lt.create(),pe):hI,rn=tS(se,G.tileID.canonical,E,A,w,Q.getProjection(),Pe),Le=z&&Q.hasTextData(),Se=Q.hasIconTextFit()&&Le&&Q.hasIconData();if(S){const or=w.elevation,kn=or?or.getAtTileOffsetFunc($,w.center.lat,w.worldSize,Q.getProjection()):null,mi=QC(se,G.tileID.canonical,E,A,w,Q.getProjection(),Pe);QL(Q,se,e,i,mi,rn,E,h,kn,$)}const _e=S||i&&z||Se,ln=e.translatePosMatrix(se,G,o,s),cn=_e?hI:pe,Je=e.translatePosMatrix(rn,G,o,s,!0),Gn=Q.getProjection().createInversionMatrix(w,$.canonical),Tr=n.paint.get("icon-image-cross-fade").constantOr(0),On=[];e.terrainRenderModeElevated()&&E&&On.push("PITCH_WITH_MAP_TERRAIN"),qt&&(On.push("PROJECTION_GLOBE_VIEW"),_e&&On.push("PROJECTED_POS_ON_VIEWPORT")),Tr>0&&On.push("ICON_TRANSITION"),et.zOffsetVertexBuffer&&On.push("Z_OFFSET");const Xn=Y&&n.paint.get(i?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Dr;Y?Dr=Q.iconsInText?$k(tt.kind,pt,I,E,e,ln,cn,Je,dt,_t,$,ne,R,Gn,Jt,Q.getProjection()):aI(tt.kind,pt,I,E,e,ln,cn,Je,i,dt,!0,$,ne,R,Gn,Jt,Q.getProjection()):(d<1&&On.push("SATURATION"),Dr=sI(tt.kind,pt,I,E,e,ln,cn,Je,i,dt,$,ne,R,Gn,Jt,Q.getProjection(),d,Tr));const Cr={program:e.getOrCreateProgram(eF(Y,i,Q),{config:st,defines:On}),buffers:et,uniformValues:Dr,atlasTexture:wt,atlasTextureIcon:Mt,atlasInterpolation:bt,atlasInterpolationIcon:Et,isSDF:Y,hasHalo:Xn,tile:G,labelPlaneMatrixInv:pn};if(B&&Q.canOverlap){M=!0;const or=et.segments.get();for(const kn of or)V.push({segments:new Cn([kn]),sortKey:kn.sortKey,state:Cr})}else V.push({segments:et.segments,sortKey:0,state:Cr})}M&&V.sort(($,G)=>$.sortKey-G.sortKey);for(const $ of V){const G=$.state;if(e.terrain&&e.terrain.setupElevationDraw(G.tile,G.program,{useDepthForOcclusion:w.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:G.labelPlaneMatrixInv}),x.activeTexture.set(v.TEXTURE0),G.atlasTexture&&G.atlasTexture.bind(G.atlasInterpolation,v.CLAMP_TO_EDGE),G.atlasTextureIcon&&(x.activeTexture.set(v.TEXTURE1),G.atlasTextureIcon&&G.atlasTextureIcon.bind(G.atlasInterpolationIcon,v.CLAMP_TO_EDGE)),e.uploadCommonLightUniforms(e.context,G.program),G.hasHalo){const Q=G.uniformValues;Q.u_is_halo=1,fA(G.buffers,$.segments,n,e,G.program,D,m,g,Q,2),Q.u_is_halo=0}else{if(G.isSDF){const Q=G.uniformValues;G.hasHalo&&(Q.u_is_halo=1,fA(G.buffers,$.segments,n,e,G.program,D,m,g,Q,1)),Q.u_is_halo=0}fA(G.buffers,$.segments,n,e,G.program,D,m,g,G.uniformValues,1)}}}function fA(e,t,n,r,i,o,s,a,c,h){const d=[e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.iconTransitioningVertexBuffer,e.globeExtVertexBuffer,e.zOffsetVertexBuffer];i.draw(r,r.context.gl.TRIANGLES,o,s,a,Qe.disabled,c,n.id,e.layoutVertexBuffer,e.indexBuffer,t,n.paint,r.transform.zoom,e.programConfigurations.get(n.id),d,h)}function dI(e,t,n,r,i,o,s){const a=e.context.gl,c=n.paint.get("fill-pattern"),h=c&&c.constantOr(1);let d,m,g,x,v;s?(m=h&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",d=a.LINES):(m=h?"fillPattern":"fill",d=a.TRIANGLES);for(const w of r){const A=t.getTile(w);if(h&&!A.patternsLoaded())continue;const E=A.getBucket(n);if(!E)continue;e.prepareDrawTile();const S=E.programConfigurations.get(n.id),I=e.isTileAffectedByFog(w),B=e.getOrCreateProgram(m,{config:S,overrideFog:I});h&&(e.context.activeTexture.set(a.TEXTURE0),A.imageAtlasTexture&&A.imageAtlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),S.updatePaintBuffers());const M=c.constantOr(null);if(M&&A.imageAtlas){const z=A.imageAtlas.patternPositions[M.toString()];z&&S.setConstantPatternPositions(z)}const D=e.translatePosMatrix(w.projMatrix,A,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor")),R=n.paint.get("fill-emissive-strength");if(s){x=E.indexBuffer2,v=E.segments2;const z=e.terrain&&e.terrain.renderingToTexture?e.terrain.drapeBufferSize:[a.drawingBufferWidth,a.drawingBufferHeight];g=m==="fillOutlinePattern"&&h?Gk(D,R,e,A,z):Vk(D,R,z)}else x=E.indexBuffer,v=E.segments,g=h?nI(D,R,e,A):eI(D,R);e.uploadCommonUniforms(e.context,B,w.toUnwrapped()),B.draw(e,d,i,e.stencilModeForClipping(w),o,Qe.disabled,g,n.id,E.layoutVertexBuffer,x,v,n.paint,e.transform.zoom,S,void 0)}}function cx(e,t,n,r,i,o,s,a){n.resetLayerRenderingStats();const c=e.context,h=c.gl,d=e.transform,m=n.paint.get("fill-extrusion-pattern"),g=m.constantOr(1),x=n.paint.get("fill-extrusion-opacity"),v=e.style.enable3dLights(),w=n.paint.get(v&&!g?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),A=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),w],E=n.layout.get("fill-extrusion-edge-radius"),S=E>0&&!n.paint.get("fill-extrusion-rounded-roof"),I=S?0:E,B=d.projection.name==="globe"?FS():0,M=d.projection.name==="globe",D=M?$r(d.zoom):0,R=[Ir(d.center.lng),Fr(d.center.lat)],z=n.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),N=n.paint.get("fill-extrusion-flood-light-intensity"),V=n.paint.get("fill-extrusion-vertical-scale"),j=Cd(e,n.paint.get("fill-extrusion-cutoff-fade-range")),H=n.paint.get("fill-extrusion-emissive-strength"),$=[];let G;M&&$.push("PROJECTION_GLOBE_VIEW"),A[0]>0&&$.push("FAUX_AO"),S&&$.push("ZERO_ROOF_RADIUS"),a&&$.push("HAS_CENTROID"),N>0&&$.push("FLOOD_LIGHT"),j.shouldRenderCutoff&&$.push("RENDER_CUTOFF");const Q=e.renderPass==="shadow",et=e.shadowRenderer,st=Q&&!!et;e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!0);let Y=[0,0,0];if(et){const pt=e.style.directionalLight,dt=e.style.ambientLight;pt&&dt&&(Y=mA(pt,dt)),G=$.concat(["SHADOWS_SINGLE_CASCADE"])}const tt=st?"fillExtrusionDepth":g?"fillExtrusionPattern":"fillExtrusion",ct=n.getLayerRenderingStats();for(const pt of r){const dt=t.getTile(pt),wt=dt.getBucket(n);if(!wt||wt.projection.name!==d.projection.name)continue;let bt=!1;et&&(bt=et.getMaxCascadeForTile(pt.toUnwrapped())===0);const Et=e.isTileAffectedByFog(pt),_t=wt.programConfigurations.get(n.id),Mt=e.getOrCreateProgram(tt,{config:_t,defines:bt?G:$,overrideFog:Et});if(e.terrain&&e.terrain.setupElevationDraw(dt,Mt,{useMeterToDem:!0}),!wt.centroidVertexBuffer){const pe=Mt.attributes.a_centroid_pos;pe!==void 0&&h.vertexAttrib2f(pe,0,0)}!Q&&et&&et.setupShadows(dt.tileID.toUnwrapped(),Mt,"vector-tile",dt.tileID.overscaledZ),g&&(e.context.activeTexture.set(h.TEXTURE0),dt.imageAtlasTexture&&dt.imageAtlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE),_t.updatePaintBuffers());const qt=m.constantOr(null);if(qt&&dt.imageAtlas){const pe=dt.imageAtlas.patternPositions[qt.toString()];pe&&_t.setConstantPatternPositions(pe)}const Jt=n.paint.get("fill-extrusion-vertical-gradient");let ne;if(Q&&et){if(sF(dt.tileID,wt,e))continue;const pe=et.calculateShadowPassMatrixFromTile(dt.tileID.toUnwrapped());ne=Nk(pe,I,V)}else{const pe=e.translatePosMatrix(pt.expandedProjMatrix,dt,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),pn=d.projection.createInversionMatrix(d,pt.canonical);ne=g?Uk(pe,e,Jt,x,A,I,pt,dt,B,D,R,pn,z,V):tI(pe,e,Jt,x,A,I,pt,B,D,R,pn,z,V,N,Y,H)}e.uploadCommonUniforms(c,Mt,pt.toUnwrapped(),null,j);let se=wt.segments;if(d.projection.name==="mercator"&&!Q&&(se=wt.getVisibleSegments(dt.tileID,e.terrain,e.transform.getFrustum(0)),!se.get().length))continue;if(ct)if(Q)for(const pe of se.get())ct.numRenderedVerticesInShadowPass+=pe.primitiveLength;else for(const pe of se.get())ct.numRenderedVerticesInTransparentPass+=pe.primitiveLength;const Pe=[];(e.terrain||a)&&Pe.push(wt.centroidVertexBuffer),M&&Pe.push(wt.layoutVertexExtBuffer),Mt.draw(e,c.gl.TRIANGLES,i,o,s,Qe.backCCW,ne,n.id,wt.layoutVertexBuffer,wt.indexBuffer,se,n.paint,e.transform.zoom,_t,Pe)}e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!1)}function Md(e,t,n,r,i,o,s,a,c,h,d,m,g,x,v,w,A,E,S){const I=e.context,B=I.gl,M=e.transform,D=e.transform.zoom,R=[],z=Cd(e,n.paint.get("fill-extrusion-cutoff-fade-range"));h==="clear"?(R.push("CLEAR_SUBPASS"),S&&(R.push("CLEAR_FROM_TEXTURE"),I.activeTexture.set(B.TEXTURE0),S.bind(B.LINEAR,B.CLAMP_TO_EDGE))):h==="sdf"&&R.push("SDF_SUBPASS"),A&&R.push("HAS_CENTROID"),z.shouldRenderCutoff&&R.push("RENDER_CUTOFF");const N=n.layout.get("fill-extrusion-edge-radius"),V=(j,H,$,G,Q)=>{const et=H.programConfigurations.get(n.id),st=e.isTileAffectedByFog(j),Y=e.getOrCreateProgram("fillExtrusionGroundEffect",{config:et,defines:R,overrideFog:st}),tt=((pt,dt,wt,bt,Et,_t,Mt,qt,Jt,ne,se)=>({u_matrix:dt,u_opacity:wt,u_ao_pass:bt?1:0,u_meter_to_tile:Et,u_ao:_t,u_flood_light_intensity:Mt,u_flood_light_color:qt,u_attenuation:Jt,u_edge_radius:ne,u_fb:0,u_fb_size:se}))(0,G,d,c,Q,[m,g*Q],x,v,w,D>=17?0:N*Q,S?S.size[0]:0),ct=[];A&&ct.push(H.hiddenByLandmarkVertexBuffer),e.uploadCommonUniforms(I,Y,j.toUnwrapped(),null,z),Y.draw(e,I.gl.TRIANGLES,i,o,s,a,tt,n.id,H.vertexBuffer,H.indexBuffer,$,n.paint,D,et,ct)};for(const j of r){const H=t.getTile(j),$=H.getBucket(n);if(!$||$.projection.name!==M.projection.name||!$.groundEffect||$.groundEffect&&!$.groundEffect.hasData())continue;const G=$.groundEffect,Q=1/$.tileToMeter;{const et=e.translatePosMatrix(j.projMatrix,H,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),st=G.getDefaultSegment();V(j,G,st,et,Q)}if(E)for(let et=0;et<4;et++){const st=Oy[et](j),Y=t.getTile(st);if(!Y)continue;const tt=Y.getBucket(n);if(!tt||tt.projection.name!==M.projection.name||!tt.groundEffect||tt.groundEffect&&!tt.groundEffect.hasData())continue;const ct=tt.groundEffect;let pt,dt;et===0?(pt=[-gt,0,0],dt=1):et===1?(pt=[gt,0,0],dt=0):et===2?(pt=[0,-gt,0],dt=3):(pt=[0,gt,0],dt=2);const wt=ct.regionSegments[dt];if(!wt)continue;const bt=new Float32Array(16);lt.translate(bt,j.projMatrix,pt),V(j,ct,wt,e.translatePosMatrix(bt,H,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),Q)}}}function nF(e,t,n,r,i,o,s){r.centroidVertexArray.length===0&&r.createCentroidsBuffer();const a=o?o.findDEMTileFor(n):null;if(!(a&&a.dem||s))return;const c=E=>{const S=t.getSource().minzoom,I=M=>{const D=t.getTileByID(M);if(D&&D.hasData())return D.getBucket(i)},B=[0,-1,1];for(const M of B){if(E.overscaledZ+M<S)continue;const D=I(E.calculateScaledKey(E.overscaledZ+M));if(D)return D}},h=[0,0,0],d=(E,S)=>(h[0]=Math.min(E.min.y,S.min.y),h[1]=Math.max(E.max.y,S.max.y),h[2]=gt-S.min.x>E.max.x?S.min.x-gt:E.max.x,h),m=(E,S)=>(h[0]=Math.min(E.min.x,S.min.x),h[1]=Math.max(E.max.x,S.max.x),h[2]=gt-S.min.y>E.max.y?S.min.y-gt:E.max.y,h),g=[(E,S)=>d(E,S),(E,S)=>d(S,E),(E,S)=>m(E,S),(E,S)=>m(S,E)],x=(E,S,I,B,M,D,R)=>{if(!o)return 0;const z=[[D?I:E,D?E:I,0],[D?I:S,D?S:I,0]],N=R<0?gt+R:R,V=[D?N:(E+S)/2,D?(E+S)/2:N,0];return I===0&&R<0||I!==0&&R>0?o.getForTilePoints(M,[V],!0,B):z.push(V),o.getForTilePoints(n,z,!0,a),Math.max(z[0][2],z[1][2],V[2])/o.exaggeration()};for(let E=0;E<4;E++){const S=r.borderFeatureIndices[E];if(S.length===0)continue;const I=Oy[E](n),B=c(I);if(!(B&&B instanceof Bg)||r.borderDoneWithNeighborZ[E]===B.canonical.z)continue;B.centroidVertexArray.length===0&&B.createCentroidsBuffer();const M=o?o.findDEMTileFor(I):null;if(!(M&&M.dem||s))continue;const D=(E<2?1:5)-E,R=B.borderDoneWithNeighborZ[D]!==r.canonical.z,z=B.borderFeatureIndices[D];let N=0;if(r.canonical.z!==B.canonical.z){for(const V of S)r.showCentroid(r.featuresOnBorder[V]);if(R)for(const V of z)B.showCentroid(B.featuresOnBorder[V]);r.borderDoneWithNeighborZ[E]=B.canonical.z,B.borderDoneWithNeighborZ[D]=r.canonical.z}for(const V of S){const j=r.featuresOnBorder[V],H=r.centroidData[j.centroidDataIndex],$=j.borders[E];let G;for(;N<z.length;){G=B.featuresOnBorder[z[N]];const Q=G.borders[D];if(Q[1]>$[0]+3||Q[0]>$[0]-3)break;B.showCentroid(G),N++}if(G&&N<z.length){const Q=N;let et=0;for(;!(G.borders[D][0]>$[1]-3)&&(et++,++N!==z.length);)G=B.featuresOnBorder[z[N]];if(G=B.featuresOnBorder[z[Q]],et>1){const tt=G.borders[D];Math.abs($[0]-tt[0])<3&&Math.abs($[1]-tt[1])<3&&(et=1,N=Q+1)}else if(et===0){r.showCentroid(j);continue}const st=B.centroidData[G.centroidDataIndex];s&&et===1&&(((w=H).flags|(A=st).flags)&tl?(w.flags|=tl,A.flags|=tl):(w.flags&=2147483647,A.flags&=2147483647));let Y=new nt(0,0);if(et>1)N=Q;else if(M&&M.dem&&!(j.intersectsCount()>1||G.intersectsCount()>1)){const tt=g[E](H,st),ct=E%2?gt-1:0;v=x(tt[0],Math.min(gt-1,tt[1]),ct,M,I,E<2,tt[2]),Y=new nt(Math.ceil(7*(v+450)),0)}H.centroidXY=st.centroidXY=Y,r.writeCentroidToBuffer(H),B.writeCentroidToBuffer(st)}else r.showCentroid(j)}r.borderDoneWithNeighborZ[E]=B.canonical.z,B.borderDoneWithNeighborZ[D]=r.canonical.z}var v,w,A;(r.needsCentroidUpdate||!r.centroidVertexBuffer&&r.centroidVertexArray.length!==0)&&r.uploadCentroid(e)}const rF=[1,0,0],iF=[0,1,0],oF=[0,0,1];function sF(e,t,n){const r=n.transform,i=n.shadowRenderer;if(!i)return!0;const o=e.toUnwrapped(),s=r.tileSize*i._cascades[n.currentShadowCascade].scale;let a=t.maxHeight;if(r.elevation){const w=r.elevation.getMinMaxForTile(e);w&&(a+=w.max)}const c=[...i.shadowDirection];c[2]=-c[2];const h=i.computeSimplifiedTileShadowVolume(o,a,s,c);if(!h)return!1;const d=[rF,iF,oF,c,[c[0],0,c[2]],[0,c[1],c[2]]],m=r.projection.name==="globe",g=r.scaleZoom(s),x=Rs.fromInvProjectionMatrix(r.invProjMatrix,r.worldSize,g,!m),v=i.getCurrentCascadeFrustum();return x.intersectsPrecise(h.vertices,h.planes,d)===0||v.intersectsPrecise(h.vertices,h.planes,d)===0}function aF(e){const t=e._nearZ,n=e.projection.farthestPixelDistance(e),r=n-t,i=.2*e.height,o=t+i;return[t,n,(o-i-t)/r,(o-t)/r]}const lF=new Me(1,0,0,1),uF=new Me(0,1,0,1),cF=new Me(0,0,1,1),hF=new Me(1,0,1,1),fF=new Me(0,1,1,1);function dF(e,t,n){const r=e.context,i=e.transform,o=r.gl,s=i.projection.name==="globe",a=s?["PROJECTION_GLOBE_VIEW"]:[];let c=n.projMatrix;if(s&&$r(i.zoom)>0){const V=Ri(Uy(n.canonical,i));c=lt.multiply(new Float32Array(16),i.globeMatrix,V),lt.multiply(c,i.projMatrix,c)}const h=e.getOrCreateProgram("debug",{defines:a}),d=t.getTileByID(n.key);e.terrain&&e.terrain.setupElevationDraw(d,h);const m=De.disabled,g=Ke.disabled,x=e.colorModeForRenderPass(),v="$debug";r.activeTexture.set(o.TEXTURE0),e.emptyTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),s?d._makeGlobeTileDebugBuffers(e.context,i):d._makeDebugTileBoundsBuffers(e.context,i.projection);const w=d._tileDebugBuffer||e.debugBuffer,A=d._tileDebugIndexBuffer||e.debugIndexBuffer,E=d._tileDebugSegments||e.debugSegments;h.draw(e,o.LINE_STRIP,m,g,x,Qe.disabled,rI(c,Me.red),v,w,A,E,null,null,null,[d._globeTileDebugBorderBuffer]);const S=d.latestRawTileData,I=Math.floor((S&&S.byteLength||0)/1024),B=t.getTile(n).tileSize,M=512/Math.min(B,512)*(n.overscaledZ/i.zoom)*.5;let D=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(D+=` => ${n.overscaledZ}`),D+=` ${I}kb`,function(V,j){V.initDebugOverlayCanvas();const H=V.debugOverlayCanvas,$=V.context.gl,G=V.debugOverlayCanvas.getContext("2d");G.clearRect(0,0,H.width,H.height),G.shadowColor="white",G.shadowBlur=2,G.lineWidth=1.5,G.strokeStyle="white",G.textBaseline="top",G.font="bold 36px Open Sans, sans-serif",G.fillText(j,5,5),G.strokeText(j,5,5),V.debugOverlayTexture.update(H),V.debugOverlayTexture.bind($.LINEAR,$.CLAMP_TO_EDGE)}(e,D);const R=d._tileDebugTextBuffer||e.debugBuffer,z=d._tileDebugTextIndexBuffer||e.quadTriangleIndexBuffer,N=d._tileDebugTextSegments||e.debugSegments;h.draw(e,o.TRIANGLES,m,g,xn.alphaBlended,Qe.disabled,rI(c,Me.transparent,M),v,R,z,N,null,null,null,[d._globeTileDebugTextBuffer])}function pI(e,t,n,r){hx(e,0,t+n/2,e.transform.width,n,r)}function mI(e,t,n,r){hx(e,t-n/2,0,n,e.transform.height,r)}function hx(e,t,n,r,i,o){const s=e.context,a=s.gl;a.enable(a.SCISSOR_TEST),a.scissor(t*ze.devicePixelRatio,n*ze.devicePixelRatio,r*ze.devicePixelRatio,i*ze.devicePixelRatio),s.clear({color:o}),a.disable(a.SCISSOR_TEST)}const pF=wn([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:mF}=pF;function sc(e,t,n,r){e.emplaceBack(t,n,r)}class gI{constructor(t){this.vertexArray=new Ur,this.indices=new ur,sc(this.vertexArray,-1,-1,1),sc(this.vertexArray,1,-1,1),sc(this.vertexArray,-1,1,1),sc(this.vertexArray,1,1,1),sc(this.vertexArray,-1,-1,-1),sc(this.vertexArray,1,-1,-1),sc(this.vertexArray,-1,1,-1),sc(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,mF),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=Cn.simpleSegment(0,0,36,12)}}function Id(e,t,n,r,i,o){const s=e.context.gl,a=t.paint.get("sky-atmosphere-color"),c=t.paint.get("sky-atmosphere-halo-color"),h=t.paint.get("sky-atmosphere-sun-intensity"),d=((m,g,x,v,w)=>({u_matrix_3f:m,u_sun_direction:g,u_sun_intensity:x,u_color_tint_r:[v.r,v.g,v.b,v.a],u_color_tint_m:[w.r,w.g,w.b,w.a],u_luminance:5e-5}))(Ki.fromMat4(Ki.create(),r),i,h,a,c);s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+o,t.skyboxTexture,0),n.draw(e,s.TRIANGLES,De.disabled,Ke.disabled,xn.unblended,Qe.frontCW,d,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const gF=wn([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class _F{constructor(t){const n=new vo;n.emplaceBack(-1,1,1,0,0),n.emplaceBack(1,1,1,1,0),n.emplaceBack(1,-1,1,1,1),n.emplaceBack(-1,-1,1,0,1);const r=new ur;r.emplaceBack(0,1,2),r.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(n,gF.members),this.indexBuffer=t.createIndexBuffer(r),this.segments=Cn.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const yF=wn([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class xF{constructor(){this.colorModeAlphaBlendedWriteRGB=new xn([1,V1,1,V1],Me.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new xn([1,0,1,0],Me.transparent,[!1,!1,!1,!0])}update(t){const n=t.context;if(!this.atmosphereBuffer){this.atmosphereBuffer=new _F(n);const r=100,i=200,o=function(d){const m=Zp(30),g=[];for(let x=0;x<16e3;++x){const v=2*Math.PI*m(),w=Math.acos(1-2*m())-.5*Math.PI;g.push(J.fromValues(Math.cos(w)*Math.cos(v),Math.cos(w)*Math.sin(v),Math.sin(w)))}return g}(),s=Zp(300),a=new ym,c=new ur;let h=0;for(let d=0;d<o.length;++d){const m=J.scale([],o[d],200),g=Math.max(0,1+.01*r*(1*s()-.5)),x=Math.max(0,1+.01*i*(1*s()-.5));a.emplaceBack(m[0],m[1],m[2],-1,-1,g,x),a.emplaceBack(m[0],m[1],m[2],1,-1,g,x),a.emplaceBack(m[0],m[1],m[2],1,1,g,x),a.emplaceBack(m[0],m[1],m[2],-1,1,g,x),c.emplaceBack(h+0,h+1,h+2),c.emplaceBack(h+0,h+2,h+3),h+=4}this.starsVx=n.createVertexBuffer(a,yF.members),this.starsIdx=n.createIndexBuffer(c),this.starsSegments=Cn.simpleSegment(0,0,a.length,c.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,n){const r=t.context,i=r.gl,o=t.transform,s=new De(i.LEQUAL,De.ReadOnly,[0,1]),a=$r(o.zoom),c=n.properties.get("color").toArray01(),h=n.properties.get("high-color").toArray01(),d=n.properties.get("space-color").toArray01PremultipliedAlpha(),m=5e-4,g=$t((n.properties.get("horizon-blend")-0)/1*.2495+m,5e-4,.25),x=Wy(t,r,o)&&g===m?o.worldSize/(2*Math.PI*1.025)-1:o.globeRadius,v=t.frameCounter/1e3%1,w=J.length(o.globeCenterInViewSpace),A=Math.sqrt(Math.pow(w,2)-Math.pow(x,2)),E=Math.acos(A/w),S=I=>{const B=o.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];I&&B.push("ALPHA_PASS");const M=t.getOrCreateProgram("globeAtmosphere",{defines:B}),D=((z,N,V,j,H,$,G,Q,et,st,Y,tt)=>({u_frustum_tl:z,u_frustum_tr:N,u_frustum_br:V,u_frustum_bl:j,u_horizon:H,u_transition:$,u_fadeout_range:G,u_color:Q,u_high_color:et,u_space_color:st,u_temporal_offset:Y,u_horizon_angle:tt}))(o.frustumCorners.TL,o.frustumCorners.TR,o.frustumCorners.BR,o.frustumCorners.BL,o.frustumCorners.horizon,a,g,c,h,d,v,E);t.uploadCommonUniforms(r,M);const R=this.atmosphereBuffer;R&&M.draw(t,i.TRIANGLES,s,Ke.disabled,I?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Qe.backCW,D,I?"atmosphere_glow_alpha":"atmosphere_glow",R.vertexBuffer,R.indexBuffer,R.segments)};S(!1),S(!0)}drawStars(t,n){const r=$t(n.properties.get("star-intensity"),0,1);if(r===0)return;const i=t.context,o=i.gl,s=t.transform,a=t.getOrCreateProgram("stars"),c=En.identity([]);En.rotateX(c,c,-s._pitch),En.rotateZ(c,c,-s.angle),En.rotateX(c,c,Ae(s._center.lat)),En.rotateY(c,c,-Ae(s._center.lng));const h=lt.fromQuat(new Float32Array(16),c),d=lt.multiply([],s.starsProjMatrix,h),m=Ki.fromMat4([],h),g=Ki.invert([],m),x=[0,1,0];J.transformMat3(x,x,g),J.scale(x,x,.15);const v=[1,0,0];J.transformMat3(v,v,g),J.scale(v,v,.15);const w=((A,E,S,I)=>({u_matrix:Float32Array.from(A),u_up:E,u_right:S,u_intensity_multiplier:I}))(d,x,v,r);t.uploadCommonUniforms(i,a),this.starsVx&&this.starsIdx&&a.draw(t,o.TRIANGLES,De.disabled,Ke.disabled,this.colorModeAlphaBlendedWriteRGB,Qe.disabled,w,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function _I(e,t){const n=[...e],r=t.cameraWorldSizeForFog/t.worldSize,i=lt.identity([]);return lt.scale(i,i,[r,r,1]),lt.multiply(n,i,n),lt.multiply(n,t.worldToFogMatrix,n),n}function dA(e,t,n,r){const i=n.material,o=r.context,{baseColorTexture:s,metallicRoughnessTexture:a}=i.pbrMetallicRoughness,{normalTexture:c,occlusionTexture:h,emissionTexture:d}=i;function m(g,x,v){if(g&&(e.push(x),o.activeTexture.set(o.gl.TEXTURE0+v),g.gfxTexture)){const{minFilter:w,magFilter:A,wrapS:E,wrapT:S}=g.sampler;g.gfxTexture.bindExtraParam(w,A,E,S)}}m(s,"HAS_TEXTURE_u_baseColorTexture",Ho.BaseColor),m(a,"HAS_TEXTURE_u_metallicRoughnessTexture",Ho.MetallicRoughness),m(c,"HAS_TEXTURE_u_normalTexture",Ho.Normal),m(h,"HAS_TEXTURE_u_occlusionTexture",Ho.Occlusion),m(d,"HAS_TEXTURE_u_emissionTexture",Ho.Emission),n.texcoordBuffer&&(e.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(n.texcoordBuffer)),n.colorBuffer&&(e.push(n.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(n.colorBuffer)),n.normalBuffer&&(e.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(n.normalBuffer)),n.pbrBuffer&&(e.push("HAS_ATTRIBUTE_a_pbr"),e.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(n.pbrBuffer)),i.alphaMode!=="OPAQUE"&&i.alphaMode!=="MASK"||e.push("UNPREMULT_TEXTURE_IN_SHADER"),i.defined||e.push("DIFFUSE_SHADED"),e.push("USE_STANDARD_DERIVATIVES")}function fx(e,t,n,r,i,o){const s=n.paint.get("model-opacity"),a=t.context,c=new De(t.context.gl.LEQUAL,De.ReadWrite,t.depthRangeFor3D),h=t.transform,d=e.mesh,m=d.material,g=m.pbrMetallicRoughness,x=t.style.fog;let v;v=t.transform.projection.zAxisUnit==="pixels"?[...e.nodeModelMatrix]:lt.multiply([],r.zScaleMatrix,e.nodeModelMatrix),lt.multiply(v,r.negCameraPosMatrix,v);const w=lt.invert([],v);lt.transpose(w,w);const A=n.paint.get("model-emissive-strength").constantOr(0),E=hA(new Float32Array(e.worldViewProjection),new Float32Array(v),new Float32Array(w),t,s,g.baseColorFactor,m.emissiveFactor,g.metallicFactor,g.roughnessFactor,m,A,n),S={defines:[]},I=[];dA(S.defines,I,d,t);const B=t.shadowRenderer;B&&(B.useNormalOffset=!1);let M=null;if(x){const z=_I(e.nodeModelMatrix,t.transform);if(M=new Float32Array(z),h.projection.name!=="globe"){const N=d.aabb.min,V=d.aabb.max,[j,H]=x.getOpacityForBounds(z,N[0],N[1],V[0],V[1]);S.overrideFog=j>=Mh||H>=Mh}}const D=Cd(t,n.paint.get("model-cutoff-fade-range"));D.shouldRenderCutoff&&S.defines.push("RENDER_CUTOFF");const R=t.getOrCreateProgram("model",S);t.uploadCommonUniforms(a,R,null,M,D),t.renderPass!=="shadow"&&B&&B.setupShadowsFromMatrix(e.nodeModelMatrix,R),R.draw(t,a.gl.TRIANGLES,c,i,o,d.material.doubleSided?Qe.disabled:Qe.backCCW,E,n.id,d.vertexBuffer,d.indexBuffer,d.segments,n.paint,t.transform.zoom,void 0,I)}function yI(e,t,n,r,i,o,s){let a;a=e.projection.name==="globe"?hS(n,e):[...n],lt.multiply(a,a,t.matrix);const c=lt.multiply([],r,a);if(t.meshes)for(const h of t.meshes){if(h.material.alphaMode!=="BLEND"){s.push({mesh:h,depth:0,modelIndex:i,worldViewProjection:c,nodeModelMatrix:a});continue}const d=J.transformMat4([],h.centroid,c);d[2]>0&&o.push({mesh:h,depth:d[2],modelIndex:i,worldViewProjection:c,nodeModelMatrix:a})}if(t.children)for(const h of t.children)yI(e,h,n,r,i,o,s)}function pA(e,t,n,r){const i=n.shadowRenderer;if(!i)return;const o=i.getShadowPassDepthMode(),s=i.getShadowPassColorMode(),a=i.calculateShadowPassMatrixFromMatrix(t),c=uI(a);n.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(n,n.context.gl.TRIANGLES,o,Ke.disabled,s,Qe.backCCW,c,r.id,e.vertexBuffer,e.indexBuffer,e.segments,r.paint,n.transform.zoom,void 0,void 0)}function vF(e,t,n){const r=t.updateZoomBasedPaintProperties(),i=function(o,s,a){let c,h,d,m=o.terrain?o.terrain.exaggeration():0;if(o.terrain&&m>0){const g=o.terrain,x=g.findDEMTileFor(a);x&&x.dem?c=md.create(g,a,x):m=0}if(m===0&&(s.terrainElevationMin=0,s.terrainElevationMax=0),m===s.validForExaggeration&&(m===0||c&&c._demTile&&c._demTile.tileID===s.validForDEMTile.id&&c._dem._timestamp===s.validForDEMTile.timestamp))return!1;for(const g in s.instancesPerModel){const x=s.instancesPerModel[g];for(let v=0;v<x.instancedDataArray.length;++v){const w=(c?m*c.getElevationAt(0|x.instancedDataArray.float32[16*v],0|x.instancedDataArray.float32[16*v+1],!0,!0):0)+x.instancesEvaluatedElevation[v];x.instancedDataArray.float32[16*v+6]=w,h=h?Math.min(s.terrainElevationMin,w):w,d=d?Math.max(s.terrainElevationMax,w):w}}return s.terrainElevationMin=h||0,s.terrainElevationMax=d||0,s.validForExaggeration=m,s.validForDEMTile=c&&c._demTile?{id:c._demTile.tileID,timestamp:c._dem._timestamp}:{id:void 0,timestamp:0},!0}(e,t,n);(r||i)&&(t.uploaded=!1,t.upload(e.context))}const nl={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new yn([0,0,0],[gt,gt,0])};function wF(e,t){const n=1<<e.canonical.z,r=t.getFreeCameraOptions().position,i=t.elevation,o=e.canonical.x/n,s=(e.canonical.x+1)/n,a=e.canonical.y/n,c=(e.canonical.y+1)/n;let h=t._centerAltitude;if(i){const x=i.getMinMaxForTile(e);x&&x.max>h&&(h=x.max)}const d=$t(r.x,o,s)-r.x,m=$t(r.y,a,c)-r.y,g=Rn(h,t.center.lat)-r.z;return t._zoomFromMercatorZ(Math.sqrt(d*d+m*m+g*g))}function xI(e,t,n,r,i,o,s){const a=e.context,c=e.renderPass==="shadow",h=e.shadowRenderer,d=c&&h?h.getShadowPassDepthMode():new De(a.gl.LEQUAL,De.ReadWrite,e.depthRangeFor3D),m=e.isTileAffectedByFog(o);if(n.meshes)for(const g of n.meshes){const x=["MODEL_POSITION_ON_GPU"],v=[];let w,A,E;r.instancedDataArray.length>20&&x.push("INSTANCED_ARRAYS");const S=Cd(e,t.paint.get("model-cutoff-fade-range"));if(S.shouldRenderCutoff&&x.push("RENDER_CUTOFF"),c&&h)w=e.getOrCreateProgram("modelDepth",{defines:x}),A=uI(s.shadowTileMatrix,s.shadowTileMatrix,Float32Array.from(n.matrix)),E=h.getShadowPassColorMode();else{dA(x,v,g,e),w=e.getOrCreateProgram("model",{defines:x,overrideFog:m});const B=g.material,M=B.pbrMetallicRoughness,D=t.paint.get("model-opacity"),R=t.paint.get("model-emissive-strength").constantOr(0);A=hA(o.expandedProjMatrix,Float32Array.from(n.matrix),new Float32Array(16),e,D,M.baseColorFactor,B.emissiveFactor,M.metallicFactor,M.roughnessFactor,B,R,t,i),h&&(s.shadowUniformsInitialized?w.setShadowUniformValues(a,h.getShadowUniformValues()):(h.setupShadows(o.toUnwrapped(),w,"model-tile",o.overscaledZ),s.shadowUniformsInitialized=!0)),E=S.shouldRenderCutoff||D<1||B.alphaMode!=="OPAQUE"?xn.alphaBlended:xn.unblended}e.uploadCommonUniforms(a,w,o.toUnwrapped(),null,S);const I=g.material.doubleSided?Qe.disabled:Qe.backCCW;if(r.instancedDataArray.length>20)v.push(r.instancedDataBuffer),w.draw(e,a.gl.TRIANGLES,d,Ke.disabled,E,I,A,t.id,g.vertexBuffer,g.indexBuffer,g.segments,t.paint,e.transform.zoom,void 0,v,r.instancedDataArray.length);else{const B=c?"u_instance":"u_normal_matrix";for(let M=0;M<r.instancedDataArray.length;++M)A[B]=new Float32Array(r.instancedDataArray.arrayBuffer,64*M,16),w.draw(e,a.gl.TRIANGLES,d,Ke.disabled,E,I,A,t.id,g.vertexBuffer,g.indexBuffer,g.segments,t.paint,e.transform.zoom,void 0,v)}}if(n.children)for(const g of n.children)xI(e,t,g,r,i,o,s)}const bF=[1,-1,1];function AF(e,t,n,r){if(!n.modelManager)return!0;const i=n.modelManager;if(!n.shadowRenderer)return!0;const o=n.shadowRenderer,s=t.aabb;let a=!0,c=e.maxHeight;if(c===0){let d=0;for(const m in e.instancesPerModel){const g=i.getModel(m,r);g?d=Math.max(d,Math.max(Math.max(g.aabb.max[0],g.aabb.max[1]),g.aabb.max[2])):a=!1}c=e.maxScale*d*1.41+e.maxVerticalOffset,a&&(e.maxHeight=c)}s.max[2]=c,s.min[2]+=e.terrainElevationMin,s.max[2]+=e.terrainElevationMax,J.transformMat4(s.min,s.min,t.tileMatrix),J.transformMat4(s.max,s.max,t.tileMatrix);const h=s.intersects(o.getCurrentCascadeFrustum());return n.currentShadowCascade===0&&(e.isInsideFirstShadowMapFrustum=h===2),h===0}class EF{}class TF{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,n,r){{const m=this._storage.get(n.id);if(m)return m.lastUsedFrameIdx=t,m.buf}const i=r.gl,o=i.getBufferParameter(i.ELEMENT_ARRAY_BUFFER,i.BUFFER_SIZE),s=new ArrayBuffer(o),a=new Int16Array(s);i.getBufferSubData(i.ELEMENT_ARRAY_BUFFER,0,new Int16Array(s));const c=new Pi;for(let m=0;m<o/2;m+=3){const g=a[m],x=a[m+1],v=a[m+2];c.emplaceBack(g,x),c.emplaceBack(x,v),c.emplaceBack(v,g)}const h=r.bindVertexArrayOES.current,d=new EF;return d.buf=new rc(r,c),d.lastUsedFrameIdx=t,this._storage.set(n.id,d),r.bindVertexArrayOES.set(h),d.buf}update(t){for(const[n,r]of this._storage)t-r.lastUsedFrameIdx>30&&(r.buf.destroy(),this._storage.delete(n))}destroy(){for(const[t,n]of this._storage)n.buf.destroy(),this._storage.delete(t)}}const vI={symbol:function(e,t,n,r,i){if(e.renderPass!=="translucent")return;const o=Ke.disabled,s=e.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(a,c,h,d,m,g,x){const v=c.transform,w=m==="map",A=g==="map";for(const E of a){const S=d.getTile(E),I=S.getBucket(h);if(!I||!I.text||!I.text.segments.get().length)continue;const B=Xa(I.textSizeData,v.zoom),M=iA(E,I.getProjection(),v),D=v.calculatePixelsToTileUnitsMatrix(S),R=j1(M,S.tileID.canonical,A,w,v,I.getProjection(),D),z=I.hasIconTextFit()&&I.hasIconData();if(B){const N=Math.pow(2,v.zoom-S.tileID.overscaledZ);tF(I,w,A,x,bP,v,R,E,N,B,z)}}}(r,e,n,t,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),i),n.paint.get("icon-opacity").constantOr(1)!==0&&fI(e,t,n,r,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),n.paint.get("icon-color-saturation"),o,s),n.paint.get("text-opacity").constantOr(1)!==0&&fI(e,t,n,r,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),n.paint.get("icon-color-saturation"),o,s),t.map.showCollisionBoxes&&(cI(e,t,n,r,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),cI(e,t,n,r,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(e,t,n,r){if(e.renderPass!=="translucent")return;const i=n.paint.get("circle-opacity"),o=n.paint.get("circle-stroke-width"),s=n.paint.get("circle-stroke-opacity"),a=n.layout.get("circle-sort-key").constantOr(1)!==void 0,c=n.paint.get("circle-emissive-strength");if(i.constantOr(1)===0&&(o.constantOr(1)===0||s.constantOr(1)===0))return;const h=e.context,d=h.gl,m=e.transform,g=e.depthModeForSublayer(0,De.ReadOnly),x=Ke.disabled,v=e.colorModeForDrapableLayerRenderPass(c),w=m.projection.name==="globe",A=[Ir(m.center.lng),Fr(m.center.lat)],E=[];for(let I=0;I<r.length;I++){const B=r[I],M=t.getTile(B),D=M.getBucket(n);if(!D||D.projection.name!==m.projection.name)continue;const R=D.programConfigurations.get(n.id),z=a1(n),N=e.isTileAffectedByFog(B);w&&z.push("PROJECTION_GLOBE_VIEW");const V=e.getOrCreateProgram("circle",{config:R,defines:z,overrideFog:N}),j=D.layoutVertexBuffer,H=D.globeExtVertexBuffer,$=D.indexBuffer,G=m.projection.createInversionMatrix(m,B.canonical),Q={programConfiguration:R,program:V,layoutVertexBuffer:j,globeExtVertexBuffer:H,indexBuffer:$,uniformValues:hg(e,B,M,G,A,n),tile:M};if(a){const et=D.segments.get();for(const st of et)E.push({segments:new Cn([st]),sortKey:st.sortKey,state:Q})}else E.push({segments:D.segments,sortKey:0,state:Q})}a&&E.sort((I,B)=>I.sortKey-B.sortKey);const S={useDepthForOcclusion:m.depthOcclusionForSymbolsAndCircles};for(const I of E){const{programConfiguration:B,program:M,layoutVertexBuffer:D,globeExtVertexBuffer:R,indexBuffer:z,uniformValues:N,tile:V}=I.state,j=I.segments;e.terrain&&e.terrain.setupElevationDraw(V,M,S),e.uploadCommonUniforms(h,M,V.tileID.toUnwrapped()),M.draw(e,d.TRIANGLES,g,x,v,Qe.disabled,N,n.id,D,z,j,n.paint,m.zoom,B,[R])}},heatmap:function(e,t,n,r){if(n.paint.get("heatmap-opacity")!==0)if(e.renderPass==="offscreen"){const i=e.context,o=i.gl,s=Ke.disabled,a=new xn([o.ONE,o.ONE,o.ONE,o.ONE],Me.transparent,[!0,!0,!0,!0]);(function(x,v,w,A){const E=x.gl,S=v.width*A,I=v.height*A;x.activeTexture.set(E.TEXTURE1),x.viewport.set([0,0,S,I]);let B=w.heatmapFbo;if(!B||B&&(B.width!==S||B.height!==I)){B&&B.destroy();const M=E.createTexture();E.bindTexture(E.TEXTURE_2D,M),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,E.LINEAR),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,E.LINEAR),B=w.heatmapFbo=x.createFramebuffer(S,I,!0,null),function(D,R,z,N,V,j){const H=D.gl;H.texImage2D(H.TEXTURE_2D,0,D.extRenderToTextureHalfFloat?H.RGBA16F:H.RGBA,V,j,0,H.RGBA,D.extRenderToTextureHalfFloat?H.HALF_FLOAT:H.UNSIGNED_BYTE,null),N.colorAttachment.set(z)}(x,0,M,B,S,I)}else E.bindTexture(E.TEXTURE_2D,B.colorAttachment.get()),x.bindFramebuffer.set(B.framebuffer)})(i,e,n,e.transform.projection.name==="globe"?.5:.25),i.clear({color:Me.transparent});const c=e.transform,h=c.projection.name==="globe",d=h?["PROJECTION_GLOBE_VIEW"]:[],m=h?Qe.frontCCW:Qe.disabled,g=[Ir(c.center.lng),Fr(c.center.lat)];for(let x=0;x<r.length;x++){const v=r[x];if(t.hasRenderableParent(v))continue;const w=t.getTile(v),A=w.getBucket(n);if(!A||A.projection.name!==c.projection.name)continue;const E=e.isTileAffectedByFog(v),S=A.programConfigurations.get(n.id),I=e.getOrCreateProgram("heatmap",{config:S,defines:d,overrideFog:E}),{zoom:B}=e.transform;e.terrain&&e.terrain.setupElevationDraw(w,I),e.uploadCommonUniforms(i,I,v.toUnwrapped());const M=c.projection.createInversionMatrix(c,v.canonical);I.draw(e,o.TRIANGLES,De.disabled,s,a,m,Zk(e,v,w,M,g,B,n.paint.get("heatmap-intensity")),n.id,A.layoutVertexBuffer,A.indexBuffer,A.segments,n.paint,e.transform.zoom,S,h?[A.globeExtVertexBuffer]:null)}i.viewport.set([0,0,e.width,e.height])}else e.renderPass==="translucent"&&(e.context.setColorMode(e.colorModeForRenderPass()),function(i,o){const s=i.context,a=s.gl,c=o.heatmapFbo;if(!c)return;s.activeTexture.set(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,c.colorAttachment.get()),s.activeTexture.set(a.TEXTURE1);let h=o.colorRampTexture;h||(h=o.colorRampTexture=new _r(s,o.colorRamp,a.RGBA)),h.bind(a.LINEAR,a.CLAMP_TO_EDGE),i.getOrCreateProgram("heatmapTexture").draw(i,a.TRIANGLES,De.disabled,Ke.disabled,i.colorModeForRenderPass(),Qe.disabled,((d,m,g,x)=>({u_image:0,u_color_ramp:1,u_opacity:m.paint.get("heatmap-opacity")}))(0,o),o.id,i.viewportBuffer,i.quadTriangleIndexBuffer,i.viewportSegments,o.paint,i.transform.zoom)}(e,n))},line:function(e,t,n,r){if(e.renderPass!=="translucent")return;const i=n.paint.get("line-opacity"),o=n.paint.get("line-width");if(i.constantOr(1)===0||o.constantOr(1)===0)return;const s=n.paint.get("line-emissive-strength"),a=e.depthModeForSublayer(0,De.ReadOnly),c=e.colorModeForDrapableLayerRenderPass(s),h=e.terrain&&e.terrain.renderingToTexture?1:ze.devicePixelRatio,d=n.paint.get("line-dasharray"),m=d.constantOr(1),g=n.layout.get("line-cap"),x=n.paint.get("line-pattern"),v=x.constantOr(1),w=n.paint.get("line-pattern").constantOr(1),A=n.paint.get("line-opacity").constantOr(1)!==1;let E=!w&&A;const S=n.paint.get("line-gradient"),I=v?"linePattern":"line",B=e.context,M=B.gl,D=jS(n);e.terrain&&e.terrain.clipOrMaskOverlapStencilType()&&(E=!1);for(const R of r){const z=t.getTile(R);if(v&&!z.patternsLoaded())continue;const N=z.getBucket(n);if(!N)continue;e.prepareDrawTile();const V=N.programConfigurations.get(n.id),j=e.isTileAffectedByFog(R),H=e.getOrCreateProgram(I,{config:V,defines:D,overrideFog:j}),$=x.constantOr(null);if($&&z.imageAtlas){const pt=z.imageAtlas.patternPositions[$.toString()];pt&&V.setConstantPatternPositions(pt)}const G=d.constantOr(null),Q=g.constantOr(null);if(!v&&G&&Q&&z.lineAtlas){const pt=z.lineAtlas.getDash(G,Q);pt&&V.setConstantPatternPositions(pt)}let[et,st]=n.paint.get("line-trim-offset");(Q==="round"||Q==="square")&&et!==st&&(et===0&&(et-=1),st===1&&(st+=1));const Y=e.terrain?R.projMatrix:null,tt=v?wR(e,z,n,Y,h):vR(e,z,n,Y,N.lineClipsArray.length,h,[et,st]);if(S){const pt=N.gradients[n.id];let dt=pt.texture;if(n.gradientVersion!==pt.version){let wt=256;if(n.stepInterpolant){const bt=t.getSource().maxzoom,Et=R.canonical.z===bt?Math.ceil(1<<e.transform.maxZoom-R.canonical.z):1;wt=$t(dl(N.maxLineLength/gt*1024*Et),256,B.maxTextureSize)}pt.gradient=cd({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:wt,image:pt.gradient||void 0,clips:N.lineClipsArray}),pt.texture?pt.texture.update(pt.gradient):pt.texture=new _r(B,pt.gradient,M.RGBA),pt.version=n.gradientVersion,dt=pt.texture}B.activeTexture.set(M.TEXTURE1),dt.bind(n.stepInterpolant?M.NEAREST:M.LINEAR,M.CLAMP_TO_EDGE)}m&&(B.activeTexture.set(M.TEXTURE0),z.lineAtlasTexture&&z.lineAtlasTexture.bind(M.LINEAR,M.REPEAT),V.updatePaintBuffers()),v&&(B.activeTexture.set(M.TEXTURE0),z.imageAtlasTexture&&z.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),V.updatePaintBuffers()),e.uploadCommonUniforms(B,H,R.toUnwrapped());const ct=pt=>{H.draw(e,M.TRIANGLES,a,pt,c,Qe.disabled,tt,n.id,N.layoutVertexBuffer,N.indexBuffer,N.segments,n.paint,e.transform.zoom,V,[N.layoutVertexBuffer2])};if(E){const pt=e.stencilModeForClipping(R).ref;pt===0&&e.terrain&&B.clear({stencil:0});const dt={func:M.EQUAL,mask:255};tt.u_alpha_discard_threshold=.8,ct(new Ke(dt,pt,255,M.KEEP,M.KEEP,M.INVERT)),tt.u_alpha_discard_threshold=0,ct(new Ke(dt,pt,255,M.KEEP,M.KEEP,M.KEEP))}else ct(e.stencilModeForClipping(R))}E&&(e.resetStencilClippingMasks(),e.terrain&&B.clear({stencil:0}))},fill:function(e,t,n,r){const i=n.paint.get("fill-color"),o=n.paint.get("fill-opacity");if(o.constantOr(1)===0)return;const s=n.paint.get("fill-emissive-strength"),a=e.colorModeForDrapableLayerRenderPass(s),c=n.paint.get("fill-pattern"),h=e.opaquePassEnabledForLayer()&&!c.constantOr(1)&&i.constantOr(Me.transparent).a===1&&o.constantOr(0)===1?"opaque":"translucent";if(e.renderPass===h){const d=e.depthModeForSublayer(1,e.renderPass==="opaque"?De.ReadWrite:De.ReadOnly);dI(e,t,n,r,d,a,!1)}if(e.renderPass==="translucent"&&n.paint.get("fill-antialias")){const d=e.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,De.ReadOnly);dI(e,t,n,r,d,a,!0)}},"fill-extrusion":function(e,t,n,r){const i=n.paint.get("fill-extrusion-opacity"),o=e.context,s=o.gl,a=e.terrain,c=a&&a.renderingToTexture,h=n.paint.get("fill-extrusion-cutoff-fade-range");if(i===0)return;const d=e.conflationActive&&e.layerUsedInConflation(n,t.getSource());if(d&&function(m,g,x,v){for(const w of v){const A=g.getTile(w).getBucket(x);A&&(A.updateReplacement(w,m.replacementSource),A.uploadCentroid(m.context))}}(e,t,n,r),a||d)for(const m of r){const g=t.getTile(m).getBucket(n);g&&nF(e.context,t,m,g,n,a,d)}if(e.renderPass==="shadow"&&e.shadowRenderer){const m=e.shadowRenderer;if(a&&i<.65&&n._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof Fo)return;const g=m.getShadowPassDepthMode(),x=m.getShadowPassColorMode();cx(e,t,n,r,g,Ke.disabled,x,d)}else if(e.renderPass==="translucent"){const m=!n.paint.get("fill-extrusion-pattern").constantOr(1);if(!c){const g=new De(e.context.gl.LEQUAL,De.ReadWrite,e.depthRangeFor3D);h===0&&i===1&&m?cx(e,t,n,r,g,Ke.disabled,xn.unblended,d):(cx(e,t,n,r,g,Ke.disabled,xn.disabled,d),cx(e,t,n,r,g,e.stencilModeFor3D(),e.colorModeForRenderPass(),d),e.resetStencilClippingMasks())}if(e.style.enable3dLights()&&m&&(!a&&e.transform.projection.name!=="globe"||c)){const g=n.paint.get("fill-extrusion-opacity"),x=n.paint.get("fill-extrusion-ambient-occlusion-intensity"),v=n.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),w=n.paint.get("fill-extrusion-flood-light-intensity"),A=n.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),E=x>0&&v>0,S=w>0,I=(M,D,R)=>(1-R)*M+R*D,B=M=>{const D=e.depthModeForSublayer(1,De.ReadOnly,s.LEQUAL,!0),R=n.paint.get(M?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),z=I(.1,3,R),N=e._showOverdrawInspector;if(!N){const V=new Ke({func:s.ALWAYS,mask:255},255,255,s.KEEP,s.KEEP,s.REPLACE),j=new xn([s.ONE,s.ONE,s.ONE,s.ONE],Me.transparent,[!1,!1,!1,!0],s.MIN);Md(e,t,n,r,D,V,j,Qe.disabled,M,"sdf",g,x,v,w,A,z,d,!1)}{const V=N?Ke.disabled:new Ke({func:s.EQUAL,mask:255},255,255,s.KEEP,s.DECR,s.DECR),j=N?e.colorModeForRenderPass():new xn([s.ONE_MINUS_DST_ALPHA,s.DST_ALPHA,s.ONE,s.ONE],Me.transparent,[!0,!0,!0,!0]);Md(e,t,n,r,D,V,j,Qe.disabled,M,"color",g,x,v,w,A,z,d,!1)}};if(c){const M=(D,R,z)=>{const N=e.depthModeForSublayer(1,De.ReadOnly,s.LEQUAL,!1),V=n.paint.get(D?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),j=I(.1,3,V);{const H=new xn([s.ONE,s.ONE,s.ONE,s.ONE],Me.transparent,[!1,!1,!1,!0]);Md(e,t,n,r,N,Ke.disabled,H,Qe.disabled,D,"clear",g,x,v,w,A,j,d,R)}{const H=new Ke({func:s.ALWAYS,mask:255},255,255,s.KEEP,s.KEEP,s.REPLACE),$=new xn([s.ONE,s.ONE,s.ONE,s.ONE],Me.transparent,[!1,!1,!1,!0],s.MIN);Md(e,t,n,r,N,H,$,Qe.disabled,D,"sdf",g,x,v,w,A,j,d,R)}{const H=D?s.ZERO:s.ONE_MINUS_DST_ALPHA,$=new Ke({func:s.EQUAL,mask:255},255,255,s.KEEP,s.DECR,s.DECR),G=new xn([H,s.DST_ALPHA,s.ONE_MINUS_DST_ALPHA,s.ZERO],Me.transparent,[!0,!0,!0,!0]);Md(e,t,n,r,N,$,G,Qe.disabled,D,"color",g,x,v,w,A,j,d,R)}{const H=new xn([s.ONE,s.ONE,s.ONE,D?s.ZERO:s.ONE],Me.transparent,[!1,!1,!1,!0],D?s.FUNC_ADD:s.MAX);Md(e,t,n,r,N,Ke.disabled,H,Qe.disabled,D,"clear",g,x,v,w,A,j,d,R,z)}};if(E||S){let D;if(e.prepareDrawTile(),a){const R=a.drapeBufferSize[0],z=a.drapeBufferSize[1];D=a.framebufferCopyTexture,D&&(!D||D.size[0]===R&&D.size[1]===z)||(D&&D.destroy(),D=a.framebufferCopyTexture=new _r(o,new Er({width:R,height:z}),s.RGBA)),D.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,R,z,0)}E&&M(!0,!1,D),S&&M(!1,!0,D)}}else E&&B(!0),S&&B(!1)}}},hillshade:function(e,t,n,r){if(e.renderPass!=="offscreen"&&e.renderPass!=="translucent"||e.style.disableElevatedTerrain)return;const i=e.context,o=e.terrain&&e.terrain.renderingToTexture,[s,a]=e.renderPass!=="translucent"||o?[{},r]:e.stencilConfigForOverlap(r);for(const c of a){const h=t.getTile(c);if(h.needsHillshadePrepare&&e.renderPass==="offscreen")Bk(e,h,n);else if(e.renderPass==="translucent"){const d=e.depthModeForSublayer(0,De.ReadOnly),m=n.paint.get("hillshade-emissive-strength"),g=e.colorModeForDrapableLayerRenderPass(m),x=o&&e.terrain?e.terrain.stencilModeForRTTOverlap(c):s[c.overscaledZ];Ik(e,c,h,n,d,x,g)}}i.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()},raster:function(e,t,n,r,i,o){if(e.renderPass!=="translucent"||n.paint.get("raster-opacity")===0)return;const s=e.context,a=s.gl,c=t.getSource(),h=function(R,z,N){const V=R.paint.get("raster-color"),j=[],H=R.paint.get("raster-resampling"),$=R.paint.get("raster-color-mix"),G=R.paint.get("raster-color-range"),Q=[$[0],$[1],$[2],0],et=$[3],st=H==="nearest"?N.NEAREST:N.LINEAR;if(V&&j.push("RASTER_COLOR"),V){z.activeTexture.set(N.TEXTURE2);let Y=R.colorRampTexture;Y||(Y=R.colorRampTexture=new _r(z,R.colorRamp,N.RGBA)),Y.bind(N.LINEAR,N.CLAMP_TO_EDGE)}return{mix:Q,range:G,offset:et,defines:j,resampling:st}}(n,s,a),d=h.defines,m=e.transform.projection.name==="globe";let g=!1;if(c instanceof Os&&!r.length){if(!m)return;if(c.onNorthPole)g=!0,d.push("GLOBE_POLES");else{if(!c.onSouthPole)return;g=!0,d.push("GLOBE_POLES")}}const x=n.paint.get("raster-emissive-strength"),v=e.colorModeForDrapableLayerRenderPass(x),w=e.terrain&&e.terrain.renderingToTexture,A=c instanceof Os&&n.paint.get("raster-elevation")!==0,E=!e.options.moving,S=n.paint.get("raster-resampling")==="nearest"?a.NEAREST:a.LINEAR;if(g){const R=t.getSource();if(!(R instanceof Os))return;const z=R.texture;if(!z)return;const N=e.globeSharedBuffers;if(!N)return;const V=new De(a.LEQUAL,De.ReadWrite,e.depthRangeFor3D),j=Float32Array.from(e.transform.expandedFarZProjMatrix);let H=Zy(0,0,e.transform);const $=Float32Array.from(Ar(To(new Xi(0,0,0)))),G={opacity:1,mix:0};e.terrain&&e.terrain.prepareDrawTile(),s.activeTexture.set(a.TEXTURE0),z.bind(S,a.CLAMP_TO_EDGE),s.activeTexture.set(a.TEXTURE1),z.bind(S,a.CLAMP_TO_EDGE),z.useMipmap&&s.extTextureFilterAnisotropic&&e.transform.pitch>20&&a.texParameterf(a.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax);const[Q,et,st,Y]=N.getPoleBuffers(0,!0);let tt;R.onNorthPole?(tt=Q,e.renderDefaultNorthPole=!1):(H=lt.scale(lt.create(),H,[1,-1,1]),tt=et,e.renderDefaultSouthPole=!1);const ct=((dt,wt,bt,Et,_t,Mt,qt,Jt,ne,se,Pe,pe)=>iI(dt,wt,bt,new Float32Array(16),new Float32Array(9),[0,0],[0,0,0,0],0,[0,0],[0,0,0,0],1,Et,_t,Mt||[0,0],qt,2,ne,se,Pe,1,0,pe))(j,$,H,G,n,R.perspectiveTransform||[0,0],n.paint.get("raster-elevation"),0,h.mix,h.offset,h.range,x),pt=e.getOrCreateProgram("raster",{defines:h.defines});return e.uploadCommonUniforms(s,pt,null),void pt.draw(e,a.TRIANGLES,V,Ke.disabled,v,Qe.disabled,ct,n.id,tt,st,Y)}if(!r.length)return;const[I,B]=c instanceof Os||w?[{},r]:e.stencilConfigForOverlap(r),M=B[B.length-1].overscaledZ,D=A&&m;D&&h.defines.push("PROJECTION_GLOBE_VIEW"),A&&h.defines.push("RENDER_CUTOFF");for(const R of B){const z=R.toUnwrapped(),N=t.getTile(R);if(w&&(!N||!N.hasData())||!N.texture)continue;let V,j;w?(V=De.disabled,j=R.projMatrix):A?(V=new De(a.LEQUAL,De.ReadWrite,e.depthRangeFor3D),j=m?Float32Array.from(e.transform.expandedFarZProjMatrix):e.transform.calculateProjMatrix(z,E)):(V=e.depthModeForSublayer(R.overscaledZ-M,n.paint.get("raster-opacity")===1?De.ReadWrite:De.ReadOnly,a.LESS),j=e.transform.calculateProjMatrix(z,E));const H=e.terrain&&w?e.terrain.stencilModeForRTTOverlap(R):I[R.overscaledZ],$=o?0:n.paint.get("raster-fade-duration");N.registerFadeDuration($);const G=t.findLoadedParent(R,0),Q=KM(N,G,t,e.transform,$);let et,st;e.terrain&&e.terrain.prepareDrawTile(),s.activeTexture.set(a.TEXTURE0),N.texture&&N.texture.bind(S,a.CLAMP_TO_EDGE),s.activeTexture.set(a.TEXTURE1),G?(G.texture&&G.texture.bind(S,a.CLAMP_TO_EDGE),et=Math.pow(2,G.tileID.overscaledZ-N.tileID.overscaledZ),st=[N.tileID.canonical.x*et%1,N.tileID.canonical.y*et%1]):N.texture&&N.texture.bind(S,a.CLAMP_TO_EDGE),N.texture&&N.texture.useMipmap&&s.extTextureFilterAnisotropic&&e.transform.pitch>20&&a.texParameterf(a.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax);const Y=e.transform,tt=c instanceof Os?c.perspectiveTransform:[0,0],ct=A?aF(Y):[0,0,0,0];let pt,dt,wt,bt,Et,_t;if(D&&c instanceof Os&&c.coordinates.length>3){pt=Float32Array.from(Ar(To(new Xi(0,0,0)))),dt=Float32Array.from(Y.globeMatrix),wt=Float32Array.from(tg(Y)),bt=[Ir(Y.center.lng),Fr(Y.center.lat)],_t=[Ir(c.coordinates[1][0]),Fr(c.coordinates[1][1]),Ir(c.coordinates[3][0]),Fr(c.coordinates[3][1])];const ne=new lo(c.coordinates[1],c.coordinates[3]);Et=Float32Array.from(eg(new Xi(0,0,0),ne,0,Y.worldSize/e.transform._pixelsPerMercatorPixel))}else pt=new Float32Array(16),dt=new Float32Array(9),wt=new Float32Array(16),bt=[0,0],Et=new Float32Array(16),_t=[0,0,0,0];const Mt=iI(j,pt,dt,wt,Et,st||[0,0],_t,$r(e.transform.zoom),bt,ct,et||1,Q,n,tt,A?n.paint.get("raster-elevation"):0,2,h.mix,h.offset,h.range,1,0,x),qt=e.isTileAffectedByFog(R),Jt=e.getOrCreateProgram("raster",{defines:h.defines,overrideFog:qt});if(e.uploadCommonUniforms(s,Jt,z),c instanceof Os){if(w||!m)c.boundsBuffer&&c.boundsSegments&&Jt.draw(e,a.TRIANGLES,V,Ke.disabled,v,Qe.disabled,Mt,n.id,c.boundsBuffer,e.quadTriangleIndexBuffer,c.boundsSegments);else if(e.globeSharedBuffers){const[ne,se,Pe]=e.globeSharedBuffers.getGridBuffers(0,!1);Jt.draw(e,a.TRIANGLES,V,Ke.disabled,v,Qe.frontCCW,Mt,n.id,ne,se,Pe),Jt.draw(e,a.TRIANGLES,V,Ke.disabled,v,Qe.backCCW,Mt,n.id,ne,se,Pe)}}else{const{tileBoundsBuffer:ne,tileBoundsIndexBuffer:se,tileBoundsSegments:Pe}=e.getTileBoundsBuffers(N);Jt.draw(e,a.TRIANGLES,V,H,v,Qe.disabled,Mt,n.id,ne,se,Pe)}}e.resetStencilClippingMasks()},background:function(e,t,n,r){const i=n.paint.get("background-color"),o=n.paint.get("background-opacity"),s=n.paint.get("background-emissive-strength");if(o===0)return;const a=e.context,c=a.gl,h=e.transform,d=h.tileSize,m=n.paint.get("background-pattern");if(e.isPatternMissing(m,n.scope))return;const g=!m&&i.a===1&&o===1&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==g)return;const x=Ke.disabled,v=e.depthModeForSublayer(0,g==="opaque"?De.ReadWrite:De.ReadOnly),w=e.colorModeForDrapableLayerRenderPass(s),A=m?"backgroundPattern":"background";let E,S=r;S||(E=e.getBackgroundTiles(),S=Object.values(E).map(I=>I.tileID)),m&&(a.activeTexture.set(c.TEXTURE0),e.imageManager.bind(e.context,n.scope));for(const I of S){const B=e.isTileAffectedByFog(I),M=e.getOrCreateProgram(A,{overrideFog:B}),D=I.toUnwrapped(),R=r?I.projMatrix:e.transform.calculateProjMatrix(D);e.prepareDrawTile();const z=t?t.getTile(I):E?E[I.key]:new Ag(I,d,h.zoom,e),N=m?Xk(R,s,o,e,m,n.scope,{tileID:I,tileSize:d}):Kk(R,s,o,i);e.uploadCommonUniforms(a,M,D);const{tileBoundsBuffer:V,tileBoundsIndexBuffer:j,tileBoundsSegments:H}=e.getTileBoundsBuffers(z);M.draw(e,c.TRIANGLES,v,x,w,Qe.disabled,N,n.id,V,j,H)}},sky:function(e,t,n){const r=e._atmosphere?$r(e.transform.zoom):1,i=n.paint.get("sky-opacity")*r;if(i===0)return;const o=e.context,s=n.paint.get("sky-type"),a=new De(o.gl.LEQUAL,De.ReadOnly,[0,1]),c=e.frameCounter/1e3%1;s==="atmosphere"?e.renderPass==="offscreen"?n.needsSkyboxCapture(e)&&(function(h,d,m,g){const x=h.context,v=x.gl;let w=d.skyboxFbo;if(!w){w=d.skyboxFbo=x.createFramebuffer(32,32,!0,null),d.skyboxGeometry=new gI(x),d.skyboxTexture=x.gl.createTexture(),v.bindTexture(v.TEXTURE_CUBE_MAP,d.skyboxTexture),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_MIN_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_CUBE_MAP,v.TEXTURE_MAG_FILTER,v.LINEAR);for(let I=0;I<6;++I)v.texImage2D(v.TEXTURE_CUBE_MAP_POSITIVE_X+I,0,v.RGBA,32,32,0,v.RGBA,v.UNSIGNED_BYTE,null)}x.bindFramebuffer.set(w.framebuffer),x.viewport.set([0,0,32,32]);const A=d.getCenter(h,!0),E=h.getOrCreateProgram("skyboxCapture"),S=new Float64Array(16);lt.identity(S),lt.rotateY(S,S,.5*-Math.PI),Id(h,d,E,S,A,0),lt.identity(S),lt.rotateY(S,S,.5*Math.PI),Id(h,d,E,S,A,1),lt.identity(S),lt.rotateX(S,S,.5*-Math.PI),Id(h,d,E,S,A,2),lt.identity(S),lt.rotateX(S,S,.5*Math.PI),Id(h,d,E,S,A,3),lt.identity(S),Id(h,d,E,S,A,4),lt.identity(S),lt.rotateY(S,S,Math.PI),Id(h,d,E,S,A,5),x.viewport.set([0,0,h.width,h.height])}(e,n),n.markSkyboxValid(e)):e.renderPass==="sky"&&function(h,d,m,g,x){const v=h.context,w=v.gl,A=h.transform,E=h.getOrCreateProgram("skybox");v.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_CUBE_MAP,d.skyboxTexture);const S=((I,B,M,D,R)=>({u_matrix:I,u_sun_direction:B,u_cubemap:0,u_opacity:D,u_temporal_offset:R}))(A.skyboxMatrix,d.getCenter(h,!1),0,g,x);h.uploadCommonUniforms(v,E),E.draw(h,w.TRIANGLES,m,Ke.disabled,h.colorModeForRenderPass(),Qe.backCW,S,"skybox",d.skyboxGeometry.vertexBuffer,d.skyboxGeometry.indexBuffer,d.skyboxGeometry.segment)}(e,n,a,i,c):s==="gradient"&&e.renderPass==="sky"&&function(h,d,m,g,x){const v=h.context,w=v.gl,A=h.transform,E=h.getOrCreateProgram("skyboxGradient");d.skyboxGeometry||(d.skyboxGeometry=new gI(v)),v.activeTexture.set(w.TEXTURE0);let S=d.colorRampTexture;S||(S=d.colorRampTexture=new _r(v,d.colorRamp,w.RGBA)),S.bind(w.LINEAR,w.CLAMP_TO_EDGE);const I=((B,M,D,R,z)=>({u_matrix:B,u_color_ramp:0,u_center_direction:M,u_radius:Ae(D),u_opacity:R,u_temporal_offset:z}))(A.skyboxMatrix,d.getCenter(h,!1),d.paint.get("sky-gradient-radius"),g,x);h.uploadCommonUniforms(v,E),E.draw(h,w.TRIANGLES,m,Ke.disabled,h.colorModeForRenderPass(),Qe.backCW,I,"skyboxGradient",d.skyboxGeometry.vertexBuffer,d.skyboxGeometry.indexBuffer,d.skyboxGeometry.segment)}(e,n,a,i,c)},debug:function(e,t,n){for(let r=0;r<n.length;r++)dF(e,t,n[r])},custom:function(e,t,n,r){const i=e.context,o=n.implementation;if(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes("custom")||e.terrain&&(e.terrain.renderingToTexture||e.renderPass==="offscreen")&&n.isLayerDraped(t)){if(e.renderPass==="offscreen"){const s=o.prerender;if(s){if(e.setCustomLayerDefaults(),i.setColorMode(e.colorModeForRenderPass()),e.transform.projection.name==="globe"){const a=e.transform.pointMerc;s.call(o,i.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),$r(e.transform.zoom),[a.x,a.y],e.transform.pixelsPerMeterRatio)}else s.call(o,i.gl,e.transform.customLayerMatrix());i.setDirty(),e.setBaseState()}}else if(e.renderPass==="translucent"){if(e.terrain&&e.terrain.renderingToTexture){const a=o.renderToTile;if(a){const c=r[0].canonical,h=new an(c.x+r[0].wrap*(1<<c.z),c.y,c.z);i.setDepthMode(De.disabled),i.setStencilMode(Ke.disabled),i.setColorMode(e.colorModeForRenderPass()),e.setCustomLayerDefaults(),a.call(o,i.gl,h),i.setDirty(),e.setBaseState()}return}e.setCustomLayerDefaults(),i.setColorMode(e.colorModeForRenderPass()),i.setStencilMode(Ke.disabled);const s=o.renderingMode==="3d"?new De(e.context.gl.LEQUAL,De.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,De.ReadOnly);if(i.setDepthMode(s),e.transform.projection.name==="globe"){const a=e.transform.pointMerc;o.render(i.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),$r(e.transform.zoom),[a.x,a.y],e.transform.pixelsPerMeterRatio)}else o.render(i.gl,e.transform.customLayerMatrix());i.setDirty(),e.setBaseState(),i.bindFramebuffer.set(null)}}else rt("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(e,t,n,r){if(e.renderPass==="opaque")return;const i=n.paint.get("model-opacity");if(i===0)return;const o=n.paint.get("model-cast-shadows");if(e.renderPass==="shadow"&&(!o||e.terrain&&i<.65&&n._transitionablePaint._values["model-opacity"].value.expression instanceof Fo))return;const s=e.shadowRenderer,a=n.paint.get("model-receive-shadows");s&&(s.useNormalOffset=!0,a||(s.enabled=!1));const c=()=>{s&&(s.useNormalOffset=!0,a||(s.enabled=!0))},h=t.getSource();if(e.renderPass==="light-beam"&&h.type!=="batched-model")return;if(h.type==="vector"||h.type==="geojson")return function(E,S,I,B){const M=E.transform;if(M.projection.name!=="mercator")return void rt(`Drawing 3D models for ${M.projection.name} projection is not yet implemented`);const D=M.getFreeCameraOptions().position;if(!E.modelManager)return;const R=E.modelManager,z=E.shadowRenderer;if(!I._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const N=I._unevaluatedLayout._values["model-id"],V={...I.layout.get("model-id").parameters};for(const j of B){const H=S.getTile(j).getBucket(I);if(!H||H.projection.name!==M.projection.name)continue;const $=wF(j,M);V.zoom=$;const G=N.possiblyEvaluate(V);if(vF(E,H,j),nl.shadowUniformsInitialized=!1,nl.useSingleShadowCascade=!!z&&z.getMaxCascadeForTile(j.toUnwrapped())===0,E.renderPass==="shadow"&&z){if(E.currentShadowCascade===1&&H.isInsideFirstShadowMapFrustum)continue;const st=M.calculatePosMatrix(j.toUnwrapped(),M.worldSize);if(nl.tileMatrix.set(st),nl.shadowTileMatrix=Float32Array.from(z.calculateShadowPassMatrixFromMatrix(st)),nl.aabb.min.fill(0),nl.aabb.max[0]=nl.aabb.max[1]=gt,nl.aabb.max[2]=0,AF(H,nl,E,I.scope))continue}const Q=1<<j.canonical.z,et=[((D.x-j.wrap)*Q-j.canonical.x)*gt,(D.y*Q-j.canonical.y)*gt,D.z*Q*gt];for(let st in H.instancesPerModel){const Y=H.instancesPerModel[st];Y.features.length>0&&(st=G.evaluate(Y.features[0].feature,{}));const tt=R.getModel(st,I.scope);if(tt&&tt.uploaded)for(const ct of tt.nodes)xI(E,I,ct,Y,et,j,nl)}}}(e,t,n,r),void c();if(!h.loaded())return;if(h.type==="batched-model")return function(E,S,I,B){const M=E.context,D=E.transform,R=E.style.fog,z=E.shadowRenderer;if(D.projection.name!=="mercator")return void rt(`Drawing 3D landmark models for ${D.projection.name} projection is not yet implemented`);const N=E.transform.getFreeCameraOptions().position,V=J.scale([],[N.x,N.y,N.z],E.transform.worldSize);J.negate(V,V);const j=lt.identity([]),H=Ja(D.center.lat,D.zoom),$=lt.fromScaling([],[1,1,1/H]);lt.translate(j,j,V);const G=I.paint.get("model-opacity"),Q=new De(M.gl.LEQUAL,De.ReadWrite,E.depthRangeFor3D),et=new De(M.gl.LEQUAL,De.ReadOnly,E.depthRangeFor3D),st=function(Y,tt){for(const ct of B){const pt=S.getTile(ct).getBucket(I);if(!pt||!pt.uploaded)continue;let dt=!1;z&&(dt=z.getMaxCascadeForTile(ct.toUnwrapped())===0);const wt=D.calculatePosMatrix(ct.toUnwrapped(),D.worldSize),bt=pt.modelTraits;for(const Et of pt.getNodesInfo()){if(Et.hiddenByReplacement||!Et.node.meshes)continue;const _t=Et.node,Mt=E.renderPass==="light-beam",qt=[...wt],Jt=Et.evaluatedScale;let ne=0;E.terrain&&_t.elevation&&(ne=_t.elevation*E.terrain.exaggeration()),lt.translate(qt,qt,[(_t.anchor?_t.anchor[0]:0)*(Jt[0]-1),(_t.anchor?_t.anchor[1]:0)*(Jt[1]-1),ne]),Jt!==tR&&lt.scale(qt,qt,Jt),lt.multiply(qt,qt,_t.matrix);const se=lt.multiply([],$,qt);lt.multiply(se,j,se);const Pe=lt.invert([],se);lt.transpose(Pe,Pe),lt.scale(Pe,Pe,bF);const pe=lt.multiply([],D.expandedFarZProjMatrix,qt);for(let pn=0;pn<_t.meshes.length;++pn){const rn=_t.meshes[pn],Le=pn===_t.lightMeshIndex;if(Le){if(!Mt&&!E.terrain&&E.shadowRenderer){E.currentLayer<E.firstLightBeamLayer&&(E.firstLightBeamLayer=E.currentLayer);continue}}else if(Mt)continue;const Se={defines:[]},_e=[];dA(Se.defines,_e,rn,E),4&bt||Se.defines.push("DIFFUSE_SHADED"),dt&&Se.defines.push("SHADOWS_SINGLE_CASCADE");const ln=E.renderPass==="shadow";if(ln){pA(rn,qt,E,I);continue}let cn=null;if(R){const Dr=_I(qt,E.transform);if(cn=new Float32Array(Dr),D.projection.name!=="globe"){const Cr=rn.aabb.min,or=rn.aabb.max,[kn,mi]=R.getOpacityForBounds(Dr,Cr[0],Cr[1],or[0],or[1]);Se.overrideFog=kn>=Mh||mi>=Mh}}const Je=E.getOrCreateProgram("model",Se);!ln&&z&&(z.useNormalOffset=!!rn.normalBuffer,z.setupShadowsFromMatrix(qt,Je,z.useNormalOffset)),E.uploadCommonUniforms(M,Je,ct.toUnwrapped(),cn);const Gn=rn.material,Tr=Gn.pbrMetallicRoughness;Tr.metallicFactor=.9,Tr.roughnessFactor=.5;const On=0,Xn=hA(new Float32Array(pe),new Float32Array(se),new Float32Array(Pe),E,G,Tr.baseColorFactor,Gn.emissiveFactor,Tr.metallicFactor,Tr.roughnessFactor,Gn,On,I);Je.draw(E,M.gl.TRIANGLES,tt&&!Le?Q:et,Ke.disabled,Y?Le||G<1||Et.hasTranslucentParts?xn.alphaBlended:xn.unblended:xn.disabled,Qe.backCCW,Xn,I.id,rn.vertexBuffer,rn.indexBuffer,rn.segments,I.paint,E.transform.zoom,void 0,_e)}}}};(function(Y,tt,ct,pt){const dt=Y.terrain?Y.terrain.exaggeration():0,wt=Y.transform.zoom;for(const bt of pt){const Et=tt.getTile(bt).getBucket(ct);Et&&(Y.conflationActive&&Et.updateReplacement(bt,Y.replacementSource),Et.evaluateScale(Y,ct),Y.terrain&&dt>0&&Et.elevationUpdate(Y.terrain,dt,bt,ct.source),Et.needsReEvaluation(Y,wt,ct)&&Et.evaluate(ct))}})(E,S,I,B),G===1?st(!0,!0):(st(!1,!0),st(!0,!1))}(e,t,n,r),void c();const d=h.getModels(),m=[],g=e.transform.getFreeCameraOptions().position,x=J.scale([],[g.x,g.y,g.z],e.transform.worldSize);J.negate(x,x);const v=[],w=[];let A=0;for(const E of d){const S=n.paint.get("model-rotation").constantOr(null),I=n.paint.get("model-scale").constantOr(null),B=n.paint.get("model-translation").constantOr(null);E.computeModelMatrix(e,S,I,B,!0,!0,!1);const M=lt.identity([]),D=Ja(E.position.lat,e.transform.zoom),R=lt.fromScaling([],[1,1,1/D]);lt.translate(M,M,x),m.push({zScaleMatrix:R,negCameraPosMatrix:M});for(const z of E.nodes)yI(e.transform,z,E.matrix,e.transform.expandedFarZProjMatrix,A,v,w);A++}if(v.sort((E,S)=>S.depth-E.depth),e.renderPass!=="shadow"){if(i===1)for(const E of w)fx(E,e,n,m[E.modelIndex],Ke.disabled,e.colorModeForRenderPass());else{for(const E of w)fx(E,e,n,m[E.modelIndex],Ke.disabled,xn.disabled);for(const E of w)fx(E,e,n,m[E.modelIndex],e.stencilModeFor3D(),e.colorModeForRenderPass());e.resetStencilClippingMasks()}for(const E of v)fx(E,e,n,m[E.modelIndex],Ke.disabled,e.colorModeForRenderPass());c()}else{for(const E of w)pA(E.mesh,E.nodeModelMatrix,e,n);for(const E of v)pA(E.mesh,E.nodeModelMatrix,e,n);c()}}},wI={modelUpload:function(e,t,n){const r=t.getSource();if(!r.loaded())return;if(r.type==="vector"||r.type==="geojson")return void(e.modelManager&&e.modelManager.upload(e,n));if(r.type==="batched-model")return;const i=r.getModels();for(const o of i)o.upload(e.context)}};class CF{constructor(t,n,r){this.context=new jL(t,n),this.transform=r,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=_a.maxUnderzooming+_a.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new sR,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new IF(this),this._wireframeDebugCache=new TF,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(t,n){const r=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(r||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Rk(this,t));const i=this._terrain;this.transform.elevation=r?i:null,i.update(t,this.transform,n),this.transform.elevation&&!i.enabled&&(this.transform.elevation=null)}_updateFog(t){const n=t.fog;if(!n||this.transform.projection.name==="globe"||n.getOpacity(this.transform.pitch)<1||n.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[r,i]=n.getFovAdjustedRange(this.transform._fov);if(r>i)return void(this.transform.fogCullDistSq=null);const o=r+.78*(i-r);this.transform.fogCullDistSq=o*o}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,n){if(this.width=t*ze.devicePixelRatio,this.height=n*ze.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const r of this.style.order)this.style._mergedLayers[r].resize()}setup(){const t=this.context,n=new bi;n.emplaceBack(0,0),n.emplaceBack(gt,0),n.emplaceBack(0,gt),n.emplaceBack(gt,gt),this.tileExtentBuffer=t.createVertexBuffer(n,Ps.members),this.tileExtentSegments=Cn.simpleSegment(0,0,4,2);const r=new bi;r.emplaceBack(0,0),r.emplaceBack(gt,0),r.emplaceBack(0,gt),r.emplaceBack(gt,gt),this.debugBuffer=t.createVertexBuffer(r,Ps.members),this.debugSegments=Cn.simpleSegment(0,0,4,5);const i=new bi;i.emplaceBack(-1,-1),i.emplaceBack(1,-1),i.emplaceBack(-1,1),i.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(i,Ps.members),this.viewportSegments=Cn.simpleSegment(0,0,4,2);const o=new sa;o.emplaceBack(0,0,0,0),o.emplaceBack(gt,0,gt,0),o.emplaceBack(0,gt,0,gt),o.emplaceBack(gt,gt,gt,gt),this.mercatorBoundsBuffer=t.createVertexBuffer(o,Mb.members),this.mercatorBoundsSegments=Cn.simpleSegment(0,0,4,2);const s=new ur;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(s);const a=new Vu;for(const h of[0,1,3,2,0])a.emplaceBack(h);this.debugIndexBuffer=t.createIndexBuffer(a),this.emptyTexture=new _r(t,new Er({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=lt.create();const c=this.context.gl;this.stencilClearMode=new Ke({func:c.ALWAYS,mask:0},0,255,c.ZERO,c.ZERO,c.ZERO),this.loadTimeStamps.push(k.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,De.disabled,this.stencilClearMode,xn.disabled,Qe.disabled,cA(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,n,r){if(!n||this.currentStencilSource===n.id||!t.isTileClipped()||!r||r.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let a=!1;for(const c of r)if(this._tileClippingMaskIDs[c.key]===void 0){a=!0;break}if(!a)return}this.currentStencilSource=n.id;const i=this.context,o=i.gl;this.nextStencilID+r.length>256&&this.clearStencil(),i.setColorMode(xn.disabled),i.setDepthMode(De.disabled);const s=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const a of r){const c=n.getTile(a),h=this._tileClippingMaskIDs[a.key]=this.nextStencilID++,{tileBoundsBuffer:d,tileBoundsIndexBuffer:m,tileBoundsSegments:g}=this.getTileBoundsBuffers(c);s.draw(this,o.TRIANGLES,De.disabled,new Ke({func:o.ALWAYS,mask:0},h,255,o.KEEP,o.KEEP,o.REPLACE),xn.disabled,Qe.disabled,cA(a.projMatrix),"$clipping",d,m,g)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new Ke({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const n=this.context.gl;return new Ke({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,r=t.sort((s,a)=>a.overscaledZ-s.overscaledZ),i=r[r.length-1].overscaledZ,o=r[0].overscaledZ-i+1;if(o>1){this.currentStencilSource=void 0,this.nextStencilID+o>256&&this.clearStencil();const s={};for(let a=0;a<o;a++)s[a+i]=new Ke({func:n.GEQUAL,mask:255},a+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=o,[s,r]}return[{[i]:Ke.disabled},r]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new xn([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new Me(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?xn.unblended:xn.alphaBlended}colorModeForDrapableLayerRenderPass(t){const n=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new xn([n.ONE,n.ONE_MINUS_SRC_ALPHA,n.CONSTANT_ALPHA,n.ONE_MINUS_SRC_ALPHA],new Me(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,n,r,i=!1){if(!this.opaquePassEnabledForLayer()&&!i)return De.disabled;const o=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new De(r||this.context.gl.LEQUAL,n,[o,o])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){this._wireframeDebugCache.update(this.frameCounter),this.style=t,this.options=n;const r=this.style._mergedLayers,i=this.style.order,o=i.map(M=>r[M]),s=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(ze.now()),this.imageManager.beginFrame();let a=0,c=!1;for(const M in s){const D=s[M];D.used&&(D.prepare(this.context),D.getSource().usedInConflation&&++a)}const h={},d={},m={},g={},x={};for(const M in s){const D=s[M];h[M]=D.getVisibleCoordinates(),d[M]=h[M].slice().reverse(),m[M]=D.getVisibleCoordinates(!0).reverse(),g[M]=D.getShadowCasterCoordinates(),x[M]=D.sortCoordinatesByDistance(h[M])}const v=M=>{const D=this.style.getLayerSourceCache(M);return D&&D.used?D.getSource():null};if(a){const M=[];for(const D of o)this.layerUsedInConflation(D,v(D))&&M.push(D);if(M&&M.length>1){const D=[];for(const R of M){const z=this.style.getLayerSourceCache(R);z&&z.used&&z.getSource().usedInConflation&&D.push({layer:R.fqid,cache:z})}this.replacementSource.setSources(D),c=!0}}c||this.replacementSource.clear(),this.conflationActive=c,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const M of o){const D=M.cutoffRange();if(this.longestCutoffRange=Math.max(D,this.longestCutoffRange),D>0){const R=v(M);R&&(this.minCutoffZoom=Math.max(R.minzoom,this.minCutoffZoom)),M.minzoom&&(this.minCutoffZoom=Math.max(M.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let M=0;M<o.length;M++)if(o[M].is3D()){this.opaquePassCutoff=M;break}const w=this.style&&this.style.fog;w?(this._fogVisible=w.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=w.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(m),this.opaquePassCutoff=0);const A=this._shadowRenderer;if(A){A.updateShadowParameters(this.transform,this.style.directionalLight);for(const M in s)for(const D of h[M]){let R={min:0,max:0};this.terrain&&(R=this.terrain.getMinMaxForTile(D)||R),A.addShadowReceiver(D.toUnwrapped(),R.min,R.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new Hw(this.context));for(const M of o){if(M.isHidden(this.transform.zoom))continue;const D=t.getLayerSourceCache(M);this.uploadLayer(this,M,D)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new xF),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!Bc.has(this.context.gl))return;this.renderPass="offscreen";for(const M of o){const D=t.getLayerSourceCache(M);if(!M.hasOffscreenPass()||M.isHidden(this.transform.zoom))continue;const R=D?d[D.id]:void 0;(M.type==="custom"||M.type==="raster"||M.isSky()||R&&R.length)&&this.renderLayer(this,D,M,R)}this.depthRangeFor3D=[0,1-(o.length+2)*this.numSublayers*this.depthEpsilon];const E=this.terrain;E&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&E.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,g)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const S=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),I=(()=>{if(n.showOverdrawInspector)return Me.black;if(this.style.fog&&this.transform.projection.supportsFog&&!S){const M=this.style.fog.properties.get("color").toArray01();return new Me(...M)}if(this.style.fog&&this.transform.projection.supportsFog&&S){const M=this.style.fog.properties.get("space-color").toArray01();return new Me(...M)}return Me.transparent})();if(this.context.clear({color:I,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&S&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=i.length-1;this.currentLayer>=0;this.currentLayer--){const M=o[this.currentLayer],D=t.getLayerSourceCache(M);if(M.isSky())continue;const R=D?(M.is3D()?x:d)[D.id]:void 0;this._renderTileClippingMasks(M,D,R),this.renderLayer(this,D,M,R)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&S&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||$r(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<i.length;this.currentLayer++){const M=o[this.currentLayer],D=t.getLayerSourceCache(M);M.isSky()&&this.renderLayer(this,D,M,D?d[D.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let B=0;for(A&&(B=A.getShadowCastingLayerCount());this.currentLayer<i.length;){const M=o[this.currentLayer],D=t.getLayerSourceCache(M);if(M.isSky()){++this.currentLayer;continue}if(E&&this.style.isLayerDraped(M)){if(M.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=E.renderBatch(this.currentLayer);continue}let R;if(D&&(R=(M.type==="symbol"?m:M.is3D()?x:d)[D.id]),this._renderTileClippingMasks(M,D,D?h[D.id]:void 0),this.renderLayer(this,D,M,R),!E&&A&&B>0&&M.hasShadowPass()&&--B==0&&(A.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const z=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=z;this.currentLayer++){const N=o[this.currentLayer];if(!N.hasLightBeamPass())continue;const V=t.getLayerSourceCache(N);this.renderLayer(this,V,N,V?d[V.id]:void 0)}this.currentLayer=z,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let M=null;o.forEach(D=>{const R=t.getLayerSourceCache(D);R&&!D.isHidden(this.transform.zoom)&&R.getVisibleCoordinates().length&&(!M||M.getSource().maxzoom<R.getSource().maxzoom)&&(M=R)}),M&&this.options.showTileBoundaries&&vI.debug(this,M,M.getVisibleCoordinates())}this.options.showPadding&&function(M){const D=M.transform.padding;pI(M,M.transform.height-(D.top||0),3,lF),pI(M,D.bottom||0,3,uF),mI(M,D.left||0,3,cF),mI(M,M.transform.width-(D.right||0),3,hF);const R=M.transform.centerPoint;(function(z,N,V,j){hx(z,N-1,V-10,2,20,j),hx(z,N-10,V-1,20,2,j)})(M,R.x,M.transform.height-R.y,fF)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(k.performance.now()),this.saveCanvasCopy()),c||(this.conflationActive=!1)}uploadLayer(t,n,r){this.gpuTimingStart(n),(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes(n.type)||t.terrain&&n.type==="custom")&&wI[`${n.type}Upload`]&&wI[`${n.type}Upload`](t,r,n.scope),this.gpuTimingEnd()}renderLayer(t,n,r,i){r.isHidden(this.transform.zoom)||(r.type==="background"||r.type==="sky"||r.type==="custom"||r.type==="model"||r.type==="raster"||i&&i.length)&&(this.id=r.id,this.gpuTimingStart(r),(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes(r.type)||t.terrain&&r.type==="custom")&&vI[r.type](t,n,r,i,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery,r=this.context.gl;let i=this.gpuTimers[t.id];i||(i=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:r.createQuery()}),i.calls++,r.beginQuery(n.TIME_ELAPSED_EXT,i.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,n=this.context.gl,r=n.createQuery();this.deferredRenderGpuTimeQueries.push(r),n.beginQuery(t.TIME_ELAPSED_EXT,r)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const n={};for(const r in t){const i=t[r],o=this.context.extTimerQuery,s=o.getQueryParameter(i.query,this.context.gl.QUERY_RESULT)/1e6;o.deleteQueryEXT(i.query),n[r]=s}return n}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const n=this.context.extTimerQuery,r=this.context.gl;let i=0;for(const o of t)i+=n.getQueryParameter(o,r.QUERY_RESULT)/1e6,n.deleteQueryEXT(o);return i}translatePosMatrix(t,n,r,i,o){if(!r[0]&&!r[1])return t;const s=o?i==="map"?this.transform.angle:0:i==="viewport"?-this.transform.angle:0;if(s){const h=Math.sin(s),d=Math.cos(s);r=[r[0]*d-r[1]*h,r[0]*h+r[1]*d]}const a=[o?r[0]:Th(n,r[0],this.transform.zoom),o?r[1]:Th(n,r[1],this.transform.zoom),0],c=new Float32Array(16);return lt.translate(c,t,a),c}saveTileTexture(t){const n=t.size[0],r=this._tileTextures[n];r?r.push(t):this._tileTextures[n]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}isPatternMissing(t,n){return t===null||t!==void 0&&!this.imageManager.getPattern(t.toString(),n)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,n,r){const i=r===void 0?this.terrain&&this.terrain.renderingToTexture:r,o=this.terrain&&this.terrain.exaggeration()===0,s=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(s.push("LIGHTING_3D_MODE"),s.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):i||s.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||s.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?s.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):s.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(s.push("TERRAIN"),this.linearFloatFilteringSupported()&&s.push("TERRAIN_DEM_FLOAT_FORMAT"),o&&s.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&s.push("GLOBE"),!this._fogVisible||i||n!==void 0&&!n||s.push("FOG","FOG_DITHERING"),i&&s.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&s.push("OVERDRAW_INSPECTOR"),s}getOrCreateProgram(t,n){this.cache=this.cache||{};const r=n&&n.defines||[],i=n&&n.config,o=this.currentGlobalDefines(t,n&&n.overrideFog,n&&n.overrideRtt).concat(r),s=YM.cacheKey(GM[t],t,o,i);return this.cache[s]||(this.cache[s]=new YM(this.context,t,GM[t],i,Yk[t],o)),this.cache[s]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=k.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new _r(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,n){if(this.style.enable3dLights()){const r=this.style.directionalLight,i=this.style.ambientLight;if(r&&i){const o=((s,a)=>{const c=s.properties.get("direction"),h=s.properties.get("color").toArray01(),d=s.properties.get("intensity"),m=a.properties.get("color").toArray01(),g=a.properties.get("intensity"),x=[c.x,c.y,c.z],v=tr(m,g),w=tr(h,d);return{u_lighting_ambient_color:v,u_lighting_directional_dir:x,u_lighting_directional_color:w,u_ground_radiance:kk(x,w,v)}})(r,i);n.setLightsUniformValues(t,o)}}}uploadCommonUniforms(t,n,r,i,o){if(this.uploadCommonLightUniforms(t,n),this.terrain&&this.terrain.renderingToTexture)return;const s=this.style.fog;if(s){const a=s.getOpacity(this.transform.pitch),c=((h,d,m,g,x,v,w,A,E,S,I,B)=>{const M=h.transform,D=d.properties.get("color").toArray01();D[3]=g;const R=h.frameCounter/1e3%1,[z,N]=d.properties.get("vertical-range");return{u_fog_matrix:m?M.calculateFogTileMatrix(m):B||h.identityMat,u_fog_range:d.getFovAdjustedRange(M._fov),u_fog_color:D,u_fog_horizon_blend:d.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(z,N),N],u_fog_temporal_offset:R,u_frustum_tl:x,u_frustum_tr:v,u_frustum_br:w,u_frustum_bl:A,u_globe_pos:E,u_globe_radius:S,u_viewport:I,u_globe_transition:$r(M.zoom),u_is_globe:+(M.projection.name==="globe")}})(this,s,r,a,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*ze.devicePixelRatio,this.transform.height*ze.devicePixelRatio],i);n.setFogUniformValues(t,c)}o&&n.setCutoffUniformValues(t,o.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,n=t.createTexture();return t.bindTexture(t.TEXTURE_2D,n),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),n}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,n=this._backgroundTiles={},r=this.transform.coveringTiles({tileSize:512});for(const i of r)n[i.key]=t[i.key]||new Ag(i,512,this.transform.tileZoom,this);return n}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(t,n){return!(!t.is3D()||t.minzoom&&t.minzoom>this.transform.zoom||t.sourceLayer!=="building"&&(!n||n.type!=="batched-model"))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let n=this._cachedTileFogOpacities[t.key];return n||(this._cachedTileFogOpacities[t.key]=n=this.style.fog.getOpacityForTile(t)),n[0]>=Mh||n[1]>=Mh}}const Dh=2048;class SF{constructor(t,n){this.aabb=t,this.lastCascade=n}}class MF{add(t,n){const r=this.receivers[t.key];r!==void 0?(r.aabb.min[0]=Math.min(r.aabb.min[0],n.min[0]),r.aabb.min[1]=Math.min(r.aabb.min[1],n.min[1]),r.aabb.min[2]=Math.min(r.aabb.min[2],n.min[2]),r.aabb.max[0]=Math.max(r.aabb.max[0],n.max[0]),r.aabb.max[1]=Math.max(r.aabb.max[1],n.max[1]),r.aabb.max[2]=Math.max(r.aabb.max[2],n.max[2])):this.receivers[t.key]=new SF(n,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,n,r){const i=yn.fromPoints(t.points);let o=0;for(const s in this.receivers){const a=this.receivers[s];if(!a||!i.intersectsAabb(a.aabb))continue;a.aabb.min=i.closestPoint(a.aabb.min),a.aabb.max=i.closestPoint(a.aabb.max);const c=a.aabb.getCorners();for(let h=0;h<r.length;h++){let d=!0;for(const m of c){const g=[m[0]*n,m[1]*n,m[2]];if(J.transformMat4(g,g,r[h].matrix),g[0]<-1||g[0]>1||g[1]<-1||g[1]>1){d=!1;break}}if(a.lastCascade=h,o=Math.max(o,h),d)break}}return o+1}}class IF{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new MF,this._depthMode=new De(t.context.gl.LEQUAL,De.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,n){const r=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!n||!n.properties)return;const i=n.properties.get("shadow-intensity");if(!n.shadowsEnabled()||i<=0||(this._shadowLayerCount=r.style.order.reduce((x,v)=>{const w=r.style._mergedLayers[v];return x+(w.hasShadowPass()&&!w.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;const o=r.context,s=Dh,a=Dh;if(this._cascades.length===0)for(let x=0;x<2;++x){const v=r._shadowMapDebug,w=o.gl,A=o.createFramebuffer(s,a,v,"texture"),E=new _r(o,{width:s,height:a,data:null},w.DEPTH_COMPONENT);if(A.depthAttachment.set(E.texture),v){const S=new _r(o,{width:s,height:a,data:null},w.RGBA);A.colorAttachment.set(S.texture)}this._cascades.push({framebuffer:A,texture:E,matrix:[],far:0,boundingSphereRadius:0,frustum:new Rs,scale:0})}this.shadowDirection=bI(n);let c=0;if(t.elevation){const x=t.elevation,v=[1e4,-1e4];x.visibleDemTiles.filter(w=>w.dem).forEach(w=>{const A=w.dem.tree;v[0]=Math.min(v[0],A.minimums[0]),v[1]=Math.max(v[1],A.maximums[0])}),v[0]!==1e4&&(c=(v[1]-v[0])*x.exaggeration())}const h=1.5*t.cameraToCenterDistance,d=3*h,m=new Float64Array(16);for(let x=0;x<2;++x){const v=this._cascades[x];let w=t.height/50,A=1;x===0?A=h:(w=h,A=d);const[E,S]=BF(t,this.shadowDirection,w,A,Dh,c);v.scale=t.scale,v.matrix=E,v.boundingSphereRadius=S,lt.invert(m,v.matrix),v.frustum=Rs.fromInvProjectionMatrix(m,1,0,!0),v.far=A}this._uniformValues.u_fade_range=[.75*this._cascades[1].far,this._cascades[1].far],this._uniformValues.u_shadow_intensity=i,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=Dh,this._uniformValues.u_shadowmap_0=Ho.ShadowMap0,this._uniformValues.u_shadowmap_1=Ho.ShadowMap0+1,this._groundShadowTiles=r.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const g=r.transform.elevation;for(const x of this._groundShadowTiles){let v={min:0,max:0};if(g){const w=g.getMinMaxForTile(x);w&&(v=w)}this.addShadowReceiver(x.toUnwrapped(),v.min,v.max)}}get enabled(){return this._enabled}set enabled(t){this._enabled=t}drawShadowPass(t,n){if(!this._enabled)return;const r=this.painter,i=r.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(r.transform.getFrustum(0),r.transform.worldSize,this._cascades),i.viewport.set([0,0,Dh,Dh]);for(let o=0;o<this._numCascadesToRender;++o){r.currentShadowCascade=o,i.bindFramebuffer.set(this._cascades[o].framebuffer.framebuffer),i.clear({color:Me.white,depth:1});for(const s of t.order){const a=t._mergedLayers[s];if(!a.hasShadowPass()||a.isHidden(r.transform.zoom))continue;const c=t.getLayerSourceCache(a),h=c?n[c.id]:void 0;(a.type==="model"||h&&h.length)&&r.renderLayer(r,c,a,h)}}r.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const t=this.painter,n=t.style,r=t.context,i=n.directionalLight,o=n.ambientLight;if(!i||!o)return;const s=[],a=Cd(t,t.longestCutoffRange);a.shouldRenderCutoff&&s.push("RENDER_CUTOFF");const c=mA(i,o),h=new De(r.gl.LEQUAL,De.ReadOnly,t.depthRangeFor3D);for(const d of this._groundShadowTiles){const m=d.toUnwrapped(),g=t.isTileAffectedByFog(d),x=t.getOrCreateProgram("groundShadow",{defines:s,overrideFog:g});this.setupShadows(m,x),t.uploadCommonUniforms(r,x,m,null,a);const v={u_matrix:t.transform.calculateProjMatrix(m),u_ground_shadow_factor:c};x.draw(t,r.gl.TRIANGLES,h,Ke.disabled,xn.multiply,Qe.disabled,v,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?xn.unblended:xn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const n=this.painter.transform,r=n.calculatePosMatrix(t,n.worldSize);return lt.multiply(r,this._cascades[this.painter.currentShadowCascade].matrix,r),Float32Array.from(r)}calculateShadowPassMatrixFromMatrix(t){return lt.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,n,r,i=0){if(!this._enabled)return;const o=this.painter.transform,s=this.painter.context,a=s.gl,c=this._uniformValues,h=new Float64Array(16),d=o.calculatePosMatrix(t,o.worldSize);for(let m=0;m<2;m++)lt.multiply(h,this._cascades[m].matrix,d),c[m===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(h),s.activeTexture.set(a.TEXTURE0+Ho.ShadowMap0+m),this._cascades[m].texture.bind(a.NEAREST,a.CLAMP_TO_EDGE);if(this.useNormalOffset=!!r,this.useNormalOffset){const m=wh(t.canonical),g=2/o.tileSize*gt/Dh,x=g*this._cascades[0].boundingSphereRadius,v=g*this._cascades[1].boundingSphereRadius,w=(r==="vector-tile"?1:3)/Math.pow(2,i-t.canonical.z-(1-o.zoom+Math.floor(o.zoom)));c.u_shadow_normal_offset=[m,x*w,v*w],c.u_shadow_bias=[6e-5,.0012,.012]}else c.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(s,c)}setupShadowsFromMatrix(t,n,r=!1){if(!this._enabled)return;const i=this.painter.context,o=i.gl,s=this._uniformValues,a=new Float64Array(16);for(let c=0;c<2;c++)lt.multiply(a,this._cascades[c].matrix,t),s[c===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(a),i.activeTexture.set(o.TEXTURE0+Ho.ShadowMap0+c),this._cascades[c].texture.bind(o.NEAREST,o.CLAMP_TO_EDGE);this.useNormalOffset=r,r?(s.u_shadow_normal_offset=[1,5,5],s.u_shadow_bias=[6e-5,.0012,.012]):s.u_shadow_bias=[36e-5,.0012,.012],n.setShadowUniformValues(i,s)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,n,r,i){if(i[2]>=0)return{};const o=function(c,h,d){const m=d/(1<<c.canonical.z);return new yn([c.canonical.x*m+c.wrap*d,c.canonical.y*m+c.wrap*d,0],[(c.canonical.x+1)*m+c.wrap*d,(c.canonical.y+1)*m+c.wrap*d,h])}(t,n,r).getCorners(),s=n/-i[2];i[0]<0?(J.add(o[0],o[0],[i[0]*s,0,0]),J.add(o[3],o[3],[i[0]*s,0,0])):i[0]>0&&(J.add(o[1],o[1],[i[0]*s,0,0]),J.add(o[2],o[2],[i[0]*s,0,0])),i[1]<0?(J.add(o[0],o[0],[0,i[1]*s,0]),J.add(o[1],o[1],[0,i[1]*s,0])):i[1]>0&&(J.add(o[2],o[2],[0,i[1]*s,0]),J.add(o[3],o[3],[0,i[1]*s,0]));const a={};return a.vertices=o,a.planes=[dx(o[1],o[0],o[4]),dx(o[2],o[1],o[5]),dx(o[3],o[2],o[6]),dx(o[0],o[3],o[7])],a}addShadowReceiver(t,n,r){this._receivers.add(t,yn.fromTileIdAndHeight(t,n,r))}getMaxCascadeForTile(t){const n=this._receivers.get(t);return n&&n.lastCascade?n.lastCascade:0}}function dx(e,t,n){const r=J.sub([],n,t),i=J.sub([],e,t),o=J.cross([],r,i),s=J.length(o);return s===0?[0,0,1,0]:(J.scale(o,o,1/s),[o[0],o[1],o[2],-J.dot(o,t)])}function bI(e){const t=e.properties.get("direction"),n=de(t.x,t.y,t.z);n[2]=$t(n[2],0,75);const r=te([n[0],n[1],n[2]]);return J.fromValues(r.x,r.y,r.z)}function mA(e,t){const n=e.properties.get("color"),r=e.properties.get("intensity"),i=e.properties.get("direction"),o=[i.x,i.y,i.z],s=t.properties.get("color"),a=t.properties.get("intensity"),c=Math.max(J.dot([0,0,1],o),0),h=[0,0,0];J.scale(h,s.toArray01Linear().slice(0,3),a);const d=[0,0,0];return J.scale(d,n.toArray01Linear().slice(0,3),c*r),pr([h[0]>0?h[0]/(h[0]+d[0]):0,h[1]>0?h[1]/(h[1]+d[1]):0,h[2]>0?h[2]/(h[2]+d[2]):0])}function BF(e,t,n,r,i,o){const s=e.zoom,a=e.scale,c=e.worldSize,h=1/c,d=e.aspect,m=Math.sqrt(1+d*d)*Math.tan(.5*e.fovX),g=m*m,x=r-n,v=r+n;let w,A;g>x/v?(w=r,A=r*m):(w=.5*v*(1+g),A=.5*Math.sqrt(x*x+2*(r*r+n*n)*g+v*v*g*g));const E=e.projection.pixelsPerMeter(e.center.lat,c),S=e._camera.getCameraToWorldMercator(),I=[0,0,-w*h];J.transformMat4(I,I,S);let B=A*h;const M=e._edgeInsets;if(!(M.left===0&&M.top===0&&M.right===0&&M.bottom===0||M.left===M.right&&M.top===M.bottom)){const pt=e._camera.getWorldToCamera(e.worldSize,e.projection.zAxisUnit==="meters"?E:1),dt=e._camera.getCameraToClipPerspective(e._fov,e.width/e.height,n,r);dt[8]=2*-e.centerOffset.x/e.width,dt[9]=2*e.centerOffset.y/e.height;const wt=new Float64Array(16);lt.mul(wt,dt,pt);const bt=new Float64Array(16);lt.invert(bt,wt);const Et=Rs.fromInvProjectionMatrix(bt,c,s,!0);for(const _t of Et.points){const Mt=((D=_t)[0]/=a,D[1]/=a,D[2]=Rn(D[2],e._center.lat),D);B=Math.max(B,J.len(J.subtract([],I,Mt)))}}var D;B*=i/(i-1);const R=Math.acos(t[2]),z=Math.atan2(-t[0],-t[1]),N=new G1;N.position=I,N.setPitchBearing(R,z);const V=N.getWorldToCamera(c,E),j=B*c,H=Math.min(e._mercatorZfromZoom(17)*c*-2,-2*j),$=N.getCameraToClipOrthographic(-j,j,-j,j,H,(j+o*E)/t[2]),G=new Float64Array(16);lt.multiply(G,$,V);const Q=J.fromValues(Math.floor(1e6*I[0])/1e6*c,Math.floor(1e6*I[1])/1e6*c,0),et=.5*i,st=[0,0,0];J.transformMat4(st,Q,G),J.scale(st,st,et);const Y=[Math.floor(st[0]),Math.floor(st[1]),Math.floor(st[2])],tt=[0,0,0];J.sub(tt,st,Y),J.scale(tt,tt,-1/et);const ct=new Float64Array(16);return lt.identity(ct),lt.translate(ct,ct,tt),lt.multiply(G,ct,G),[G,j]}class DF extends Sr{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.numModelsLoading={}}loadModel(t,n){return gM(this.requestManager.transformRequest(n,At.Model).url).then(r=>{if(!r)return;const i=tA(r),o=new fS(t,void 0,void 0,i);return o.computeBoundsAndApplyParent(),o}).catch(r=>{this.fire(new Ie(new Error(`Could not load model ${t} from ${n}: ${r.message}`)))})}load(t,n){this.models[n]||(this.models[n]={});const r=Object.keys(t);this.numModelsLoading[n]=(this.numModelsLoading[n]||0)+r.length;const i=[];for(const o of r)i.push(this.loadModel(o,t[o]));Promise.allSettled(i).then(o=>{for(let s=0;s<o.length;s++){const{status:a,value:c}=o[s];a==="fulfilled"&&c&&(this.models[n][r[s]]=c)}this.numModelsLoading[n]-=r.length,this.fire(new Nt("data",{dataType:"style"}))}).catch(o=>{this.fire(new Ie(new Error(`Could not load models: ${o.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,n){return!!this.getModel(t,n)}getModel(t,n){return this.models[n]||(this.models[n]={}),this.models[n][t]}addModel(t,n,r){this.models[r]||(this.models[r]={}),this.hasModel(t,r)&&this.removeModel(t,r),this.load({[t]:this.requestManager.normalizeModelURL(n)},r)}addModels(t,n){const r={};for(const i in t)r[i]=this.requestManager.normalizeModelURL(t[i]);this.load(r,n)}removeModel(t,n){this.models[n]||(this.models[n]={});const r=this.models[n][t];delete this.models[n][t],r.destroy()}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,n){this.models[n]||(this.models[n]={});for(const r in this.models[n])this.models[n][r].upload(t.context)}}const zg=(e,t)=>Df(e,t&&t.filter(n=>n.identifier!=="source.canvas")),PF=fi(Tn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),LF=fi(Tn,["setCenter","setZoom","setBearing","setPitch"]),AI={version:8,layers:[],sources:{}},EI={duration:300,delay:0},RF=new Set(["fill","line","background","hillshade","raster"]);class va extends Sr{constructor(t,n={}){super(),this.map=t,this.scope=n.scope||"",this.fragments=[],this.importDepth=n.importDepth||0,this.importsCache=n.importsCache||new Map,this.resolvedImports=n.resolvedImports||new Set,this.transition=re({},EI),this._buildingIndex=new rk(this),this.crossTileSymbolIndex=new Ck,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=n.styleChanges||new C0,this.dispatcher=n.dispatcher?n.dispatcher:new Ih(Rg(),this),n.imageManager?this.imageManager=n.imageManager:(this.imageManager=new PR,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=n.glyphManager?n.glyphManager:new _d(t._requestManager,n.localFontFamily?2:n.localIdeographFontFamily?1:0,n.localFontFamily||n.localIdeographFontFamily),n.modelManager?this.modelManager=n.modelManager:(this.modelManager=new DF(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=new Map,this._configDependentLayers=new Set,this._config=n.config,this.dispatcher.broadcast("setReferrer",kt());const r=this;this._rtlTextPluginCallback=va.registerForPluginStateChange(i=>{r.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:i.pluginStatus,pluginURL:i.pluginURL},(o,s)=>{if(Rf(o),s&&s.every(a=>a))for(const a in r._sourceCaches){const c=r._sourceCaches[a],h=c.getSource().type;h!=="vector"&&h!=="geojson"||c.reload()}})}),this.on("data",i=>{if(i.dataType!=="source"||i.sourceDataType!=="metadata")return;const o=this.getOwnSource(i.sourceId);if(o&&o.vectorLayerIds)for(const s in this._layers){const a=this._layers[s];a.source===o.id&&this._validateLayer(a)}})}loadURL(t,n={}){this.fire(new Nt("dataloading",{dataType:"style"}));const r=typeof n.validate=="boolean"?n.validate:!Sn(t);t=this.map._requestManager.normalizeStyleURL(t,n.accessToken),this.resolvedImports.add(t);const i=this.importsCache.get(t);if(i)return this._load(i,r);const o=this.map._requestManager.transformRequest(t,At.Style);this._request=jt(o,(s,a)=>{if(this._request=null,s)this.fire(new Ie(s));else if(a)return this.importsCache.set(t,a),this._load(a,r)})}loadJSON(t,n={}){this.fire(new Nt("dataloading",{dataType:"style"})),this._request=ze.frame(()=>{this._request=null,this._load(t,n.validate!==!1)})}loadEmpty(){this.fire(new Nt("dataloading",{dataType:"style"})),this._load(AI,!1)}_loadImports(t,n){if(this.importDepth>=4)return rt("Style doesn't support nesting deeper than 5"),Promise.resolve();const r=[];for(const i of t){const o=this._createFragmentStyle(i),s=new Promise(c=>{o.once("style.import.load",c),o.once("error",c)}).then(()=>this.mergeAll());if(r.push(s),this.resolvedImports.has(i.url)){o.loadEmpty();continue}const a=i.data||this.importsCache.get(i.url);a?o.loadJSON(a,{validate:n}):i.url?o.loadURL(i.url,{validate:n}):o.loadEmpty(),this.fragments.push({style:o,id:i.id,config:i.config})}return Promise.allSettled(r)}_createFragmentStyle(t){const n=this.scope?wi(t.id,this.scope):t.id,r=new va(this.map,{scope:n,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:t.config});return r.setEventedParent(this.map,{style:r}),r}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const t=this.isRootStyle();this._shouldPrecompile=t,this.fire(new Nt(t?"style.load":"style.import.load"))}_load(t,n){const r=t.schema;if(this.isRootStyle()&&(t.fragment||r&&t.fragment!==!1)){const s=re({},AI,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(s,n)}if(this.setConfig(this._config,r),n&&zg(this,Rl(t)))return;this._loaded=!0,this.stylesheet=q(t);for(const s in t.sources)this.addSource(s,t.sources[s],{validate:!1,isInitialLoad:!0});t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);const i=wM(this.stylesheet.layers);if(this._order=i.map(s=>s.id),this.stylesheet.light&&rt("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const s=this.stylesheet.lights[0];this.light=new JS(s.properties,s.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new JS(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const s of i){const a=K1(s,this.options);a.setScope(this.scope),a.isConfigDependent&&this._configDependentLayers.add(a.fqid),a.setEventedParent(this,{layer:{id:a.id}}),this._layers[a.id]=a,this._serializedLayers[a.id]=a.serialize();const c=this.getOwnLayerSourceCache(a),h=!!this.directionalLight&&this.directionalLight.shadowsEnabled();c&&a.canCastShadows()&&h&&(c.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const o=this.stylesheet.terrain;o&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=ze.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?rt("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(o,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new Nt("data",{dataType:"style"})),t.imports?this._loadImports(t.imports,n).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,n,r,i,o,s,a,c;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(h=>{if(h.stylesheet){if(h.light!=null&&(t=h.light),h.stylesheet.lights)for(const d of h.stylesheet.lights)d.type==="ambient"&&h.ambientLight!=null&&(n=h.ambientLight),d.type==="directional"&&h.directionalLight!=null&&(r=h.directionalLight);i=this._prioritizeTerrain(i,h.terrain,h.stylesheet.terrain),h.stylesheet.fog&&h.fog!=null&&(o=h.fog),h.stylesheet.camera!=null&&(c=h.stylesheet.camera),h.stylesheet.projection!=null&&(s=h.stylesheet.projection),h.stylesheet.transition!=null&&(a=h.stylesheet.transition)}}),this.light=t,this.ambientLight=n,this.directionalLight=r,this.fog=o,i===null?delete this.terrain:this.terrain=i,this.camera=c||{"camera-projection":"perspective"},this.projection=s||{name:"mercator"},this.transition=re({},EI,a),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const n=r=>{for(const i of r.fragments)n(i.style);t(r)};n(this)}_prioritizeTerrain(t,n,r){const i=t&&t.drapeRenderMode===0;return r===null?n&&n.drapeRenderMode===0?n:i?t:null:n!=null&&(!t||i||n&&n.drapeRenderMode===1)?n:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(n=>{t=this._prioritizeTerrain(t,n.terrain,n.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(n=>{n.stylesheet.projection!=null&&(t=n.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},n={},r={};this.forEachFragmentStyle(i=>{for(const o in i._sourceCaches){const s=wi(o,i.scope);t[s]=i._sourceCaches[o]}for(const o in i._otherSourceCaches){const s=wi(o,i.scope);n[s]=i._otherSourceCaches[o]}for(const o in i._symbolSourceCaches){const s=wi(o,i.scope);r[s]=i._symbolSourceCaches[o]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=n,this._mergedSymbolSourceCaches=r}mergeLayers(){const t={},n=[],r={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(o=>{for(const s of o._order){const a=o._layers[s];if(a.type==="slot"){const c=rh(s);if(t[c])continue;t[c]=[]}a.slot&&t[a.slot]?t[a.slot].push(a):n.push(a)}}),this._mergedOrder=[];const i=(o=[])=>{for(const s of o)if(s.type==="slot"){const a=rh(s.id);t[a]&&i(t[a])}else{const a=wi(s.id,s.scope);this._mergedOrder.push(a),r[a]=s,s.is3D()&&(this._has3DLayers=!0),s.type==="circle"&&(this._hasCircleLayers=!0),s.type==="symbol"&&(this._hasSymbolLayers=!0)}};i(n),this._mergedLayers=r,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=re({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(n,r,i){let o,s,a;const c=ze.devicePixelRatio>1?"@2x":"";let h=jt(r.transformRequest(r.normalizeSpriteURL(n,c,".json"),At.SpriteJSON),(g,x)=>{h=null,a||(a=g,o=x,m())}),d=Ze(r.transformRequest(r.normalizeSpriteURL(n,c,".png"),At.SpriteImage),(g,x)=>{d=null,a||(a=g,s=x,m())});function m(){if(a)i(a);else if(o&&s){const g=ze.getImageData(s),x={};for(const v in o){const{width:w,height:A,x:E,y:S,sdf:I,pixelRatio:B,stretchX:M,stretchY:D,content:R}=o[v],z=new Er({width:w,height:A});Er.copy(g,z,{x:E,y:S},{x:0,y:0},{width:w,height:A}),x[v]={data:z,pixelRatio:B,sdf:I,stretchX:M,stretchY:D,content:R}}i(null,x)}}return{cancel(){h&&(h.cancel(),h=null),d&&(d.cancel(),d=null)}}}(t,this.map._requestManager,(n,r)=>{if(this._spriteRequest=null,n)this.fire(new Ie(n));else if(r)for(const i in r)this.imageManager.addImage(i,this.scope,r[i]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new Nt("data",{dataType:"style"}))})}_validateLayer(t){const n=this.getOwnSource(t.source);if(!n)return;const r=t.sourceLayer;r&&(n.type==="geojson"||n.vectorLayerIds&&n.vectorLayerIds.indexOf(r)===-1)&&this.fire(new Ie(new Error(`Source layer "${r}" does not exist on source "${n.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,n)=>{const r=this.fragments[n];return r&&r.style&&(t.data=r.style.serialize()),t})}_serializeSources(){const t={};for(const n in this._sourceCaches){const r=this._sourceCaches[n].getSource();t[r.id]||(t[r.id]=r.serialize())}return t}_serializeLayers(t){const n=[];for(const r of t){const i=this._layers[r];i&&i.type!=="custom"&&n.push(i.serialize())}return n}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&(typeof t.isLayerDraped=="function"?t.isLayerDraped(this.getLayerSourceCache(t)):RF.has(t.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const n=this.getOwnLayer(t);if(n)return n;this.fire(new Ie(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const n=this.getOwnSource(t);if(n)return n;this.fire(new Ie(new Error(`The source '${t}' does not exist in the map's style.`)))}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const n=this.calculateLightsBrightness();t.brightness=n||0,n!==this._brightness&&(this._brightness=n,this.dispatcher.broadcast("setBrightness",n));const r=this._changes.isDirty();if(this._changes.isDirty()){const o=this._changes.getLayerUpdatesByScope();for(const s in o){const{updatedIds:a,removedIds:c}=o[s];(a||c)&&this._updateWorkerLayers(s,a,c)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._changes.reset()}const i={};for(const o in this._mergedSourceCaches){const s=this._mergedSourceCaches[o];i[o]=s.used,s.used=!1}for(const o of this._mergedOrder){const s=this._mergedLayers[o];if(s.recalculate(t,this._availableImages),!s.isHidden(t.zoom)){const a=this.getLayerSourceCache(s);a&&(a.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let a=s.minzoom||0;a<(s.maxzoom||25.5);a++){const c=this.map.painter;if(c){const h=s.getProgramIds();if(!h)continue;for(const d of h){const m=s.getDefaultProgramParams(d,t.zoom);m&&(c.style=this,this.fog&&(c._fogVisible=!0,m.overrideFog=!0,c.getOrCreateProgram(d,m)),c._fogVisible=!1,m.overrideFog=!1,c.getOrCreateProgram(d,m),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(m.overrideRtt=!0,c.getOrCreateProgram(d,m)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const o in i){const s=this._mergedSourceCaches[o];i[o]!==s.used&&s.getSource().fire(new Nt("data",{sourceDataType:"visibility",dataType:"source",sourceId:s.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),r&&this.fire(new Nt("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=this._changes.getUpdatedImages();if(t.length){for(const n in this._sourceCaches)this._sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,n,r){const i=this.getFragmentStyle(t);i&&this.dispatcher.broadcast("updateLayers",{layers:n?i._serializeLayers(n):[],scope:t,removedIds:r||[],options:i.options})}setState(t){if(this._checkLoaded(),zg(this,Rl(t)))return!1;(t=q(t)).layers=wM(t.layers);const n=function(i,o){if(!i)return[{command:Tn.setStyle,args:[o]}];let s=[];try{if(!Re(i.version,o.version))return[{command:Tn.setStyle,args:[o]}];Re(i.center,o.center)||s.push({command:Tn.setCenter,args:[o.center]}),Re(i.zoom,o.zoom)||s.push({command:Tn.setZoom,args:[o.zoom]}),Re(i.bearing,o.bearing)||s.push({command:Tn.setBearing,args:[o.bearing]}),Re(i.pitch,o.pitch)||s.push({command:Tn.setPitch,args:[o.pitch]}),Re(i.sprite,o.sprite)||s.push({command:Tn.setSprite,args:[o.sprite]}),Re(i.glyphs,o.glyphs)||s.push({command:Tn.setGlyphs,args:[o.glyphs]}),Re(i.imports,o.imports)||function(m=[],g=[],x){g=g||[];const v=(m=m||[]).map(ex),w=g.map(ex),A=m.reduce(nx,{}),E=g.reduce(nx,{}),S=v.slice();let I,B,M,D;for(I=0,B=0;I<v.length;I++)M=v[I],E.hasOwnProperty(M)?B++:(x.push({command:Tn.removeImport,args:[M]}),S.splice(S.indexOf(M,B),1));for(I=0,B=0;I<w.length;I++)M=w[w.length-1-I],S[S.length-1-I]!==M&&(A.hasOwnProperty(M)?(x.push({command:Tn.removeImport,args:[M]}),S.splice(S.lastIndexOf(M,S.length-B),1)):B++,D=S[S.length-I],x.push({command:Tn.addImport,args:[E[M],D]}),S.splice(S.length-I,0,M));for(const R of g){const z=A[R.id];if(!z||Re(z,R))continue;Re(z.config,R.config)||x.push({command:Tn.setImportConfig,args:[R.id,R.config]}),Re(z.url,R.url)||x.push({command:Tn.setImportUrl,args:[R.id,R.url]});const N=R.data;Re(z&&z.data,N)||x.push({command:Tn.setImportData,args:[R.id,N]})}}(i.imports,o.imports,s),Re(i.transition,o.transition)||s.push({command:Tn.setTransition,args:[o.transition]}),Re(i.light,o.light)||s.push({command:Tn.setLight,args:[o.light]}),Re(i.fog,o.fog)||s.push({command:Tn.setFog,args:[o.fog]}),Re(i.projection,o.projection)||s.push({command:Tn.setProjection,args:[o.projection]}),Re(i.lights,o.lights)||s.push({command:Tn.setLights,args:[o.lights]}),Re(i.camera,o.camera)||s.push({command:Tn.setCamera,args:[o.camera]});const a={},c=[];(function(m,g,x,v){let w;for(w in g=g||{},m=m||{})m.hasOwnProperty(w)&&(g.hasOwnProperty(w)||AM(w,x,v));for(w in g){if(!g.hasOwnProperty(w))continue;const A=g[w];m.hasOwnProperty(w)?Re(m[w],A)||(m[w].type==="geojson"&&A.type==="geojson"&&sk(m,g,w)?x.push({command:Tn.setGeoJSONSourceData,args:[w,A.data]}):ok(w,g,x,v)):bM(w,g,x)}})(i.sources,o.sources,c,a);const h=[];i.layers&&i.layers.forEach(m=>{m.source&&a[m.source]?s.push({command:Tn.removeLayer,args:[m.id]}):h.push(m)});let d=i.terrain;d&&a[d.source]&&(s.push({command:Tn.setTerrain,args:[void 0]}),d=void 0),s=s.concat(c),Re(d,o.terrain)||s.push({command:Tn.setTerrain,args:[o.terrain]}),function(m,g,x){g=g||[];const v=(m=m||[]).map(ex),w=g.map(ex),A=m.reduce(nx,{}),E=g.reduce(nx,{}),S=v.slice(),I=Object.create(null);let B,M,D,R,z,N,V;for(B=0,M=0;B<v.length;B++)D=v[B],E.hasOwnProperty(D)?M++:(x.push({command:Tn.removeLayer,args:[D]}),S.splice(S.indexOf(D,M),1));for(B=0,M=0;B<w.length;B++)D=w[w.length-1-B],S[S.length-1-B]!==D&&(A.hasOwnProperty(D)?(x.push({command:Tn.removeLayer,args:[D]}),S.splice(S.lastIndexOf(D,S.length-M),1)):M++,N=S[S.length-B],x.push({command:Tn.addLayer,args:[E[D],N]}),S.splice(S.length-B,0,D),I[D]=!0);for(B=0;B<w.length;B++)if(D=w[B],R=A[D],z=E[D],!I[D]&&!Re(R,z))if(Re(R.source,z.source)&&Re(R["source-layer"],z["source-layer"])&&Re(R.type,z.type)){for(V in tx(R.layout,z.layout,x,D,null,Tn.setLayoutProperty),tx(R.paint,z.paint,x,D,null,Tn.setPaintProperty),Re(R.slot,z.slot)||x.push({command:Tn.setSlot,args:[D,z.slot]}),Re(R.filter,z.filter)||x.push({command:Tn.setFilter,args:[D,z.filter]}),Re(R.minzoom,z.minzoom)&&Re(R.maxzoom,z.maxzoom)||x.push({command:Tn.setLayerZoomRange,args:[D,z.minzoom,z.maxzoom]}),R)R.hasOwnProperty(V)&&V!=="layout"&&V!=="paint"&&V!=="filter"&&V!=="metadata"&&V!=="minzoom"&&V!=="maxzoom"&&V!=="slot"&&(V.indexOf("paint.")===0?tx(R[V],z[V],x,D,V.slice(6),Tn.setPaintProperty):Re(R[V],z[V])||x.push({command:Tn.setLayerProperty,args:[D,V,z[V]]}));for(V in z)z.hasOwnProperty(V)&&!R.hasOwnProperty(V)&&V!=="layout"&&V!=="paint"&&V!=="filter"&&V!=="metadata"&&V!=="minzoom"&&V!=="maxzoom"&&V!=="slot"&&(V.indexOf("paint.")===0?tx(R[V],z[V],x,D,V.slice(6),Tn.setPaintProperty):Re(R[V],z[V])||x.push({command:Tn.setLayerProperty,args:[D,V,z[V]]}))}else x.push({command:Tn.removeLayer,args:[D]}),N=S[S.lastIndexOf(D)+1],x.push({command:Tn.addLayer,args:[z,N]})}(h,o.layers,s)}catch(a){console.warn("Unable to compute style diff:",a),s=[{command:Tn.setStyle,args:[o]}]}return s}(this.serialize(),t).filter(i=>!(i.command in LF));if(n.length===0)return!1;const r=n.filter(i=>!(i.command in PF));if(r.length>0)throw new Error(`Unimplemented: ${r.map(i=>i.command).join(", ")}.`);return n.forEach(i=>{this[i.command].apply(this,i.args)}),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,n){return this.getImage(t)?this.fire(new Ie(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,n),this._afterImageUpdated(t),this)}updateImage(t,n){this.imageManager.updateImage(t,this.scope,n)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new Ie(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(t),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new Nt("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,n,r={}){return this._checkLoaded(),this._validate(In,`models.${t}`,n,null,r)||(this.modelManager.addModel(t,n,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new Ie(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,n,r={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(v0,`sources.${t}`,n,null,r))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const i=nA(t,n,this.dispatcher,this);i.scope=this.scope,i.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(i.id),source:i.serialize(),sourceId:i.id}));const o=s=>{const a=(s?"symbol:":"other:")+i.id,c=wi(a,this.scope),h=this._sourceCaches[a]=new _a(c,i,s);(s?this._symbolSourceCaches:this._otherSourceCaches)[i.id]=h,h.onAdd(this.map)};o(!1),n.type!=="vector"&&n.type!=="geojson"||o(!0),i.onAdd&&i.onAdd(this.map),r.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const n=this.getOwnSource(t);if(!n)throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===t)return this.fire(new Ie(new Error(`Source "${t}" cannot be removed while layer "${i}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new Ie(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const r=this.getOwnSourceCaches(t);for(const i of r){const o=rh(i.id);delete this._sourceCaches[o],this._changes.discardSourceCacheUpdate(i.id),i.fire(new Nt("data",{sourceDataType:"metadata",dataType:"source",sourceId:i.getSource().id})),i.setEventedParent(null),i.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,n){this._checkLoaded(),this.getOwnSource(t).setData(n),this._changes.setDirty()}getOwnSource(t){const n=this.getOwnSourceCache(t);return n&&n.getSource()}getOwnSources(){const t=[];for(const n in this._otherSourceCaches){const r=this.getOwnSourceCache(n);r&&t.push(r.getSource())}return t}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const n=this._getTransitionParameters();for(const i of t){if(this._validate(w0,"lights",i))return;switch(i.type){case"ambient":if(this.ambientLight){const o=this.ambientLight;o.set(i),o.updateTransitions(n)}else this.ambientLight=new eM(i,UR,this.scope,this.options);break;case"directional":if(this.directionalLight){const o=this.directionalLight;o.set(i),o.updateTransitions(n)}else this.directionalLight=new eM(i,VR,this.scope,this.options)}}const r=new rr(this.z||0,n);this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,n=this.ambientLight;if(!t||!n)return;const r=m=>.2126*(m[0]<=.03928?m[0]/12.92:Math.pow((m[0]+.055)/1.055,2.4))+.7152*(m[1]<=.03928?m[1]/12.92:Math.pow((m[1]+.055)/1.055,2.4))+.0722*(m[2]<=.03928?m[2]/12.92:Math.pow((m[2]+.055)/1.055,2.4)),i=t.properties.get("color").toArray01(),o=t.properties.get("intensity"),s=t.properties.get("direction"),a=1-de(s.x,s.y,s.z)[2]/90,c=r(i)*o*a,h=n.properties.get("color").toArray01(),d=n.properties.get("intensity");return(c+r(h)*d)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(Fu(t)){const n=function(o){const s=o.indexOf(oa);return s>=0?o.slice(s+1):""}(t),r=this.fragments.find(({id:o})=>o===n);if(!r)throw new Error(`Style import not found: ${t}`);const i=rh(t);return r.style.getFragmentStyle(i)}{const n=this.fragments.find(({id:r})=>r===t);if(!n)throw new Error(`Style import not found: ${t}`);return n.style}}getConfigProperty(t,n){const r=this.getFragmentStyle(t);if(!r)return null;const i=r.options.get(n),o=i?i.value||i.default:null;return o?o.serialize():null}setConfigProperty(t,n,r){const i=ta(r);if(i.result!=="success")return void zg(this,i.value);const o=i.value.expression,s=this.getFragmentStyle(t);if(!s)return;const a=s.options.get(n);a&&(s.options.set(n,{...a,value:o}),s.updateConfigDependencies())}setConfig(t,n){if(this._config=t,t||n)if(n){this.options.clear();for(const r in n){let i,o;const s=ta(n[r].default);if(s.result==="success"&&(i=s.value.expression),t&&t[r]!==void 0){const g=ta(t[r]);g.result==="success"&&(o=g.value.expression)}const{minValue:a,maxValue:c,stepValue:h,type:d,values:m}=n[r];i?this.options.set(r,{default:i,value:o,minValue:a,maxValue:c,stepValue:h,type:d,values:m}):this.fire(new Ie(new Error(`No schema defined for config option "${r}".`)))}}else this.fire(new Ie(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const t of this._configDependentLayers){const n=this.getLayer(t);n&&(n.possiblyEvaluateVisibility(),this._updateLayer(n))}this.ambientLight&&this.ambientLight.scope===this.scope&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.scope===this.scope&&this.directionalLight.updateConfig(this.options),this._changes.setDirty()}addLayer(t,n,r={}){this._checkLoaded();const i=t.id;if(this._layers[i])return void this.fire(new Ie(new Error(`Layer with id "${i}" already exists on this map`)));let o;if(t.type==="custom"){if(zg(this,function(d){const m=[],g=d.id;return g===void 0&&m.push({message:`layers.${g}: missing required property "id"`}),d.render===void 0&&m.push({message:`layers.${g}: missing required method "render"`}),d.renderingMode&&d.renderingMode!=="2d"&&d.renderingMode!=="3d"&&m.push({message:`layers.${g}: property "renderingMode" must be either "2d" or "3d"`}),m}(t)))return;o=K1(t,this.options)}else{if(typeof t.source=="object"&&(this.addSource(i,t.source),t=re(t=q(t),{source:i})),this._validate(b0,`layers.${i}`,t,{arrayIndex:-1},r))return;o=K1(t,this.options),this._validateLayer(o),o.setEventedParent(this,{layer:{id:i}}),this._serializedLayers[o.id]=o.serialize()}o.isConfigDependent&&this._configDependentLayers.add(o.fqid),o.setScope(this.scope);let s=this._order.length;if(n){const d=this._order.indexOf(n);if(d===-1)return void this.fire(new Ie(new Error(`Layer with id "${n}" does not exist on this map.`)));o.slot===this._layers[n].slot?s=d:rt(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(s,0,i),this._layerOrderChanged=!0,this._layers[i]=o;const a=this.getOwnLayerSourceCache(o),c=!!this.directionalLight&&this.directionalLight.shadowsEnabled();a&&o.canCastShadows()&&c&&(a.castsShadows=!0);const h=this._changes.getRemovedLayer(o);if(h&&o.source&&a&&o.type!=="custom"){this._changes.discardLayerRemoval(o);const d=wi(o.source,o.scope);h.type!==o.type?this._changes.updateSourceCache(d,"clear"):(this._changes.updateSourceCache(d,"reload"),a.pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map),o.scope=this.scope,this.mergeLayers()}moveLayer(t,n){this._checkLoaded();const r=this._checkLayer(t);if(!r||t===n)return;const i=this._order.indexOf(t);this._order.splice(i,1);let o=this._order.length;if(n){const s=this._order.indexOf(n);if(s===-1)return void this.fire(new Ie(new Error(`Layer with id "${n}" does not exist on this map.`)));r.slot===this._layers[n].slot?o=s:rt(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(o,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const n=this._checkLayer(t);if(!n)return;n.setEventedParent(null);const r=this._order.indexOf(t);this._order.splice(r,1),delete this._layers[t],delete this._serializedLayers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(n.fqid),this._changes.removeLayer(n);const i=this.getOwnLayerSourceCache(n);if(i&&i.castsShadows){let o=!1;for(const s in this._layers)if(this._layers[s].source===n.source&&this._layers[s].canCastShadows()){o=!0;break}i.castsShadows=o}n.onRemove&&n.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const n in this._layers)if(this._layers[n].type===t)return!0;return!1}setLayerZoomRange(t,n,r){this._checkLoaded();const i=this._checkLayer(t);i&&(i.minzoom===n&&i.maxzoom===r||(n!=null&&(i.minzoom=n),r!=null&&(i.maxzoom=r),this._updateLayer(i)))}setSlot(t,n){this._checkLoaded();const r=this._checkLayer(t);r&&r.slot!==n&&(r.slot=n,this._updateLayer(r))}setFilter(t,n,r={}){this._checkLoaded();const i=this._checkLayer(t);if(i&&!Re(i.filter,n))return n==null?(i.filter=void 0,void this._updateLayer(i)):void(this._validate(Xc,`layers.${i.id}.filter`,n,{layerType:i.type},r)||(i.filter=q(n),this._updateLayer(i)))}getFilter(t){const n=this._checkLayer(t);if(n)return q(n.filter)}setLayoutProperty(t,n,r,i={}){this._checkLoaded();const o=this._checkLayer(t);o&&(Re(o.getLayoutProperty(n),r)||(o.setLayoutProperty(n,r,i),o.isConfigDependent&&this._configDependentLayers.add(o.fqid),this._updateLayer(o)))}getLayoutProperty(t,n){const r=this._checkLayer(t);if(r)return r.getLayoutProperty(n)}setPaintProperty(t,n,r,i={}){this._checkLoaded();const o=this._checkLayer(t);if(!o||Re(o.getPaintProperty(n),r))return;const s=o.setPaintProperty(n,r,i);o.isConfigDependent&&this._configDependentLayers.add(o.fqid),s&&this._updateLayer(o),this._changes.updatePaintProperties(o)}getPaintProperty(t,n){const r=this._checkLayer(t);if(r)return r.getPaintProperty(n)}setFeatureState(t,n){this._checkLoaded();const r=t.source,i=t.sourceLayer,o=this._checkSource(r);if(!o)return;const s=o.type;if(s==="geojson"&&i)return void this.fire(new Ie(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(s==="vector"&&!i)return void this.fire(new Ie(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new Ie(new Error("The feature id parameter must be provided.")));const a=this.getOwnSourceCaches(r);for(const c of a)c.setFeatureState(i,t.id,n)}removeFeatureState(t,n){this._checkLoaded();const r=t.source,i=this._checkSource(r);if(!i)return;const o=i.type,s=o==="vector"?t.sourceLayer:void 0;if(o==="vector"&&!s)return void this.fire(new Ie(new Error("The sourceLayer parameter must be provided for vector source types.")));if(n&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new Ie(new Error("A feature id is required to remove its specific state property.")));const a=this.getOwnSourceCaches(r);for(const c of a)c.removeFeatureState(s,t.id,n)}getFeatureState(t){this._checkLoaded();const n=t.source,r=t.sourceLayer,i=this._checkSource(n);if(i){if(i.type!=="vector"||r)return t.id===void 0&&this.fire(new Ie(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(n)[0].getFeatureState(r,t.id);this.fire(new Ie(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=re({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return re({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),n=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return Ot({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:n,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},r=>r!==void 0)}_updateLayer(t){this._changes.updateLayer(t);const n=this.getLayerSourceCache(t),r=wi(t.source,t.scope),i=this._changes.getUpdatedSourceCaches();t.source&&!i[r]&&n&&n.getSource().type!=="raster"&&(this._changes.updateSourceCache(r,"reload"),n.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const n=a=>this._mergedLayers[a].type==="fill-extrusion",r=this.order,i={},o=[];for(let a=r.length-1;a>=0;a--){const c=r[a];if(n(c)){i[c]=a;for(const h of t){const d=h[c];if(d)for(const m of d)o.push(m)}}}o.sort((a,c)=>c.intersectionZ-a.intersectionZ);const s=[];for(let a=r.length-1;a>=0;a--){const c=r[a];if(n(c))for(let h=o.length-1;h>=0;h--){const d=o[h].feature;if(i[d.layer.id]<a)break;s.push(d),o.pop()}else for(const h of t){const d=h[c];if(d)for(const m of d)s.push(m.feature)}}return s}queryRenderedFeatures(t,n,r){n&&n.filter&&this._validate(Xc,"queryRenderedFeatures.filter",n.filter,null,n),n.scope=this.scope,n.availableImages=this._availableImages,n.serializedLayers=this._serializedLayers;const i={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new Ie(new Error("parameters.layers must be an Array."))),[];for(const h of n.layers){const d=this._mergedLayers[h];if(!d)return this.fire(new Ie(new Error(`The layer '${h}' does not exist in the map's style and cannot be queried for features.`))),[];i[d.source]=!0}}const o=[],s=n.serializedLayers||{},a=n&&n.layers?n.layers.some(h=>{const d=this.getLayer(h);return d&&d.is3D()}):this.has3DLayers(),c=Vb.createFromScreenPoints(t,r);for(const h in this._mergedSourceCaches){const d=this._mergedSourceCaches[h].getSource();if(!d||d.scope!==n.scope)continue;const m=this._mergedSourceCaches[h].getSource().id;n.layers&&!i[m]||o.push(ek(this._mergedSourceCaches[h],this._mergedLayers,s,c,n,r,a,!!this.map._showQueryGeometry))}return this.placement&&o.push(function(h,d,m,g,x,v,w){const A={},E=v.queryRenderedSymbols(g),S=[];for(const I of Object.keys(E).map(Number))S.push(w[I]);S.sort(xM);for(const I of S){const B=I.featureIndex.lookupSymbolFeatures(E[I.bucketInstanceId],d,I.bucketIndex,I.sourceLayerIndex,x.filter,x.layers,x.availableImages,h);for(const M in B){const D=A[M]=A[M]||[],R=B[M];R.sort((z,N)=>{const V=I.featureSortOrder;if(V){const j=V.indexOf(z.featureIndex);return V.indexOf(N.featureIndex)-j}return N.featureIndex-z.featureIndex});for(const z of R)D.push(z)}}for(const I in A)A[I].forEach(B=>{const M=B.feature,D=m(h[I]);if(!D)return;const R=D.getFeatureState(M.layer["source-layer"],M.id);M.source=M.layer.source,M.layer["source-layer"]&&(M.sourceLayer=M.layer["source-layer"]),M.state=R});return A}(this._mergedLayers,s,this.getLayerSourceCache.bind(this),c.screenGeometry,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(t,n){n&&n.filter&&this._validate(Xc,"querySourceFeatures.filter",n.filter,null,n);const r=this.getOwnSourceCaches(t);let i=[];for(const o of r)i=i.concat(nk(o,n));return i}addSourceType(t,n,r){return va.getSourceType(t)?r(new Error(`A source type called "${t}" already exists.`)):(va.setSourceType(t,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:n.workerSourceURL},r):r(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,n,r={}){this._checkLoaded();const i=this.light.getLight();let o=!1;for(const a in t)if(!Re(t[a],i[a])){o=!0;break}if(!o)return;const s=this._getTransitionParameters();this.light.setLight(t,n,r),this.light.updateTransitions(s)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(t,n=1){if(this._checkLoaded(),!t)return delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let r=t;const i=t.source==null;if(n===1){if(typeof r.source=="object"){const a="terrain-dem-src";this.addSource(a,r.source),r=q(r),r=re(r,{source:a})}const o=re({},r),s={};if(this.terrain&&i){o.source=this.terrain.get().source;const a=this.terrain?this.getFragmentStyle(this.terrain.scope):null;a&&(s.style=a.serialize())}if(this._validate(pw,"terrain",o,s))return}if(!this.terrain||this.terrain.scope!==this.scope&&!i||this.terrain&&n!==this.terrain.drapeRenderMode){if(!r)return;this._createTerrain(r,n),this.fire(new Nt("data",{dataType:"style"}))}else{const o=this.terrain,s=o.get();for(const a of Object.keys(ut.terrain))!r.hasOwnProperty(a)&&ut.terrain[a].default&&(r[a]=ut.terrain[a].default);for(const a in t)if(!Re(t[a],s[a])){o.set(t,this.options),this.stylesheet.terrain=t;const c=this._getTransitionParameters({duration:0});o.updateTransitions(c),this.fire(new Nt("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const n=this.fog=new zR(t,this.map.transform);this.stylesheet.fog=n.get();const r=this._getTransitionParameters({duration:0});n.updateTransitions(r)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const n=this.fog;if(!Re(n.get(),t)){n.set(t),this.stylesheet.fog=n.get();const r=this._getTransitionParameters({duration:0});n.updateTransitions(r)}}else this._createFog(t);this._markersNeedUpdate=!0}_getTransitionParameters(t){return{now:ze.now(),transition:re(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],n=[];for(const r in this._mergedLayers)this.isLayerDraped(this._mergedLayers[r])?t.push(r):n.push(r);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...n)}_createTerrain(t,n){const r=this.terrain=new kR(t,n,this.scope,this.options);n===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const i=this._getTransitionParameters({duration:0});r.updateTransitions(i)}_force3DLayerUpdate(){for(const t in this._layers){const n=this._layers[t];n.type==="fill-extrusion"&&this._updateLayer(n)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const n=this._layers[t];n.type==="symbol"&&this._updateLayer(n)}}_validate(t,n,r,i,o={}){if(o&&o.validate===!1)return!1;const s=re({},this.serialize());return zg(this,t.call(Rl,re({key:n,style:s,value:r,styleSpec:ut},i)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),cm.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){const n=this.getSourceCaches(t);for(const r of n)r.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const n=this.getSourceCaches(t);for(const r of n)r.resume(),r.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}updateSources(t){let n;this.directionalLight&&(n=bI(this.directionalLight));for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].update(t,void 0,void 0,n)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const n=this._sourceCaches[t];n.resume(),n.reload()}}_updatePlacement(t,n,r,i,o=!1){let s=!1,a=!1;const c={},h={};for(const d of this._mergedOrder){const m=this._mergedLayers[d];if(m.type!=="symbol")continue;const g=wi(m.source,m.scope);let x=c[g];if(!x){const w=this.getLayerSourceCache(m);if(!w)continue;const A=w.getRenderableIds(!0).map(E=>w.getTileByID(E));h[g]=A.slice(),x=c[g]=A.sort((E,S)=>S.tileID.overscaledZ-E.tileID.overscaledZ||(E.tileID.isLessThan(S.tileID)?-1:1))}const v=this.crossTileSymbolIndex.addLayer(m,x,t.center.lng,t.projection);s=s||v}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),o=o||this._layerOrderChanged||r===0,this._layerOrderChanged&&this.fire(new Nt("neworder")),(o||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ze.now(),t.zoom))&&(this.pauseablePlacement=new bk(t,this._mergedOrder,o,n,r,i,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,c,h),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ze.now()),a=!0),s&&this.pauseablePlacement.placement.setStale()),a||s)for(const d of this._mergedOrder){const m=this._mergedLayers[d];m.type==="symbol"&&this.placement.updateLayerOpacities(m,c[wi(m.source,m.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ze.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t){this._checkLoaded();const n=this.stylesheet.imports=this.stylesheet.imports||[];return n.findIndex(({id:i})=>i===t.id)!==-1?this.fire(new Ie(new Error(`Import with id '${t.id}' already exists in the map's style.`))):(n.push(t),this._loadImports([t],!0),this)}setImportUrl(t,n){this._checkLoaded();const r=this.stylesheet.imports||[],i=this.getImportIndex(t);if(i===-1)return this;r[i].url=n;const o=this.fragments[i];return o.style=this._createFragmentStyle(r[i]),o.style.on("style.import.load",()=>this.mergeAll()),o.style.loadURL(n),this}setImportData(t,n){this._checkLoaded();const r=this.getImportIndex(t),i=this.stylesheet.imports||[];return r===-1?this:n?(this.fragments[r].style.setState(n),this._reloadImports(),this):(delete i[r].data,this.setImportUrl(t,i[r].url))}setImportConfig(t,n){this._checkLoaded();const r=this.getImportIndex(t),i=this.stylesheet.imports||[];if(r===-1)return this;n?i[r].config=n:delete i[r].config;const o=this.fragments[r],s=o.style.stylesheet&&o.style.stylesheet.schema;return o.config=n,o.style.setConfig(n,s),o.style.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const n=this.stylesheet.imports||[],r=this.getImportIndex(t);return r===-1||(n.splice(r,1),this.fragments[r].style._remove(),this.fragments.splice(r,1),this._reloadImports()),this}getImportIndex(t){const n=(this.stylesheet.imports||[]).findIndex(r=>r.id===t);return n===-1&&this.fire(new Ie(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),n}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const n in this._mergedOtherSourceCaches){const r=this._mergedOtherSourceCaches[n];r&&t.push(r.getSource())}return t}getSource(t,n){const r=this.getSourceCache(t,n);return r&&r.getSource()}getLayerSource(t){const n=this.getLayerSourceCache(t);return n&&n.getSource()}getSourceCache(t,n){const r=wi(t,n);return this._mergedOtherSourceCaches[r]}getLayerSourceCache(t){const n=wi(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[n]:this._mergedOtherSourceCaches[n]}getSourceCaches(t){const n=[];return this._mergedOtherSourceCaches[t]&&n.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&n.push(this._mergedSymbolSourceCaches[t]),n}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const n in t){const r=t[n];r==="reload"?this.reloadSource(n):r==="clear"&&this.clearSource(n)}}updateLayers(t){const n=this._changes.getUpdatedPaintProperties();for(const r of n){const i=this.getLayer(r);i&&i.updateTransitions(t)}}getImages(t,n,r){this.imageManager.getImages(n.icons,n.scope,r),this._updateTilesForChangedImages();const i=o=>{o&&o.setDependencies(n.tileID.key,n.type,n.icons)};i(this._otherSourceCaches[n.source]),i(this._symbolSourceCaches[n.source])}getGlyphs(t,n,r){this.glyphManager.getGlyphs(n.stacks,n.scope,r)}getResource(t,n,r){return Ut(n,r)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const n=[];return this._otherSourceCaches[t]&&n.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&n.push(this._symbolSourceCaches[t]),n}_isSourceCacheLoaded(t){const n=this.getOwnSourceCaches(t);return n.length===0?(this.fire(new Ie(new Error(`There is no source with ID '${t}'`))),!1):n.every(r=>r.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function TI(e,t){let n=!1,r=null;const i=()=>{r=null,n&&(e(),r=setTimeout(i,t),n=!1)};return()=>(n=!0,r||i(),r)}va.getSourceType=function(e){return eA[e]},va.setSourceType=function(e,t){eA[e]=t},va.registerForPluginStateChange=function(e){return e({pluginStatus:qi,pluginURL:ra}),cm.on("pluginStateChange",e),e};class kF{constructor(t){this._hashName=t&&encodeURIComponent(t),Jn(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=TI(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,k.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),k.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const n=CI(t);if(this._hashName){const r=this._hashName;let i=!1;const o=k.location.hash.slice(1).split("&").map(s=>{const a=s.split("=")[0];return a===r?(i=!0,`${a}=${n}`):s}).filter(s=>s);return i||o.push(`${r}=${n}`),`#${o.join("&")}`}return`#${n}`}_getCurrentHash(){const t=k.location.hash.replace("#","");if(this._hashName){let n;return t.split("&").map(r=>r.split("=")).forEach(r=>{r[0]===this._hashName&&(n=r)}),(n&&n[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const n=this._getCurrentHash();if(n.length>=3&&!n.some(r=>isNaN(r))){const r=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(n[3]||0):t.getBearing();return t.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:r,pitch:+(n[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=k.location.href.replace(/(#.+)?$/,this.getHashString());k.history.replaceState(k.history.state,null,t)}}function CI(e,t){const n=e.getCenter(),r=Math.round(100*e.getZoom())/100,i=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,i),s=Math.round(n.lng*o)/o,a=Math.round(n.lat*o)/o,c=e.getBearing(),h=e.getPitch();let d=t?`/${s}/${a}/${r}`:`${r}/${a}/${s}`;return(c||h)&&(d+="/"+Math.round(10*c)/10),h&&(d+=`/${Math.round(h)}`),d}const px={linearity:.3,easing:We(0,0,.3,1)},FF=re({deceleration:2500,maxSpeed:1400},px),zF=re({deceleration:20,maxSpeed:1400},px),OF=re({deceleration:1e3,maxSpeed:360},px),NF=re({deceleration:1e3,maxSpeed:90},px);class UF{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ze.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=ze.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const n={zoom:0,bearing:0,pitch:0,pan:new nt(0,0),pinchAround:void 0,around:void 0};for(const{settings:o}of this._inertiaBuffer)n.zoom+=o.zoomDelta||0,n.bearing+=o.bearingDelta||0,n.pitch+=o.pitchDelta||0,o.panDelta&&n.pan._add(o.panDelta),o.around&&(n.around=o.around),o.pinchAround&&(n.pinchAround=o.pinchAround);const r=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,i={};if(n.pan.mag()){const o=gx(n.pan.mag(),r,re({},FF,t||{}));i.offset=n.pan.mult(o.amount/n.pan.mag()),i.center=this._map.transform.center,mx(i,o)}if(n.zoom){const o=gx(n.zoom,r,zF);i.zoom=this._map.transform.zoom+o.amount,mx(i,o)}if(n.bearing){const o=gx(n.bearing,r,OF);i.bearing=this._map.transform.bearing+$t(o.amount,-179,179),mx(i,o)}if(n.pitch){const o=gx(n.pitch,r,NF);i.pitch=this._map.transform.pitch+o.amount,mx(i,o)}if(i.zoom||i.bearing){const o=n.pinchAround===void 0?n.around:n.pinchAround;i.around=o?this._map.unproject(o):this._map.getCenter()}return this.clear(),i.noMoveStart=!0,i}}function mx(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function gx(e,t,n){const{maxSpeed:r,linearity:i,deceleration:o}=n,s=$t(e*i/(t/1e3),-r,r),a=Math.abs(s)/(o*i);return{easing:n.easing,duration:1e3*a,amount:s*(a/2)}}class ss extends Nt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,r,i={}){const o=pu(n.getCanvasContainer(),r);super(t,re({point:o,lngLat:n.unproject(o),originalEvent:r},i)),this._defaultPrevented=!1,this.target=n}}class _x extends Nt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,r){const i=t==="touchend"?r.changedTouches:r.touches,o=Rc(n.getCanvasContainer(),i),s=o.map(c=>n.unproject(c)),a=o.reduce((c,h,d,m)=>c.add(h.div(m.length)),new nt(0,0));super(t,{points:o,point:a,lngLats:s,lngLat:n.unproject(a),originalEvent:r}),this._defaultPrevented=!1}}class VF extends Nt{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,r){super(t,{originalEvent:r}),this._defaultPrevented=!1}}class GF{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new VF(t.type,this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new ss(t.type,this._map,t))}mouseup(t){this._map.fire(new ss(t.type,this._map,t))}preclick(t){const n=re({},t);n.type="preclick",this._map.fire(new ss(n.type,this._map,n))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||(this.preclick(t),this._map.fire(new ss(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new ss(t.type,this._map,t))}mouseover(t){this._map.fire(new ss(t.type,this._map,t))}mouseout(t){this._map.fire(new ss(t.type,this._map,t))}touchstart(t){return this._firePreventable(new _x(t.type,this._map,t))}touchmove(t){this._map.fire(new _x(t.type,this._map,t))}touchend(t){this._map.fire(new _x(t.type,this._map,t))}touchcancel(t){this._map.fire(new _x(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class jF{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new ss(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ss("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new ss(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class HF{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(gl(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const r=n,i=this._startPos,o=this._lastPos;if(!i||!o||o.equals(r)||!this._box&&r.dist(i)<this._clickTolerance)return;this._lastPos=r,this._box||(this._box=Fn("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const s=Math.min(i.x,r.x),a=Math.max(i.x,r.x),c=Math.min(i.y,r.y),h=Math.max(i.y,r.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${s}px,${c}px)`,this._box.style.width=a-s+"px",this._box.style.height=h-c+"px")})}mouseupWindow(t,n){if(!this._active)return;const r=this._startPos,i=n;if(r&&t.button===0){if(this.reset(),mp(),r.x!==i.x||r.y!==i.y)return this._map.fire(new Nt("boxzoomend",{originalEvent:t})),{cameraAnimation:o=>o.fitScreenCoordinates(r,i,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),pp(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new Nt(t,{originalEvent:n}))}}function gA(e,t){const n={};for(let r=0;r<e.length;r++)n[e[r].identifier]=t[r];return n}class ZF{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,n,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),r.length===this.numTouches&&(this.centroid=function(i){const o=new nt(0,0);for(const s of i)o._add(s);return o.div(i.length)}(n),this.touches=gA(r,n)))}touchmove(t,n,r){if(this.aborted||!this.centroid)return;const i=gA(r,n);for(const o in this.touches){const s=i[o];(!s||s.dist(this.touches[o])>30)&&(this.aborted=!0)}}touchend(t,n,r){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),r.length===0){const i=!this.aborted&&this.centroid;if(this.reset(),i)return i}}}class _A{constructor(t){this.singleTap=new ZF(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,n,r){this.singleTap.touchstart(t,n,r)}touchmove(t,n,r){this.singleTap.touchmove(t,n,r)}touchend(t,n,r){const i=this.singleTap.touchend(t,n,r);if(i){const o=t.timeStamp-this.lastTime<500,s=!this.lastTap||this.lastTap.dist(i)<30;if(o&&s||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=i,this.count===this.numTaps)return this.reset(),i}}}class WF{constructor(){this._zoomIn=new _A({numTouches:1,numTaps:2}),this._zoomOut=new _A({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,r){this._zoomIn.touchstart(t,n,r),this._zoomOut.touchstart(t,n,r)}touchmove(t,n,r){this._zoomIn.touchmove(t,n,r),this._zoomOut.touchmove(t,n,r)}touchend(t,n,r){const i=this._zoomIn.touchend(t,n,r),o=this._zoomOut.touchend(t,n,r);return i?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:s=>s.easeTo({duration:300,zoom:s.getZoom()+1,around:s.unproject(i)},{originalEvent:t})}):o?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:s=>s.easeTo({duration:300,zoom:s.getZoom()-1,around:s.unproject(o)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const qF={0:1,2:2};class yA{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,n){return!1}_move(t,n){return{}}mousedown(t,n){if(this._lastPoint)return;const r=gp(t);this._correctButton(t,r)&&(this._lastPoint=n,this._eventButton=r)}mousemoveWindow(t,n){const r=this._lastPoint;if(r){if(t.preventDefault(),this._eventButton!=null&&function(i,o){const s=qF[o];return i.buttons===void 0||(i.buttons&s)!==s}(t,this._eventButton))this.reset();else if(this._moved||!(n.dist(r)<this._clickTolerance))return this._moved=!0,this._lastPoint=n,this._move(r,n)}}mouseupWindow(t){this._lastPoint&&gp(t)===this._eventButton&&(this._moved&&mp(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class JF extends yA{mousedown(t,n){super.mousedown(t,n),this._lastPoint&&(this._active=!0)}_correctButton(t,n){return n===0&&!t.ctrlKey}_move(t,n){return{around:n,panDelta:n.sub(t)}}}class SI extends yA{_correctButton(t,n){return n===0&&t.ctrlKey||n===2}_move(t,n){const r=.8*(n.x-t.x);if(r)return this._active=!0,{bearingDelta:r}}contextmenu(t){t.preventDefault()}}class MI extends yA{_correctButton(t,n){return n===0&&t.ctrlKey||n===2}_move(t,n){const r=-.5*(n.y-t.y);if(r)return this._active=!0,{pitchDelta:r}}contextmenu(t){t.preventDefault()}}class $F{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset(),Jn(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new nt(0,0)}touchstart(t,n,r){return this._calculateTransform(t,n,r)}touchmove(t,n,r){if(this._active&&!(r.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(r.length===1&&!Ee())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,n,r)}}touchend(t,n,r){this._calculateTransform(t,n,r),this._active&&r.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,r){r.length>0&&(this._active=!0);const i=gA(r,n),o=new nt(0,0),s=new nt(0,0);let a=0;for(const h in i){const d=i[h],m=this._touches[h];m&&(o._add(d),s._add(d.sub(m)),a++,i[h]=d)}if(this._touches=i,a<this._minTouches||!s.mag())return;const c=s.div(a);return this._sum._add(c),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(a),panDelta:c}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Fn("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class xA{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,n,r){return{}}touchstart(t,n,r){this._firstTwoTouches||r.length<2||(this._firstTwoTouches=[r[0].identifier,r[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,r){const i=this._firstTwoTouches;if(!i)return;t.preventDefault();const[o,s]=i,a=yx(r,n,o),c=yx(r,n,s);if(!a||!c)return;const h=this._aroundCenter?null:a.add(c).div(2);return this._move([a,c],h,t)}touchend(t,n,r){if(!this._firstTwoTouches)return;const[i,o]=this._firstTwoTouches,s=yx(r,n,i),a=yx(r,n,o);s&&a||(this._active&&mp(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function yx(e,t,n){for(let r=0;r<e.length;r++)if(e[r].identifier===n)return t[r]}function II(e,t){return Math.log(e/t)/Math.LN2}class KF extends xA{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const r=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(II(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:II(this._distance,r),pinchAround:n}}}function BI(e,t){return 180*e.angleWith(t)/Math.PI}class XF extends xA{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n){const r=this._vector;if(this._vector=t[0].sub(t[1]),r&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:BI(this._vector,r),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,r=this._startVector;if(!r)return!1;const i=BI(t,r);return Math.abs(i)<n}}function vA(e){return Math.abs(e.y)>Math.abs(e.x)}class YF extends xA{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,vA(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,r){const i=this._lastPoints;if(!i)return;const o=t[0].sub(i[0]),s=t[1].sub(i[1]);return this._map._cooperativeGestures&&!Ee()&&r.touches.length<3||(this._valid=this.gestureBeginsVertically(o,s,r.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(o.y+s.y)/2*-.5})}gestureBeginsVertically(t,n,r){if(this._valid!==void 0)return this._valid;const i=t.mag()>=2,o=n.mag()>=2;if(!i&&!o)return;if(!i||!o)return this._firstMove==null&&(this._firstMove=r),r-this._firstMove<100&&void 0;const s=t.y>0==n.y>0;return vA(t)&&vA(n)&&s}}const QF={panStep:100,bearingStep:15,pitchStep:10};class tz{constructor(){const t=QF;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,r=0,i=0,o=0,s=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?r=-1:(t.preventDefault(),o=-1);break;case 39:t.shiftKey?r=1:(t.preventDefault(),o=1);break;case 38:t.shiftKey?i=1:(t.preventDefault(),s=-1);break;case 40:t.shiftKey?i=-1:(t.preventDefault(),s=1);break;default:return}return this._rotationDisabled&&(r=0,i=0),{cameraAnimation:a=>{const c=a.getZoom();a.easeTo({duration:300,easeId:"keyboardHandler",easing:ez,zoom:n?Math.round(c)+n*(t.shiftKey?2:1):c,bearing:a.getBearing()+r*this._bearingStep,pitch:a.getPitch()+i*this._pitchStep,offset:[-o*this._panStep,-s*this._panStep],center:a.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ez(e){return e*(2-e)}const DI=4.000244140625;class nz{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._handler=n,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,Jn(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||Ee()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let n=t.deltaMode===k.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const r=ze.now(),i=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,n!==0&&n%DI==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(i*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=pu(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:n,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const n=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const h=this._type==="wheel"&&Math.abs(this._delta)>DI?this._wheelZoomRate:this._defaultZoomRate;let d=2/(1+Math.exp(-Math.abs(this._delta*h)));this._delta<0&&d!==0&&(d=1/d);const m=n(),g=Math.pow(2,m),x=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):g;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(x*d))),this._type==="wheel"&&(this._startZoom=m,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const r=typeof this._targetZoom=="number"?this._targetZoom:n(),i=this._startZoom,o=this._easing;let s,a=!1;if(this._type==="wheel"&&i&&o){const h=Math.min((ze.now()-this._lastWheelEventTime)/200,1);s=Ce(i,r,o(h)),h<1?this._frameId||(this._frameId=!0):a=!0}else s=r,a=!0;this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let c=s-n();return c*this._lastDelta<0&&(c=0),{noInertia:!0,needsRenderFrame:!a,zoomDelta:c,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=hn;if(this._prevEase){const r=this._prevEase,i=(ze.now()-r.start)/r.duration,o=r.easing(i+.01)-r.easing(i),s=.27/Math.sqrt(o*o+1e-4)*.01;n=We(s,Math.sqrt(.0729-s*s),.25,1)}return this._prevEase={start:ze.now(),duration:t,easing:n},n}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Fn("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(k.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class rz{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class iz{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,n){return t.preventDefault(),{cameraAnimation:r=>{r.easeTo({duration:300,zoom:r.getZoom()+(t.shiftKey?-1:1),around:r.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class oz{constructor(){this._tap=new _A({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,n,r){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?r.length>0&&(this._swipePoint=n[0],this._swipeTouch=r[0].identifier):this._tap.touchstart(t,n,r))}touchmove(t,n,r){if(this._tapTime){if(this._swipePoint){if(r[0].identifier!==this._swipeTouch)return;const i=n[0],o=i.y-this._swipePoint.y;return this._swipePoint=i,t.preventDefault(),this._active=!0,{zoomDelta:o/128}}}else this._tap.touchmove(t,n,r)}touchend(t,n,r){this._tapTime?this._swipePoint&&r.length===0&&this.reset():this._tap.touchend(t,n,r)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sz{constructor(t,n,r){this._el=t,this._mousePan=n,this._touchPan=r}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class az{constructor(t,n,r){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=r}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class lz{constructor(t,n,r,i){this._el=t,this._touchZoom=n,this._touchRotate=r,this._tapDragZoom=i,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const xx=e=>e.zoom||e.drag||e.pitch||e.rotate;class uz extends Nt{}class cz{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,n){const r=J.sub([],n,t);this.radius=J.length(r[2]<0?J.div([],r,this.constants):[r[0],r[1],0])}projectRay(t){J.div(t,t,this.constants),J.normalize(t,t),J.mul(t,t,this.constants);const n=J.scale([],t,this.radius);if(n[2]>0){const r=J.scale([],[0,0,1],J.dot(n,[0,0,1])),i=J.scale([],J.normalize([],[n[0],n[1],0]),this.radius),o=J.add([],n,J.scale([],J.sub([],J.add([],i,r),n),2));n[0]=o[0],n[1]=o[1]}return n}}function vx(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class hz{constructor(t,n){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new UF(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new cz,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),Jn(["handleEvent","handleWindowEvent"],this);const r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[k.document,"mousemove",{capture:!0}],[k.document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[k,"blur",void 0]];for(const[i,o,s]of this._listeners)i.addEventListener(o,i===k.document?this.handleWindowEvent:this.handleEvent,s)}destroy(){for(const[t,n,r]of this._listeners)t.removeEventListener(n,t===k.document?this.handleWindowEvent:this.handleEvent,r)}_addDefaultHandlers(t){const n=this._map,r=n.getCanvasContainer();this._add("mapEvent",new GF(n,t));const i=n.boxZoom=new HF(n,t);this._add("boxZoom",i);const o=new WF,s=new iz;n.doubleClickZoom=new rz(s,o),this._add("tapZoom",o),this._add("clickZoom",s);const a=new oz;this._add("tapDragZoom",a);const c=n.touchPitch=new YF(n);this._add("touchPitch",c);const h=new SI(t),d=new MI(t);n.dragRotate=new az(t,h,d),this._add("mouseRotate",h,["mousePitch"]),this._add("mousePitch",d,["mouseRotate"]);const m=new JF(t),g=new $F(n,t);n.dragPan=new sz(r,m,g),this._add("mousePan",m),this._add("touchPan",g,["touchZoom","touchRotate"]);const x=new XF,v=new KF;n.touchZoomRotate=new lz(r,v,x,a),this._add("touchRotate",x,["touchPan","touchZoom"]),this._add("touchZoom",v,["touchPan","touchRotate"]),this._add("blockableMapEvent",new jF(n));const w=n.scrollZoom=new nz(n,this);this._add("scrollZoom",w,["mousePan"]);const A=n.keyboard=new tz;this._add("keyboard",A);for(const E of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[E]&&n[E].enable(t[E])}_add(t,n,r){this._handlers.push({handlerName:t,handler:n,allowed:r}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!xx(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,n,r){for(const i in t)if(i!==r&&(!n||n.indexOf(i)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const n=[];for(const r of t)this._el.contains(r.target)&&n.push(r);return n}handleEvent(t,n){this._updatingCamera=!0;const r=t.type==="renderFrame",i=r?void 0:t,o={needsRenderFrame:!1},s={},a={},c=t.touches?this._getMapTouches(t.touches):void 0,h=c?Rc(this._el,c):r?void 0:pu(this._el,t);for(const{handlerName:g,handler:x,allowed:v}of this._handlers){if(!x.isEnabled())continue;let w;this._blockedByActive(a,v,g)?x.reset():x[n||t.type]&&(w=x[n||t.type](t,h,c),this.mergeHandlerResult(o,s,w,g,i),w&&w.needsRenderFrame&&this._triggerRenderFrame()),(w||x.isActive())&&(a[g]=x)}const d={};for(const g in this._previousActiveHandlers)a[g]||(d[g]=i);this._previousActiveHandlers=a,(Object.keys(d).length||vx(o))&&(this._changes.push([o,s,d]),this._triggerRenderFrame()),(Object.keys(a).length||vx(o))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:m}=o;m&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],m(this._map))}mergeHandlerResult(t,n,r,i,o){if(!r)return;re(t,r);const s={handlerName:i,originalEvent:r.originalEvent||o};r.zoomDelta!==void 0&&(n.zoom=s),r.panDelta!==void 0&&(n.drag=s),r.pitchDelta!==void 0&&(n.pitch=s),r.bearingDelta!==void 0&&(n.rotate=s)}_applyChanges(){const t={},n={},r={};for(const[i,o,s]of this._changes)i.panDelta&&(t.panDelta=(t.panDelta||new nt(0,0))._add(i.panDelta)),i.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+i.zoomDelta),i.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+i.bearingDelta),i.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+i.pitchDelta),i.around!==void 0&&(t.around=i.around),i.aroundCoord!==void 0&&(t.aroundCoord=i.aroundCoord),i.pinchAround!==void 0&&(t.pinchAround=i.pinchAround),i.noInertia&&(t.noInertia=i.noInertia),re(n,o),re(r,s);this._updateMapTransform(t,n,r),this._changes=[]}_updateMapTransform(t,n,r){const i=this._map,o=i.transform,s=S=>[S.x,S.y,S.z];if((S=>{const I=this._eventsInProgress.drag;return I&&!this._handlersById[I.handlerName].isActive()})()&&!vx(t)){const S=o.zoom;o.cameraElevationReference="sea",this._originalZoom!=null&&o._orthographicProjectionAtLowPitch&&o.projection.name!=="globe"&&o.pitch===0?(o.cameraElevationReference="ground",o.zoom=this._originalZoom):(o.recenterOnTerrain(),o.cameraElevationReference="ground"),S!==o.zoom&&this._map._update(!0)}if(o._isCameraConstrained&&i._stop(!0),!vx(t))return void this._fireEvents(n,r,!0);let{panDelta:a,zoomDelta:c,bearingDelta:h,pitchDelta:d,around:m,aroundCoord:g,pinchAround:x}=t;o._isCameraConstrained&&(c>0&&(c=0),o._isCameraConstrained=!1),x!==void 0&&(m=x),(c||(S=>n[S]&&!this._eventsInProgress[S])("drag"))&&m&&(this._dragOrigin=s(o.pointCoordinate3D(m)),this._originalZoom=o.zoom,this._trackingEllipsoid.setup(o._camera.position,this._dragOrigin)),o.cameraElevationReference="sea",i._stop(!0),m=m||i.transform.centerPoint,h&&(o.bearing+=h),d&&(o.pitch+=d),o._updateCameraState();const v=[0,0,0];if(a)if(o.projection.name==="mercator"){const S=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(m).dir),I=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(m.sub(a)).dir);v[0]=I[0]-S[0],v[1]=I[1]-S[1]}else{const S=o.pointCoordinate(m);if(o.projection.name==="globe"){a=a.rotate(-o.angle);const I=o._pixelsPerMercatorPixel/o.worldSize;v[0]=-a.x*rg(Br(S.y))*I,v[1]=-a.y*rg(o.center.lat)*I}else{const I=o.pointCoordinate(m.sub(a));S&&I&&(v[0]=I.x-S.x,v[1]=I.y-S.y)}}const w=o.zoom,A=[0,0,0];if(c){const S=s(g||o.pointCoordinate3D(m)),I={dir:J.normalize([],J.sub([],S,o._camera.position))};if(I.dir[2]<0){const B=o.zoomDeltaToMovement(S,c);J.scale(A,I.dir,B)}}const E=J.add(v,v,A);o._translateCameraConstrained(E),c&&Math.abs(o.zoom-w)>1e-4&&o.recenterOnTerrain(),o.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,r,!0)}_fireEvents(t,n,r){const i=xx(this._eventsInProgress),o=xx(t),s={};for(const d in t){const{originalEvent:m}=t[d];this._eventsInProgress[d]||(s[`${d}start`]=m),this._eventsInProgress[d]=t[d]}!i&&o&&this._fireEvent("movestart",o.originalEvent);for(const d in s)this._fireEvent(d,s[d]);o&&this._fireEvent("move",o.originalEvent);for(const d in t){const{originalEvent:m}=t[d];this._fireEvent(d,m)}const a={};let c;for(const d in this._eventsInProgress){const{handlerName:m,originalEvent:g}=this._eventsInProgress[d];this._handlersById[m].isActive()||(delete this._eventsInProgress[d],c=n[m]||g,a[`${d}end`]=c)}for(const d in a)this._fireEvent(d,a[d]);const h=xx(this._eventsInProgress);if(r&&(i||o)&&!h){this._updatingCamera=!0;const d=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),m=g=>g!==0&&-this._bearingSnap<g&&g<this._bearingSnap;d?(m(d.bearing||this._map.getBearing())&&(d.bearing=0),this._map.easeTo(d,{originalEvent:c})):(this._map.fire(new Nt("moveend",{originalEvent:c})),m(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new Nt(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new uz("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const PI="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class fz extends Sr{constructor(t,n){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this._respectPrefersReducedMotion=n.respectPrefersReducedMotion!==!1,Jn(["_renderFrameCallback"],this)}getCenter(){return new Be(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,r){return t=nt.convert(t).mult(-1),this.panTo(this.transform.center,re({offset:t},n),r)}panTo(t,n,r){return this.easeTo(re({center:t},n),r)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,r){return this.easeTo(re({zoom:t},n),r)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,r){return this.easeTo(re({bearing:t},n),r)}resetNorth(t,n){return this.rotateTo(0,re({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(re({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=lo.convert(t);const r=n&&n.bearing||0,i=n&&n.pitch||0,o=t.getNorthWest(),s=t.getSouthEast();return this._cameraForBounds(this.transform,o,s,r,i,n)}_extendCameraOptions(t){const n={top:0,bottom:0,right:0,left:0};if(typeof(t=re({padding:n,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=="number"){const r=t.padding;t.padding={top:r,bottom:r,right:r,left:r}}return t.padding=re(n,t.padding),t}_minimumAABBFrustumDistance(t,n){const r=n.max[0]-n.min[0],i=n.max[1]-n.min[1];return r/i>t.aspect?r/(2*Math.tan(.5*t.fovX)*t.aspect):i/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,n,r,i,o,s){const a=t.clone(),c=this._extendCameraOptions(s);a.bearing=i,a.pitch=o;const h=Be.convert(n),d=Be.convert(r),m=.5*(h.lat+d.lat),g=.5*(h.lng+d.lng),x=Ei(m,g),v=J.normalize([],x),w=J.normalize([],J.cross([],v,[0,1,0])),A=J.cross([],w,v),E=[w[0],w[1],w[2],0,A[0],A[1],A[2],0,v[0],v[1],v[2],0,0,0,0,1],S=[x,Ei(h.lat,h.lng),Ei(d.lat,h.lng),Ei(d.lat,d.lng),Ei(h.lat,d.lng),Ei(m,h.lng),Ei(m,d.lng),Ei(h.lat,g),Ei(d.lat,g)];let I=yn.fromPoints(S.map(tt=>[J.dot(w,tt),J.dot(A,tt),J.dot(v,tt)]));const B=J.transformMat4([],I.center,E);J.squaredLength(B)===0&&J.set(B,0,0,1),J.normalize(B,B),J.scale(B,B,dn),a.center=function([tt,ct,pt]){const dt=Math.hypot(tt,ct,pt),wt=Math.atan2(tt,pt),bt=.5*Math.PI-Math.acos(-ct/dt);return new Be(dr(wt),dr(bt))}(B);const M=a.getWorldToCameraMatrix(),D=lt.invert(new Float64Array(16),M);I=yn.applyTransform(I,lt.multiply([],M,E)),J.transformMat4(B,B,M);const R=.5*(I.max[2]-I.min[2]),z=this._minimumAABBFrustumDistance(a,I),N=J.scale([],[0,0,1],R),V=J.add(N,B,N),j=z+(a.pitch===0?0:J.distance(B,V)),H=a.globeCenterInViewSpace,$=J.sub([],B,[H[0],H[1],H[2]]);J.normalize($,$),J.scale($,$,j);const G=J.add([],B,$);J.transformMat4(G,G,D);const Q=$u/dn,et=J.length(G),st=Rn(Math.max(et*Q-$u,Number.EPSILON),0),Y=Math.min(a.zoomFromMercatorZAdjusted(st),c.maxZoom);return Y>.5*(Wu+Za)?(a.setProjection({name:"mercator"}),a.zoom=Y,this._cameraForBounds(a,n,r,i,o,s)):{center:a.center,zoom:Y,bearing:i,pitch:o}}queryTerrainElevation(t,n){const r=this.transform.elevation;return r?(n=re({},{exaggerated:!0},n),r.getAtPoint(an.fromLngLat(t),null,n.exaggerated)):null}_cameraForBounds(t,n,r,i,o,s){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,n,r,i,o,s);const a=t.clone(),c=this._extendCameraOptions(s),h=a.padding;a.bearing=i,a.pitch=o;const d=Be.convert(n),m=Be.convert(r),g=new Be(d.lng,m.lat),x=new Be(m.lng,d.lat),v=a.project(d),w=a.project(m),A=this.queryTerrainElevation(d),E=this.queryTerrainElevation(m),S=this.queryTerrainElevation(g),I=this.queryTerrainElevation(x),B=[[v.x,v.y,Math.min(A||0,E||0,S||0,I||0)],[w.x,w.y,Math.max(A||0,E||0,S||0,I||0)]];let M=yn.fromPoints(B);const D=a.getWorldToCameraMatrix(),R=lt.invert(new Float64Array(16),D);M=yn.applyTransform(M,D);const z=J.sub([],M.max,M.min),N=h.left||0,V=h.right||0,j=h.bottom||0,H=h.top||0,{left:$,right:G,top:Q,bottom:et}=c.padding,st=.5*(N+V),Y=.5*(H+j),tt=Math.min(a.scaleZoom(a.scale*Math.min((a.width-(N+V+$+G))/z[0],(a.height-(j+H+et+Q))/z[1])),c.maxZoom),ct=a.scale/a.zoomScale(tt);M=new yn([M.min[0]-($+st)*ct,M.min[1]-(et+Y)*ct,M.min[2]],[M.max[0]+(G+st)*ct,M.max[1]+(Q+Y)*ct,M.max[2]]);const pt=.5*z[2],dt=this._minimumAABBFrustumDistance(a,M),wt=[0,0,1,0];Bn.transformMat4(wt,wt,D),Bn.normalize(wt,wt);const bt=J.scale([],wt,dt+pt),Et=J.add([],M.center,bt),_t=(typeof c.offset.x=="number"&&typeof c.offset.y=="number"?new nt(c.offset.x,c.offset.y):nt.convert(c.offset)).rotate(-Ae(i));M.center[0]-=_t.x*ct,M.center[1]+=_t.y*ct,J.transformMat4(M.center,M.center,R),J.transformMat4(Et,Et,R);const Mt=[M.center[0],M.center[1],Et[2]*a.pixelsPerMeter];J.scale(Mt,Mt,1/a.worldSize);const qt=uo(Mt[0]),Jt=Br(Mt[1]),ne=Math.min(a._zoomFromMercatorZ(Mt[2]),c.maxZoom),se=new Be(qt,Jt);return a.mercatorFromTransition&&ne<.5*(Wu+Za)?(a.setProjection({name:"globe"}),a.zoom=ne,this._cameraForBounds(a,n,r,i,o,s)):{center:se,zoom:ne,bearing:i,pitch:o}}fitBounds(t,n,r){const i=this.cameraForBounds(t,n);return this._fitInternal(i,n,r)}fitScreenCoordinates(t,n,r,i,o){const s=nt.convert(t),a=nt.convert(n),c=new nt(Math.min(s.x,a.x),Math.min(s.y,a.y)),h=new nt(Math.max(s.x,a.x),Math.max(s.y,a.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(s,a))return this;const d=this.transform.pointLocation3D(c),m=this.transform.pointLocation3D(h),g=this.transform.pointLocation3D(new nt(c.x,h.y)),x=this.transform.pointLocation3D(new nt(h.x,c.y)),v=[Math.min(d.lng,m.lng,g.lng,x.lng),Math.min(d.lat,m.lat,g.lat,x.lat)],w=[Math.max(d.lng,m.lng,g.lng,x.lng),Math.max(d.lat,m.lat,g.lat,x.lat)],A=i&&i.pitch?i.pitch:this.getPitch(),E=this._cameraForBounds(this.transform,v,w,r,A,i);return this._fitInternal(E,i,o)}_fitInternal(t,n,r){return t?(delete(n=re(t,n)).padding,n.linear?this.easeTo(n,r):this.flyTo(n,r)):this}jumpTo(t,n){this.stop();const r=t.preloadOnly?this.transform.clone():this.transform;let i=!1,o=!1,s=!1;return"zoom"in t&&r.zoom!==+t.zoom&&(i=!0,r.zoom=+t.zoom),t.center!==void 0&&(r.center=Be.convert(t.center)),"bearing"in t&&r.bearing!==+t.bearing&&(o=!0,r.bearing=+t.bearing),"pitch"in t&&r.pitch!==+t.pitch&&(s=!0,r.pitch=+t.pitch),t.padding==null||r.isPaddingEqual(t.padding)||(r.padding=t.padding),t.preloadOnly?(this._preloadTiles(r),this):(this.fire(new Nt("movestart",n)).fire(new Nt("move",n)),i&&this.fire(new Nt("zoomstart",n)).fire(new Nt("zoom",n)).fire(new Nt("zoomend",n)),o&&this.fire(new Nt("rotatestart",n)).fire(new Nt("rotate",n)).fire(new Nt("rotateend",n)),s&&this.fire(new Nt("pitchstart",n)).fire(new Nt("pitch",n)).fire(new Nt("pitchend",n)),this.fire(new Nt("moveend",n)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||rt(PI),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,n){const r=this.transform;if(!r.projection.supportsFreeCamera)return rt(PI),this;this.stop();const i=r.zoom,o=r.pitch,s=r.bearing;r.setFreeCameraOptions(t);const a=i!==r.zoom,c=o!==r.pitch,h=s!==r.bearing;return this.fire(new Nt("movestart",n)).fire(new Nt("move",n)),a&&this.fire(new Nt("zoomstart",n)).fire(new Nt("zoom",n)).fire(new Nt("zoomend",n)),h&&this.fire(new Nt("rotatestart",n)).fire(new Nt("rotate",n)).fire(new Nt("rotateend",n)),c&&this.fire(new Nt("pitchstart",n)).fire(new Nt("pitch",n)).fire(new Nt("pitchend",n)),this.fire(new Nt("moveend",n)),this}easeTo(t,n){this._stop(!1,t.easeId),((t=re({offset:[0,0],duration:500,easing:hn},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const r=this.transform,i=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),c="zoom"in t?+t.zoom:i,h="bearing"in t?this._normalizeBearing(t.bearing,o):o,d="pitch"in t?+t.pitch:s,m="padding"in t?t.padding:r.padding,g=nt.convert(t.offset);let x,v,w;if(r.projection.name==="globe"){const N=an.fromLngLat(r.center),V=g.rotate(-r.angle);N.x+=V.x/r.worldSize,N.y+=V.y/r.worldSize;const j=N.toLngLat(),H=Be.convert(t.center||j);this._normalizeCenter(H),x=r.centerPoint.add(V),v=new nt(N.x,N.y).mult(r.worldSize),w=new nt(Ir(H.lng),Fr(H.lat)).mult(r.worldSize).sub(v)}else{x=r.centerPoint.add(g);const N=r.pointLocation(x),V=Be.convert(t.center||N);this._normalizeCenter(V),v=r.project(N),w=r.project(V).sub(v)}const A=r.zoomScale(c-i);let E,S;t.around&&(E=Be.convert(t.around),S=r.locationPoint(E));const I=this._zooming||c!==i,B=this._rotating||o!==h,M=this._pitching||d!==s,D=!r.isPaddingEqual(m),R=N=>V=>{if(I&&(N.zoom=Ce(i,c,V)),B&&(N.bearing=Ce(o,h,V)),M&&(N.pitch=Ce(s,d,V)),D&&(N.interpolatePadding(a,m,V),x=N.centerPoint.add(g)),E)N.setLocationAtPoint(E,S);else{const j=N.zoomScale(N.zoom-i),H=c>i?Math.min(2,A):Math.max(.5,A),$=Math.pow(H,1-V),G=N.unproject(v.add(w.mult(V*$)).mult(j));N.setLocationAtPoint(N.renderWorldCopies?G.wrap():G,x)}return t.preloadOnly||this._fireMoveEvents(n),N};if(t.preloadOnly){const N=this._emulate(R,t.duration,r);return this._preloadTiles(N),this}const z={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=I,this._rotating=B,this._pitching=M,this._padding=D,this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,z),this._ease(R(r),N=>{r.cameraElevationReference==="sea"&&r.recenterOnTerrain(),this._afterEase(n,N)},t),this}_prepareEase(t,n,r={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),n||r.moving||this.fire(new Nt("movestart",t)),this._zooming&&!r.zooming&&this.fire(new Nt("zoomstart",t)),this._rotating&&!r.rotating&&this.fire(new Nt("rotatestart",t)),this._pitching&&!r.pitching&&this.fire(new Nt("pitchstart",t))}_fireMoveEvents(t){this.fire(new Nt("move",t)),this._zooming&&this.fire(new Nt("zoom",t)),this._rotating&&this.fire(new Nt("rotate",t)),this._pitching&&this.fire(new Nt("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const r=this._zooming,i=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new Nt("zoomend",t)),i&&this.fire(new Nt("rotateend",t)),o&&this.fire(new Nt("pitchend",t)),this.fire(new Nt("moveend",t))}flyTo(t,n){if(this._prefersReducedMotion(t)){const tt=fi(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(tt,n)}this.stop(),t=re({offset:[0,0],speed:1.2,curve:1.42,easing:hn},t);const r=this.transform,i=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),c="zoom"in t?$t(+t.zoom,r.minZoom,r.maxZoom):i,h="bearing"in t?this._normalizeBearing(t.bearing,o):o,d="pitch"in t?+t.pitch:s,m="padding"in t?t.padding:r.padding,g=r.zoomScale(c-i),x=nt.convert(t.offset);let v=r.centerPoint.add(x);const w=r.pointLocation(v),A=Be.convert(t.center||w);this._normalizeCenter(A);const E=r.project(w),S=r.project(A).sub(E);let I=t.curve;const B=Math.max(r.width,r.height),M=B/g,D=S.mag();if("minZoom"in t){const tt=$t(Math.min(t.minZoom,i,c),r.minZoom,r.maxZoom),ct=B/r.zoomScale(tt-i);I=Math.sqrt(ct/D*2)}const R=I*I;function z(tt){const ct=(M*M-B*B+(tt?-1:1)*R*R*D*D)/(2*(tt?M:B)*R*D);return Math.log(Math.sqrt(ct*ct+1)-ct)}function N(tt){return(Math.exp(tt)-Math.exp(-tt))/2}function V(tt){return(Math.exp(tt)+Math.exp(-tt))/2}const j=z(0);let H=function(tt){return V(j)/V(j+I*tt)},$=function(tt){return B*((V(j)*(N(ct=j+I*tt)/V(ct))-N(j))/R)/D;var ct},G=(z(1)-j)/I;if(Math.abs(D)<1e-6||!isFinite(G)){if(Math.abs(B-M)<1e-6)return this.easeTo(t,n);const tt=M<B?-1:1;G=Math.abs(Math.log(M/B))/I,$=function(){return 0},H=function(ct){return Math.exp(tt*I*ct)}}t.duration="duration"in t?+t.duration:1e3*G/("screenSpeed"in t?+t.screenSpeed/I:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const Q=o!==h,et=d!==s,st=!r.isPaddingEqual(m),Y=tt=>ct=>{const pt=ct*G,dt=1/H(pt);tt.zoom=ct===1?c:i+tt.scaleZoom(dt),Q&&(tt.bearing=Ce(o,h,ct)),et&&(tt.pitch=Ce(s,d,ct)),st&&(tt.interpolatePadding(a,m,ct),v=tt.centerPoint.add(x));const wt=ct===1?A:tt.unproject(E.add(S.mult($(pt))).mult(dt));return tt.setLocationAtPoint(tt.renderWorldCopies?wt.wrap():wt,v),tt._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(n),tt};if(t.preloadOnly){const tt=this._emulate(Y,t.duration,r);return this._preloadTiles(tt),this}return this._zooming=!0,this._rotating=Q,this._pitching=et,this._padding=st,this._prepareEase(n,!1),this._ease(Y(r),()=>this._afterEase(n),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const r=this._onEaseEnd;this._onEaseEnd=void 0,r.call(this,n)}if(!t){const r=this.handlers;r&&r.stop(!1)}return this}_ease(t,n,r){r.animate===!1||r.duration===0?(t(1),n()):(this._easeStart=ze.now(),this._easeOptions=r,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((ze.now()-this._easeStart)/this._easeOptions.duration,1),n=this._onEaseFrame;n&&n(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,n){t=ci(t,-180,180);const r=Math.abs(t-n);return Math.abs(t-360-n)<r&&(t-=360),Math.abs(t+360-n)<r&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(n.maxBounds||n.projection.name!=="globe"&&!n.renderWorldCopies)return;const r=t.lng-n.center.lng;t.lng+=r>180?-360:r<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&ze.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,n,r){const i=Math.ceil(15*n/1e3),o=[],s=t(r.clone());for(let a=0;a<=i;a++){const c=s(a/i);o.push(c.clone())}return o}}class LI{constructor(t={}){this.options=t,Jn(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const n=this.options&&this.options.compact;return this._map=t,this._container=Fn("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Fn("button","mapboxgl-ctrl-attrib-button",this._container),Fn("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Fn("div","mapboxgl-ctrl-attrib-inner",this._container),n&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),n===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,n){const r=this._map._getUIString(`AttributionControl.${n}`);t.removeAttribute("title"),t.firstElementChild&&t.firstElementChild.setAttribute("title",r)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||X.ACCESS_TOKEN}];if(t){const r=n.reduce((i,o,s)=>(o.value&&(i+=`${o.key}=${o.value}${s<n.length-1?"&":""}`),i),"?");t.href=`${X.FEEDBACK_URL}/${r}#${CI(this._map,!0)}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const i=this._map.style.stylesheet;this.styleOwner=i.owner,this.styleId=i.id}const n=this._map.style._mergedSourceCaches;for(const i in n){const o=n[i];if(o.used){const s=o.getSource();s.attribution&&t.indexOf(s.attribution)<0&&t.push(s.attribution)}}t.sort((i,o)=>i.length-o.length),t=t.filter((i,o)=>{for(let s=o+1;s<t.length;s++)if(t[s].indexOf(i)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const r=t.join(" | ");r!==this._attribHTML&&(this._attribHTML=r,t.length?(this._innerContainer.innerHTML=r,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class RI{constructor(){Jn(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=Fn("div","mapboxgl-ctrl");const n=Fn("a","mapboxgl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://www.mapbox.com/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const n in t){const r=t[n].getSource();if(r.hasOwnProperty("mapbox_logo")&&!r.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const n=t[0];this._map.getCanvasContainer().offsetWidth<250?n.classList.add("mapboxgl-compact"):n.classList.remove("mapboxgl-compact")}}}class kI{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,r=n?this._queue.concat(n):this._queue;for(const i of r)if(i.id===t)return void(i.cancelled=!0)}run(t=0){const n=this._currentlyRunning=this._queue;this._queue=[];for(const r of n)if(!r.cancelled&&(r.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function FI(e,t,n){if(e=new Be(e.lng,e.lat),t){const r=new Be(e.lng-360,e.lat),i=new Be(e.lng+360,e.lat),o=360*Math.ceil(Math.abs(e.lng-n.center.lng)/360),s=n.locationPoint(e).distSqr(t),a=t.x<0||t.y<0||t.x>n.width||t.y>n.height;n.locationPoint(r).distSqr(t)<s&&(a||Math.abs(r.lng-n.center.lng)<o)?e=r:n.locationPoint(i).distSqr(t)<s&&(a||Math.abs(i.lng-n.center.lng)<o)&&(e=i)}for(;Math.abs(e.lng-n.center.lng)>180;){const r=n.locationPoint(e);if(r.x>=0&&r.y>=0&&r.x<=n.width&&r.y<=n.height)break;e.lng>n.center.lng?e.lng-=360:e.lng+=360}return e}const wA={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class bA extends Sr{constructor(t,n){if(super(),(t instanceof k.HTMLElement||n)&&(t=re({element:t},n)),Jn(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=nt.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=Fn("div");const o=41,s=27,a=Ws("svg",{display:"block",height:o*this._scale+"px",width:s*this._scale+"px",viewBox:`0 0 ${s} ${o}`},this._element),c=Ws("radialGradient",{id:"shadowGradient"},Ws("defs",{},a));Ws("stop",{offset:"10%","stop-opacity":.4},c),Ws("stop",{offset:"100%","stop-opacity":.05},c),Ws("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},a),Ws("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},a),Ws("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},a),Ws("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},a),this._offset=nt.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",o=>{o.preventDefault()}),this._element.addEventListener("mousedown",o=>{o.preventDefault()});const r=this._element.classList;for(const o in wA)r.remove(`mapboxgl-marker-anchor-${o}`);r.add(`mapboxgl-marker-anchor-${this._anchor}`);const i=t&&t.className?t.className.trim().split(/\s+/):[];r.add(...i),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=Be.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const i=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[i,-1*(38.1-13.5+i)],"bottom-right":[-i,-1*(38.1-13.5+i)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const n=t.code,r=t.charCode||t.keyCode;n!=="Space"&&n!=="Enter"&&r!==32&&r!==13||this.togglePopup()}_onMapClick(t){const n=t.originalEvent.target,r=this._element;this._popup&&(n===r||r.contains(n))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,n=this._pos;if(!t||!n)return!1;const r=t.unproject(n),i=t.getFreeCameraOptions();if(!i.position)return!1;const o=i.position.toLngLat();return o.distanceTo(r)<.9*o.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const n=this._pos;if(!n||n.x<0||n.x>t.transform.width||n.y<0||n.y>t.transform.height)return void this._clearFadeTimer();const r=t.unproject(n);let i;t._showingGlobe()&&vh(t.transform,this._lngLat)?i=0:(i=1-t._queryFogOpacity(r),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(i*=this._occludedOpacity)),this._element.style.opacity=`${i}`,this._element.style.pointerEvents=i>0?"auto":"none",this._popup&&this._popup._setOpacity(i),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const n=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${wA[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${n.x}px,${n.y}px)
        `}_calculateXYTransform(){const t=this._pos,n=this._map,r=this.getPitchAlignment();if(!n||!t||r!=="map")return"";if(!n._showingGlobe()){const c=n.getPitch();return c?`rotateX(${c}deg)`:""}const i=dr(Jy(n.transform,this._lngLat)),o=t.sub(qy(n.transform)),s=Math.abs(o.x)+Math.abs(o.y);if(s===0)return"";const a=i/s;return`rotateX(${-o.y*a}deg) rotateY(${o.x*a}deg)`}_calculateZTransform(){const t=this._pos,n=this._map;if(!n||!t)return"";let r=0;const i=this.getRotationAlignment();if(i==="map")if(n._showingGlobe()){const o=n.project(new Be(this._lngLat.lng,this._lngLat.lat+.001)),s=n.project(new Be(this._lngLat.lng,this._lngLat.lat-.001)).sub(o);r=dr(Math.atan2(s.y,s.x))-90}else r=-n.getBearing();else if(i==="horizon"){const o=Ui(4,6,n.getZoom()),s=qy(n.transform);s.y+=o*n.transform.height;const a=t.sub(s),c=dr(Math.atan2(a.y,a.x));r=(c>90?c-270:c+90)*(1-o)}return r+=this._rotation,r?`rotateZ(${r}deg)`:""}_update(t){k.cancelAnimationFrame(this._updateFrameId);const n=this._map;n&&(n.transform.renderWorldCopies&&(this._lngLat=FI(this._lngLat,this._pos,n.transform)),this._pos=n.project(this._lngLat),t===!0?this._updateFrameId=k.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),n._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(n._showingGlobe()||n.getTerrain()||n.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=nt.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const n=this._map;if(!n)return;const r=this._pointerdownPos,i=this._positionDelta;if(r&&i){if(!this._isDragging){const o=this._clickTolerance||n._clickTolerance;if(t.point.dist(r)<o)return;this._isDragging=!0}this._pos=t.point.sub(i),this._lngLat=n.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new Nt("dragstart"))),this.fire(new Nt("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new Nt("dragend")),this._state="inactive"}_addDragHandler(t){const n=this._map,r=this._pos;n&&r&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(r),this._pointerdownPos=t.point,this._state="pending",n.on("mousemove",this._onMove),n.on("touchmove",this._onMove),n.once("mouseup",this._onUp),n.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const n=this._map;return n&&(t?(n.on("mousedown",this._addDragHandler),n.on("touchstart",this._addDragHandler)):(n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const dz={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},pz=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function zI(e=new nt(0,0),t="bottom"){if(typeof e=="number"){const n=Math.round(Math.sqrt(.5*Math.pow(e,2)));switch(t){case"top":return new nt(0,e);case"top-left":return new nt(n,n);case"top-right":return new nt(-n,n);case"bottom":return new nt(0,-e);case"bottom-left":return new nt(n,-n);case"bottom-right":return new nt(-n,-n);case"left":return new nt(e,0);case"right":return new nt(-e,0)}return new nt(0,0)}return e instanceof nt||Array.isArray(e)?nt.convert(e):nt.convert(e[t]||[0,0])}class mz{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const n=si((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-n)+this._end*n}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,n,r){this._start=this.getValue(n),this._end=t,this._startTime=n,this._endTime=n+r}}const gz={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},_z={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},yz={showCompass:!0,showZoom:!0,visualizePitch:!1};class xz{constructor(t,n,r=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new SI({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,r&&(this.mousePitch=new MI({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),Jn(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener("mousedown",this.mousedown),n.addEventListener("touchstart",this.touchstart,{passive:!1}),n.addEventListener("touchmove",this.touchmove),n.addEventListener("touchend",this.touchend),n.addEventListener("touchcancel",this.reset)}down(t,n){this.mouseRotate.mousedown(t,n),this.mousePitch&&this.mousePitch.mousedown(t,n),gl()}move(t,n){const r=this.map,i=this.mouseRotate.mousemoveWindow(t,n),o=i&&i.bearingDelta;if(o&&r.setBearing(r.getBearing()+o),this.mousePitch){const s=this.mousePitch.mousemoveWindow(t,n),a=s&&s.pitchDelta;a&&r.setPitch(r.getPitch()+a)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){pp(),k.removeEventListener("mousemove",this.mousemove),k.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(re({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),pu(this.element,t)),k.addEventListener("mousemove",this.mousemove),k.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,pu(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Rc(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Rc(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const vz={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},wz={maxWidth:100,unit:"metric"},bz={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},wx={version:ot,supported:hp,setRTLTextPlugin:function(e,t,n=!1){if(qi===th||qi===As||qi===lm)throw new Error("setRTLTextPlugin cannot be called multiple times.");ra=ze.resolveURL(e),qi=th,Es=t,um(),n||fm()},getRTLTextPluginStatus:hm,Map:class extends fz{constructor(e){O_.mark($h.create);const t=e;if((e=re({},_z,e)).minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(e.antialias&&function(n){const r=n.navigator?n.navigator.userAgent:null;return!!function(i){if(be==null){const o=i.navigator?i.navigator.userAgent:null;be=!!i.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return be}(n)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))}(k)&&(e.antialias=!1,rt("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Fb(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),e),this._interactive=e.interactive,this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=e.crossSourceCollisions,this._collectResourceTiming=e.collectResourceTiming,this._language=this._parseLanguage(e.language),this._worldview=e.worldview,this._renderTaskQueue=new kI,this._domRenderTaskQueue=new kI,this._controls=[],this._markers=[],this._popups=[],this._mapId=su(),this._locale=re({},gz,e.locale),this._clickTolerance=e.clickTolerance,this._cooperativeGestures=e.cooperativeGestures,this._performanceMetricsCollection=e.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new mz(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new ve(e.transformRequest,e.accessToken,e.testMode),this._silenceAuthErrors=!!e.testMode,this._contextCreateOptions=e.contextCreateOptions?{...e.contextCreateOptions}:{},typeof e.container=="string"){if(this._container=k.document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container.toString()}' not found.`)}else{if(!(e.container instanceof k.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(this._container.childNodes.length>0&&rt("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),e.maxBounds&&this.setMaxBounds(e.maxBounds),Jn(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),k!==void 0&&(this._fullscreenchangeEvent="onfullscreenchange"in k.document?"fullscreenchange":"webkitfullscreenchange",k.addEventListener("online",this._onWindowOnline,!1),k.addEventListener("resize",this._onWindowResize,!1),k.addEventListener("orientationchange",this._onWindowResize,!1),k.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),k.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new hz(this,e),this._localFontFamily=e.localFontFamily,this._localIdeographFontFamily=e.localIdeographFontFamily,(e.style||!e.testMode)&&this.setStyle(e.style||X.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),e.projection&&this.setProjection(e.projection),e.hash&&(this._hash=new kF(typeof e.hash=="string"&&e.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch});const n=e.bounds;n&&(this.resize(),this.fitBounds(n,re({},e.fitBoundsOptions,{duration:0})))}this.resize(),e.attributionControl&&this.addControl(new LI({customAttribution:e.customAttribution})),this._logoControl=new RI,this.addControl(this._logoControl,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new Nt(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new Nt(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(e,t){if(t===void 0&&(t=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new Ie(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=e.onAdd(this);this._controls.push(e);const r=this._controlPositions[t];return t.indexOf("bottom")!==-1?r.insertBefore(n,r.firstChild):r.appendChild(n),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new Ie(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(e);return t>-1&&this._controls.splice(t,1),e.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(e){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new Nt("movestart",e)).fire(new Nt("move",e)),this.fire(new Nt("resize",e)),t&&this.fire(new Nt("moveend",e)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(e){return this.transform.setMaxBounds(lo.convert(e)),this._update()}setMinZoom(e){if((e=e??-2)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e?this.setZoom(e):this.fire(new Nt("zoomstart")).fire(new Nt("zoom")).fire(new Nt("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=e??22)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e?this.setZoom(e):this.fire(new Nt("zoomstart")).fire(new Nt("zoom")).fire(new Nt("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=e??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e?this.setPitch(e):this.fire(new Nt("pitchstart")).fire(new Nt("pitch")).fire(new Nt("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=e??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e?this.setPitch(e):this.fire(new Nt("pitchstart")).fire(new Nt("pitch")).fire(new Nt("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(e){return e==="auto"?k.navigator.language:Array.isArray(e)?e.length===0?void 0:e.map(t=>t==="auto"?k.navigator.language:t):e}setLanguage(e){const t=this._parseLanguage(e);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview?(this._worldview=e,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(e){return this._lazyInitEmptyStyle(),e?typeof e=="string"&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const e=this.transform,t=e.projection.name;let n;t==="globe"&&e.zoom>=Za?(e.setMercatorFromTransition(),n=!0):t==="mercator"&&e.zoom<Za&&(e.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(e,t){return this._updateProjection(e||t||{name:"mercator"})}_updateProjection(e){let t;return t=e.name==="globe"&&this.transform.zoom>=Za?this.transform.setMercatorFromTransition():this.transform.setProjection(e),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(e){return this.transform.locationPoint3D(Be.convert(e))}unproject(e){return this.transform.pointLocation3D(nt.convert(e))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(e,t,n){if(e==="mouseenter"||e==="mouseover"){let r=!1;const i=s=>{const a=t.filter(h=>this.getLayer(h)),c=a.length?this.queryRenderedFeatures(s.point,{layers:a}):[];c.length?r||(r=!0,n.call(this,new ss(e,this,s.originalEvent,{features:c}))):r=!1},o=()=>{r=!1};return{layers:new Set(t),listener:n,delegates:{mousemove:i,mouseout:o}}}if(e==="mouseleave"||e==="mouseout"){let r=!1;const i=s=>{const a=t.filter(c=>this.getLayer(c));(a.length?this.queryRenderedFeatures(s.point,{layers:a}):[]).length?r=!0:r&&(r=!1,n.call(this,new ss(e,this,s.originalEvent)))},o=s=>{r&&(r=!1,n.call(this,new ss(e,this,s.originalEvent)))};return{layers:new Set(t),listener:n,delegates:{mousemove:i,mouseout:o}}}{const r=i=>{const o=t.filter(a=>this.getLayer(a)),s=o.length?this.queryRenderedFeatures(i.point,{layers:o}):[];s.length&&(i.features=s,n.call(this,i),delete i.features)};return{layers:new Set(t),listener:n,delegates:{[e]:r}}}}on(e,t,n){if(n===void 0)return super.on(e,t);if(Array.isArray(t)||(t=[t]),t){for(const i of t)if(!this._isValidId(i))return this}const r=this._createDelegatedListener(e,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(r);for(const i in r.delegates)this.on(i,r.delegates[i]);return this}once(e,t,n){if(n===void 0)return super.once(e,t);if(Array.isArray(t)||(t=[t]),t){for(const i of t)if(!this._isValidId(i))return this}const r=this._createDelegatedListener(e,t,n);for(const i in r.delegates)this.once(i,r.delegates[i]);return this}off(e,t,n){if(n===void 0)return super.off(e,t);t=new Set(Array.isArray(t)?t:[t]);for(const o of t)if(!this._isValidId(o))return this;const r=(o,s)=>{if(o.size!==s.size)return!1;for(const a of o)if(!s.has(a))return!1;return!0},i=this._delegatedListeners?this._delegatedListeners[e]:void 0;return i&&(o=>{for(let s=0;s<o.length;s++){const a=o[s];if(a.listener===n&&r(a.layers,t)){for(const c in a.delegates)this.off(c,a.delegates[c]);return o.splice(s,1),this}}})(i),this}queryRenderedFeatures(e,t){if(!this.style)return[];if(t!==void 0||e===void 0||e instanceof nt||Array.isArray(e)||(t=e,e=void 0),e=e||[[0,0],[this.transform.width,this.transform.height]],(t=t||{}).layers&&Array.isArray(t.layers)){for(const n of t.layers)if(!this._isValidId(n))return[]}return this.style.queryRenderedFeatures(e,t,this.transform)}querySourceFeatures(e,t){return this._isValidId(e)?this.style.querySourceFeatures(e,t):[]}isPointOnSurface(e){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&rt(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(nt.convert(e))}setStyle(e,t){return(t=re({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&e?(this._diffStyle(e,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(e,t))}_getUIString(e){const t=this._locale[e];if(t==null)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),e&&(this.style=new va(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof e=="string"?this.style.loadURL(e):this.style.loadJSON(e)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new va(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,t){if(typeof e=="string"){const n=this._requestManager.normalizeStyleURL(e),r=this._requestManager.transformRequest(n,At.Style);jt(r,(i,o)=>{i?this.fire(new Ie(i)):o&&this._updateDiff(o,t)})}else typeof e=="object"&&this._updateDiff(e,t)}_updateDiff(e,t){try{this.style.setState(e)&&this._update(!0)}catch(n){rt(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(e,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(rt("There is no style added to the map."),!1)}_isValidId(e){return e==null?(this.fire(new Ie(new Error("IDs can't be empty."))),!1):!Fu(e)||(this.fire(new Ie(new Error(`IDs can't contain special symbols: "${e}".`))),!1)}addSource(e,t){return this._isValidId(e)?(this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)):this}isSourceLoaded(e){return!!this._isValidId(e)&&!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){const e=this.style&&this.style._sourceCaches;for(const t in e){const n=e[t]._tiles;for(const r in n){const i=n[r];if(i.state!=="loaded"&&i.state!=="errored")return!1}}return!0}addSourceType(e,t,n){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,n)}removeSource(e){return this._isValidId(e)?(this.style.removeSource(e),this._updateTerrain(),this._update(!0)):this}getSource(e){return this._isValidId(e)?this.style.getOwnSource(e):null}addImage(e,t,{pixelRatio:n=1,sdf:r=!1,stretchX:i,stretchY:o,content:s}={}){if(this._lazyInitEmptyStyle(),t instanceof k.HTMLImageElement||k.ImageBitmap&&t instanceof k.ImageBitmap){const{width:a,height:c,data:h}=ze.getImageData(t);this.style.addImage(e,{data:new Er({width:a,height:c},h),pixelRatio:n,stretchX:i,stretchY:o,content:s,sdf:r,version:0})}else if(t.width===void 0||t.height===void 0)this.fire(new Ie(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:a,height:c}=t,h=t;this.style.addImage(e,{data:new Er({width:a,height:c},new Uint8Array(h.data)),pixelRatio:n,stretchX:i,stretchY:o,content:s,sdf:r,version:0,userImage:h}),h.onAdd&&h.onAdd(this,e)}}updateImage(e,t){this._lazyInitEmptyStyle();const n=this.style.getImage(e);if(!n)return void this.fire(new Ie(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const r=t instanceof k.HTMLImageElement||k.ImageBitmap&&t instanceof k.ImageBitmap?ze.getImageData(t):t,{width:i,height:o}=r;i!==void 0&&o!==void 0?i===n.data.width&&o===n.data.height?(n.data.replace(r.data,!(t instanceof k.HTMLImageElement||k.ImageBitmap&&t instanceof k.ImageBitmap)),this.style.updateImage(e,n)):this.fire(new Ie(new Error(`The width and height of the updated image (${i}, ${o})
                must be that same as the previous version of the image
                (${n.data.width}, ${n.data.height})`))):this.fire(new Ie(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(e){return e?!!this.style&&!!this.style.getImage(e):(this.fire(new Ie(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(e,t){Ze(this._requestManager.transformRequest(e,At.Image),(n,r)=>{t(n,r instanceof k.HTMLImageElement?ze.getImageData(r):r)})}listImages(){return this.style.listImages()}addModel(e,t){this._lazyInitEmptyStyle(),this.style.addModel(e,t)}hasModel(e){return e?this.style.hasModel(e):(this.fire(new Ie(new Error("Missing required model id"))),!1)}removeModel(e){this.style.removeModel(e)}listModels(){return this.style.listModels()}addLayer(e,t){return this._isValidId(e.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)):this}moveLayer(e,t){return this._isValidId(e)?(this.style.moveLayer(e,t),this._update(!0)):this}removeLayer(e){return this._isValidId(e)?(this.style.removeLayer(e),this._update(!0)):this}getLayer(e){return this._isValidId(e)?this.style.getOwnLayer(e):null}setLayerZoomRange(e,t,n){return this._isValidId(e)?(this.style.setLayerZoomRange(e,t,n),this._update(!0)):this}setFilter(e,t,n={}){return this._isValidId(e)?(this.style.setFilter(e,t,n),this._update(!0)):this}getFilter(e){return this._isValidId(e)?this.style.getFilter(e):null}setPaintProperty(e,t,n,r={}){return this._isValidId(e)?(this.style.setPaintProperty(e,t,n,r),this._update(!0)):this}getPaintProperty(e,t){return this._isValidId(e)?this.style.getPaintProperty(e,t):null}setLayoutProperty(e,t,n,r={}){return this._isValidId(e)?(this.style.setLayoutProperty(e,t,n,r),this._update(!0)):this}getLayoutProperty(e,t){return this._isValidId(e)?this.style.getLayoutProperty(e,t):null}getConfigProperty(e,t){return this.style.getConfigProperty(e,t)}setConfigProperty(e,t,n){return this.style.setConfigProperty(e,t,n),this._update(!0)}setLights(e){if(this._lazyInitEmptyStyle(),e&&e.length===1&&e[0].type==="flat"){const t=e[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(e),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const e=this.style.getLights()||[];return e.length===0&&e.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),e}setLight(e,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:e}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(e){return this.style.setCamera(e),this._triggerCameraUpdate(e)}_triggerCameraUpdate(e){return this._update(this.transform.setOrthographicProjectionAtLowPitch(e["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(e){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(Be.convert(e),this.transform):0}setFeatureState(e,t){return this._isValidId(e.source)?(this.style.setFeatureState(e,t),this._update()):this}removeFeatureState(e,t){return this._isValidId(e.source)?(this.style.removeFeatureState(e,t),this._update()):this}getFeatureState(e){return this._isValidId(e.source)?this.style.getFeatureState(e):null}_updateContainerDimensions(){if(!this._container)return;const e=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let n,r,i,o=this._container;for(;o&&(!r||!i);){const s=k.getComputedStyle(o).transform;s&&s!=="none"&&(n=s.match(/matrix.*\((.+)\)/)[1].split(", "),n[0]&&n[0]!=="0"&&n[0]!=="1"&&(r=n[0]),n[3]&&n[3]!=="0"&&n[3]!=="1"&&(i=n[3])),o=o.parentElement}this._containerWidth=r?Math.abs(e/r):e,this._containerHeight=i?Math.abs(t/i):t}_detectMissingCSS(){k.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&rt("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=Fn("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=Fn("div","mapboxgl-canvas-container",e);this._canvas=Fn("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const n=this._controlContainer=Fn("div","mapboxgl-control-container",e),r=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(i=>{r[i]=Fn("div",`mapboxgl-ctrl-${i}`,n)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,t){const n=ze.devicePixelRatio||1;this._canvas.width=n*Math.ceil(e),this._canvas.height=n*Math.ceil(t),this._canvas.style.width=`${e}px`,this._canvas.style.height=`${t}px`}_addMarker(e){this._markers.push(e)}_removeMarker(e){const t=this._markers.indexOf(e);t!==-1&&this._markers.splice(t,1)}_addPopup(e){this._popups.push(e)}_removePopup(e){const t=this._popups.indexOf(e);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const e=re({},hp.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",e);t?(up(t,!0),this.painter=new CF(t,this._contextCreateOptions,this.transform),this.on("data",n=>{n.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),zt.testSupport(t)):this.fire(new Ie(new Error("Failed to initialize WebGL")))}_contextLost(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new Nt("webglcontextlost",{originalEvent:e}))}_contextRestored(e){this._setupPainter(),this.resize(),this._update(),this.fire(new Nt("webglcontextrestored",{originalEvent:e}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(e){let t;this.fire(new Nt("renderstart"));const n=this.painter.context.extTimerQuery,r=ze.now(),i=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=i.createQuery(),i.beginQuery(n.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],k.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],k.performance.now())),this._renderTaskQueue.run(e),this._domRenderTaskQueue.run(e),this._removed)return;this._updateProjectionTransition();const o=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const c=this.transform.zoom,h=this.transform.pitch,d=ze.now(),m=new rr(c,{now:d,fadeDuration:o,pitch:h,transition:this.style.transition});this.style.update(m)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let s=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),s=this._updateAverageElevation(r),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):s=this._updateAverageElevation(r),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new Nt("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new Nt("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const c=ze.now()-r;i.endQuery(n.TIME_ELAPSED_EXT),setTimeout(()=>{const h=i.getQueryParameter(t,i.QUERY_RESULT)/1e6;i.deleteQuery(t),this.fire(new Nt("gpu-timing-frame",{cpuTime:c,gpuTime:h})),k.performance.mark("frame-gpu",{startTime:r,detail:{gpuTime:h}})},50)}if(this.listens("gpu-timing-layer")){const c=this.painter.collectGpuTimers();setTimeout(()=>{const h=this.painter.queryGpuTimers(c);this.fire(new Nt("gpu-timing-layer",{layerTimes:h}))},50)}if(this.listens("gpu-timing-deferred-render")){const c=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const h=this.painter.queryGpuTimeDeferredRender(c);this.fire(new Nt("gpu-timing-deferred-render",{gpuTime:h}))},50)}const a=this._sourcesDirty||this._styleDirty||this._placementDirty||s;if(a||this._repaint)this.triggerRepaint();else{const c=!this.isMoving()&&this.loaded();if(c&&(s=this._updateAverageElevation(r,!0)),s)this.triggerRepaint();else if(this._triggerFrame(!1),c&&(this.fire(new Nt("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const h=this._calculateSpeedIndex();this.fire(new Nt("speedindexcompleted",{speedIndex:h})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||a||(this._fullyLoaded=!0,O_.mark($h.fullLoad),this._performanceMetricsCollection&&qv(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(e){for(const t of this._markers)e&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!e||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(e,t=!1){const n=i=>(this.transform.averageElevation=i,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&n(0);const r=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(r||(t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){const i=this.transform.averageElevation;let o=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(o)?o=0:this._averageElevationLastSampledAt=e;const s=Math.abs(i-o);if(s>1){if(this._isInitialLoad||r)return this._averageElevation.jumpTo(o),n(o);this._averageElevation.easeTo(o,e,300)}else if(s>1e-4)return this._averageElevation.jumpTo(o),n(o)}return!!this._averageElevation.isEasing(e)&&n(this._averageElevation.getValue(e))}_authenticate(){z_(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,e=>{if(e&&(e.message===Ln||e.status===401)){const t=this.painter.context.gl;up(t,!1),this._logoControl instanceof RI&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new Ie(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Jh(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const e=this._isDragging();this.painter.updateTerrain(this.style,e)}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const n=this.painter.context.gl,r=n.createFramebuffer();function i(o){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,o,0);const s=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,s),s}return n.bindFramebuffer(n.FRAMEBUFFER,r),this._canvasPixelComparison(i(e),t.canvasCopies.map(i),t.timeStamps)}_canvasPixelComparison(e,t,n){let r=n[1]-n[0];const i=e.length/4;for(let o=0;o<t.length;o++){const s=t[o];let a=0;for(let c=0;c<s.length;c+=4)s[c]===e[c]&&s[c+1]===e[c+1]&&s[c+2]===e[c+2]&&s[c+3]===e[c+3]&&(a+=1);r+=(n[o+2]-n[o+1])*(1-a/i)}return r}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),k!==void 0&&(k.removeEventListener("resize",this._onWindowResize,!1),k.removeEventListener("orientationchange",this._onWindowResize,!1),k.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),k.removeEventListener("online",this._onWindowOnline,!1),k.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Bc.delete(this.painter.context.gl),this._removed=!0,this.fire(new Nt("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(e){this._renderNextFrame=this._renderNextFrame||e,this.style&&!this._frame&&(this._frame=ze.frame(t=>{const n=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,n&&this._render(t)}))}_preloadTiles(e){return Mi(this.style?Object.values(this.style._sourceCaches):[],(t,n)=>t._preloadTiles(e,n),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}_onVisibilityChange(){k.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(e){this._showLayers2DWireframe!==e&&(this._showLayers2DWireframe=e,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(e){this._showLayers3DWireframe!==e&&(this._showLayers3DWireframe=e,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&(this._showTileAABBs=e,e&&this._update())}_setCacheLimits(e,t){(function(n,r){ai=n,_i=r})(e,t)}get version(){return ot}},NavigationControl:class{constructor(e){this.options=re({},yz,e),this._container=Fn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(Jn(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),Fn("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),Fn("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(Jn(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const n=this._map;n&&(this.options.visualizePitch?n.resetNorthPitch({},{originalEvent:t}):n.resetNorth({},{originalEvent:t}))}),this._compassIcon=Fn("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const e=this._map;if(!e)return;const t=e.getZoom(),n=t===e.getMaxZoom(),r=t===e.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=r,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",r.toString())}_rotateCompassArrow(){const e=this._map;if(!e)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5)}) rotateX(${e.transform.pitch}deg) rotateZ(${e.transform.angle*(180/Math.PI)}deg)`:`rotate(${e.transform.angle*(180/Math.PI)}deg)`;e._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new xz(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){const e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){const n=Fn("button",e,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(e,t){if(!this._map)return;const n=this._map._getUIString(`NavigationControl.${t}`);e.setAttribute("aria-label",n),e.firstElementChild&&e.firstElementChild.setAttribute("title",n)}},GeolocateControl:class extends Sr{constructor(e){super(),this.options=re({geolocation:k.navigator.geolocation},vz,e),Jn(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=TI(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=Fn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(e){const t=(n=!!this.options.geolocation)=>{this._supportsGeolocation=n,e(n)};this._supportsGeolocation!==void 0?e(this._supportsGeolocation):k.navigator.permissions!==void 0?k.navigator.permissions.query({name:"geolocation"}).then(n=>t(n.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),n=e.coords;return!!t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new Nt("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new Nt("geolocate",e)),this._finish()}}_updateCamera(e){const t=new Be(e.coords.longitude,e.coords.latitude),n=e.coords.accuracy,r=re({bearing:this._map.getBearing()},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(n),r,{geolocateSource:!0})}_updateMarker(e){if(e){const t=new Be(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const e=this._map.transform,t=Rn(1,e._center.lat)*e.worldSize,n=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(e){if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new Nt("error",e)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(e){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=Fn("button","mapboxgl-ctrl-geolocate",this._container),Fn("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",e===!1){rt("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Fn("div","mapboxgl-user-location"),this._dotElement.appendChild(Fn("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Fn("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new bA({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Fn("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new bA({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new Nt("trackuserlocationend")))})}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:e.absolute===!0&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return rt("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new Nt("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new Nt("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new Nt("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const e=()=>{k.addEventListener("ondeviceorientationabsolute"in k?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};k.DeviceMotionEvent!==void 0&&typeof k.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&e()}).catch(console.error):e()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),k.removeEventListener("deviceorientation",this._onDeviceOrientation),k.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:LI,ScaleControl:class{constructor(e){this.options=re({},wz,e),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),Jn(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const e=this.options.maxWidth||100,t=this._map,n=t._containerHeight/2,r=t._containerWidth/2-e/2,i=t.unproject([r,n]),o=t.unproject([r+e,n]),s=i.distanceTo(o);if(this.options.unit==="imperial"){const a=3.2808*s;a>5280?this._setScale(e,a/5280,"mile"):this._setScale(e,a,"foot")}else this.options.unit==="nautical"?this._setScale(e,s/1852,"nautical-mile"):s>=1e3?this._setScale(e,s/1e3,"kilometer"):this._setScale(e,s,"meter")}_setScale(e,t,n){this._map._requestDomTask(()=>{const r=function(o){const s=Math.pow(10,`${Math.floor(o)}`.length-1);let a=o/s;return a=a>=10?10:a>=5?5:a>=3?3:a>=2?2:a>=1?1:function(c){const h=Math.pow(10,Math.ceil(-Math.log(c)/Math.LN10));return Math.round(c*h)/h}(a),s*a}(t),i=r/t;this._container.innerHTML=this._isNumberFormatSupported&&n!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:n}).format(r):`${r}&nbsp;${bz[n]}`,this._container.style.width=e*i+"px"})}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=Fn("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof k.HTMLElement?this._container=e.container:rt("Full screen control 'container' must be a DOM element.")),Jn(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in k.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in k.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=Fn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",rt("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,k.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!k.document.fullscreenEnabled&&!k.document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=Fn("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Fn("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),k.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(k.document.fullscreenElement||k.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?k.document.exitFullscreen?k.document.exitFullscreen():k.document.webkitCancelFullScreen&&k.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends Sr{constructor(e){super(),this.options=re(Object.create(dz),e),Jn(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(e&&e.className?e.className.trim().split(/\s+/):[])}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&e.on("preclick",this._onClose),this.options.closeOnMove&&e.on("move",this._onClose),e.on("remove",this.remove),this._update(),e._addPopup(this),this._focusFirstElement(),this._trackPointer?(e.on("mousemove",this._onMouseEvent),e.on("mouseup",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")):e.on("move",this._update),this.fire(new Nt("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const e=this._map;return e&&(e.off("move",this._update),e.off("move",this._onClose),e.off("preclick",this._onClose),e.off("click",this._onClose),e.off("remove",this.remove),e.off("mousemove",this._onMouseEvent),e.off("mouseup",this._onMouseEvent),e.off("drag",this._onMouseEvent),e._canvasContainer&&e._canvasContainer.classList.remove("mapboxgl-track-pointer"),e._removePopup(this),this._map=void 0),this.fire(new Nt("close")),this}getLngLat(){return this._lngLat}setLngLat(e){this._lngLat=Be.convert(e),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(k.document.createTextNode(e))}setHTML(e){const t=k.document.createDocumentFragment(),n=k.document.createElement("body");let r;for(n.innerHTML=e;r=n.firstChild,r;)t.appendChild(r);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=Fn("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){const n=this._closeButton=Fn("button","mapboxgl-popup-close-button",t);n.type="button",n.setAttribute("aria-label","Close popup"),n.setAttribute("aria-hidden","true"),n.innerHTML="&#215;",n.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._map,n=this._container,r=this._pos;if(!t||!n||!r)return"bottom";const i=n.offsetWidth,o=n.offsetHeight,s=r.x<i/2,a=r.x>t.transform.width-i/2;if(r.y+e<o)return s?"top-left":a?"top-right":"top";if(r.y>t.transform.height-o){if(s)return"bottom-left";if(a)return"bottom-right"}return s?"left":a?"right":"bottom"}_updateClassList(){const e=this._container;if(!e)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ")}_update(e){const t=this._map,n=this._content;if(!t||!this._lngLat&&!this._trackPointer||!n)return;let r=this._container;if(r||(r=this._container=Fn("div","mapboxgl-popup",t.getContainer()),this._tip=Fn("div","mapboxgl-popup-tip",r),r.appendChild(n)),this.options.maxWidth&&r.style.maxWidth!==this.options.maxWidth&&(r.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=FI(this._lngLat,this._pos,t.transform)),!this._trackPointer||e){const i=this._pos=this._trackPointer&&e?e:t.project(this._lngLat),o=zI(this.options.offset),s=this._anchor=this._getAnchor(o.y),a=zI(this.options.offset,s),c=i.add(a).round();t._requestDomTask(()=>{this._container&&s&&(this._container.style.transform=`${wA[s]} translate(${c.x}px,${c.y}px)`)})}if(!this._marker&&t._showingGlobe()){const i=vh(t.transform,this._lngLat)?0:1;this._setOpacity(i)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(pz);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity=`${e}`),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:bA,Style:va,LngLat:Be,LngLatBounds:lo,Point:nt,MercatorCoordinate:an,FreeCameraOptions:JC,Evented:Sr,config:X,prewarm:function(){Rg().acquire(Wb)},clearPrewarmedResources:function(){const e=Lg;e&&(e.isPreloaded()&&e.numActive()===1?(e.release(Wb),Lg=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return X.ACCESS_TOKEN},set accessToken(e){X.ACCESS_TOKEN=e},get baseApiUrl(){return X.API_URL},set baseApiUrl(e){X.API_URL=e},get workerCount(){return Td.workerCount},set workerCount(e){Td.workerCount=e},get maxParallelImageRequests(){return X.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){X.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(e){(function(t){if(!lu())return;const n=k.caches.delete(Hn);t&&n.catch(t).then(()=>t())})(e)},workerUrl:"",workerClass:null,get dracoUrl(){return uM()},set dracoUrl(e){(function(t){qb=ze.resolveURL(t),Jb||(Jb=new Ih(Rg(),new Sr)),Jb.broadcast("setDracoUrl",qb)})(e)},setNow:ze.setNow,restoreNow:ze.restoreNow};F.A=tM,F.D=b1,F.E=gt,F.F=mb,F.K=ox,F.O=sn,F.P=nt,F.T=xS,F.V=_1,F.a=g1,F.b=XT,F.c=K1,F.d=class extends Sr{constructor(e,t,n,r,i,o){super(),this.actor=e,this.layerIndex=t,this.availableImages=n,this.loadVectorData=i||aM,this.loading={},this.loaded={},this.deduped=new sM(e.scheduler),this.isSpriteLoaded=r,this.scheduler=e.scheduler,this.brightness=o}loadTile(e,t){const n=e.uid,r=e&&e.request,i=r&&r.collectResourceTiming,o=this.loading[n]=new GR(e);o.abort=this.loadVectorData(e,(s,a)=>{const c=!this.loading[n];if(delete this.loading[n],c||s||!a)return o.status="done",c||(this.loaded[n]=o),t(s);const h=a.rawData,d={};a.expires&&(d.expires=a.expires),a.cacheControl&&(d.cacheControl=a.cacheControl),o.vectorTile=a.vectorTile||new db(new w1(h));const m=()=>{o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,(g,x)=>{if(g||!x)return t(g);const v={};if(i){const w=cp(r);w.length>0&&(v.resourceTiming=JSON.parse(JSON.stringify(w)))}t(null,re({rawTileData:h.slice(0)},x,d,v))})};this.isSpriteLoaded?m():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(m,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):m()}),this.loaded=this.loaded||{},this.loaded[n]=o})}reloadTile(e,t){const n=this.loaded,r=e.uid,i=this;if(n&&n[r]){const o=n[r];o.showCollisionBoxes=e.showCollisionBoxes,o.projection=e.projection,o.brightness=e.brightness,o.tileTransform=Eh(e.tileID.canonical,e.projection),o.extraShadowCaster=e.extraShadowCaster;const s=(a,c)=>{const h=o.reloadCallback;h&&(delete o.reloadCallback,o.parse(o.vectorTile,i.layerIndex,this.availableImages,i.actor,h)),t(a,c)};o.status==="parsing"?o.reloadCallback=s:o.status==="done"&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}else t(null,void 0)}abortTile(e,t){const n=e.uid,r=this.loading[n];r&&(r.abort&&r.abort(),delete this.loading[n]),t()}removeTile(e,t){const n=this.loaded,r=e.uid;n&&n[r]&&delete n[r],t()}},F.e=ta,F.f=cp,F.g=It,F.h=jt,F.i=Kt,F.j=function(e,t){const n=tA(e);for(const r of n){for(const i of r.meshes)YR(i);r.lights&&(r.lightMeshIndex=r.meshes.length,r.meshes.push(QR(r.lights,t)))}return n},F.k=rr,F.l=function(e){let t=0;if(new Uint32Array(e,0,1)[0]!==hM){const n=new Uint32Array(e,0,7),[,,r,i,o,s]=n;t=n.byteLength+i+o+s+o,(r!==e.byteLength||t>=e.byteLength)&&rt("Invalid b3dm header information.")}return mM(e,t)},F.m=D1,F.n=xo,F.o=Nt,F.p=me,F.q=function(e){ro(),yi&&yi.then(t=>{t.keys().then(n=>{for(let r=0;r<n.length-e;r++)t.delete(n[r])})})},F.r=vM,F.s=wx,F.t=wh,F.v=hi,F.w=k}),P(["./shared"],function(F){function k(Ot){if(typeof Ot=="number"||typeof Ot=="boolean"||typeof Ot=="string"||Ot==null)return JSON.stringify(Ot);if(Array.isArray(Ot)){let K="[";for(const rt of Ot)K+=`${k(rt)},`;return`${K}]`}let q="{";for(const K of Object.keys(Ot).sort())q+=`${K}:${k(Ot[K])},`;return`${q}}`}function ot(Ot){let q="";for(const K of F.r)q+=`/${k(Ot[K])}`;return q}class ft{constructor(q){this.keyCache={},this._layers={},this._layerConfigs={},q&&this.replace(q)}replace(q,K){this._layerConfigs={},this._layers={},this.update(q,[],K)}update(q,K,rt){this._options=rt;for(const Dt of q){this._layerConfigs[Dt.id]=Dt;const te=this._layers[Dt.id]=F.c(Dt,this._options);te.setScope(this.scope),te.compileFilter(),this.keyCache[Dt.id]&&delete this.keyCache[Dt.id]}for(const Dt of K)delete this.keyCache[Dt],delete this._layerConfigs[Dt],delete this._layers[Dt];this.familiesBySource={};const St=function(Dt,te){const de={};for(let xe=0;xe<Dt.length;xe++){const be=te&&te[Dt[xe].id]||ot(Dt[xe]);te&&(te[Dt[xe].id]=be);let Ee=de[be];Ee||(Ee=de[be]=[]),Ee.push(Dt[xe])}const Pt=[];for(const xe in de)Pt.push(de[xe]);return Pt}(F.v(this._layerConfigs),this.keyCache);for(const Dt of St){const te=Dt.map(Un=>this._layers[Un.id]),de=te[0];if(de.visibility==="none")continue;const Pt=de.source||"";let xe=this.familiesBySource[Pt];xe||(xe=this.familiesBySource[Pt]={});const be=de.sourceLayer||"_geojsonTileLayer";let Ee=xe[be];Ee||(Ee=xe[be]=[]),Ee.push(te)}}}class X{loadTile(q,K){const{uid:rt,encoding:St,rawImageData:Dt,padding:te}=q,de=F.w.ImageBitmap&&Dt instanceof F.w.ImageBitmap?this.getImageData(Dt,te):Dt;K(null,new F.D(rt,de,St,te<1))}getImageData(q,K){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(q.width,q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=q.width,this.offscreenCanvas.height=q.height,this.offscreenCanvasContext.drawImage(q,0,0,q.width,q.height);const rt=this.offscreenCanvasContext.getImageData(-K,-K,q.width+2*K,q.height+2*K);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),rt}}function zt(Ot,q){if(Ot.length!==0){Lt(Ot[0],q);for(var K=1;K<Ot.length;K++)Lt(Ot[K],!q)}}function Lt(Ot,q){for(var K=0,rt=0,St=0,Dt=Ot.length,te=Dt-1;St<Dt;te=St++){var de=(Ot[St][0]-Ot[te][0])*(Ot[te][1]+Ot[St][1]),Pt=K+de;rt+=Math.abs(K)>=Math.abs(de)?K-Pt+de:de-Pt+K,K=Pt}K+rt>=0!=!!q&&Ot.reverse()}var Ht=F.g(function Ot(q,K){var rt,St=q&&q.type;if(St==="FeatureCollection")for(rt=0;rt<q.features.length;rt++)Ot(q.features[rt],K);else if(St==="GeometryCollection")for(rt=0;rt<q.geometries.length;rt++)Ot(q.geometries[rt],K);else if(St==="Feature")Ot(q.geometry,K);else if(St==="Polygon")zt(q.coordinates,K);else if(St==="MultiPolygon")for(rt=0;rt<q.coordinates.length;rt++)zt(q.coordinates[rt],K);return q});const we=F.V.prototype.toGeoJSON;var mt={exports:{}},at=F.p,xt=F.a.VectorTileFeature,It=Xt;function Xt(Ot,q){this.options=q||{},this.features=Ot,this.length=Ot.length}function ue(Ot,q){this.id=typeof Ot.id=="number"?Ot.id:void 0,this.type=Ot.type,this.rawGeometry=Ot.type===1?[Ot.geometry]:Ot.geometry,this.properties=Ot.tags,this.extent=q||4096}Xt.prototype.feature=function(Ot){return new ue(this.features[Ot],this.options.extent)},ue.prototype.loadGeometry=function(){var Ot=this.rawGeometry;this.geometry=[];for(var q=0;q<Ot.length;q++){for(var K=Ot[q],rt=[],St=0;St<K.length;St++)rt.push(new at(K[St][0],K[St][1]));this.geometry.push(rt)}return this.geometry},ue.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ot=this.geometry,q=1/0,K=-1/0,rt=1/0,St=-1/0,Dt=0;Dt<Ot.length;Dt++)for(var te=Ot[Dt],de=0;de<te.length;de++){var Pt=te[de];q=Math.min(q,Pt.x),K=Math.max(K,Pt.x),rt=Math.min(rt,Pt.y),St=Math.max(St,Pt.y)}return[q,rt,K,St]},ue.prototype.toGeoJSON=xt.prototype.toGeoJSON;var oe=F.b,me=It;function Nn(Ot){var q=new oe;return function(K,rt){for(var St in K.layers)rt.writeMessage(3,nt,K.layers[St])}(Ot,q),q.finish()}function nt(Ot,q){var K;q.writeVarintField(15,Ot.version||1),q.writeStringField(1,Ot.name||""),q.writeVarintField(5,Ot.extent||4096);var rt={keys:[],values:[],keycache:{},valuecache:{}};for(K=0;K<Ot.length;K++)rt.feature=Ot.feature(K),q.writeMessage(2,Re,rt);var St=rt.keys;for(K=0;K<St.length;K++)q.writeStringField(3,St[K]);var Dt=rt.values;for(K=0;K<Dt.length;K++)q.writeMessage(4,Bo,Dt[K])}function Re(Ot,q){var K=Ot.feature;K.id!==void 0&&q.writeVarintField(1,K.id),q.writeMessage(2,ds,Ot),q.writeVarintField(3,K.type),q.writeMessage(4,dr,K)}function ds(Ot,q){var K=Ot.feature,rt=Ot.keys,St=Ot.values,Dt=Ot.keycache,te=Ot.valuecache;for(var de in K.properties){var Pt=K.properties[de],xe=Dt[de];if(Pt!==null){xe===void 0&&(rt.push(de),Dt[de]=xe=rt.length-1),q.writeVarint(xe);var be=typeof Pt;be!=="string"&&be!=="boolean"&&be!=="number"&&(Pt=JSON.stringify(Pt));var Ee=be+":"+Pt,Un=te[Ee];Un===void 0&&(St.push(Pt),te[Ee]=Un=St.length-1),q.writeVarint(Un)}}}function Ni(Ot,q){return(q<<3)+(7&Ot)}function Ae(Ot){return Ot<<1^Ot>>31}function dr(Ot,q){for(var K=Ot.loadGeometry(),rt=Ot.type,St=0,Dt=0,te=K.length,de=0;de<te;de++){var Pt=K[de],xe=1;rt===1&&(xe=Pt.length),q.writeVarint(Ni(1,xe));for(var be=rt===3?Pt.length-1:Pt.length,Ee=0;Ee<be;Ee++){Ee===1&&rt!==1&&q.writeVarint(Ni(2,be-1));var Un=Pt[Ee].x-St,Qn=Pt[Ee].y-Dt;q.writeVarint(Ae(Un)),q.writeVarint(Ae(Qn)),St+=Un,Dt+=Qn}rt===3&&q.writeVarint(Ni(7,1))}}function Bo(Ot,q){var K=typeof Ot;K==="string"?q.writeStringField(1,Ot):K==="boolean"?q.writeBooleanField(7,Ot):K==="number"&&(Ot%1!=0?q.writeDoubleField(3,Ot):Ot<0?q.writeSVarintField(6,Ot):q.writeVarintField(5,Ot))}mt.exports=Nn,mt.exports.fromVectorTileJs=Nn,mt.exports.fromGeojsonVt=function(Ot,q){q=q||{};var K={};for(var rt in Ot)K[rt]=new me(Ot[rt].features,q),K[rt].name=rt,K[rt].version=q.version,K[rt].extent=q.extent;return Nn({layers:K})},mt.exports.GeoJSONWrapper=me;var si=F.g(mt.exports);const fe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ot=>Ot},He=Math.fround||(We=new Float32Array(1),Ot=>(We[0]=+Ot,We[0]));var We;const hn=3,$t=5,Ui=6;class ci{constructor(q){this.options=Object.assign(Object.create(fe),q),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(q){const{log:K,minZoom:rt,maxZoom:St}=this.options;K&&console.time("total time");const Dt=`prepare ${q.length} points`;K&&console.time(Dt),this.points=q;const te=[];for(let Pt=0;Pt<q.length;Pt++){const xe=q[Pt];if(!xe.geometry)continue;const[be,Ee]=xe.geometry.coordinates,Un=He(re(be)),Qn=He(fi(Ee));te.push(Un,Qn,1/0,Pt,-1,1),this.options.reduce&&te.push(0)}let de=this.trees[St+1]=this._createTree(te);K&&console.timeEnd(Dt);for(let Pt=St;Pt>=rt;Pt--){const xe=+Date.now();de=this.trees[Pt]=this._createTree(this._cluster(de,Pt)),K&&console.log("z%d: %d clusters in %dms",Pt,de.numItems,+Date.now()-xe)}return K&&console.timeEnd("total time"),this}getClusters(q,K){let rt=((q[0]+180)%360+360)%360-180;const St=Math.max(-90,Math.min(90,q[1]));let Dt=q[2]===180?180:((q[2]+180)%360+360)%360-180;const te=Math.max(-90,Math.min(90,q[3]));if(q[2]-q[0]>=360)rt=-180,Dt=180;else if(rt>Dt){const Ee=this.getClusters([rt,St,180,te],K),Un=this.getClusters([-180,St,Dt,te],K);return Ee.concat(Un)}const de=this.trees[this._limitZoom(K)],Pt=de.range(re(rt),fi(te),re(Dt),fi(St)),xe=de.data,be=[];for(const Ee of Pt){const Un=this.stride*Ee;be.push(xe[Un+$t]>1?Mi(xe,Un,this.clusterProps):this.points[xe[Un+hn]])}return be}getChildren(q){const K=this._getOriginId(q),rt=this._getOriginZoom(q),St="No cluster with the specified id.",Dt=this.trees[rt];if(!Dt)throw new Error(St);const te=Dt.data;if(K*this.stride>=te.length)throw new Error(St);const de=this.options.radius/(this.options.extent*Math.pow(2,rt-1)),Pt=Dt.within(te[K*this.stride],te[K*this.stride+1],de),xe=[];for(const be of Pt){const Ee=be*this.stride;te[Ee+4]===q&&xe.push(te[Ee+$t]>1?Mi(te,Ee,this.clusterProps):this.points[te[Ee+hn]])}if(xe.length===0)throw new Error(St);return xe}getLeaves(q,K,rt){const St=[];return this._appendLeaves(St,q,K=K||10,rt=rt||0,0),St}getTile(q,K,rt){const St=this.trees[this._limitZoom(q)],Dt=Math.pow(2,q),{extent:te,radius:de}=this.options,Pt=de/te,xe=(rt-Pt)/Dt,be=(rt+1+Pt)/Dt,Ee={features:[]};return this._addTileFeatures(St.range((K-Pt)/Dt,xe,(K+1+Pt)/Dt,be),St.data,K,rt,Dt,Ee),K===0&&this._addTileFeatures(St.range(1-Pt/Dt,xe,1,be),St.data,Dt,rt,Dt,Ee),K===Dt-1&&this._addTileFeatures(St.range(0,xe,Pt/Dt,be),St.data,-1,rt,Dt,Ee),Ee.features.length?Ee:null}getClusterExpansionZoom(q){let K=this._getOriginZoom(q)-1;for(;K<=this.options.maxZoom;){const rt=this.getChildren(q);if(K++,rt.length!==1)break;q=rt[0].properties.cluster_id}return K}_appendLeaves(q,K,rt,St,Dt){const te=this.getChildren(K);for(const de of te){const Pt=de.properties;if(Pt&&Pt.cluster?Dt+Pt.point_count<=St?Dt+=Pt.point_count:Dt=this._appendLeaves(q,Pt.cluster_id,rt,St,Dt):Dt<St?Dt++:q.push(de),q.length===rt)break}return Dt}_createTree(q){const K=new F.K(q.length/this.stride|0,this.options.nodeSize,Float32Array);for(let rt=0;rt<q.length;rt+=this.stride)K.add(q[rt],q[rt+1]);return K.finish(),K.data=q,K}_addTileFeatures(q,K,rt,St,Dt,te){for(const de of q){const Pt=de*this.stride,xe=K[Pt+$t]>1;let be,Ee,Un;if(xe)be=hi(K,Pt,this.clusterProps),Ee=K[Pt],Un=K[Pt+1];else{const tr=this.points[K[Pt+hn]];be=tr.properties;const[pr,Hn]=tr.geometry.coordinates;Ee=re(pr),Un=fi(Hn)}const Qn={type:1,geometry:[[Math.round(this.options.extent*(Ee*Dt-rt)),Math.round(this.options.extent*(Un*Dt-St))]],tags:be};let Nr;Nr=xe||this.options.generateId?K[Pt+hn]:this.points[K[Pt+hn]].id,Nr!==void 0&&(Qn.id=Nr),te.features.push(Qn)}}_limitZoom(q){return Math.max(this.options.minZoom,Math.min(Math.floor(+q),this.options.maxZoom+1))}_cluster(q,K){const{radius:rt,extent:St,reduce:Dt,minPoints:te}=this.options,de=rt/(St*Math.pow(2,K)),Pt=q.data,xe=[],be=this.stride;for(let Ee=0;Ee<Pt.length;Ee+=be){if(Pt[Ee+2]<=K)continue;Pt[Ee+2]=K;const Un=Pt[Ee],Qn=Pt[Ee+1],Nr=q.within(Pt[Ee],Pt[Ee+1],de),tr=Pt[Ee+$t];let pr=tr;for(const Hn of Nr){const ai=Hn*be;Pt[ai+2]>K&&(pr+=Pt[ai+$t])}if(pr>tr&&pr>=te){let Hn,ai=Un*tr,_i=Qn*tr,yi=-1;const Yo=((Ee/be|0)<<5)+(K+1)+this.points.length;for(const lu of Nr){const ro=lu*be;if(Pt[ro+2]<=K)continue;Pt[ro+2]=K;const ms=Pt[ro+$t];ai+=Pt[ro]*ms,_i+=Pt[ro+1]*ms,Pt[ro+4]=Yo,Dt&&(Hn||(Hn=this._map(Pt,Ee,!0),yi=this.clusterProps.length,this.clusterProps.push(Hn)),Dt(Hn,this._map(Pt,ro)))}Pt[Ee+4]=Yo,xe.push(ai/pr,_i/pr,1/0,Yo,-1,pr),Dt&&xe.push(yi)}else{for(let Hn=0;Hn<be;Hn++)xe.push(Pt[Ee+Hn]);if(pr>1)for(const Hn of Nr){const ai=Hn*be;if(!(Pt[ai+2]<=K)){Pt[ai+2]=K;for(let _i=0;_i<be;_i++)xe.push(Pt[ai+_i])}}}}return xe}_getOriginId(q){return q-this.points.length>>5}_getOriginZoom(q){return(q-this.points.length)%32}_map(q,K,rt){if(q[K+$t]>1){const te=this.clusterProps[q[K+Ui]];return rt?Object.assign({},te):te}const St=this.points[q[K+hn]].properties,Dt=this.options.map(St);return rt&&Dt===St?Object.assign({},Dt):Dt}}function Mi(Ot,q,K){return{type:"Feature",id:Ot[q+hn],properties:hi(Ot,q,K),geometry:{type:"Point",coordinates:[(rt=Ot[q],360*(rt-.5)),hl(Ot[q+1])]}};var rt}function hi(Ot,q,K){const rt=Ot[q+$t],St=rt>=1e4?`${Math.round(rt/1e3)}k`:rt>=1e3?Math.round(rt/100)/10+"k":rt,Dt=Ot[q+Ui],te=Dt===-1?{}:Object.assign({},K[Dt]);return Object.assign(te,{cluster:!0,cluster_id:Ot[q+hn],point_count:rt,point_count_abbreviated:St})}function re(Ot){return Ot/360+.5}function fi(Ot){const q=Math.sin(Ot*Math.PI/180),K=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return K<0?0:K>1?1:K}function hl(Ot){const q=(180-360*Ot)*Math.PI/180;return 360*Math.atan(Math.exp(q))/Math.PI-90}var su={exports:{}};su.exports=function(){function Ot(At,Ct,kt,Ut){for(var jt,Kt=Ut,Qt=kt-Ct>>1,Zt=kt-Ct,ce=At[Ct],Wt=At[Ct+1],Ze=At[kt],Ln=At[kt+1],ve=Ct+3;ve<kt;ve+=3){var Sn=q(At[ve],At[ve+1],ce,Wt,Ze,Ln);if(Sn>Kt)jt=ve,Kt=Sn;else if(Sn===Kt){var mr=Math.abs(ve-Qt);mr<Zt&&(jt=ve,Zt=mr)}}Kt>Ut&&(jt-Ct>3&&Ot(At,Ct,jt,Ut),At[jt+2]=Kt,kt-jt>3&&Ot(At,jt,kt,Ut))}function q(At,Ct,kt,Ut,jt,Kt){var Qt=jt-kt,Zt=Kt-Ut;if(Qt!==0||Zt!==0){var ce=((At-kt)*Qt+(Ct-Ut)*Zt)/(Qt*Qt+Zt*Zt);ce>1?(kt=jt,Ut=Kt):ce>0&&(kt+=Qt*ce,Ut+=Zt*ce)}return(Qt=At-kt)*Qt+(Zt=Ct-Ut)*Zt}function K(At,Ct,kt,Ut){var jt={id:At===void 0?null:At,type:Ct,geometry:kt,tags:Ut,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Kt){var Qt=Kt.geometry,Zt=Kt.type;if(Zt==="Point"||Zt==="MultiPoint"||Zt==="LineString")rt(Kt,Qt);else if(Zt==="Polygon"||Zt==="MultiLineString")for(var ce=0;ce<Qt.length;ce++)rt(Kt,Qt[ce]);else if(Zt==="MultiPolygon")for(ce=0;ce<Qt.length;ce++)for(var Wt=0;Wt<Qt[ce].length;Wt++)rt(Kt,Qt[ce][Wt])}(jt),jt}function rt(At,Ct){for(var kt=0;kt<Ct.length;kt+=3)At.minX=Math.min(At.minX,Ct[kt]),At.minY=Math.min(At.minY,Ct[kt+1]),At.maxX=Math.max(At.maxX,Ct[kt]),At.maxY=Math.max(At.maxY,Ct[kt+1])}function St(At,Ct,kt,Ut){if(Ct.geometry){var jt=Ct.geometry.coordinates,Kt=Ct.geometry.type,Qt=Math.pow(kt.tolerance/((1<<kt.maxZoom)*kt.extent),2),Zt=[],ce=Ct.id;if(kt.promoteId?ce=Ct.properties[kt.promoteId]:kt.generateId&&(ce=Ut||0),Kt==="Point")Dt(jt,Zt);else if(Kt==="MultiPoint")for(var Wt=0;Wt<jt.length;Wt++)Dt(jt[Wt],Zt);else if(Kt==="LineString")te(jt,Zt,Qt,!1);else if(Kt==="MultiLineString"){if(kt.lineMetrics){for(Wt=0;Wt<jt.length;Wt++)te(jt[Wt],Zt=[],Qt,!1),At.push(K(ce,"LineString",Zt,Ct.properties));return}de(jt,Zt,Qt,!1)}else if(Kt==="Polygon")de(jt,Zt,Qt,!0);else{if(Kt!=="MultiPolygon"){if(Kt==="GeometryCollection"){for(Wt=0;Wt<Ct.geometry.geometries.length;Wt++)St(At,{id:ce,geometry:Ct.geometry.geometries[Wt],properties:Ct.properties},kt,Ut);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Wt=0;Wt<jt.length;Wt++){var Ze=[];de(jt[Wt],Ze,Qt,!0),Zt.push(Ze)}}At.push(K(ce,Kt,Zt,Ct.properties))}}function Dt(At,Ct){Ct.push(Pt(At[0])),Ct.push(xe(At[1])),Ct.push(0)}function te(At,Ct,kt,Ut){for(var jt,Kt,Qt=0,Zt=0;Zt<At.length;Zt++){var ce=Pt(At[Zt][0]),Wt=xe(At[Zt][1]);Ct.push(ce),Ct.push(Wt),Ct.push(0),Zt>0&&(Qt+=Ut?(jt*Wt-ce*Kt)/2:Math.sqrt(Math.pow(ce-jt,2)+Math.pow(Wt-Kt,2))),jt=ce,Kt=Wt}var Ze=Ct.length-3;Ct[2]=1,Ot(Ct,0,Ze,kt),Ct[Ze+2]=1,Ct.size=Math.abs(Qt),Ct.start=0,Ct.end=Ct.size}function de(At,Ct,kt,Ut){for(var jt=0;jt<At.length;jt++){var Kt=[];te(At[jt],Kt,kt,Ut),Ct.push(Kt)}}function Pt(At){return At/360+.5}function xe(At){var Ct=Math.sin(At*Math.PI/180),kt=.5-.25*Math.log((1+Ct)/(1-Ct))/Math.PI;return kt<0?0:kt>1?1:kt}function be(At,Ct,kt,Ut,jt,Kt,Qt,Zt){if(Ut/=Ct,Kt>=(kt/=Ct)&&Qt<Ut)return At;if(Qt<kt||Kt>=Ut)return null;for(var ce=[],Wt=0;Wt<At.length;Wt++){var Ze=At[Wt],Ln=Ze.geometry,ve=Ze.type,Sn=jt===0?Ze.minX:Ze.minY,mr=jt===0?Ze.maxX:Ze.maxY;if(Sn>=kt&&mr<Ut)ce.push(Ze);else if(!(mr<kt||Sn>=Ut)){var wr=[];if(ve==="Point"||ve==="MultiPoint")Ee(Ln,wr,kt,Ut,jt);else if(ve==="LineString")Un(Ln,wr,kt,Ut,jt,!1,Zt.lineMetrics);else if(ve==="MultiLineString")Nr(Ln,wr,kt,Ut,jt,!1);else if(ve==="Polygon")Nr(Ln,wr,kt,Ut,jt,!0);else if(ve==="MultiPolygon")for(var Rr=0;Rr<Ln.length;Rr++){var xi=[];Nr(Ln[Rr],xi,kt,Ut,jt,!0),xi.length&&wr.push(xi)}if(wr.length){if(Zt.lineMetrics&&ve==="LineString"){for(Rr=0;Rr<wr.length;Rr++)ce.push(K(Ze.id,ve,wr[Rr],Ze.tags));continue}ve!=="LineString"&&ve!=="MultiLineString"||(wr.length===1?(ve="LineString",wr=wr[0]):ve="MultiLineString"),ve!=="Point"&&ve!=="MultiPoint"||(ve=wr.length===3?"Point":"MultiPoint"),ce.push(K(Ze.id,ve,wr,Ze.tags))}}}return ce.length?ce:null}function Ee(At,Ct,kt,Ut,jt){for(var Kt=0;Kt<At.length;Kt+=3){var Qt=At[Kt+jt];Qt>=kt&&Qt<=Ut&&(Ct.push(At[Kt]),Ct.push(At[Kt+1]),Ct.push(At[Kt+2]))}}function Un(At,Ct,kt,Ut,jt,Kt,Qt){for(var Zt,ce,Wt=Qn(At),Ze=jt===0?pr:Hn,Ln=At.start,ve=0;ve<At.length-3;ve+=3){var Sn=At[ve],mr=At[ve+1],wr=At[ve+2],Rr=At[ve+3],xi=At[ve+4],mo=jt===0?Sn:mr,Hr=jt===0?Rr:xi,Vi=!1;Qt&&(Zt=Math.sqrt(Math.pow(Sn-Rr,2)+Math.pow(mr-xi,2))),mo<kt?Hr>kt&&(ce=Ze(Wt,Sn,mr,Rr,xi,kt),Qt&&(Wt.start=Ln+Zt*ce)):mo>Ut?Hr<Ut&&(ce=Ze(Wt,Sn,mr,Rr,xi,Ut),Qt&&(Wt.start=Ln+Zt*ce)):tr(Wt,Sn,mr,wr),Hr<kt&&mo>=kt&&(ce=Ze(Wt,Sn,mr,Rr,xi,kt),Vi=!0),Hr>Ut&&mo<=Ut&&(ce=Ze(Wt,Sn,mr,Rr,xi,Ut),Vi=!0),!Kt&&Vi&&(Qt&&(Wt.end=Ln+Zt*ce),Ct.push(Wt),Wt=Qn(At)),Qt&&(Ln+=Zt)}var vi=At.length-3;Sn=At[vi],mr=At[vi+1],wr=At[vi+2],(mo=jt===0?Sn:mr)>=kt&&mo<=Ut&&tr(Wt,Sn,mr,wr),vi=Wt.length-3,Kt&&vi>=3&&(Wt[vi]!==Wt[0]||Wt[vi+1]!==Wt[1])&&tr(Wt,Wt[0],Wt[1],Wt[2]),Wt.length&&Ct.push(Wt)}function Qn(At){var Ct=[];return Ct.size=At.size,Ct.start=At.start,Ct.end=At.end,Ct}function Nr(At,Ct,kt,Ut,jt,Kt){for(var Qt=0;Qt<At.length;Qt++)Un(At[Qt],Ct,kt,Ut,jt,Kt,!1)}function tr(At,Ct,kt,Ut){At.push(Ct),At.push(kt),At.push(Ut)}function pr(At,Ct,kt,Ut,jt,Kt){var Qt=(Kt-Ct)/(Ut-Ct);return At.push(Kt),At.push(kt+(jt-kt)*Qt),At.push(1),Qt}function Hn(At,Ct,kt,Ut,jt,Kt){var Qt=(Kt-kt)/(jt-kt);return At.push(Ct+(Ut-Ct)*Qt),At.push(Kt),At.push(1),Qt}function ai(At,Ct){for(var kt=[],Ut=0;Ut<At.length;Ut++){var jt,Kt=At[Ut],Qt=Kt.type;if(Qt==="Point"||Qt==="MultiPoint"||Qt==="LineString")jt=_i(Kt.geometry,Ct);else if(Qt==="MultiLineString"||Qt==="Polygon"){jt=[];for(var Zt=0;Zt<Kt.geometry.length;Zt++)jt.push(_i(Kt.geometry[Zt],Ct))}else if(Qt==="MultiPolygon")for(jt=[],Zt=0;Zt<Kt.geometry.length;Zt++){for(var ce=[],Wt=0;Wt<Kt.geometry[Zt].length;Wt++)ce.push(_i(Kt.geometry[Zt][Wt],Ct));jt.push(ce)}kt.push(K(Kt.id,Qt,jt,Kt.tags))}return kt}function _i(At,Ct){var kt=[];kt.size=At.size,At.start!==void 0&&(kt.start=At.start,kt.end=At.end);for(var Ut=0;Ut<At.length;Ut+=3)kt.push(At[Ut]+Ct,At[Ut+1],At[Ut+2]);return kt}function yi(At,Ct){if(At.transformed)return At;var kt,Ut,jt,Kt=1<<At.z,Qt=At.x,Zt=At.y;for(kt=0;kt<At.features.length;kt++){var ce=At.features[kt],Wt=ce.geometry,Ze=ce.type;if(ce.geometry=[],Ze===1)for(Ut=0;Ut<Wt.length;Ut+=2)ce.geometry.push(Yo(Wt[Ut],Wt[Ut+1],Ct,Kt,Qt,Zt));else for(Ut=0;Ut<Wt.length;Ut++){var Ln=[];for(jt=0;jt<Wt[Ut].length;jt+=2)Ln.push(Yo(Wt[Ut][jt],Wt[Ut][jt+1],Ct,Kt,Qt,Zt));ce.geometry.push(Ln)}}return At.transformed=!0,At}function Yo(At,Ct,kt,Ut,jt,Kt){return[Math.round(kt*(At*Ut-jt)),Math.round(kt*(Ct*Ut-Kt))]}function lu(At,Ct,kt,Ut,jt){for(var Kt=Ct===jt.maxZoom?0:jt.tolerance/((1<<Ct)*jt.extent),Qt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:kt,y:Ut,z:Ct,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Zt=0;Zt<At.length;Zt++){Qt.numFeatures++,ro(Qt,At[Zt],Kt,jt);var ce=At[Zt].minX,Wt=At[Zt].minY,Ze=At[Zt].maxX,Ln=At[Zt].maxY;ce<Qt.minX&&(Qt.minX=ce),Wt<Qt.minY&&(Qt.minY=Wt),Ze>Qt.maxX&&(Qt.maxX=Ze),Ln>Qt.maxY&&(Qt.maxY=Ln)}return Qt}function ro(At,Ct,kt,Ut){var jt=Ct.geometry,Kt=Ct.type,Qt=[];if(Kt==="Point"||Kt==="MultiPoint")for(var Zt=0;Zt<jt.length;Zt+=3)Qt.push(jt[Zt]),Qt.push(jt[Zt+1]),At.numPoints++,At.numSimplified++;else if(Kt==="LineString")ms(Qt,jt,At,kt,!1,!1);else if(Kt==="MultiLineString"||Kt==="Polygon")for(Zt=0;Zt<jt.length;Zt++)ms(Qt,jt[Zt],At,kt,Kt==="Polygon",Zt===0);else if(Kt==="MultiPolygon")for(var ce=0;ce<jt.length;ce++){var Wt=jt[ce];for(Zt=0;Zt<Wt.length;Zt++)ms(Qt,Wt[Zt],At,kt,!0,Zt===0)}if(Qt.length){var Ze=Ct.tags||null;if(Kt==="LineString"&&Ut.lineMetrics){for(var Ln in Ze={},Ct.tags)Ze[Ln]=Ct.tags[Ln];Ze.mapbox_clip_start=jt.start/jt.size,Ze.mapbox_clip_end=jt.end/jt.size}var ve={geometry:Qt,type:Kt==="Polygon"||Kt==="MultiPolygon"?3:Kt==="LineString"||Kt==="MultiLineString"?2:1,tags:Ze};Ct.id!==null&&(ve.id=Ct.id),At.features.push(ve)}}function ms(At,Ct,kt,Ut,jt,Kt){var Qt=Ut*Ut;if(Ut>0&&Ct.size<(jt?Qt:Ut))kt.numPoints+=Ct.length/3;else{for(var Zt=[],ce=0;ce<Ct.length;ce+=3)(Ut===0||Ct[ce+2]>Qt)&&(kt.numSimplified++,Zt.push(Ct[ce]),Zt.push(Ct[ce+1])),kt.numPoints++;jt&&function(Wt,Ze){for(var Ln=0,ve=0,Sn=Wt.length,mr=Sn-2;ve<Sn;mr=ve,ve+=2)Ln+=(Wt[ve]-Wt[mr])*(Wt[ve+1]+Wt[mr+1]);if(Ln>0===Ze)for(ve=0,Sn=Wt.length;ve<Sn/2;ve+=2){var wr=Wt[ve],Rr=Wt[ve+1];Wt[ve]=Wt[Sn-2-ve],Wt[ve+1]=Wt[Sn-1-ve],Wt[Sn-2-ve]=wr,Wt[Sn-1-ve]=Rr}}(Zt,Kt),At.push(Zt)}}function Zs(At,Ct){var kt=(Ct=this.options=function(jt,Kt){for(var Qt in Kt)jt[Qt]=Kt[Qt];return jt}(Object.create(this.options),Ct)).debug;if(kt&&console.time("preprocess data"),Ct.maxZoom<0||Ct.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Ct.promoteId&&Ct.generateId)throw new Error("promoteId and generateId cannot be used together.");var Ut=function(jt,Kt){var Qt=[];if(jt.type==="FeatureCollection")for(var Zt=0;Zt<jt.features.length;Zt++)St(Qt,jt.features[Zt],Kt,Zt);else St(Qt,jt.type==="Feature"?jt:{geometry:jt},Kt);return Qt}(At,Ct);this.tiles={},this.tileCoords=[],kt&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Ct.indexMaxZoom,Ct.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Ut=function(jt,Kt){var Qt=Kt.buffer/Kt.extent,Zt=jt,ce=be(jt,1,-1-Qt,Qt,0,-1,2,Kt),Wt=be(jt,1,1-Qt,2+Qt,0,-1,2,Kt);return(ce||Wt)&&(Zt=be(jt,1,-Qt,1+Qt,0,-1,2,Kt)||[],ce&&(Zt=ai(ce,1).concat(Zt)),Wt&&(Zt=Zt.concat(ai(Wt,-1)))),Zt}(Ut,Ct)).length&&this.splitTile(Ut,0,0,0),kt&&(Ut.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function uu(At,Ct,kt){return 32*((1<<At)*kt+Ct)+At}return Zs.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Zs.prototype.splitTile=function(At,Ct,kt,Ut,jt,Kt,Qt){for(var Zt=[At,Ct,kt,Ut],ce=this.options,Wt=ce.debug;Zt.length;){Ut=Zt.pop(),kt=Zt.pop(),Ct=Zt.pop(),At=Zt.pop();var Ze=1<<Ct,Ln=uu(Ct,kt,Ut),ve=this.tiles[Ln];if(!ve&&(Wt>1&&console.time("creation"),ve=this.tiles[Ln]=lu(At,Ct,kt,Ut,ce),this.tileCoords.push({z:Ct,x:kt,y:Ut}),Wt)){Wt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ct,kt,Ut,ve.numFeatures,ve.numPoints,ve.numSimplified),console.timeEnd("creation"));var Sn="z"+Ct;this.stats[Sn]=(this.stats[Sn]||0)+1,this.total++}if(ve.source=At,jt){if(Ct===ce.maxZoom||Ct===jt)continue;var mr=1<<jt-Ct;if(kt!==Math.floor(Kt/mr)||Ut!==Math.floor(Qt/mr))continue}else if(Ct===ce.indexMaxZoom||ve.numPoints<=ce.indexMaxPoints)continue;if(ve.source=null,At.length!==0){Wt>1&&console.time("clipping");var wr,Rr,xi,mo,Hr,Vi,vi=.5*ce.buffer/ce.extent,cu=.5-vi,Ma=.5+vi,hu=1+vi;wr=Rr=xi=mo=null,Hr=be(At,Ze,kt-vi,kt+Ma,0,ve.minX,ve.maxX,ce),Vi=be(At,Ze,kt+cu,kt+hu,0,ve.minX,ve.maxX,ce),At=null,Hr&&(wr=be(Hr,Ze,Ut-vi,Ut+Ma,1,ve.minY,ve.maxY,ce),Rr=be(Hr,Ze,Ut+cu,Ut+hu,1,ve.minY,ve.maxY,ce),Hr=null),Vi&&(xi=be(Vi,Ze,Ut-vi,Ut+Ma,1,ve.minY,ve.maxY,ce),mo=be(Vi,Ze,Ut+cu,Ut+hu,1,ve.minY,ve.maxY,ce),Vi=null),Wt>1&&console.timeEnd("clipping"),Zt.push(wr||[],Ct+1,2*kt,2*Ut),Zt.push(Rr||[],Ct+1,2*kt,2*Ut+1),Zt.push(xi||[],Ct+1,2*kt+1,2*Ut),Zt.push(mo||[],Ct+1,2*kt+1,2*Ut+1)}}},Zs.prototype.getTile=function(At,Ct,kt){var Ut=this.options,jt=Ut.extent,Kt=Ut.debug;if(At<0||At>24)return null;var Qt=1<<At,Zt=uu(At,Ct=(Ct%Qt+Qt)%Qt,kt);if(this.tiles[Zt])return yi(this.tiles[Zt],jt);Kt>1&&console.log("drilling down to z%d-%d-%d",At,Ct,kt);for(var ce,Wt=At,Ze=Ct,Ln=kt;!ce&&Wt>0;)Wt--,Ze=Math.floor(Ze/2),Ln=Math.floor(Ln/2),ce=this.tiles[uu(Wt,Ze,Ln)];return ce&&ce.source?(Kt>1&&console.log("found parent tile z%d-%d-%d",Wt,Ze,Ln),Kt>1&&console.time("drilling down"),this.splitTile(ce.source,Wt,Ze,Ln,At,Ct,kt),Kt>1&&console.timeEnd("drilling down"),this.tiles[Zt]?yi(this.tiles[Zt],jt):null):null},function(At,Ct){return new Zs(At,Ct)}}();var fl=F.g(su.exports);function dl(Ot,q){const K=Ot.tileID.canonical;if(!this._geoJSONIndex)return q(null,null);const rt=this._geoJSONIndex.getTile(K.z,K.x,K.y);if(!rt)return q(null,null);const St=new class{constructor(te){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=F.E,this.length=te.length,this._features=te}feature(te){return new class{constructor(de){this._feature=de,this.extent=F.E,this.type=de.type,this.properties=de.tags,"id"in de&&!isNaN(de.id)&&(this.id=parseInt(de.id,10))}loadGeometry(){if(this._feature.type===1){const de=[];for(const Pt of this._feature.geometry)de.push([new F.P(Pt[0],Pt[1])]);return de}{const de=[];for(const Pt of this._feature.geometry){const xe=[];for(const be of Pt)xe.push(new F.P(be[0],be[1]));de.push(xe)}return de}}toGeoJSON(de,Pt,xe){return we.call(this,de,Pt,xe)}}(this._features[te])}}(rt.features);let Dt=si(St);Dt.byteOffset===0&&Dt.byteLength===Dt.buffer.byteLength||(Dt=new Uint8Array(Dt)),q(null,{vectorTile:St,rawData:Dt.buffer})}class Ic extends F.d{constructor(q,K,rt,St,Dt,te){super(q,K,rt,St,dl,te),Dt&&(this.loadGeoJSON=Dt)}loadData(q,K){const rt=q&&q.request,St=rt&&rt.collectResourceTiming;this.loadGeoJSON(q,(Dt,te)=>{if(Dt||!te)return K(Dt);if(typeof te!="object")return K(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`));{Ht(te,!0);try{if(q.filter){const Pt=F.e(q.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Pt.result==="error")throw new Error(Pt.value.map(be=>`${be.key}: ${be.message}`).join(", "));te={type:"FeatureCollection",features:te.features.filter(be=>Pt.value.evaluate({zoom:0},be))}}this._geoJSONIndex=q.cluster?new ci(function({superclusterOptions:Pt,clusterProperties:xe}){if(!xe||!Pt)return Pt;const be={},Ee={},Un={accumulated:null,zoom:0},Qn={properties:null},Nr=Object.keys(xe);for(const tr of Nr){const[pr,Hn]=xe[tr],ai=F.e(Hn),_i=F.e(typeof pr=="string"?[pr,["accumulated"],["get",tr]]:pr);be[tr]=ai.value,Ee[tr]=_i.value}return Pt.map=tr=>{Qn.properties=tr;const pr={};for(const Hn of Nr)pr[Hn]=be[Hn].evaluate(Un,Qn);return pr},Pt.reduce=(tr,pr)=>{Qn.properties=pr;for(const Hn of Nr)Un.accumulated=tr[Hn],tr[Hn]=Ee[Hn].evaluate(Un,Qn)},Pt}(q)).load(te.features):fl(te,q.geojsonVtOptions)}catch(Pt){return K(Pt)}this.loaded={};const de={};if(St){const Pt=F.f(rt);Pt&&(de.resourceTiming={},de.resourceTiming[q.source]=JSON.parse(JSON.stringify(Pt)))}K(null,de)}})}reloadTile(q,K){const rt=this.loaded;return rt&&rt[q.uid]?super.reloadTile(q,K):this.loadTile(q,K)}loadGeoJSON(q,K){if(q.request)F.h(q.request,K);else{if(typeof q.data!="string")return K(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`));try{return K(null,JSON.parse(q.data))}catch{return K(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(q,K){try{K(null,this._geoJSONIndex.getClusterExpansionZoom(q.clusterId))}catch(rt){K(rt)}}getClusterChildren(q,K){try{K(null,this._geoJSONIndex.getChildren(q.clusterId))}catch(rt){K(rt)}}getClusterLeaves(q,K){try{K(null,this._geoJSONIndex.getLeaves(q.clusterId,q.limit,q.offset))}catch(rt){K(rt)}}}class Jn{constructor(q,K){this.tileID=new F.O(q.tileID.overscaledZ,q.tileID.wrap,q.tileID.canonical.z,q.tileID.canonical.x,q.tileID.canonical.y),this.tileZoom=q.tileZoom,this.uid=q.uid,this.zoom=q.zoom,this.canonical=q.tileID.canonical,this.pixelRatio=q.pixelRatio,this.tileSize=q.tileSize,this.source=q.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=q.projection,this.brightness=K}parse(q,K,rt,St){this.status="parsing";const Dt=new F.O(rt.tileID.overscaledZ,rt.tileID.wrap,rt.tileID.canonical.z,rt.tileID.canonical.x,rt.tileID.canonical.y),te={},de=K.familiesBySource[rt.source],Pt=new F.F(Dt,rt.promoteId);return Pt.bucketLayerIDs=[],F.l(q).then(xe=>{if(!xe)return St(new Error("Could not parse tile"));const be=F.j(xe,1/F.t(rt.tileID.canonical)),Ee=xe.json.extensionsUsed&&xe.json.extensionsUsed.includes("MAPBOX_mesh_features"),Un=new F.k(this.zoom,{brightness:this.brightness});for(const Qn in de)for(const Nr of de[Qn]){const tr=Nr[0],pr=xe.json.extensionsUsed;tr.recalculate(Un,[]);const Hn=new F.T(be,Dt,pr&&pr.includes("MAPBOX_mesh_features"),this.brightness);Ee||(Hn.needsUpload=!0),te[tr.fqid]=Hn,Hn.evaluate(tr)}this.status="done",St(null,{buckets:te,featureIndex:Pt})}).catch(xe=>St(new Error(xe.message)))}}class ps{constructor(q,K,rt,St,Dt,te){this.actor=q,this.layerIndex=K,this.brightness=te,this.loading={},this.loaded={}}loadTile(q,K){const rt=q.uid,St=this.loading[rt]=new Jn(q,this.brightness);F.i(q.request,(Dt,te)=>{const de=!this.loading[rt];return delete this.loading[rt],de||Dt?(St.status="done",de||(this.loaded[rt]=St),K(Dt)):te&&te.byteLength!==0?void St.parse(te,this.layerIndex,q,(Pt,xe)=>{St.status="done",this.loaded=this.loaded||{},this.loaded[rt]=St,Pt||!xe?K(Pt):K(null,xe)}):(St.status="done",this.loaded[rt]=St,K())})}reloadTile(q,K){const rt=this.loaded,St=q.uid;if(rt&&rt[St]){const Dt=rt[St];Dt.projection=q.projection,Dt.brightness=q.brightness;const te=(de,Pt)=>{Dt.reloadCallback&&(delete Dt.reloadCallback,this.loadTile(q,K)),K(de,Pt)};Dt.status==="parsing"?Dt.reloadCallback=te:Dt.status==="done"&&this.loadTile(q,K)}}abortTile(q,K){const rt=q.uid;this.loading[rt]&&delete this.loading[rt],K()}removeTile(q,K){const rt=this.loaded,St=q.uid;rt&&rt[St]&&delete rt[St],K()}}class au{constructor(q){this.self=q,this.actor=new F.A(q,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=F.m({name:"mercator"}),this.workerSourceTypes={vector:F.d,geojson:Ic,"batched-model":ps},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(K,rt)=>{if(this.workerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.workerSourceTypes[K]=rt},this.self.registerRTLTextPlugin=K=>{if(F.n.isParsed())throw new Error("RTL text plugin already registered.");F.n.applyArabicShaping=K.applyArabicShaping,F.n.processBidirectionalText=K.processBidirectionalText,F.n.processStyledBidirectionalText=K.processStyledBidirectionalText}}clearCaches(q,K,rt){delete this.layerIndexes[q],delete this.availableImages[q],delete this.workerSources[q],delete this.demWorkerSources[q],rt()}checkIfReady(q,K,rt){rt()}setReferrer(q,K){this.referrer=K}spriteLoaded(q,{scope:K,isLoaded:rt}){if(this.isSpriteLoaded[q]||(this.isSpriteLoaded[q]={}),this.isSpriteLoaded[q][K]=rt,this.workerSources[q]&&this.workerSources[q][K])for(const St in this.workerSources[q][K]){const Dt=this.workerSources[q][K][St];for(const te in Dt)Dt[te]instanceof F.d&&(Dt[te].isSpriteLoaded=rt,Dt[te].fire(new F.o("isSpriteLoaded")))}}setImages(q,{scope:K,images:rt},St){if(this.availableImages[q]||(this.availableImages[q]={}),this.availableImages[q][K]=rt,this.workerSources[q]&&this.workerSources[q][K]){for(const Dt in this.workerSources[q][K]){const te=this.workerSources[q][K][Dt];for(const de in te)te[de].availableImages=rt}St()}else St()}setProjection(q,K){this.projections[q]=F.m(K)}setBrightness(q,K,rt){this.brightness=K,rt()}setLayers(q,K,rt){this.getLayerIndex(q,K.scope).replace(K.layers,K.options),rt()}updateLayers(q,K,rt){this.getLayerIndex(q,K.scope).update(K.layers,K.removedIds,K.options),rt()}loadTile(q,K,rt){K.projection=this.projections[q]||this.defaultProjection,this.getWorkerSource(q,K.type,K.source,K.scope).loadTile(K,rt)}loadDEMTile(q,K,rt){this.getDEMWorkerSource(q,K.source,K.scope).loadTile(K,rt)}reloadTile(q,K,rt){K.projection=this.projections[q]||this.defaultProjection,this.getWorkerSource(q,K.type,K.source,K.scope).reloadTile(K,rt)}abortTile(q,K,rt){this.getWorkerSource(q,K.type,K.source,K.scope).abortTile(K,rt)}removeTile(q,K,rt){this.getWorkerSource(q,K.type,K.source,K.scope).removeTile(K,rt)}removeSource(q,K,rt){if(!(this.workerSources[q]&&this.workerSources[q][K.scope]&&this.workerSources[q][K.scope][K.type]&&this.workerSources[q][K.scope][K.type][K.source]))return;const St=this.workerSources[q][K.scope][K.type][K.source];delete this.workerSources[q][K.scope][K.type][K.source],St.removeSource!==void 0?St.removeSource(K,rt):rt()}loadWorkerSource(q,K,rt){try{this.self.importScripts(K.url),rt()}catch(St){rt(St.toString())}}syncRTLPluginState(q,K,rt){try{F.n.setState(K);const St=F.n.getPluginURL();if(F.n.isLoaded()&&!F.n.isParsed()&&St!=null){this.self.importScripts(St);const Dt=F.n.isParsed();rt(Dt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${St}`),Dt)}}catch(St){rt(St.toString())}}setDracoUrl(q,K){this.dracoUrl=K}getAvailableImages(q,K){this.availableImages[q]||(this.availableImages[q]={});let rt=this.availableImages[q][K];return rt||(rt=[]),rt}getLayerIndex(q,K){this.layerIndexes[q]||(this.layerIndexes[q]={});let rt=this.layerIndexes[q][K];return rt||(rt=this.layerIndexes[q][K]=new ft,rt.scope=K),rt}getWorkerSource(q,K,rt,St){if(this.workerSources[q]||(this.workerSources[q]={}),this.workerSources[q][St]||(this.workerSources[q][St]={}),this.workerSources[q][St][K]||(this.workerSources[q][St][K]={}),this.isSpriteLoaded[q]||(this.isSpriteLoaded[q]={}),!this.workerSources[q][St][K][rt]){const Dt={send:(te,de,Pt,xe,be,Ee)=>{this.actor.send(te,de,Pt,q,be,Ee)},scheduler:this.actor.scheduler};this.workerSources[q][St][K][rt]=new this.workerSourceTypes[K](Dt,this.getLayerIndex(q,St),this.getAvailableImages(q,St),this.isSpriteLoaded[q][St],void 0,this.brightness)}return this.workerSources[q][St][K][rt]}getDEMWorkerSource(q,K,rt){return this.demWorkerSources[q]||(this.demWorkerSources[q]={}),this.demWorkerSources[q][rt]||(this.demWorkerSources[q][rt]={}),this.demWorkerSources[q][rt][K]||(this.demWorkerSources[q][rt][K]=new X),this.demWorkerSources[q][rt][K]}enforceCacheSizeLimit(q,K){F.q(K)}getWorkerPerformanceMetrics(q,K,rt){rt(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new au(self)),au}),P(["./shared"],function(F){return F.s});var O=C;return O})})(P3);var yN=P3.exports;const Qx=Iv(yN),xN="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Generator:%20Adobe%20Illustrator%2028.3.0,%20SVG%20Export%20Plug-In%20.%20SVG%20Version:%206.00%20Build%200)%20--%3e%3csvg%20version='1.1'%20id='Layer_1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20x='0px'%20y='0px'%20viewBox='0%200%2024%2024'%20style='enable-background:new%200%200%2024%2024;'%20xml:space='preserve'%3e%3cstyle%20type='text/css'%3e%20.st0{fill:%23FFFFFF;}%20%3c/style%3e%3cpath%20class='st0'%20d='M7.2,21.2c0.4,0,0.7-0.1,1.1-0.3c0.3-0.2,0.7-0.4,0.9-0.7v-2.1c-0.3,0-0.6,0.1-0.8,0.1s-0.5,0.1-0.7,0.2%20c-0.6,0.2-1,0.4-1.3,0.7c-0.3,0.3-0.4,0.6-0.4,1c0,0.3,0.1,0.6,0.4,0.8C6.5,21.1,6.8,21.2,7.2,21.2z%20M6.8,22.6%20c-0.7,0-1.3-0.2-1.8-0.6c-0.4-0.4-0.6-1-0.6-1.7c0-0.7,0.2-1.2,0.6-1.7c0.4-0.4,1.1-0.8,2.1-1c0.3-0.1,0.6-0.1,1-0.2%20s0.7-0.1,1.2-0.2c0-0.6-0.2-1.1-0.4-1.3c-0.3-0.3-0.7-0.4-1.2-0.4c-0.3,0-0.7,0.1-1,0.2c-0.3,0.1-0.8,0.3-1.3,0.7l-0.6-1.1%20c0.4-0.3,0.9-0.6,1.5-0.8S7.4,14,8,14c0.9,0,1.6,0.3,2.1,0.9c0.5,0.6,0.7,1.4,0.7,2.5v5H9.5l-0.1-0.9c-0.4,0.3-0.8,0.6-1.2,0.8%20C7.7,22.5,7.3,22.6,6.8,22.6z'/%3e%3cg%3e%3cpath%20class='st0'%20d='M4.3,5.7l0.1-1.8h3.9c0.4,0,0.7,0,0.9-0.1c0.2-0.1,0.4-0.2,0.6-0.3C9.9,3.3,10,3.1,10,2.8C10,2.5,10,2.3,9.8,2%20C9.7,1.8,9.5,1.5,9.3,1.3L10,0.8c0.4,0.4,0.7,0.8,0.9,1.3c0.2,0.4,0.3,0.9,0.3,1.3c0,0.4-0.1,0.7-0.2,1c-0.1,0.3-0.3,0.5-0.5,0.7%20c-0.2,0.2-0.5,0.4-0.9,0.5C9.2,5.7,8.7,5.7,8.2,5.7H4.3z%20M7.6,12c-0.6,0-1-0.1-1.5-0.3c-0.4-0.2-0.7-0.5-0.9-0.8%20C5,10.6,4.9,10.2,4.9,9.8c0-0.5,0.1-0.8,0.3-1.2C5.4,8.3,5.7,8,6.1,7.8L6,8C5.8,8,5.6,8,5.4,8C5.2,8,4.9,8,4.7,8H4.3l0.1-1.4H7%20c0.1-0.1,0.2-0.2,0.2-0.2c0.1-0.1,0.1-0.2,0.1-0.3c0-0.1,0-0.2,0-0.3c0-0.1-0.1-0.1-0.1-0.2h1c0,0.1,0.1,0.2,0.1,0.3%20c0,0.1,0,0.2,0,0.3c0,0.1,0,0.2,0,0.3c0,0.1,0,0.2-0.1,0.2h2.7V8h-0.4C10.3,8,10,8,9.8,8C9.6,8,9.4,8,9.3,8L9.2,7.8%20C9.5,8,9.8,8.3,10,8.6c0.2,0.3,0.3,0.7,0.3,1.2c0,0.4-0.1,0.8-0.3,1.1c-0.2,0.3-0.5,0.6-0.9,0.8C8.7,11.9,8.2,12,7.6,12z%20M7.6,10%20c0.4,0,0.6,0,0.9-0.1C8.7,9.8,8.9,9.7,9,9.6c0.1-0.1,0.2-0.3,0.2-0.5c0-0.2-0.1-0.4-0.2-0.6C8.8,8.3,8.7,8.2,8.5,8.1%20C8.2,8,8,8,7.6,8S7,8,6.8,8.1C6.6,8.2,6.4,8.3,6.3,8.5C6.2,8.6,6.1,8.8,6.1,9.1c0,0.2,0.1,0.4,0.2,0.5c0.1,0.2,0.3,0.3,0.5,0.3%20C7,10,7.3,10,7.6,10z'/%3e%3c/g%3e%3cpath%20class='st0'%20d='M15,22v-6h2v2.8c0.7-1,1.2-2.1,1.5-3.2c0.3-1.2,0.5-2.3,0.5-3.5s-0.2-2.4-0.5-3.5c-0.3-1.2-0.8-2.2-1.5-3.2V8%20h-2V2h6v2h-2.4c0.8,1.2,1.4,2.4,1.8,3.8S21,10.6,21,12s-0.2,2.8-0.6,4.2c-0.4,1.4-1,2.6-1.8,3.8H21v2H15z'/%3e%3c/svg%3e";Qx.accessToken=oN;let vN=class extends Pr.PureComponent{constructor(f){super(f);lc(this,"initMap",()=>{const{mapRef:f}=this.props,{lng:y,lat:b,zoom:C}=this.state,P=new Qx.Map({container:this.mapContainer.current,style:"mapbox://styles/mapbox/streets-v11",center:[y,b],zoom:C,minZoom:10,maxZoom:18});P.dragRotate.disable(),P.touchZoomRotate.disableRotation(),P.on("move",()=>{this.setState({lng:P.getCenter().lng.toFixed(4),lat:P.getCenter().lat.toFixed(4),zoom:P.getZoom().toFixed(2)})}),f.current=P});lc(this,"highlightSelectedroute",()=>{const{selectedBus:f,mapRef:y}=this.props;this.callFnIfMapLoaded(()=>{y.current.setFilter("routes-highlighted",["==","name",f||""])})});lc(this,"callFnIfMapLoaded",f=>{const{mapRef:y}=this.props;y.current._loaded?f():y.current.on("load",f)});lc(this,"renderMapData",()=>{const{busData:f,selectedBus:y,mapRef:b}=this.props;b.current.addSource("metro-routes",{type:"geojson",data:gN}),b.current.addLayer({id:"metro-routes",source:"metro-routes",...fN}),b.current.addSource("metro-stops",{type:"geojson",data:_N}),b.current.addLayer({id:"metro-stops",source:"metro-stops",...dN}),b.current.addSource("routes",eN(f)),b.current.addLayer({id:"routes",source:"routes",...S_}),b.current.addLayer({id:"routes-highlighted",source:"routes",...hN,filter:["==","name",y||""]})});lc(this,"updateUserLocation",()=>{const{mapRef:f}=this.props;this.userLocationMarker||this.initLocationMarker(),navigator.geolocation.getCurrentPosition(y=>{const{latitude:b,longitude:C}=y.coords;this.userLocationMarker.setLngLat({lat:b,lng:C}),f.current.flyTo({center:[C,b],zoom:12,pitch:0,bearing:0,duration:500,essential:!0})},y=>{console.log(y)})});lc(this,"initLocationMarker",()=>{const{mapRef:f}=this.props,y=document.createElement("div");y.className="user-location-indicator",this.userLocationMarker=new Qx.Marker(y).setLngLat({lat:0,lng:0}).addTo(f.current)});lc(this,"addMapEvents",()=>{const{mapRef:f}=this.props;f.current.on("mouseenter","routes",y=>{const{selectedBus:b}=this.props;f.current.getCanvas().style.cursor="pointer";const C=y.features[0],{name:P}=C.properties;f.current.setFilter("routes-highlighted",["==","name",P||b||""])}),f.current.on("click","routes",y=>{const{setSelectedBus:b}=this.props,C=y.features[0],{name:P}=C.properties;b(P)}),f.current.on("mouseleave","routes",()=>{const{selectedBus:y}=this.props;f.current.getCanvas().style.cursor="",f.current.setFilter("routes-highlighted",["==","name",y||""])})});this.state={lat:12.977529081680132,lng:77.57247169985196,zoom:11,supported:Qx.supported()},this.mapContainer=Pr.createRef()}componentDidMount(){var y;const{mapRef:f}=this.props;this.state.supported&&(this.initMap(),(y=f.current)==null||y.on("load",()=>{this.renderMapData(),this.addMapEvents(),this.highlightSelectedroute()}))}componentDidUpdate(f,y,b){const{selectedBus:C,mapRef:P}=this.props,{selectedBus:O}=f;C!==O&&this.highlightSelectedroute()}componentWillUnmount(){var y;const{mapRef:f}=this.props;(y=f.current)==null||y.remove()}render(){const{setLang:f,lang:y}=this.props;return un.jsx("div",{id:"map",ref:this.mapContainer,className:"map-container",children:un.jsxs("div",{id:"action-btns-wrapper",children:[un.jsx("button",{className:"action-btn",onClick:this.updateUserLocation,children:un.jsx("span",{className:"material-symbols-outlined",children:"my_location"})}),un.jsx("button",{className:"action-btn",onClick:()=>f(y==="en"?"kn":"en"),children:un.jsx("img",{src:xN,alt:"Change language"})})]})})}};function wN(){if(console&&console.warn){for(var l=arguments.length,u=new Array(l),f=0;f<l;f++)u[f]=arguments[f];typeof u[0]=="string"&&(u[0]=`react-i18next:: ${u[0]}`),console.warn(...u)}}const rD={};function KE(){for(var l=arguments.length,u=new Array(l),f=0;f<l;f++)u[f]=arguments[f];typeof u[0]=="string"&&rD[u[0]]||(typeof u[0]=="string"&&(rD[u[0]]=new Date),wN(...u))}const R3=(l,u)=>()=>{if(l.isInitialized)u();else{const f=()=>{setTimeout(()=>{l.off("initialized",f)},0),u()};l.on("initialized",f)}};function iD(l,u,f){l.loadNamespaces(u,R3(l,f))}function oD(l,u,f,y){typeof f=="string"&&(f=[f]),f.forEach(b=>{l.options.ns.indexOf(b)<0&&l.options.ns.push(b)}),l.loadLanguages(u,R3(l,y))}function bN(l,u){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const y=u.languages[0],b=u.options?u.options.fallbackLng:!1,C=u.languages[u.languages.length-1];if(y.toLowerCase()==="cimode")return!0;const P=(O,F)=>{const k=u.services.backendConnector.state[`${O}|${F}`];return k===-1||k===2};return f.bindI18n&&f.bindI18n.indexOf("languageChanging")>-1&&u.services.backendConnector.backend&&u.isLanguageChangingTo&&!P(u.isLanguageChangingTo,l)?!1:!!(u.hasResourceBundle(y,l)||!u.services.backendConnector.backend||u.options.resources&&!u.options.partialBundledLanguages||P(y,l)&&(!b||P(C,l)))}function AN(l,u){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return!u.languages||!u.languages.length?(KE("i18n.languages were undefined or empty",u.languages),!0):u.options.ignoreJSONStructure!==void 0?u.hasLoadedNamespace(l,{lng:f.lng,precheck:(b,C)=>{if(f.bindI18n&&f.bindI18n.indexOf("languageChanging")>-1&&b.services.backendConnector.backend&&b.isLanguageChangingTo&&!C(b.isLanguageChangingTo,l))return!1}}):bN(l,u,f)}function EN(l){return l.displayName||l.name||(typeof l=="string"&&l.length>0?l:"Unknown")}const TN=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,CN={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"","&#169;":"","&reg;":"","&#174;":"","&hellip;":"","&#8230;":"","&#x2F;":"/","&#47;":"/"},SN=l=>CN[l],MN=l=>l.replace(TN,SN);let XE={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:MN};function IN(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};XE={...XE,...l}}function BN(){return XE}let k3;function DN(l){k3=l}function PN(){return k3}const LN={type:"3rdParty",init(l){IN(l.options.react),DN(l)}},RN=Pr.createContext();class kN{constructor(){this.usedNamespaces={}}addUsedNamespaces(u){u.forEach(f=>{this.usedNamespaces[f]||(this.usedNamespaces[f]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const FN=(l,u)=>{const f=Pr.useRef();return Pr.useEffect(()=>{f.current=u?f.current:l},[l,u]),f.current};function F3(l,u,f,y){return l.getFixedT(u,f,y)}function zN(l,u,f,y){return Pr.useCallback(F3(l,u,f,y),[l,u,f,y])}function ON(l){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{i18n:f}=u,{i18n:y,defaultNS:b}=Pr.useContext(RN)||{},C=f||y||PN();if(C&&!C.reportNamespaces&&(C.reportNamespaces=new kN),!C){KE("You will need to pass in an i18next instance by using initReactI18next");const Xt=(oe,me)=>typeof me=="string"?me:me&&typeof me=="object"&&typeof me.defaultValue=="string"?me.defaultValue:Array.isArray(oe)?oe[oe.length-1]:oe,ue=[Xt,{},!1];return ue.t=Xt,ue.i18n={},ue.ready=!1,ue}C.options.react&&C.options.react.wait!==void 0&&KE("It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const P={...BN(),...C.options.react,...u},{useSuspense:O,keyPrefix:F}=P;let k=l||b||C.options&&C.options.defaultNS;k=typeof k=="string"?[k]:k||["translation"],C.reportNamespaces.addUsedNamespaces&&C.reportNamespaces.addUsedNamespaces(k);const ot=(C.isInitialized||C.initializedStoreOnce)&&k.every(Xt=>AN(Xt,C,P)),ft=zN(C,u.lng||null,P.nsMode==="fallback"?k:k[0],F),X=()=>ft,zt=()=>F3(C,u.lng||null,P.nsMode==="fallback"?k:k[0],F),[Lt,Ht]=Pr.useState(X);let we=k.join();u.lng&&(we=`${u.lng}${we}`);const mt=FN(we),at=Pr.useRef(!0);Pr.useEffect(()=>{const{bindI18n:Xt,bindI18nStore:ue}=P;at.current=!0,!ot&&!O&&(u.lng?oD(C,u.lng,k,()=>{at.current&&Ht(zt)}):iD(C,k,()=>{at.current&&Ht(zt)})),ot&&mt&&mt!==we&&at.current&&Ht(zt);function oe(){at.current&&Ht(zt)}return Xt&&C&&C.on(Xt,oe),ue&&C&&C.store.on(ue,oe),()=>{at.current=!1,Xt&&C&&Xt.split(" ").forEach(me=>C.off(me,oe)),ue&&C&&ue.split(" ").forEach(me=>C.store.off(me,oe))}},[C,we]);const xt=Pr.useRef(!0);Pr.useEffect(()=>{at.current&&!xt.current&&Ht(X),xt.current=!1},[C,F]);const It=[Lt,C,ot];if(It.t=Lt,It.i18n=C,It.ready=ot,ot||!ot&&!O)return It;throw new Promise(Xt=>{u.lng?oD(C,u.lng,k,()=>Xt()):iD(C,k,()=>Xt())})}function z3(l){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function(y){function b(P){let{forwardedRef:O,...F}=P;const[k,ot,ft]=ON(l,{...F,keyPrefix:u.keyPrefix}),X={...F,t:k,i18n:ot,tReady:ft};return u.withRef&&O?X.ref=O:!u.withRef&&O&&(X.forwardedRef=O),Pr.createElement(y,X)}b.displayName=`withI18nextTranslation(${EN(y)})`,b.WrappedComponent=y;const C=(P,O)=>Pr.createElement(b,Object.assign({},P,{forwardedRef:O}));return u.withRef?Pr.forwardRef(C):b}}const NN={type:"logger",log(l){this.output("log",l)},warn(l){this.output("warn",l)},error(l){this.output("error",l)},output(l,u){console&&console[l]&&console[l].apply(console,u)}};class Tv{constructor(u){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.init(u,f)}init(u){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.prefix=f.prefix||"i18next:",this.logger=u||NN,this.options=f,this.debug=f.debug}log(){for(var u=arguments.length,f=new Array(u),y=0;y<u;y++)f[y]=arguments[y];return this.forward(f,"log","",!0)}warn(){for(var u=arguments.length,f=new Array(u),y=0;y<u;y++)f[y]=arguments[y];return this.forward(f,"warn","",!0)}error(){for(var u=arguments.length,f=new Array(u),y=0;y<u;y++)f[y]=arguments[y];return this.forward(f,"error","")}deprecate(){for(var u=arguments.length,f=new Array(u),y=0;y<u;y++)f[y]=arguments[y];return this.forward(f,"warn","WARNING DEPRECATED: ",!0)}forward(u,f,y,b){return b&&!this.debug?null:(typeof u[0]=="string"&&(u[0]=`${y}${this.prefix} ${u[0]}`),this.logger[f](u))}create(u){return new Tv(this.logger,{prefix:`${this.prefix}:${u}:`,...this.options})}clone(u){return u=u||this.options,u.prefix=u.prefix||this.prefix,new Tv(this.logger,u)}}var ll=new Tv;class Wv{constructor(){this.observers={}}on(u,f){return u.split(" ").forEach(y=>{this.observers[y]||(this.observers[y]=new Map);const b=this.observers[y].get(f)||0;this.observers[y].set(f,b+1)}),this}off(u,f){if(this.observers[u]){if(!f){delete this.observers[u];return}this.observers[u].delete(f)}}emit(u){for(var f=arguments.length,y=new Array(f>1?f-1:0),b=1;b<f;b++)y[b-1]=arguments[b];this.observers[u]&&Array.from(this.observers[u].entries()).forEach(P=>{let[O,F]=P;for(let k=0;k<F;k++)O(...y)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(P=>{let[O,F]=P;for(let k=0;k<F;k++)O.apply(O,[u,...y])})}}function $g(){let l,u;const f=new Promise((y,b)=>{l=y,u=b});return f.resolve=l,f.reject=u,f}function sD(l){return l==null?"":""+l}function UN(l,u,f){l.forEach(y=>{u[y]&&(f[y]=u[y])})}const VN=/###/g;function u_(l,u,f){function y(O){return O&&O.indexOf("###")>-1?O.replace(VN,"."):O}function b(){return!l||typeof l=="string"}const C=typeof u!="string"?u:u.split(".");let P=0;for(;P<C.length-1;){if(b())return{};const O=y(C[P]);!l[O]&&f&&(l[O]=new f),Object.prototype.hasOwnProperty.call(l,O)?l=l[O]:l={},++P}return b()?{}:{obj:l,k:y(C[P])}}function aD(l,u,f){const{obj:y,k:b}=u_(l,u,Object);if(y!==void 0||u.length===1){y[b]=f;return}let C=u[u.length-1],P=u.slice(0,u.length-1),O=u_(l,P,Object);for(;O.obj===void 0&&P.length;)C=`${P[P.length-1]}.${C}`,P=P.slice(0,P.length-1),O=u_(l,P,Object),O&&O.obj&&typeof O.obj[`${O.k}.${C}`]<"u"&&(O.obj=void 0);O.obj[`${O.k}.${C}`]=f}function GN(l,u,f,y){const{obj:b,k:C}=u_(l,u,Object);b[C]=b[C]||[],y&&(b[C]=b[C].concat(f)),y||b[C].push(f)}function Cv(l,u){const{obj:f,k:y}=u_(l,u);if(f)return f[y]}function jN(l,u,f){const y=Cv(l,f);return y!==void 0?y:Cv(u,f)}function O3(l,u,f){for(const y in u)y!=="__proto__"&&y!=="constructor"&&(y in l?typeof l[y]=="string"||l[y]instanceof String||typeof u[y]=="string"||u[y]instanceof String?f&&(l[y]=u[y]):O3(l[y],u[y],f):l[y]=u[y]);return l}function Pd(l){return l.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var HN={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function ZN(l){return typeof l=="string"?l.replace(/[&<>"'\/]/g,u=>HN[u]):l}class WN{constructor(u){this.capacity=u,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(u){const f=this.regExpMap.get(u);if(f!==void 0)return f;const y=new RegExp(u);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(u,y),this.regExpQueue.push(u),y}}const qN=[" ",",","?","!",";"],JN=new WN(20);function $N(l,u,f){u=u||"",f=f||"";const y=qN.filter(P=>u.indexOf(P)<0&&f.indexOf(P)<0);if(y.length===0)return!0;const b=JN.getRegExp(`(${y.map(P=>P==="?"?"\\?":P).join("|")})`);let C=!b.test(l);if(!C){const P=l.indexOf(f);P>0&&!b.test(l.substring(0,P))&&(C=!0)}return C}function YE(l,u){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:".";if(!l)return;if(l[u])return l[u];const y=u.split(f);let b=l;for(let C=0;C<y.length;){if(!b||typeof b!="object")return;let P,O="";for(let F=C;F<y.length;++F)if(F!==C&&(O+=f),O+=y[F],P=b[O],P!==void 0){if(["string","number","boolean"].indexOf(typeof P)>-1&&F<y.length-1)continue;C+=F-C+1;break}b=P}return b}function Sv(l){return l&&l.indexOf("_")>0?l.replace("_","-"):l}class lD extends Wv{constructor(u){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=u||{},this.options=f,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(u){this.options.ns.indexOf(u)<0&&this.options.ns.push(u)}removeNamespaces(u){const f=this.options.ns.indexOf(u);f>-1&&this.options.ns.splice(f,1)}getResource(u,f,y){let b=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const C=b.keySeparator!==void 0?b.keySeparator:this.options.keySeparator,P=b.ignoreJSONStructure!==void 0?b.ignoreJSONStructure:this.options.ignoreJSONStructure;let O;u.indexOf(".")>-1?O=u.split("."):(O=[u,f],y&&(Array.isArray(y)?O.push(...y):typeof y=="string"&&C?O.push(...y.split(C)):O.push(y)));const F=Cv(this.data,O);return!F&&!f&&!y&&u.indexOf(".")>-1&&(u=O[0],f=O[1],y=O.slice(2).join(".")),F||!P||typeof y!="string"?F:YE(this.data&&this.data[u]&&this.data[u][f],y,C)}addResource(u,f,y,b){let C=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{silent:!1};const P=C.keySeparator!==void 0?C.keySeparator:this.options.keySeparator;let O=[u,f];y&&(O=O.concat(P?y.split(P):y)),u.indexOf(".")>-1&&(O=u.split("."),b=f,f=O[1]),this.addNamespaces(f),aD(this.data,O,b),C.silent||this.emit("added",u,f,y,b)}addResources(u,f,y){let b=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{silent:!1};for(const C in y)(typeof y[C]=="string"||Object.prototype.toString.apply(y[C])==="[object Array]")&&this.addResource(u,f,C,y[C],{silent:!0});b.silent||this.emit("added",u,f,y)}addResourceBundle(u,f,y,b,C){let P=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{silent:!1,skipCopy:!1},O=[u,f];u.indexOf(".")>-1&&(O=u.split("."),b=y,y=f,f=O[1]),this.addNamespaces(f);let F=Cv(this.data,O)||{};P.skipCopy||(y=JSON.parse(JSON.stringify(y))),b?O3(F,y,C):F={...F,...y},aD(this.data,O,F),P.silent||this.emit("added",u,f,y)}removeResourceBundle(u,f){this.hasResourceBundle(u,f)&&delete this.data[u][f],this.removeNamespaces(f),this.emit("removed",u,f)}hasResourceBundle(u,f){return this.getResource(u,f)!==void 0}getResourceBundle(u,f){return f||(f=this.options.defaultNS),this.options.compatibilityAPI==="v1"?{...this.getResource(u,f)}:this.getResource(u,f)}getDataByLanguage(u){return this.data[u]}hasLanguageSomeTranslations(u){const f=this.getDataByLanguage(u);return!!(f&&Object.keys(f)||[]).find(b=>f[b]&&Object.keys(f[b]).length>0)}toJSON(){return this.data}}var N3={processors:{},addPostProcessor(l){this.processors[l.name]=l},handle(l,u,f,y,b){return l.forEach(C=>{this.processors[C]&&(u=this.processors[C].process(u,f,y,b))}),u}};const uD={};class Mv extends Wv{constructor(u){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),UN(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],u,this),this.options=f,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=ll.create("translator")}changeLanguage(u){u&&(this.language=u)}exists(u){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};if(u==null)return!1;const y=this.resolve(u,f);return y&&y.res!==void 0}extractFromKey(u,f){let y=f.nsSeparator!==void 0?f.nsSeparator:this.options.nsSeparator;y===void 0&&(y=":");const b=f.keySeparator!==void 0?f.keySeparator:this.options.keySeparator;let C=f.ns||this.options.defaultNS||[];const P=y&&u.indexOf(y)>-1,O=!this.options.userDefinedKeySeparator&&!f.keySeparator&&!this.options.userDefinedNsSeparator&&!f.nsSeparator&&!$N(u,y,b);if(P&&!O){const F=u.match(this.interpolator.nestingRegexp);if(F&&F.length>0)return{key:u,namespaces:C};const k=u.split(y);(y!==b||y===b&&this.options.ns.indexOf(k[0])>-1)&&(C=k.shift()),u=k.join(b)}return typeof C=="string"&&(C=[C]),{key:u,namespaces:C}}translate(u,f,y){if(typeof f!="object"&&this.options.overloadTranslationOptionHandler&&(f=this.options.overloadTranslationOptionHandler(arguments)),typeof f=="object"&&(f={...f}),f||(f={}),u==null)return"";Array.isArray(u)||(u=[String(u)]);const b=f.returnDetails!==void 0?f.returnDetails:this.options.returnDetails,C=f.keySeparator!==void 0?f.keySeparator:this.options.keySeparator,{key:P,namespaces:O}=this.extractFromKey(u[u.length-1],f),F=O[O.length-1],k=f.lng||this.language,ot=f.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(k&&k.toLowerCase()==="cimode"){if(ot){const It=f.nsSeparator||this.options.nsSeparator;return b?{res:`${F}${It}${P}`,usedKey:P,exactUsedKey:P,usedLng:k,usedNS:F,usedParams:this.getUsedParamsDetails(f)}:`${F}${It}${P}`}return b?{res:P,usedKey:P,exactUsedKey:P,usedLng:k,usedNS:F,usedParams:this.getUsedParamsDetails(f)}:P}const ft=this.resolve(u,f);let X=ft&&ft.res;const zt=ft&&ft.usedKey||P,Lt=ft&&ft.exactUsedKey||P,Ht=Object.prototype.toString.apply(X),we=["[object Number]","[object Function]","[object RegExp]"],mt=f.joinArrays!==void 0?f.joinArrays:this.options.joinArrays,at=!this.i18nFormat||this.i18nFormat.handleAsObject;if(at&&X&&(typeof X!="string"&&typeof X!="boolean"&&typeof X!="number")&&we.indexOf(Ht)<0&&!(typeof mt=="string"&&Ht==="[object Array]")){if(!f.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const It=this.options.returnedObjectHandler?this.options.returnedObjectHandler(zt,X,{...f,ns:O}):`key '${P} (${this.language})' returned an object instead of string.`;return b?(ft.res=It,ft.usedParams=this.getUsedParamsDetails(f),ft):It}if(C){const It=Ht==="[object Array]",Xt=It?[]:{},ue=It?Lt:zt;for(const oe in X)if(Object.prototype.hasOwnProperty.call(X,oe)){const me=`${ue}${C}${oe}`;Xt[oe]=this.translate(me,{...f,joinArrays:!1,ns:O}),Xt[oe]===me&&(Xt[oe]=X[oe])}X=Xt}}else if(at&&typeof mt=="string"&&Ht==="[object Array]")X=X.join(mt),X&&(X=this.extendTranslation(X,u,f,y));else{let It=!1,Xt=!1;const ue=f.count!==void 0&&typeof f.count!="string",oe=Mv.hasDefaultValue(f),me=ue?this.pluralResolver.getSuffix(k,f.count,f):"",Nn=f.ordinal&&ue?this.pluralResolver.getSuffix(k,f.count,{ordinal:!1}):"",nt=ue&&!f.ordinal&&f.count===0&&this.pluralResolver.shouldUseIntlApi(),Re=nt&&f[`defaultValue${this.options.pluralSeparator}zero`]||f[`defaultValue${me}`]||f[`defaultValue${Nn}`]||f.defaultValue;!this.isValidLookup(X)&&oe&&(It=!0,X=Re),this.isValidLookup(X)||(Xt=!0,X=P);const Ni=(f.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&Xt?void 0:X,Ae=oe&&Re!==X&&this.options.updateMissing;if(Xt||It||Ae){if(this.logger.log(Ae?"updateKey":"missingKey",k,F,P,Ae?Re:X),C){const fe=this.resolve(P,{...f,keySeparator:!1});fe&&fe.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let dr=[];const Bo=this.languageUtils.getFallbackCodes(this.options.fallbackLng,f.lng||this.language);if(this.options.saveMissingTo==="fallback"&&Bo&&Bo[0])for(let fe=0;fe<Bo.length;fe++)dr.push(Bo[fe]);else this.options.saveMissingTo==="all"?dr=this.languageUtils.toResolveHierarchy(f.lng||this.language):dr.push(f.lng||this.language);const si=(fe,He,We)=>{const hn=oe&&We!==X?We:Ni;this.options.missingKeyHandler?this.options.missingKeyHandler(fe,F,He,hn,Ae,f):this.backendConnector&&this.backendConnector.saveMissing&&this.backendConnector.saveMissing(fe,F,He,hn,Ae,f),this.emit("missingKey",fe,F,He,X)};this.options.saveMissing&&(this.options.saveMissingPlurals&&ue?dr.forEach(fe=>{const He=this.pluralResolver.getSuffixes(fe,f);nt&&f[`defaultValue${this.options.pluralSeparator}zero`]&&He.indexOf(`${this.options.pluralSeparator}zero`)<0&&He.push(`${this.options.pluralSeparator}zero`),He.forEach(We=>{si([fe],P+We,f[`defaultValue${We}`]||Re)})}):si(dr,P,Re))}X=this.extendTranslation(X,u,f,ft,y),Xt&&X===P&&this.options.appendNamespaceToMissingKey&&(X=`${F}:${P}`),(Xt||It)&&this.options.parseMissingKeyHandler&&(this.options.compatibilityAPI!=="v1"?X=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${F}:${P}`:P,It?X:void 0):X=this.options.parseMissingKeyHandler(X))}return b?(ft.res=X,ft.usedParams=this.getUsedParamsDetails(f),ft):X}extendTranslation(u,f,y,b,C){var P=this;if(this.i18nFormat&&this.i18nFormat.parse)u=this.i18nFormat.parse(u,{...this.options.interpolation.defaultVariables,...y},y.lng||this.language||b.usedLng,b.usedNS,b.usedKey,{resolved:b});else if(!y.skipInterpolation){y.interpolation&&this.interpolator.init({...y,interpolation:{...this.options.interpolation,...y.interpolation}});const k=typeof u=="string"&&(y&&y.interpolation&&y.interpolation.skipOnVariables!==void 0?y.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let ot;if(k){const X=u.match(this.interpolator.nestingRegexp);ot=X&&X.length}let ft=y.replace&&typeof y.replace!="string"?y.replace:y;if(this.options.interpolation.defaultVariables&&(ft={...this.options.interpolation.defaultVariables,...ft}),u=this.interpolator.interpolate(u,ft,y.lng||this.language,y),k){const X=u.match(this.interpolator.nestingRegexp),zt=X&&X.length;ot<zt&&(y.nest=!1)}!y.lng&&this.options.compatibilityAPI!=="v1"&&b&&b.res&&(y.lng=b.usedLng),y.nest!==!1&&(u=this.interpolator.nest(u,function(){for(var X=arguments.length,zt=new Array(X),Lt=0;Lt<X;Lt++)zt[Lt]=arguments[Lt];return C&&C[0]===zt[0]&&!y.context?(P.logger.warn(`It seems you are nesting recursively key: ${zt[0]} in key: ${f[0]}`),null):P.translate(...zt,f)},y)),y.interpolation&&this.interpolator.reset()}const O=y.postProcess||this.options.postProcess,F=typeof O=="string"?[O]:O;return u!=null&&F&&F.length&&y.applyPostProcessor!==!1&&(u=N3.handle(F,u,f,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...b,usedParams:this.getUsedParamsDetails(y)},...y}:y,this)),u}resolve(u){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},y,b,C,P,O;return typeof u=="string"&&(u=[u]),u.forEach(F=>{if(this.isValidLookup(y))return;const k=this.extractFromKey(F,f),ot=k.key;b=ot;let ft=k.namespaces;this.options.fallbackNS&&(ft=ft.concat(this.options.fallbackNS));const X=f.count!==void 0&&typeof f.count!="string",zt=X&&!f.ordinal&&f.count===0&&this.pluralResolver.shouldUseIntlApi(),Lt=f.context!==void 0&&(typeof f.context=="string"||typeof f.context=="number")&&f.context!=="",Ht=f.lngs?f.lngs:this.languageUtils.toResolveHierarchy(f.lng||this.language,f.fallbackLng);ft.forEach(we=>{this.isValidLookup(y)||(O=we,!uD[`${Ht[0]}-${we}`]&&this.utils&&this.utils.hasLoadedNamespace&&!this.utils.hasLoadedNamespace(O)&&(uD[`${Ht[0]}-${we}`]=!0,this.logger.warn(`key "${b}" for languages "${Ht.join(", ")}" won't get resolved as namespace "${O}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),Ht.forEach(mt=>{if(this.isValidLookup(y))return;P=mt;const at=[ot];if(this.i18nFormat&&this.i18nFormat.addLookupKeys)this.i18nFormat.addLookupKeys(at,ot,mt,we,f);else{let It;X&&(It=this.pluralResolver.getSuffix(mt,f.count,f));const Xt=`${this.options.pluralSeparator}zero`,ue=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(X&&(at.push(ot+It),f.ordinal&&It.indexOf(ue)===0&&at.push(ot+It.replace(ue,this.options.pluralSeparator)),zt&&at.push(ot+Xt)),Lt){const oe=`${ot}${this.options.contextSeparator}${f.context}`;at.push(oe),X&&(at.push(oe+It),f.ordinal&&It.indexOf(ue)===0&&at.push(oe+It.replace(ue,this.options.pluralSeparator)),zt&&at.push(oe+Xt))}}let xt;for(;xt=at.pop();)this.isValidLookup(y)||(C=xt,y=this.getResource(mt,we,xt,f))}))})}),{res:y,usedKey:b,exactUsedKey:C,usedLng:P,usedNS:O}}isValidLookup(u){return u!==void 0&&!(!this.options.returnNull&&u===null)&&!(!this.options.returnEmptyString&&u==="")}getResource(u,f,y){let b=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(u,f,y,b):this.resourceStore.getResource(u,f,y,b)}getUsedParamsDetails(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const f=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],y=u.replace&&typeof u.replace!="string";let b=y?u.replace:u;if(y&&typeof u.count<"u"&&(b.count=u.count),this.options.interpolation.defaultVariables&&(b={...this.options.interpolation.defaultVariables,...b}),!y){b={...b};for(const C of f)delete b[C]}return b}static hasDefaultValue(u){const f="defaultValue";for(const y in u)if(Object.prototype.hasOwnProperty.call(u,y)&&f===y.substring(0,f.length)&&u[y]!==void 0)return!0;return!1}}function eE(l){return l.charAt(0).toUpperCase()+l.slice(1)}class cD{constructor(u){this.options=u,this.supportedLngs=this.options.supportedLngs||!1,this.logger=ll.create("languageUtils")}getScriptPartFromCode(u){if(u=Sv(u),!u||u.indexOf("-")<0)return null;const f=u.split("-");return f.length===2||(f.pop(),f[f.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(f.join("-"))}getLanguagePartFromCode(u){if(u=Sv(u),!u||u.indexOf("-")<0)return u;const f=u.split("-");return this.formatLanguageCode(f[0])}formatLanguageCode(u){if(typeof u=="string"&&u.indexOf("-")>-1){const f=["hans","hant","latn","cyrl","cans","mong","arab"];let y=u.split("-");return this.options.lowerCaseLng?y=y.map(b=>b.toLowerCase()):y.length===2?(y[0]=y[0].toLowerCase(),y[1]=y[1].toUpperCase(),f.indexOf(y[1].toLowerCase())>-1&&(y[1]=eE(y[1].toLowerCase()))):y.length===3&&(y[0]=y[0].toLowerCase(),y[1].length===2&&(y[1]=y[1].toUpperCase()),y[0]!=="sgn"&&y[2].length===2&&(y[2]=y[2].toUpperCase()),f.indexOf(y[1].toLowerCase())>-1&&(y[1]=eE(y[1].toLowerCase())),f.indexOf(y[2].toLowerCase())>-1&&(y[2]=eE(y[2].toLowerCase()))),y.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?u.toLowerCase():u}isSupportedCode(u){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(u=this.getLanguagePartFromCode(u)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(u)>-1}getBestMatchFromCodes(u){if(!u)return null;let f;return u.forEach(y=>{if(f)return;const b=this.formatLanguageCode(y);(!this.options.supportedLngs||this.isSupportedCode(b))&&(f=b)}),!f&&this.options.supportedLngs&&u.forEach(y=>{if(f)return;const b=this.getLanguagePartFromCode(y);if(this.isSupportedCode(b))return f=b;f=this.options.supportedLngs.find(C=>{if(C===b)return C;if(!(C.indexOf("-")<0&&b.indexOf("-")<0)&&C.indexOf(b)===0)return C})}),f||(f=this.getFallbackCodes(this.options.fallbackLng)[0]),f}getFallbackCodes(u,f){if(!u)return[];if(typeof u=="function"&&(u=u(f)),typeof u=="string"&&(u=[u]),Object.prototype.toString.apply(u)==="[object Array]")return u;if(!f)return u.default||[];let y=u[f];return y||(y=u[this.getScriptPartFromCode(f)]),y||(y=u[this.formatLanguageCode(f)]),y||(y=u[this.getLanguagePartFromCode(f)]),y||(y=u.default),y||[]}toResolveHierarchy(u,f){const y=this.getFallbackCodes(f||this.options.fallbackLng||[],u),b=[],C=P=>{P&&(this.isSupportedCode(P)?b.push(P):this.logger.warn(`rejecting language code not found in supportedLngs: ${P}`))};return typeof u=="string"&&(u.indexOf("-")>-1||u.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&C(this.formatLanguageCode(u)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&C(this.getScriptPartFromCode(u)),this.options.load!=="currentOnly"&&C(this.getLanguagePartFromCode(u))):typeof u=="string"&&C(this.formatLanguageCode(u)),y.forEach(P=>{b.indexOf(P)<0&&C(this.formatLanguageCode(P))}),b}}let KN=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],XN={1:function(l){return+(l>1)},2:function(l){return+(l!=1)},3:function(l){return 0},4:function(l){return l%10==1&&l%100!=11?0:l%10>=2&&l%10<=4&&(l%100<10||l%100>=20)?1:2},5:function(l){return l==0?0:l==1?1:l==2?2:l%100>=3&&l%100<=10?3:l%100>=11?4:5},6:function(l){return l==1?0:l>=2&&l<=4?1:2},7:function(l){return l==1?0:l%10>=2&&l%10<=4&&(l%100<10||l%100>=20)?1:2},8:function(l){return l==1?0:l==2?1:l!=8&&l!=11?2:3},9:function(l){return+(l>=2)},10:function(l){return l==1?0:l==2?1:l<7?2:l<11?3:4},11:function(l){return l==1||l==11?0:l==2||l==12?1:l>2&&l<20?2:3},12:function(l){return+(l%10!=1||l%100==11)},13:function(l){return+(l!==0)},14:function(l){return l==1?0:l==2?1:l==3?2:3},15:function(l){return l%10==1&&l%100!=11?0:l%10>=2&&(l%100<10||l%100>=20)?1:2},16:function(l){return l%10==1&&l%100!=11?0:l!==0?1:2},17:function(l){return l==1||l%10==1&&l%100!=11?0:1},18:function(l){return l==0?0:l==1?1:2},19:function(l){return l==1?0:l==0||l%100>1&&l%100<11?1:l%100>10&&l%100<20?2:3},20:function(l){return l==1?0:l==0||l%100>0&&l%100<20?1:2},21:function(l){return l%100==1?1:l%100==2?2:l%100==3||l%100==4?3:0},22:function(l){return l==1?0:l==2?1:(l<0||l>10)&&l%10==0?2:3}};const YN=["v1","v2","v3"],QN=["v4"],hD={zero:0,one:1,two:2,few:3,many:4,other:5};function t6(){const l={};return KN.forEach(u=>{u.lngs.forEach(f=>{l[f]={numbers:u.nr,plurals:XN[u.fc]}})}),l}class e6{constructor(u){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.languageUtils=u,this.options=f,this.logger=ll.create("pluralResolver"),(!this.options.compatibilityJSON||QN.includes(this.options.compatibilityJSON))&&(typeof Intl>"u"||!Intl.PluralRules)&&(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=t6()}addRule(u,f){this.rules[u]=f}getRule(u){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.shouldUseIntlApi())try{return new Intl.PluralRules(Sv(u==="dev"?"en":u),{type:f.ordinal?"ordinal":"cardinal"})}catch{return}return this.rules[u]||this.rules[this.languageUtils.getLanguagePartFromCode(u)]}needsPlural(u){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const y=this.getRule(u,f);return this.shouldUseIntlApi()?y&&y.resolvedOptions().pluralCategories.length>1:y&&y.numbers.length>1}getPluralFormsOfKey(u,f){let y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.getSuffixes(u,y).map(b=>`${f}${b}`)}getSuffixes(u){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const y=this.getRule(u,f);return y?this.shouldUseIntlApi()?y.resolvedOptions().pluralCategories.sort((b,C)=>hD[b]-hD[C]).map(b=>`${this.options.prepend}${f.ordinal?`ordinal${this.options.prepend}`:""}${b}`):y.numbers.map(b=>this.getSuffix(u,b,f)):[]}getSuffix(u,f){let y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const b=this.getRule(u,y);return b?this.shouldUseIntlApi()?`${this.options.prepend}${y.ordinal?`ordinal${this.options.prepend}`:""}${b.select(f)}`:this.getSuffixRetroCompatible(b,f):(this.logger.warn(`no plural rule found for: ${u}`),"")}getSuffixRetroCompatible(u,f){const y=u.noAbs?u.plurals(f):u.plurals(Math.abs(f));let b=u.numbers[y];this.options.simplifyPluralSuffix&&u.numbers.length===2&&u.numbers[0]===1&&(b===2?b="plural":b===1&&(b=""));const C=()=>this.options.prepend&&b.toString()?this.options.prepend+b.toString():b.toString();return this.options.compatibilityJSON==="v1"?b===1?"":typeof b=="number"?`_plural_${b.toString()}`:C():this.options.compatibilityJSON==="v2"||this.options.simplifyPluralSuffix&&u.numbers.length===2&&u.numbers[0]===1?C():this.options.prepend&&y.toString()?this.options.prepend+y.toString():y.toString()}shouldUseIntlApi(){return!YN.includes(this.options.compatibilityJSON)}}function fD(l,u,f){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:".",b=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,C=jN(l,u,f);return!C&&b&&typeof f=="string"&&(C=YE(l,f,y),C===void 0&&(C=YE(u,f,y))),C}class n6{constructor(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=ll.create("interpolator"),this.options=u,this.format=u.interpolation&&u.interpolation.format||(f=>f),this.init(u)}init(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};u.interpolation||(u.interpolation={escapeValue:!0});const f=u.interpolation;this.escape=f.escape!==void 0?f.escape:ZN,this.escapeValue=f.escapeValue!==void 0?f.escapeValue:!0,this.useRawValueToEscape=f.useRawValueToEscape!==void 0?f.useRawValueToEscape:!1,this.prefix=f.prefix?Pd(f.prefix):f.prefixEscaped||"{{",this.suffix=f.suffix?Pd(f.suffix):f.suffixEscaped||"}}",this.formatSeparator=f.formatSeparator?f.formatSeparator:f.formatSeparator||",",this.unescapePrefix=f.unescapeSuffix?"":f.unescapePrefix||"-",this.unescapeSuffix=this.unescapePrefix?"":f.unescapeSuffix||"",this.nestingPrefix=f.nestingPrefix?Pd(f.nestingPrefix):f.nestingPrefixEscaped||Pd("$t("),this.nestingSuffix=f.nestingSuffix?Pd(f.nestingSuffix):f.nestingSuffixEscaped||Pd(")"),this.nestingOptionsSeparator=f.nestingOptionsSeparator?f.nestingOptionsSeparator:f.nestingOptionsSeparator||",",this.maxReplaces=f.maxReplaces?f.maxReplaces:1e3,this.alwaysFormat=f.alwaysFormat!==void 0?f.alwaysFormat:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const u=(f,y)=>f&&f.source===y?(f.lastIndex=0,f):new RegExp(y,"g");this.regexp=u(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=u(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=u(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(u,f,y,b){let C,P,O;const F=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{};function k(Lt){return Lt.replace(/\$/g,"$$$$")}const ot=Lt=>{if(Lt.indexOf(this.formatSeparator)<0){const at=fD(f,F,Lt,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(at,void 0,y,{...b,...f,interpolationkey:Lt}):at}const Ht=Lt.split(this.formatSeparator),we=Ht.shift().trim(),mt=Ht.join(this.formatSeparator).trim();return this.format(fD(f,F,we,this.options.keySeparator,this.options.ignoreJSONStructure),mt,y,{...b,...f,interpolationkey:we})};this.resetRegExp();const ft=b&&b.missingInterpolationHandler||this.options.missingInterpolationHandler,X=b&&b.interpolation&&b.interpolation.skipOnVariables!==void 0?b.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:Lt=>k(Lt)},{regex:this.regexp,safeValue:Lt=>this.escapeValue?k(this.escape(Lt)):k(Lt)}].forEach(Lt=>{for(O=0;C=Lt.regex.exec(u);){const Ht=C[1].trim();if(P=ot(Ht),P===void 0)if(typeof ft=="function"){const mt=ft(u,C,b);P=typeof mt=="string"?mt:""}else if(b&&Object.prototype.hasOwnProperty.call(b,Ht))P="";else if(X){P=C[0];continue}else this.logger.warn(`missed to pass in variable ${Ht} for interpolating ${u}`),P="";else typeof P!="string"&&!this.useRawValueToEscape&&(P=sD(P));const we=Lt.safeValue(P);if(u=u.replace(C[0],we),X?(Lt.regex.lastIndex+=P.length,Lt.regex.lastIndex-=C[0].length):Lt.regex.lastIndex=0,O++,O>=this.maxReplaces)break}}),u}nest(u,f){let y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},b,C,P;function O(F,k){const ot=this.nestingOptionsSeparator;if(F.indexOf(ot)<0)return F;const ft=F.split(new RegExp(`${ot}[ ]*{`));let X=`{${ft[1]}`;F=ft[0],X=this.interpolate(X,P);const zt=X.match(/'/g),Lt=X.match(/"/g);(zt&&zt.length%2===0&&!Lt||Lt.length%2!==0)&&(X=X.replace(/'/g,'"'));try{P=JSON.parse(X),k&&(P={...k,...P})}catch(Ht){return this.logger.warn(`failed parsing options string in nesting for key ${F}`,Ht),`${F}${ot}${X}`}return delete P.defaultValue,F}for(;b=this.nestingRegexp.exec(u);){let F=[];P={...y},P=P.replace&&typeof P.replace!="string"?P.replace:P,P.applyPostProcessor=!1,delete P.defaultValue;let k=!1;if(b[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(b[1])){const ot=b[1].split(this.formatSeparator).map(ft=>ft.trim());b[1]=ot.shift(),F=ot,k=!0}if(C=f(O.call(this,b[1].trim(),P),P),C&&b[0]===u&&typeof C!="string")return C;typeof C!="string"&&(C=sD(C)),C||(this.logger.warn(`missed to resolve ${b[1]} for nesting ${u}`),C=""),k&&(C=F.reduce((ot,ft)=>this.format(ot,ft,y.lng,{...y,interpolationkey:b[1].trim()}),C.trim())),u=u.replace(b[0],C),this.regexp.lastIndex=0}return u}}function r6(l){let u=l.toLowerCase().trim();const f={};if(l.indexOf("(")>-1){const y=l.split("(");u=y[0].toLowerCase().trim();const b=y[1].substring(0,y[1].length-1);u==="currency"&&b.indexOf(":")<0?f.currency||(f.currency=b.trim()):u==="relativetime"&&b.indexOf(":")<0?f.range||(f.range=b.trim()):b.split(";").forEach(P=>{if(!P)return;const[O,...F]=P.split(":"),k=F.join(":").trim().replace(/^'+|'+$/g,"");f[O.trim()]||(f[O.trim()]=k),k==="false"&&(f[O.trim()]=!1),k==="true"&&(f[O.trim()]=!0),isNaN(k)||(f[O.trim()]=parseInt(k,10))})}return{formatName:u,formatOptions:f}}function Ld(l){const u={};return function(y,b,C){const P=b+JSON.stringify(C);let O=u[P];return O||(O=l(Sv(b),C),u[P]=O),O(y)}}class i6{constructor(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=ll.create("formatter"),this.options=u,this.formats={number:Ld((f,y)=>{const b=new Intl.NumberFormat(f,{...y});return C=>b.format(C)}),currency:Ld((f,y)=>{const b=new Intl.NumberFormat(f,{...y,style:"currency"});return C=>b.format(C)}),datetime:Ld((f,y)=>{const b=new Intl.DateTimeFormat(f,{...y});return C=>b.format(C)}),relativetime:Ld((f,y)=>{const b=new Intl.RelativeTimeFormat(f,{...y});return C=>b.format(C,y.range||"day")}),list:Ld((f,y)=>{const b=new Intl.ListFormat(f,{...y});return C=>b.format(C)})},this.init(u)}init(u){const y=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}}).interpolation;this.formatSeparator=y.formatSeparator?y.formatSeparator:y.formatSeparator||","}add(u,f){this.formats[u.toLowerCase().trim()]=f}addCached(u,f){this.formats[u.toLowerCase().trim()]=Ld(f)}format(u,f,y){let b=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return f.split(this.formatSeparator).reduce((O,F)=>{const{formatName:k,formatOptions:ot}=r6(F);if(this.formats[k]){let ft=O;try{const X=b&&b.formatParams&&b.formatParams[b.interpolationkey]||{},zt=X.locale||X.lng||b.locale||b.lng||y;ft=this.formats[k](O,zt,{...ot,...b,...X})}catch(X){this.logger.warn(X)}return ft}else this.logger.warn(`there was no format function for ${k}`);return O},u)}}function o6(l,u){l.pending[u]!==void 0&&(delete l.pending[u],l.pendingCount--)}class s6 extends Wv{constructor(u,f,y){let b=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),this.backend=u,this.store=f,this.services=y,this.languageUtils=y.languageUtils,this.options=b,this.logger=ll.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=b.maxParallelReads||10,this.readingCalls=0,this.maxRetries=b.maxRetries>=0?b.maxRetries:5,this.retryTimeout=b.retryTimeout>=1?b.retryTimeout:350,this.state={},this.queue=[],this.backend&&this.backend.init&&this.backend.init(y,b.backend,b)}queueLoad(u,f,y,b){const C={},P={},O={},F={};return u.forEach(k=>{let ot=!0;f.forEach(ft=>{const X=`${k}|${ft}`;!y.reload&&this.store.hasResourceBundle(k,ft)?this.state[X]=2:this.state[X]<0||(this.state[X]===1?P[X]===void 0&&(P[X]=!0):(this.state[X]=1,ot=!1,P[X]===void 0&&(P[X]=!0),C[X]===void 0&&(C[X]=!0),F[ft]===void 0&&(F[ft]=!0)))}),ot||(O[k]=!0)}),(Object.keys(C).length||Object.keys(P).length)&&this.queue.push({pending:P,pendingCount:Object.keys(P).length,loaded:{},errors:[],callback:b}),{toLoad:Object.keys(C),pending:Object.keys(P),toLoadLanguages:Object.keys(O),toLoadNamespaces:Object.keys(F)}}loaded(u,f,y){const b=u.split("|"),C=b[0],P=b[1];f&&this.emit("failedLoading",C,P,f),y&&this.store.addResourceBundle(C,P,y,void 0,void 0,{skipCopy:!0}),this.state[u]=f?-1:2;const O={};this.queue.forEach(F=>{GN(F.loaded,[C],P),o6(F,u),f&&F.errors.push(f),F.pendingCount===0&&!F.done&&(Object.keys(F.loaded).forEach(k=>{O[k]||(O[k]={});const ot=F.loaded[k];ot.length&&ot.forEach(ft=>{O[k][ft]===void 0&&(O[k][ft]=!0)})}),F.done=!0,F.errors.length?F.callback(F.errors):F.callback())}),this.emit("loaded",O),this.queue=this.queue.filter(F=>!F.done)}read(u,f,y){let b=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,C=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.retryTimeout,P=arguments.length>5?arguments[5]:void 0;if(!u.length)return P(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:u,ns:f,fcName:y,tried:b,wait:C,callback:P});return}this.readingCalls++;const O=(k,ot)=>{if(this.readingCalls--,this.waitingReads.length>0){const ft=this.waitingReads.shift();this.read(ft.lng,ft.ns,ft.fcName,ft.tried,ft.wait,ft.callback)}if(k&&ot&&b<this.maxRetries){setTimeout(()=>{this.read.call(this,u,f,y,b+1,C*2,P)},C);return}P(k,ot)},F=this.backend[y].bind(this.backend);if(F.length===2){try{const k=F(u,f);k&&typeof k.then=="function"?k.then(ot=>O(null,ot)).catch(O):O(null,k)}catch(k){O(k)}return}return F(u,f,O)}prepareLoading(u,f){let y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},b=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),b&&b();typeof u=="string"&&(u=this.languageUtils.toResolveHierarchy(u)),typeof f=="string"&&(f=[f]);const C=this.queueLoad(u,f,y,b);if(!C.toLoad.length)return C.pending.length||b(),null;C.toLoad.forEach(P=>{this.loadOne(P)})}load(u,f,y){this.prepareLoading(u,f,{},y)}reload(u,f,y){this.prepareLoading(u,f,{reload:!0},y)}loadOne(u){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const y=u.split("|"),b=y[0],C=y[1];this.read(b,C,"read",void 0,void 0,(P,O)=>{P&&this.logger.warn(`${f}loading namespace ${C} for language ${b} failed`,P),!P&&O&&this.logger.log(`${f}loaded namespace ${C} for language ${b}`,O),this.loaded(u,P,O)})}saveMissing(u,f,y,b,C){let P=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},O=arguments.length>6&&arguments[6]!==void 0?arguments[6]:()=>{};if(this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(f)){this.logger.warn(`did not save key "${y}" as the namespace "${f}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(y==null||y==="")){if(this.backend&&this.backend.create){const F={...P,isUpdate:C},k=this.backend.create.bind(this.backend);if(k.length<6)try{let ot;k.length===5?ot=k(u,f,y,b,F):ot=k(u,f,y,b),ot&&typeof ot.then=="function"?ot.then(ft=>O(null,ft)).catch(O):O(null,ot)}catch(ot){O(ot)}else k(u,f,y,b,O,F)}!u||!u[0]||this.store.addResource(u[0],f,y,b)}}}function dD(){return{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:function(u){let f={};if(typeof u[1]=="object"&&(f=u[1]),typeof u[1]=="string"&&(f.defaultValue=u[1]),typeof u[2]=="string"&&(f.tDescription=u[2]),typeof u[2]=="object"||typeof u[3]=="object"){const y=u[3]||u[2];Object.keys(y).forEach(b=>{f[b]=y[b]})}return f},interpolation:{escapeValue:!0,format:l=>l,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}}function pD(l){return typeof l.ns=="string"&&(l.ns=[l.ns]),typeof l.fallbackLng=="string"&&(l.fallbackLng=[l.fallbackLng]),typeof l.fallbackNS=="string"&&(l.fallbackNS=[l.fallbackNS]),l.supportedLngs&&l.supportedLngs.indexOf("cimode")<0&&(l.supportedLngs=l.supportedLngs.concat(["cimode"])),l}function Ux(){}function a6(l){Object.getOwnPropertyNames(Object.getPrototypeOf(l)).forEach(f=>{typeof l[f]=="function"&&(l[f]=l[f].bind(l))})}class M_ extends Wv{constructor(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},f=arguments.length>1?arguments[1]:void 0;if(super(),this.options=pD(u),this.services={},this.logger=ll,this.modules={external:[]},a6(this),f&&!this.isInitialized&&!u.isClone){if(!this.options.initImmediate)return this.init(u,f),this;setTimeout(()=>{this.init(u,f)},0)}}init(){var u=this;let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},y=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,typeof f=="function"&&(y=f,f={}),!f.defaultNS&&f.defaultNS!==!1&&f.ns&&(typeof f.ns=="string"?f.defaultNS=f.ns:f.ns.indexOf("translation")<0&&(f.defaultNS=f.ns[0]));const b=dD();this.options={...b,...this.options,...pD(f)},this.options.compatibilityAPI!=="v1"&&(this.options.interpolation={...b.interpolation,...this.options.interpolation}),f.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=f.keySeparator),f.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=f.nsSeparator);function C(ot){return ot?typeof ot=="function"?new ot:ot:null}if(!this.options.isClone){this.modules.logger?ll.init(C(this.modules.logger),this.options):ll.init(null,this.options);let ot;this.modules.formatter?ot=this.modules.formatter:typeof Intl<"u"&&(ot=i6);const ft=new cD(this.options);this.store=new lD(this.options.resources,this.options);const X=this.services;X.logger=ll,X.resourceStore=this.store,X.languageUtils=ft,X.pluralResolver=new e6(ft,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),ot&&(!this.options.interpolation.format||this.options.interpolation.format===b.interpolation.format)&&(X.formatter=C(ot),X.formatter.init(X,this.options),this.options.interpolation.format=X.formatter.format.bind(X.formatter)),X.interpolator=new n6(this.options),X.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},X.backendConnector=new s6(C(this.modules.backend),X.resourceStore,X,this.options),X.backendConnector.on("*",function(zt){for(var Lt=arguments.length,Ht=new Array(Lt>1?Lt-1:0),we=1;we<Lt;we++)Ht[we-1]=arguments[we];u.emit(zt,...Ht)}),this.modules.languageDetector&&(X.languageDetector=C(this.modules.languageDetector),X.languageDetector.init&&X.languageDetector.init(X,this.options.detection,this.options)),this.modules.i18nFormat&&(X.i18nFormat=C(this.modules.i18nFormat),X.i18nFormat.init&&X.i18nFormat.init(this)),this.translator=new Mv(this.services,this.options),this.translator.on("*",function(zt){for(var Lt=arguments.length,Ht=new Array(Lt>1?Lt-1:0),we=1;we<Lt;we++)Ht[we-1]=arguments[we];u.emit(zt,...Ht)}),this.modules.external.forEach(zt=>{zt.init&&zt.init(this)})}if(this.format=this.options.interpolation.format,y||(y=Ux),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const ot=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);ot.length>0&&ot[0]!=="dev"&&(this.options.lng=ot[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(ot=>{this[ot]=function(){return u.store[ot](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(ot=>{this[ot]=function(){return u.store[ot](...arguments),u}});const F=$g(),k=()=>{const ot=(ft,X)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),F.resolve(X),y(ft,X)};if(this.languages&&this.options.compatibilityAPI!=="v1"&&!this.isInitialized)return ot(null,this.t.bind(this));this.changeLanguage(this.options.lng,ot)};return this.options.resources||!this.options.initImmediate?k():setTimeout(k,0),F}loadResources(u){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ux;const b=typeof u=="string"?u:this.language;if(typeof u=="function"&&(y=u),!this.options.resources||this.options.partialBundledLanguages){if(b&&b.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return y();const C=[],P=O=>{if(!O||O==="cimode")return;this.services.languageUtils.toResolveHierarchy(O).forEach(k=>{k!=="cimode"&&C.indexOf(k)<0&&C.push(k)})};b?P(b):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(F=>P(F)),this.options.preload&&this.options.preload.forEach(O=>P(O)),this.services.backendConnector.load(C,this.options.ns,O=>{!O&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),y(O)})}else y(null)}reloadResources(u,f,y){const b=$g();return u||(u=this.languages),f||(f=this.options.ns),y||(y=Ux),this.services.backendConnector.reload(u,f,C=>{b.resolve(),y(C)}),b}use(u){if(!u)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!u.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return u.type==="backend"&&(this.modules.backend=u),(u.type==="logger"||u.log&&u.warn&&u.error)&&(this.modules.logger=u),u.type==="languageDetector"&&(this.modules.languageDetector=u),u.type==="i18nFormat"&&(this.modules.i18nFormat=u),u.type==="postProcessor"&&N3.addPostProcessor(u),u.type==="formatter"&&(this.modules.formatter=u),u.type==="3rdParty"&&this.modules.external.push(u),this}setResolvedLanguage(u){if(!(!u||!this.languages)&&!(["cimode","dev"].indexOf(u)>-1))for(let f=0;f<this.languages.length;f++){const y=this.languages[f];if(!(["cimode","dev"].indexOf(y)>-1)&&this.store.hasLanguageSomeTranslations(y)){this.resolvedLanguage=y;break}}}changeLanguage(u,f){var y=this;this.isLanguageChangingTo=u;const b=$g();this.emit("languageChanging",u);const C=F=>{this.language=F,this.languages=this.services.languageUtils.toResolveHierarchy(F),this.resolvedLanguage=void 0,this.setResolvedLanguage(F)},P=(F,k)=>{k?(C(k),this.translator.changeLanguage(k),this.isLanguageChangingTo=void 0,this.emit("languageChanged",k),this.logger.log("languageChanged",k)):this.isLanguageChangingTo=void 0,b.resolve(function(){return y.t(...arguments)}),f&&f(F,function(){return y.t(...arguments)})},O=F=>{!u&&!F&&this.services.languageDetector&&(F=[]);const k=typeof F=="string"?F:this.services.languageUtils.getBestMatchFromCodes(F);k&&(this.language||C(k),this.translator.language||this.translator.changeLanguage(k),this.services.languageDetector&&this.services.languageDetector.cacheUserLanguage&&this.services.languageDetector.cacheUserLanguage(k)),this.loadResources(k,ot=>{P(ot,k)})};return!u&&this.services.languageDetector&&!this.services.languageDetector.async?O(this.services.languageDetector.detect()):!u&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(O):this.services.languageDetector.detect(O):O(u),b}getFixedT(u,f,y){var b=this;const C=function(P,O){let F;if(typeof O!="object"){for(var k=arguments.length,ot=new Array(k>2?k-2:0),ft=2;ft<k;ft++)ot[ft-2]=arguments[ft];F=b.options.overloadTranslationOptionHandler([P,O].concat(ot))}else F={...O};F.lng=F.lng||C.lng,F.lngs=F.lngs||C.lngs,F.ns=F.ns||C.ns,F.keyPrefix=F.keyPrefix||y||C.keyPrefix;const X=b.options.keySeparator||".";let zt;return F.keyPrefix&&Array.isArray(P)?zt=P.map(Lt=>`${F.keyPrefix}${X}${Lt}`):zt=F.keyPrefix?`${F.keyPrefix}${X}${P}`:P,b.t(zt,F)};return typeof u=="string"?C.lng=u:C.lngs=u,C.ns=f,C.keyPrefix=y,C}t(){return this.translator&&this.translator.translate(...arguments)}exists(){return this.translator&&this.translator.exists(...arguments)}setDefaultNamespace(u){this.options.defaultNS=u}hasLoadedNamespace(u){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const y=f.lng||this.resolvedLanguage||this.languages[0],b=this.options?this.options.fallbackLng:!1,C=this.languages[this.languages.length-1];if(y.toLowerCase()==="cimode")return!0;const P=(O,F)=>{const k=this.services.backendConnector.state[`${O}|${F}`];return k===-1||k===2};if(f.precheck){const O=f.precheck(this,P);if(O!==void 0)return O}return!!(this.hasResourceBundle(y,u)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||P(y,u)&&(!b||P(C,u)))}loadNamespaces(u,f){const y=$g();return this.options.ns?(typeof u=="string"&&(u=[u]),u.forEach(b=>{this.options.ns.indexOf(b)<0&&this.options.ns.push(b)}),this.loadResources(b=>{y.resolve(),f&&f(b)}),y):(f&&f(),Promise.resolve())}loadLanguages(u,f){const y=$g();typeof u=="string"&&(u=[u]);const b=this.options.preload||[],C=u.filter(P=>b.indexOf(P)<0);return C.length?(this.options.preload=b.concat(C),this.loadResources(P=>{y.resolve(),f&&f(P)}),y):(f&&f(),Promise.resolve())}dir(u){if(u||(u=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!u)return"rtl";const f=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],y=this.services&&this.services.languageUtils||new cD(dD());return f.indexOf(y.getLanguagePartFromCode(u))>-1||u.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},f=arguments.length>1?arguments[1]:void 0;return new M_(u,f)}cloneInstance(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ux;const y=u.forkResourceStore;y&&delete u.forkResourceStore;const b={...this.options,...u,isClone:!0},C=new M_(b);return(u.debug!==void 0||u.prefix!==void 0)&&(C.logger=C.logger.clone(u)),["store","services","language"].forEach(O=>{C[O]=this[O]}),C.services={...this.services},C.services.utils={hasLoadedNamespace:C.hasLoadedNamespace.bind(C)},y&&(C.store=new lD(this.store.data,b),C.services.resourceStore=C.store),C.translator=new Mv(C.services,b),C.translator.on("*",function(O){for(var F=arguments.length,k=new Array(F>1?F-1:0),ot=1;ot<F;ot++)k[ot-1]=arguments[ot];C.emit(O,...k)}),C.init(b,f),C.translator.options=b,C.translator.backendConnector.services.utils={hasLoadedNamespace:C.hasLoadedNamespace.bind(C)},C}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const oi=M_.createInstance();oi.createInstance=M_.createInstance;oi.createInstance;oi.dir;oi.init;oi.loadResources;oi.reloadResources;oi.use;oi.changeLanguage;oi.getFixedT;oi.t;oi.exists;oi.setDefaultNamespace;oi.hasLoadedNamespace;oi.loadNamespaces;oi.loadLanguages;const l6=(l,u)=>{if(!u)return l;const f=mn.toLower(u.replace(/[^a-z0-9]/gi,""));return mn.filter(l,y=>{const b=[mn.toLower(y.route_number),mn.toLower(y.routings_en),mn.toLower(y.routings_kn),mn.toLower(y.from_en),mn.toLower(y.to_en),mn.toLower(y.from_kn),mn.toLower(y.to_kn),...mn.map(y.metroDetails,C=>mn.toLower(C.name))];return mn.some(b,C=>mn.includes(C.replace(/[^a-z0-9]/gi,""),f))})},u6=({t:l,busData:u,setSelectedBus:f})=>{const{language:y}=oi,[b,C]=Pr.useState(""),P=Pr.useRef(null),O=l6(u,b);return un.jsxs(un.Fragment,{children:[un.jsx("div",{id:"page-heading",children:l("title")}),un.jsxs("div",{id:"search-input-wrapper",children:[un.jsx("input",{id:"search-input",type:"text",placeholder:l("search"),ref:P,value:b,onChange:F=>C(F.target.value)}),b?un.jsx("span",{className:"material-symbols-outlined",onClick:()=>C(""),children:"close"}):un.jsx("span",{className:"material-symbols-outlined",onClick:()=>P.current.focus(),children:"search"})]}),un.jsx("ul",{children:mn.map(O,F=>un.jsxs("li",{id:`bus-item-${F.route_number}`,className:"bus-item",onClick:()=>f(F.route_number),children:[un.jsx("h4",{className:"bus-item-name",children:F.route_number}),un.jsxs("p",{className:"bus-item-route",children:[F[`from_${y}`]," - ",F[`to_${y}`]]}),un.jsxs("p",{className:"bus-item-description",children:["Via ",F[`routings_${y}`]]})]},F.route_number))})]})},c6=z3()(u6),h6=({line:l})=>{if(l==="green")return un.jsx("span",{className:"metro-line-icon green",children:"M"});if(l==="purple")return un.jsx("span",{className:"metro-line-icon purple",children:"M"})},f6=({metroDetails:l})=>{const{language:u}=oi;return un.jsx("p",{children:mn.map(l,f=>un.jsxs("span",{className:"metro-list-item",children:[un.jsx(h6,{line:f.line}),f[`name_${u}`]]},f.name_en))})},d6=({busData:l,selectedBus:u,setSelectedBus:f,t:y})=>{const b=mn.find(l,{route_number:u}),{route_number:C,timings_from:P,timings_to:O,metroDetails:F}=b,{language:k}=oi;return un.jsxs(un.Fragment,{children:[un.jsxs("div",{id:"page-heading",children:[un.jsx("button",{id:"btn-back",onClick:()=>f(""),children:un.jsx("span",{className:"material-symbols-outlined",children:"arrow_back"})}),C]}),un.jsxs("div",{id:"selected-bus-content",children:[un.jsxs("p",{id:"fromto",children:[un.jsxs("span",{className:"fromto-text",children:[y("from"),":"]})," ",b[`from_${k}`]," ",un.jsx("br",{}),un.jsxs("span",{className:"fromto-text",children:[y("to"),":"]})," ",b[`to_${k}`]]}),un.jsxs("p",{id:"routings",children:[y("via"),": ",b[`routings_${k}`]]}),mn.size(F)>0&&un.jsxs(un.Fragment,{children:[un.jsx("h4",{children:y("metros")}),un.jsx(f6,{metroDetails:F})]}),un.jsx("h4",{children:oi.t("start_times",{station:b[`from_${k}`]})}),mn.map(P,ot=>un.jsx("div",{className:"time",children:ot},ot)),mn.size(O)>0&&un.jsxs(un.Fragment,{children:[un.jsx("h4",{children:oi.t("start_times",{station:b[`to_${k}`]})}),mn.map(O,ot=>un.jsx("div",{className:"time",children:ot},ot))]})]})]})},p6=z3()(d6),mD="localStorage"in window&&window.localStorage!==null,gD={getItem:l=>mD?localStorage.getItem(l):null,setItem:(l,u)=>{mD&&localStorage.setItem(l,u)}};function m6(){const[l,u]=Pr.useState(""),[f,y]=Pr.useState(gD.getItem("lang")||aN[0].code),b=Pr.useRef();return Pr.useEffect(()=>{const P=new URLSearchParams(window.location.search).get("q");P&&!l&&mn.some(Jg,{route_number:P})&&u(P)},[]),Pr.useEffect(()=>{gD.setItem("lang",f),document.documentElement.setAttribute("lang",f),oi.changeLanguage(f)},[f]),Pr.useEffect(()=>{const C=new URLSearchParams(window.location.search),P=C.get("q"),{origin:O,pathname:F}=window.location;if(l&&P!==l){C.set("q",l||Jg[0].route_number);const ot=O+F+"?"+C.toString();window.history.pushState({path:ot},"",ot)}else if(!l){const ot=O+F;window.history.pushState({path:ot},"",ot)}const k=document.getElementById(`bus-item-${l}`);k&&!nN(k)&&k.scrollIntoView({behavior:"smooth"})},[l]),un.jsxs(un.Fragment,{children:[un.jsx("div",{id:"sidebar",children:l?un.jsx(p6,{selectedBus:l,setSelectedBus:u,busData:Jg}):un.jsx(c6,{busData:Jg,setSelectedBus:u})}),un.jsx(vN,{lang:f,setLang:y,mapRef:b,busData:Jg,selectedBus:l,setSelectedBus:u})]})}const g6={search:", ,    ",title:"BMTC   ",metros:"   ",from:"",to:"",via:"",start_times:"{{station}}   "},_6={search:"Search by name, stops, and other info",title:"BMTC Metro Feeder Info",metros:"Metro stations on this route",from:"From",to:"To",via:"Via",start_times:"Start time from {{station}}"};oi.use(LN).init({resources:{en:{translation:_6},kn:{translation:g6}},fallbackLng:"en",debug:!1,interpolation:{escapeValue:!1},react:{useSuspense:!1}});nE.createRoot(document.getElementById("root")).render(un.jsx(Vz.StrictMode,{children:un.jsx(m6,{})}));
